var Ob=Object.defineProperty;var Lb=(t,e,n)=>e in t?Ob(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var C=(t,e,n)=>(Lb(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var Db=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vp(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var fE={exports:{}},Ae={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Za=Symbol.for("react.element"),Fb=Symbol.for("react.portal"),Bb=Symbol.for("react.fragment"),Ub=Symbol.for("react.strict_mode"),zb=Symbol.for("react.profiler"),Vb=Symbol.for("react.provider"),Wb=Symbol.for("react.context"),Hb=Symbol.for("react.forward_ref"),jb=Symbol.for("react.suspense"),$b=Symbol.for("react.memo"),Xb=Symbol.for("react.lazy"),jm=Symbol.iterator;function Yb(t){return t===null||typeof t!="object"?null:(t=jm&&t[jm]||t["@@iterator"],typeof t=="function"?t:null)}var dE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},gE=Object.assign,pE={};function po(t,e,n){this.props=t,this.context=e,this.refs=pE,this.updater=n||dE}po.prototype.isReactComponent={};po.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};po.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function _E(){}_E.prototype=po.prototype;function Ep(t,e,n){this.props=t,this.context=e,this.refs=pE,this.updater=n||dE}var wp=Ep.prototype=new _E;wp.constructor=Ep;gE(wp,po.prototype);wp.isPureReactComponent=!0;var $m=Array.isArray,mE=Object.prototype.hasOwnProperty,Tp={current:null},yE={key:!0,ref:!0,__self:!0,__source:!0};function vE(t,e,n){var i,r={},s=null,l=null;if(e!=null)for(i in e.ref!==void 0&&(l=e.ref),e.key!==void 0&&(s=""+e.key),e)mE.call(e,i)&&!yE.hasOwnProperty(i)&&(r[i]=e[i]);var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){for(var f=Array(u),d=0;d<u;d++)f[d]=arguments[d+2];r.children=f}if(t&&t.defaultProps)for(i in u=t.defaultProps,u)r[i]===void 0&&(r[i]=u[i]);return{$$typeof:Za,type:t,key:s,ref:l,props:r,_owner:Tp.current}}function qb(t,e){return{$$typeof:Za,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Sp(t){return typeof t=="object"&&t!==null&&t.$$typeof===Za}function Kb(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Xm=/\/+/g;function nf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Kb(""+t.key):e.toString(36)}function pu(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var l=!1;if(t===null)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case Za:case Fb:l=!0}}if(l)return l=t,r=r(l),t=i===""?"."+nf(l,0):i,$m(r)?(n="",t!=null&&(n=t.replace(Xm,"$&/")+"/"),pu(r,e,n,"",function(d){return d})):r!=null&&(Sp(r)&&(r=qb(r,n+(!r.key||l&&l.key===r.key?"":(""+r.key).replace(Xm,"$&/")+"/")+t)),e.push(r)),1;if(l=0,i=i===""?".":i+":",$m(t))for(var u=0;u<t.length;u++){s=t[u];var f=i+nf(s,u);l+=pu(s,e,n,f,r)}else if(f=Yb(t),typeof f=="function")for(t=f.call(t),u=0;!(s=t.next()).done;)s=s.value,f=i+nf(s,u++),l+=pu(s,e,n,f,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function Tl(t,e,n){if(t==null)return t;var i=[],r=0;return pu(t,i,"","",function(s){return e.call(n,s,r++)}),i}function Gb(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Vt={current:null},_u={transition:null},Zb={ReactCurrentDispatcher:Vt,ReactCurrentBatchConfig:_u,ReactCurrentOwner:Tp};function EE(){throw Error("act(...) is not supported in production builds of React.")}Ae.Children={map:Tl,forEach:function(t,e,n){Tl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Tl(t,function(){e++}),e},toArray:function(t){return Tl(t,function(e){return e})||[]},only:function(t){if(!Sp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ae.Component=po;Ae.Fragment=Bb;Ae.Profiler=zb;Ae.PureComponent=Ep;Ae.StrictMode=Ub;Ae.Suspense=jb;Ae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zb;Ae.act=EE;Ae.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=gE({},t.props),r=t.key,s=t.ref,l=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,l=Tp.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var u=t.type.defaultProps;for(f in e)mE.call(e,f)&&!yE.hasOwnProperty(f)&&(i[f]=e[f]===void 0&&u!==void 0?u[f]:e[f])}var f=arguments.length-2;if(f===1)i.children=n;else if(1<f){u=Array(f);for(var d=0;d<f;d++)u[d]=arguments[d+2];i.children=u}return{$$typeof:Za,type:t.type,key:r,ref:s,props:i,_owner:l}};Ae.createContext=function(t){return t={$$typeof:Wb,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Vb,_context:t},t.Consumer=t};Ae.createElement=vE;Ae.createFactory=function(t){var e=vE.bind(null,t);return e.type=t,e};Ae.createRef=function(){return{current:null}};Ae.forwardRef=function(t){return{$$typeof:Hb,render:t}};Ae.isValidElement=Sp;Ae.lazy=function(t){return{$$typeof:Xb,_payload:{_status:-1,_result:t},_init:Gb}};Ae.memo=function(t,e){return{$$typeof:$b,type:t,compare:e===void 0?null:e}};Ae.startTransition=function(t){var e=_u.transition;_u.transition={};try{t()}finally{_u.transition=e}};Ae.unstable_act=EE;Ae.useCallback=function(t,e){return Vt.current.useCallback(t,e)};Ae.useContext=function(t){return Vt.current.useContext(t)};Ae.useDebugValue=function(){};Ae.useDeferredValue=function(t){return Vt.current.useDeferredValue(t)};Ae.useEffect=function(t,e){return Vt.current.useEffect(t,e)};Ae.useId=function(){return Vt.current.useId()};Ae.useImperativeHandle=function(t,e,n){return Vt.current.useImperativeHandle(t,e,n)};Ae.useInsertionEffect=function(t,e){return Vt.current.useInsertionEffect(t,e)};Ae.useLayoutEffect=function(t,e){return Vt.current.useLayoutEffect(t,e)};Ae.useMemo=function(t,e){return Vt.current.useMemo(t,e)};Ae.useReducer=function(t,e,n){return Vt.current.useReducer(t,e,n)};Ae.useRef=function(t){return Vt.current.useRef(t)};Ae.useState=function(t){return Vt.current.useState(t)};Ae.useSyncExternalStore=function(t,e,n){return Vt.current.useSyncExternalStore(t,e,n)};Ae.useTransition=function(){return Vt.current.useTransition()};Ae.version="18.3.1";fE.exports=Ae;var re=fE.exports;const Ce=vp(re);var wE={exports:{}},an={},TE={exports:{}},SE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(H,Z){var te=H.length;H.push(Z);e:for(;0<te;){var ie=te-1>>>1,ce=H[ie];if(0<r(ce,Z))H[ie]=Z,H[te]=ce,te=ie;else break e}}function n(H){return H.length===0?null:H[0]}function i(H){if(H.length===0)return null;var Z=H[0],te=H.pop();if(te!==Z){H[0]=te;e:for(var ie=0,ce=H.length,Ee=ce>>>1;ie<Ee;){var he=2*(ie+1)-1,ye=H[he],xe=he+1,Xe=H[xe];if(0>r(ye,te))xe<ce&&0>r(Xe,ye)?(H[ie]=Xe,H[xe]=te,ie=xe):(H[ie]=ye,H[he]=te,ie=he);else if(xe<ce&&0>r(Xe,te))H[ie]=Xe,H[xe]=te,ie=xe;else break e}}return Z}function r(H,Z){var te=H.sortIndex-Z.sortIndex;return te!==0?te:H.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var l=Date,u=l.now();t.unstable_now=function(){return l.now()-u}}var f=[],d=[],p=1,_=null,y=3,E=!1,T=!1,k=!1,M=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function A(H){for(var Z=n(d);Z!==null;){if(Z.callback===null)i(d);else if(Z.startTime<=H)i(d),Z.sortIndex=Z.expirationTime,e(f,Z);else break;Z=n(d)}}function N(H){if(k=!1,A(H),!T)if(n(f)!==null)T=!0,$(D);else{var Z=n(d);Z!==null&&G(N,Z.startTime-H)}}function D(H,Z){T=!1,k&&(k=!1,b(x),x=-1),E=!0;var te=y;try{for(A(Z),_=n(f);_!==null&&(!(_.expirationTime>Z)||H&&!U());){var ie=_.callback;if(typeof ie=="function"){_.callback=null,y=_.priorityLevel;var ce=ie(_.expirationTime<=Z);Z=t.unstable_now(),typeof ce=="function"?_.callback=ce:_===n(f)&&i(f),A(Z)}else i(f);_=n(f)}if(_!==null)var Ee=!0;else{var he=n(d);he!==null&&G(N,he.startTime-Z),Ee=!1}return Ee}finally{_=null,y=te,E=!1}}var W=!1,K=null,x=-1,R=5,P=-1;function U(){return!(t.unstable_now()-P<R)}function F(){if(K!==null){var H=t.unstable_now();P=H;var Z=!0;try{Z=K(!0,H)}finally{Z?z():(W=!1,K=null)}}else W=!1}var z;if(typeof w=="function")z=function(){w(F)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,V=B.port2;B.port1.onmessage=F,z=function(){V.postMessage(null)}}else z=function(){M(F,0)};function $(H){K=H,W||(W=!0,z())}function G(H,Z){x=M(function(){H(t.unstable_now())},Z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(H){H.callback=null},t.unstable_continueExecution=function(){T||E||(T=!0,$(D))},t.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<H?Math.floor(1e3/H):5},t.unstable_getCurrentPriorityLevel=function(){return y},t.unstable_getFirstCallbackNode=function(){return n(f)},t.unstable_next=function(H){switch(y){case 1:case 2:case 3:var Z=3;break;default:Z=y}var te=y;y=Z;try{return H()}finally{y=te}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(H,Z){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var te=y;y=H;try{return Z()}finally{y=te}},t.unstable_scheduleCallback=function(H,Z,te){var ie=t.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?ie+te:ie):te=ie,H){case 1:var ce=-1;break;case 2:ce=250;break;case 5:ce=1073741823;break;case 4:ce=1e4;break;default:ce=5e3}return ce=te+ce,H={id:p++,callback:Z,priorityLevel:H,startTime:te,expirationTime:ce,sortIndex:-1},te>ie?(H.sortIndex=te,e(d,H),n(f)===null&&H===n(d)&&(k?(b(x),x=-1):k=!0,G(N,te-ie))):(H.sortIndex=ce,e(f,H),T||E||(T=!0,$(D))),H},t.unstable_shouldYield=U,t.unstable_wrapCallback=function(H){var Z=y;return function(){var te=y;y=Z;try{return H.apply(this,arguments)}finally{y=te}}}})(SE);TE.exports=SE;var Qb=TE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jb=re,on=Qb;function se(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var xE=new Set,Ta={};function Kr(t,e){Ys(t,e),Ys(t+"Capture",e)}function Ys(t,e){for(Ta[t]=e,t=0;t<e.length;t++)xE.add(e[t])}var Ei=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wd=Object.prototype.hasOwnProperty,eR=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ym={},qm={};function tR(t){return wd.call(qm,t)?!0:wd.call(Ym,t)?!1:eR.test(t)?qm[t]=!0:(Ym[t]=!0,!1)}function nR(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function iR(t,e,n,i){if(e===null||typeof e>"u"||nR(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Wt(t,e,n,i,r,s,l){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=l}var Ct={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ct[t]=new Wt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ct[e]=new Wt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ct[t]=new Wt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ct[t]=new Wt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ct[t]=new Wt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ct[t]=new Wt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ct[t]=new Wt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ct[t]=new Wt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ct[t]=new Wt(t,5,!1,t.toLowerCase(),null,!1,!1)});var xp=/[\-:]([a-z])/g;function Ap(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(xp,Ap);Ct[e]=new Wt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(xp,Ap);Ct[e]=new Wt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(xp,Ap);Ct[e]=new Wt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ct[t]=new Wt(t,1,!1,t.toLowerCase(),null,!1,!1)});Ct.xlinkHref=new Wt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ct[t]=new Wt(t,1,!1,t.toLowerCase(),null,!0,!0)});function bp(t,e,n,i){var r=Ct.hasOwnProperty(e)?Ct[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(iR(e,n,r,i)&&(n=null),i||r===null?tR(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var bi=Jb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Sl=Symbol.for("react.element"),vs=Symbol.for("react.portal"),Es=Symbol.for("react.fragment"),Rp=Symbol.for("react.strict_mode"),Td=Symbol.for("react.profiler"),AE=Symbol.for("react.provider"),bE=Symbol.for("react.context"),Cp=Symbol.for("react.forward_ref"),Sd=Symbol.for("react.suspense"),xd=Symbol.for("react.suspense_list"),kp=Symbol.for("react.memo"),Di=Symbol.for("react.lazy"),RE=Symbol.for("react.offscreen"),Km=Symbol.iterator;function Po(t){return t===null||typeof t!="object"?null:(t=Km&&t[Km]||t["@@iterator"],typeof t=="function"?t:null)}var rt=Object.assign,rf;function Xo(t){if(rf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);rf=e&&e[1]||""}return`
`+rf+t}var sf=!1;function of(t,e){if(!t||sf)return"";sf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var i=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){i=d}t.call(e.prototype)}else{try{throw Error()}catch(d){i=d}t()}}catch(d){if(d&&i&&typeof d.stack=="string"){for(var r=d.stack.split(`
`),s=i.stack.split(`
`),l=r.length-1,u=s.length-1;1<=l&&0<=u&&r[l]!==s[u];)u--;for(;1<=l&&0<=u;l--,u--)if(r[l]!==s[u]){if(l!==1||u!==1)do if(l--,u--,0>u||r[l]!==s[u]){var f=`
`+r[l].replace(" at new "," at ");return t.displayName&&f.includes("<anonymous>")&&(f=f.replace("<anonymous>",t.displayName)),f}while(1<=l&&0<=u);break}}}finally{sf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Xo(t):""}function rR(t){switch(t.tag){case 5:return Xo(t.type);case 16:return Xo("Lazy");case 13:return Xo("Suspense");case 19:return Xo("SuspenseList");case 0:case 2:case 15:return t=of(t.type,!1),t;case 11:return t=of(t.type.render,!1),t;case 1:return t=of(t.type,!0),t;default:return""}}function Ad(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Es:return"Fragment";case vs:return"Portal";case Td:return"Profiler";case Rp:return"StrictMode";case Sd:return"Suspense";case xd:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case bE:return(t.displayName||"Context")+".Consumer";case AE:return(t._context.displayName||"Context")+".Provider";case Cp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case kp:return e=t.displayName||null,e!==null?e:Ad(t.type)||"Memo";case Di:e=t._payload,t=t._init;try{return Ad(t(e))}catch{}}return null}function sR(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ad(e);case 8:return e===Rp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function sr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function CE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function oR(t){var e=CE(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(l){i=""+l,s.call(this,l)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(l){i=""+l},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function xl(t){t._valueTracker||(t._valueTracker=oR(t))}function kE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=CE(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function zu(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function bd(t,e){var n=e.checked;return rt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Gm(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=sr(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function IE(t,e){e=e.checked,e!=null&&bp(t,"checked",e,!1)}function Rd(t,e){IE(t,e);var n=sr(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Cd(t,e.type,n):e.hasOwnProperty("defaultValue")&&Cd(t,e.type,sr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Zm(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Cd(t,e,n){(e!=="number"||zu(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Yo=Array.isArray;function Fs(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+sr(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function kd(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(se(91));return rt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Qm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(se(92));if(Yo(n)){if(1<n.length)throw Error(se(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:sr(n)}}function PE(t,e){var n=sr(e.value),i=sr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function Jm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function NE(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Id(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?NE(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Al,ME=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Al=Al||document.createElement("div"),Al.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Al.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Sa(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var sa={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},aR=["Webkit","ms","Moz","O"];Object.keys(sa).forEach(function(t){aR.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),sa[e]=sa[t]})});function OE(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||sa.hasOwnProperty(t)&&sa[t]?(""+e).trim():e+"px"}function LE(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=OE(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var lR=rt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Pd(t,e){if(e){if(lR[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(se(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(se(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(se(61))}if(e.style!=null&&typeof e.style!="object")throw Error(se(62))}}function Nd(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Md=null;function Ip(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Od=null,Bs=null,Us=null;function ey(t){if(t=el(t)){if(typeof Od!="function")throw Error(se(280));var e=t.stateNode;e&&(e=hh(e),Od(t.stateNode,t.type,e))}}function DE(t){Bs?Us?Us.push(t):Us=[t]:Bs=t}function FE(){if(Bs){var t=Bs,e=Us;if(Us=Bs=null,ey(t),e)for(t=0;t<e.length;t++)ey(e[t])}}function BE(t,e){return t(e)}function UE(){}var af=!1;function zE(t,e,n){if(af)return t(e,n);af=!0;try{return BE(t,e,n)}finally{af=!1,(Bs!==null||Us!==null)&&(UE(),FE())}}function xa(t,e){var n=t.stateNode;if(n===null)return null;var i=hh(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(se(231,e,typeof n));return n}var Ld=!1;if(Ei)try{var No={};Object.defineProperty(No,"passive",{get:function(){Ld=!0}}),window.addEventListener("test",No,No),window.removeEventListener("test",No,No)}catch{Ld=!1}function uR(t,e,n,i,r,s,l,u,f){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(p){this.onError(p)}}var oa=!1,Vu=null,Wu=!1,Dd=null,cR={onError:function(t){oa=!0,Vu=t}};function hR(t,e,n,i,r,s,l,u,f){oa=!1,Vu=null,uR.apply(cR,arguments)}function fR(t,e,n,i,r,s,l,u,f){if(hR.apply(this,arguments),oa){if(oa){var d=Vu;oa=!1,Vu=null}else throw Error(se(198));Wu||(Wu=!0,Dd=d)}}function Gr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function VE(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ty(t){if(Gr(t)!==t)throw Error(se(188))}function dR(t){var e=t.alternate;if(!e){if(e=Gr(t),e===null)throw Error(se(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return ty(r),t;if(s===i)return ty(r),e;s=s.sibling}throw Error(se(188))}if(n.return!==i.return)n=r,i=s;else{for(var l=!1,u=r.child;u;){if(u===n){l=!0,n=r,i=s;break}if(u===i){l=!0,i=r,n=s;break}u=u.sibling}if(!l){for(u=s.child;u;){if(u===n){l=!0,n=s,i=r;break}if(u===i){l=!0,i=s,n=r;break}u=u.sibling}if(!l)throw Error(se(189))}}if(n.alternate!==i)throw Error(se(190))}if(n.tag!==3)throw Error(se(188));return n.stateNode.current===n?t:e}function WE(t){return t=dR(t),t!==null?HE(t):null}function HE(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=HE(t);if(e!==null)return e;t=t.sibling}return null}var jE=on.unstable_scheduleCallback,ny=on.unstable_cancelCallback,gR=on.unstable_shouldYield,pR=on.unstable_requestPaint,lt=on.unstable_now,_R=on.unstable_getCurrentPriorityLevel,Pp=on.unstable_ImmediatePriority,$E=on.unstable_UserBlockingPriority,Hu=on.unstable_NormalPriority,mR=on.unstable_LowPriority,XE=on.unstable_IdlePriority,ah=null,ni=null;function yR(t){if(ni&&typeof ni.onCommitFiberRoot=="function")try{ni.onCommitFiberRoot(ah,t,void 0,(t.current.flags&128)===128)}catch{}}var Fn=Math.clz32?Math.clz32:wR,vR=Math.log,ER=Math.LN2;function wR(t){return t>>>=0,t===0?32:31-(vR(t)/ER|0)|0}var bl=64,Rl=4194304;function qo(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ju(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,l=n&268435455;if(l!==0){var u=l&~r;u!==0?i=qo(u):(s&=l,s!==0&&(i=qo(s)))}else l=n&~r,l!==0?i=qo(l):s!==0&&(i=qo(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Fn(e),r=1<<n,i|=t[n],e&=~r;return i}function TR(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function SR(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var l=31-Fn(s),u=1<<l,f=r[l];f===-1?(!(u&n)||u&i)&&(r[l]=TR(u,e)):f<=e&&(t.expiredLanes|=u),s&=~u}}function Fd(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function YE(){var t=bl;return bl<<=1,!(bl&4194240)&&(bl=64),t}function lf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Qa(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Fn(e),t[e]=n}function xR(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Fn(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Np(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Fn(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var Fe=0;function qE(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var KE,Mp,GE,ZE,QE,Bd=!1,Cl=[],Gi=null,Zi=null,Qi=null,Aa=new Map,ba=new Map,Vi=[],AR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function iy(t,e){switch(t){case"focusin":case"focusout":Gi=null;break;case"dragenter":case"dragleave":Zi=null;break;case"mouseover":case"mouseout":Qi=null;break;case"pointerover":case"pointerout":Aa.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ba.delete(e.pointerId)}}function Mo(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=el(e),e!==null&&Mp(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function bR(t,e,n,i,r){switch(e){case"focusin":return Gi=Mo(Gi,t,e,n,i,r),!0;case"dragenter":return Zi=Mo(Zi,t,e,n,i,r),!0;case"mouseover":return Qi=Mo(Qi,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Aa.set(s,Mo(Aa.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,ba.set(s,Mo(ba.get(s)||null,t,e,n,i,r)),!0}return!1}function JE(t){var e=kr(t.target);if(e!==null){var n=Gr(e);if(n!==null){if(e=n.tag,e===13){if(e=VE(n),e!==null){t.blockedOn=e,QE(t.priority,function(){GE(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function mu(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Ud(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Md=i,n.target.dispatchEvent(i),Md=null}else return e=el(n),e!==null&&Mp(e),t.blockedOn=n,!1;e.shift()}return!0}function ry(t,e,n){mu(t)&&n.delete(e)}function RR(){Bd=!1,Gi!==null&&mu(Gi)&&(Gi=null),Zi!==null&&mu(Zi)&&(Zi=null),Qi!==null&&mu(Qi)&&(Qi=null),Aa.forEach(ry),ba.forEach(ry)}function Oo(t,e){t.blockedOn===e&&(t.blockedOn=null,Bd||(Bd=!0,on.unstable_scheduleCallback(on.unstable_NormalPriority,RR)))}function Ra(t){function e(r){return Oo(r,t)}if(0<Cl.length){Oo(Cl[0],t);for(var n=1;n<Cl.length;n++){var i=Cl[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Gi!==null&&Oo(Gi,t),Zi!==null&&Oo(Zi,t),Qi!==null&&Oo(Qi,t),Aa.forEach(e),ba.forEach(e),n=0;n<Vi.length;n++)i=Vi[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Vi.length&&(n=Vi[0],n.blockedOn===null);)JE(n),n.blockedOn===null&&Vi.shift()}var zs=bi.ReactCurrentBatchConfig,$u=!0;function CR(t,e,n,i){var r=Fe,s=zs.transition;zs.transition=null;try{Fe=1,Op(t,e,n,i)}finally{Fe=r,zs.transition=s}}function kR(t,e,n,i){var r=Fe,s=zs.transition;zs.transition=null;try{Fe=4,Op(t,e,n,i)}finally{Fe=r,zs.transition=s}}function Op(t,e,n,i){if($u){var r=Ud(t,e,n,i);if(r===null)yf(t,e,i,Xu,n),iy(t,i);else if(bR(r,t,e,n,i))i.stopPropagation();else if(iy(t,i),e&4&&-1<AR.indexOf(t)){for(;r!==null;){var s=el(r);if(s!==null&&KE(s),s=Ud(t,e,n,i),s===null&&yf(t,e,i,Xu,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else yf(t,e,i,null,n)}}var Xu=null;function Ud(t,e,n,i){if(Xu=null,t=Ip(i),t=kr(t),t!==null)if(e=Gr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=VE(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Xu=t,null}function ew(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_R()){case Pp:return 1;case $E:return 4;case Hu:case mR:return 16;case XE:return 536870912;default:return 16}default:return 16}}var Hi=null,Lp=null,yu=null;function tw(){if(yu)return yu;var t,e=Lp,n=e.length,i,r="value"in Hi?Hi.value:Hi.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var l=n-t;for(i=1;i<=l&&e[n-i]===r[s-i];i++);return yu=r.slice(t,1<i?1-i:void 0)}function vu(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function kl(){return!0}function sy(){return!1}function ln(t){function e(n,i,r,s,l){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=l,this.currentTarget=null;for(var u in t)t.hasOwnProperty(u)&&(n=t[u],this[u]=n?n(s):s[u]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?kl:sy,this.isPropagationStopped=sy,this}return rt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=kl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=kl)},persist:function(){},isPersistent:kl}),e}var _o={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Dp=ln(_o),Ja=rt({},_o,{view:0,detail:0}),IR=ln(Ja),uf,cf,Lo,lh=rt({},Ja,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Lo&&(Lo&&t.type==="mousemove"?(uf=t.screenX-Lo.screenX,cf=t.screenY-Lo.screenY):cf=uf=0,Lo=t),uf)},movementY:function(t){return"movementY"in t?t.movementY:cf}}),oy=ln(lh),PR=rt({},lh,{dataTransfer:0}),NR=ln(PR),MR=rt({},Ja,{relatedTarget:0}),hf=ln(MR),OR=rt({},_o,{animationName:0,elapsedTime:0,pseudoElement:0}),LR=ln(OR),DR=rt({},_o,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),FR=ln(DR),BR=rt({},_o,{data:0}),ay=ln(BR),UR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},VR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function WR(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=VR[t])?!!e[t]:!1}function Fp(){return WR}var HR=rt({},Ja,{key:function(t){if(t.key){var e=UR[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=vu(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?zR[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fp,charCode:function(t){return t.type==="keypress"?vu(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?vu(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),jR=ln(HR),$R=rt({},lh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ly=ln($R),XR=rt({},Ja,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fp}),YR=ln(XR),qR=rt({},_o,{propertyName:0,elapsedTime:0,pseudoElement:0}),KR=ln(qR),GR=rt({},lh,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),ZR=ln(GR),QR=[9,13,27,32],Bp=Ei&&"CompositionEvent"in window,aa=null;Ei&&"documentMode"in document&&(aa=document.documentMode);var JR=Ei&&"TextEvent"in window&&!aa,nw=Ei&&(!Bp||aa&&8<aa&&11>=aa),uy=String.fromCharCode(32),cy=!1;function iw(t,e){switch(t){case"keyup":return QR.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rw(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ws=!1;function eC(t,e){switch(t){case"compositionend":return rw(e);case"keypress":return e.which!==32?null:(cy=!0,uy);case"textInput":return t=e.data,t===uy&&cy?null:t;default:return null}}function tC(t,e){if(ws)return t==="compositionend"||!Bp&&iw(t,e)?(t=tw(),yu=Lp=Hi=null,ws=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return nw&&e.locale!=="ko"?null:e.data;default:return null}}var nC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!nC[t.type]:e==="textarea"}function sw(t,e,n,i){DE(i),e=Yu(e,"onChange"),0<e.length&&(n=new Dp("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var la=null,Ca=null;function iC(t){_w(t,0)}function uh(t){var e=xs(t);if(kE(e))return t}function rC(t,e){if(t==="change")return e}var ow=!1;if(Ei){var ff;if(Ei){var df="oninput"in document;if(!df){var fy=document.createElement("div");fy.setAttribute("oninput","return;"),df=typeof fy.oninput=="function"}ff=df}else ff=!1;ow=ff&&(!document.documentMode||9<document.documentMode)}function dy(){la&&(la.detachEvent("onpropertychange",aw),Ca=la=null)}function aw(t){if(t.propertyName==="value"&&uh(Ca)){var e=[];sw(e,Ca,t,Ip(t)),zE(iC,e)}}function sC(t,e,n){t==="focusin"?(dy(),la=e,Ca=n,la.attachEvent("onpropertychange",aw)):t==="focusout"&&dy()}function oC(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return uh(Ca)}function aC(t,e){if(t==="click")return uh(e)}function lC(t,e){if(t==="input"||t==="change")return uh(e)}function uC(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var zn=typeof Object.is=="function"?Object.is:uC;function ka(t,e){if(zn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!wd.call(e,r)||!zn(t[r],e[r]))return!1}return!0}function gy(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function py(t,e){var n=gy(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=gy(n)}}function lw(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?lw(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function uw(){for(var t=window,e=zu();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=zu(t.document)}return e}function Up(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function cC(t){var e=uw(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&lw(n.ownerDocument.documentElement,n)){if(i!==null&&Up(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=py(n,s);var l=py(n,i);r&&l&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==l.node||t.focusOffset!==l.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(l.node,l.offset)):(e.setEnd(l.node,l.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var hC=Ei&&"documentMode"in document&&11>=document.documentMode,Ts=null,zd=null,ua=null,Vd=!1;function _y(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Vd||Ts==null||Ts!==zu(i)||(i=Ts,"selectionStart"in i&&Up(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),ua&&ka(ua,i)||(ua=i,i=Yu(zd,"onSelect"),0<i.length&&(e=new Dp("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Ts)))}function Il(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ss={animationend:Il("Animation","AnimationEnd"),animationiteration:Il("Animation","AnimationIteration"),animationstart:Il("Animation","AnimationStart"),transitionend:Il("Transition","TransitionEnd")},gf={},cw={};Ei&&(cw=document.createElement("div").style,"AnimationEvent"in window||(delete Ss.animationend.animation,delete Ss.animationiteration.animation,delete Ss.animationstart.animation),"TransitionEvent"in window||delete Ss.transitionend.transition);function ch(t){if(gf[t])return gf[t];if(!Ss[t])return t;var e=Ss[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in cw)return gf[t]=e[n];return t}var hw=ch("animationend"),fw=ch("animationiteration"),dw=ch("animationstart"),gw=ch("transitionend"),pw=new Map,my="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function lr(t,e){pw.set(t,e),Kr(e,[t])}for(var pf=0;pf<my.length;pf++){var _f=my[pf],fC=_f.toLowerCase(),dC=_f[0].toUpperCase()+_f.slice(1);lr(fC,"on"+dC)}lr(hw,"onAnimationEnd");lr(fw,"onAnimationIteration");lr(dw,"onAnimationStart");lr("dblclick","onDoubleClick");lr("focusin","onFocus");lr("focusout","onBlur");lr(gw,"onTransitionEnd");Ys("onMouseEnter",["mouseout","mouseover"]);Ys("onMouseLeave",["mouseout","mouseover"]);Ys("onPointerEnter",["pointerout","pointerover"]);Ys("onPointerLeave",["pointerout","pointerover"]);Kr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Kr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Kr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Kr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Kr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Kr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ko="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gC=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ko));function yy(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,fR(i,e,void 0,t),t.currentTarget=null}function _w(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var l=i.length-1;0<=l;l--){var u=i[l],f=u.instance,d=u.currentTarget;if(u=u.listener,f!==s&&r.isPropagationStopped())break e;yy(r,u,d),s=f}else for(l=0;l<i.length;l++){if(u=i[l],f=u.instance,d=u.currentTarget,u=u.listener,f!==s&&r.isPropagationStopped())break e;yy(r,u,d),s=f}}}if(Wu)throw t=Dd,Wu=!1,Dd=null,t}function je(t,e){var n=e[Xd];n===void 0&&(n=e[Xd]=new Set);var i=t+"__bubble";n.has(i)||(mw(e,t,2,!1),n.add(i))}function mf(t,e,n){var i=0;e&&(i|=4),mw(n,t,i,e)}var Pl="_reactListening"+Math.random().toString(36).slice(2);function Ia(t){if(!t[Pl]){t[Pl]=!0,xE.forEach(function(n){n!=="selectionchange"&&(gC.has(n)||mf(n,!1,t),mf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Pl]||(e[Pl]=!0,mf("selectionchange",!1,e))}}function mw(t,e,n,i){switch(ew(e)){case 1:var r=CR;break;case 4:r=kR;break;default:r=Op}n=r.bind(null,e,n,t),r=void 0,!Ld||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function yf(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var l=i.tag;if(l===3||l===4){var u=i.stateNode.containerInfo;if(u===r||u.nodeType===8&&u.parentNode===r)break;if(l===4)for(l=i.return;l!==null;){var f=l.tag;if((f===3||f===4)&&(f=l.stateNode.containerInfo,f===r||f.nodeType===8&&f.parentNode===r))return;l=l.return}for(;u!==null;){if(l=kr(u),l===null)return;if(f=l.tag,f===5||f===6){i=s=l;continue e}u=u.parentNode}}i=i.return}zE(function(){var d=s,p=Ip(n),_=[];e:{var y=pw.get(t);if(y!==void 0){var E=Dp,T=t;switch(t){case"keypress":if(vu(n)===0)break e;case"keydown":case"keyup":E=jR;break;case"focusin":T="focus",E=hf;break;case"focusout":T="blur",E=hf;break;case"beforeblur":case"afterblur":E=hf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":E=oy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":E=NR;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":E=YR;break;case hw:case fw:case dw:E=LR;break;case gw:E=KR;break;case"scroll":E=IR;break;case"wheel":E=ZR;break;case"copy":case"cut":case"paste":E=FR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":E=ly}var k=(e&4)!==0,M=!k&&t==="scroll",b=k?y!==null?y+"Capture":null:y;k=[];for(var w=d,A;w!==null;){A=w;var N=A.stateNode;if(A.tag===5&&N!==null&&(A=N,b!==null&&(N=xa(w,b),N!=null&&k.push(Pa(w,N,A)))),M)break;w=w.return}0<k.length&&(y=new E(y,T,null,n,p),_.push({event:y,listeners:k}))}}if(!(e&7)){e:{if(y=t==="mouseover"||t==="pointerover",E=t==="mouseout"||t==="pointerout",y&&n!==Md&&(T=n.relatedTarget||n.fromElement)&&(kr(T)||T[wi]))break e;if((E||y)&&(y=p.window===p?p:(y=p.ownerDocument)?y.defaultView||y.parentWindow:window,E?(T=n.relatedTarget||n.toElement,E=d,T=T?kr(T):null,T!==null&&(M=Gr(T),T!==M||T.tag!==5&&T.tag!==6)&&(T=null)):(E=null,T=d),E!==T)){if(k=oy,N="onMouseLeave",b="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(k=ly,N="onPointerLeave",b="onPointerEnter",w="pointer"),M=E==null?y:xs(E),A=T==null?y:xs(T),y=new k(N,w+"leave",E,n,p),y.target=M,y.relatedTarget=A,N=null,kr(p)===d&&(k=new k(b,w+"enter",T,n,p),k.target=A,k.relatedTarget=M,N=k),M=N,E&&T)t:{for(k=E,b=T,w=0,A=k;A;A=cs(A))w++;for(A=0,N=b;N;N=cs(N))A++;for(;0<w-A;)k=cs(k),w--;for(;0<A-w;)b=cs(b),A--;for(;w--;){if(k===b||b!==null&&k===b.alternate)break t;k=cs(k),b=cs(b)}k=null}else k=null;E!==null&&vy(_,y,E,k,!1),T!==null&&M!==null&&vy(_,M,T,k,!0)}}e:{if(y=d?xs(d):window,E=y.nodeName&&y.nodeName.toLowerCase(),E==="select"||E==="input"&&y.type==="file")var D=rC;else if(hy(y))if(ow)D=lC;else{D=oC;var W=sC}else(E=y.nodeName)&&E.toLowerCase()==="input"&&(y.type==="checkbox"||y.type==="radio")&&(D=aC);if(D&&(D=D(t,d))){sw(_,D,n,p);break e}W&&W(t,y,d),t==="focusout"&&(W=y._wrapperState)&&W.controlled&&y.type==="number"&&Cd(y,"number",y.value)}switch(W=d?xs(d):window,t){case"focusin":(hy(W)||W.contentEditable==="true")&&(Ts=W,zd=d,ua=null);break;case"focusout":ua=zd=Ts=null;break;case"mousedown":Vd=!0;break;case"contextmenu":case"mouseup":case"dragend":Vd=!1,_y(_,n,p);break;case"selectionchange":if(hC)break;case"keydown":case"keyup":_y(_,n,p)}var K;if(Bp)e:{switch(t){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else ws?iw(t,n)&&(x="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(x="onCompositionStart");x&&(nw&&n.locale!=="ko"&&(ws||x!=="onCompositionStart"?x==="onCompositionEnd"&&ws&&(K=tw()):(Hi=p,Lp="value"in Hi?Hi.value:Hi.textContent,ws=!0)),W=Yu(d,x),0<W.length&&(x=new ay(x,t,null,n,p),_.push({event:x,listeners:W}),K?x.data=K:(K=rw(n),K!==null&&(x.data=K)))),(K=JR?eC(t,n):tC(t,n))&&(d=Yu(d,"onBeforeInput"),0<d.length&&(p=new ay("onBeforeInput","beforeinput",null,n,p),_.push({event:p,listeners:d}),p.data=K))}_w(_,e)})}function Pa(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Yu(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=xa(t,n),s!=null&&i.unshift(Pa(t,s,r)),s=xa(t,e),s!=null&&i.push(Pa(t,s,r))),t=t.return}return i}function cs(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function vy(t,e,n,i,r){for(var s=e._reactName,l=[];n!==null&&n!==i;){var u=n,f=u.alternate,d=u.stateNode;if(f!==null&&f===i)break;u.tag===5&&d!==null&&(u=d,r?(f=xa(n,s),f!=null&&l.unshift(Pa(n,f,u))):r||(f=xa(n,s),f!=null&&l.push(Pa(n,f,u)))),n=n.return}l.length!==0&&t.push({event:e,listeners:l})}var pC=/\r\n?/g,_C=/\u0000|\uFFFD/g;function Ey(t){return(typeof t=="string"?t:""+t).replace(pC,`
`).replace(_C,"")}function Nl(t,e,n){if(e=Ey(e),Ey(t)!==e&&n)throw Error(se(425))}function qu(){}var Wd=null,Hd=null;function jd(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var $d=typeof setTimeout=="function"?setTimeout:void 0,mC=typeof clearTimeout=="function"?clearTimeout:void 0,wy=typeof Promise=="function"?Promise:void 0,yC=typeof queueMicrotask=="function"?queueMicrotask:typeof wy<"u"?function(t){return wy.resolve(null).then(t).catch(vC)}:$d;function vC(t){setTimeout(function(){throw t})}function vf(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Ra(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Ra(e)}function Ji(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ty(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var mo=Math.random().toString(36).slice(2),Zn="__reactFiber$"+mo,Na="__reactProps$"+mo,wi="__reactContainer$"+mo,Xd="__reactEvents$"+mo,EC="__reactListeners$"+mo,wC="__reactHandles$"+mo;function kr(t){var e=t[Zn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[wi]||n[Zn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ty(t);t!==null;){if(n=t[Zn])return n;t=Ty(t)}return e}t=n,n=t.parentNode}return null}function el(t){return t=t[Zn]||t[wi],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function xs(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(se(33))}function hh(t){return t[Na]||null}var Yd=[],As=-1;function ur(t){return{current:t}}function $e(t){0>As||(t.current=Yd[As],Yd[As]=null,As--)}function He(t,e){As++,Yd[As]=t.current,t.current=e}var or={},Dt=ur(or),Yt=ur(!1),zr=or;function qs(t,e){var n=t.type.contextTypes;if(!n)return or;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function qt(t){return t=t.childContextTypes,t!=null}function Ku(){$e(Yt),$e(Dt)}function Sy(t,e,n){if(Dt.current!==or)throw Error(se(168));He(Dt,e),He(Yt,n)}function yw(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(se(108,sR(t)||"Unknown",r));return rt({},n,i)}function Gu(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||or,zr=Dt.current,He(Dt,t),He(Yt,Yt.current),!0}function xy(t,e,n){var i=t.stateNode;if(!i)throw Error(se(169));n?(t=yw(t,e,zr),i.__reactInternalMemoizedMergedChildContext=t,$e(Yt),$e(Dt),He(Dt,t)):$e(Yt),He(Yt,n)}var di=null,fh=!1,Ef=!1;function vw(t){di===null?di=[t]:di.push(t)}function TC(t){fh=!0,vw(t)}function cr(){if(!Ef&&di!==null){Ef=!0;var t=0,e=Fe;try{var n=di;for(Fe=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}di=null,fh=!1}catch(r){throw di!==null&&(di=di.slice(t+1)),jE(Pp,cr),r}finally{Fe=e,Ef=!1}}return null}var bs=[],Rs=0,Zu=null,Qu=0,yn=[],vn=0,Vr=null,pi=1,_i="";function xr(t,e){bs[Rs++]=Qu,bs[Rs++]=Zu,Zu=t,Qu=e}function Ew(t,e,n){yn[vn++]=pi,yn[vn++]=_i,yn[vn++]=Vr,Vr=t;var i=pi;t=_i;var r=32-Fn(i)-1;i&=~(1<<r),n+=1;var s=32-Fn(e)+r;if(30<s){var l=r-r%5;s=(i&(1<<l)-1).toString(32),i>>=l,r-=l,pi=1<<32-Fn(e)+r|n<<r|i,_i=s+t}else pi=1<<s|n<<r|i,_i=t}function zp(t){t.return!==null&&(xr(t,1),Ew(t,1,0))}function Vp(t){for(;t===Zu;)Zu=bs[--Rs],bs[Rs]=null,Qu=bs[--Rs],bs[Rs]=null;for(;t===Vr;)Vr=yn[--vn],yn[vn]=null,_i=yn[--vn],yn[vn]=null,pi=yn[--vn],yn[vn]=null}var sn=null,nn=null,qe=!1,Mn=null;function ww(t,e){var n=En(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Ay(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,sn=t,nn=Ji(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,sn=t,nn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Vr!==null?{id:pi,overflow:_i}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=En(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,sn=t,nn=null,!0):!1;default:return!1}}function qd(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Kd(t){if(qe){var e=nn;if(e){var n=e;if(!Ay(t,e)){if(qd(t))throw Error(se(418));e=Ji(n.nextSibling);var i=sn;e&&Ay(t,e)?ww(i,n):(t.flags=t.flags&-4097|2,qe=!1,sn=t)}}else{if(qd(t))throw Error(se(418));t.flags=t.flags&-4097|2,qe=!1,sn=t}}}function by(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;sn=t}function Ml(t){if(t!==sn)return!1;if(!qe)return by(t),qe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!jd(t.type,t.memoizedProps)),e&&(e=nn)){if(qd(t))throw Tw(),Error(se(418));for(;e;)ww(t,e),e=Ji(e.nextSibling)}if(by(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(se(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){nn=Ji(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}nn=null}}else nn=sn?Ji(t.stateNode.nextSibling):null;return!0}function Tw(){for(var t=nn;t;)t=Ji(t.nextSibling)}function Ks(){nn=sn=null,qe=!1}function Wp(t){Mn===null?Mn=[t]:Mn.push(t)}var SC=bi.ReactCurrentBatchConfig;function Do(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(se(309));var i=n.stateNode}if(!i)throw Error(se(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(l){var u=r.refs;l===null?delete u[s]:u[s]=l},e._stringRef=s,e)}if(typeof t!="string")throw Error(se(284));if(!n._owner)throw Error(se(290,t))}return t}function Ol(t,e){throw t=Object.prototype.toString.call(e),Error(se(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Ry(t){var e=t._init;return e(t._payload)}function Sw(t){function e(b,w){if(t){var A=b.deletions;A===null?(b.deletions=[w],b.flags|=16):A.push(w)}}function n(b,w){if(!t)return null;for(;w!==null;)e(b,w),w=w.sibling;return null}function i(b,w){for(b=new Map;w!==null;)w.key!==null?b.set(w.key,w):b.set(w.index,w),w=w.sibling;return b}function r(b,w){return b=ir(b,w),b.index=0,b.sibling=null,b}function s(b,w,A){return b.index=A,t?(A=b.alternate,A!==null?(A=A.index,A<w?(b.flags|=2,w):A):(b.flags|=2,w)):(b.flags|=1048576,w)}function l(b){return t&&b.alternate===null&&(b.flags|=2),b}function u(b,w,A,N){return w===null||w.tag!==6?(w=Rf(A,b.mode,N),w.return=b,w):(w=r(w,A),w.return=b,w)}function f(b,w,A,N){var D=A.type;return D===Es?p(b,w,A.props.children,N,A.key):w!==null&&(w.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===Di&&Ry(D)===w.type)?(N=r(w,A.props),N.ref=Do(b,w,A),N.return=b,N):(N=bu(A.type,A.key,A.props,null,b.mode,N),N.ref=Do(b,w,A),N.return=b,N)}function d(b,w,A,N){return w===null||w.tag!==4||w.stateNode.containerInfo!==A.containerInfo||w.stateNode.implementation!==A.implementation?(w=Cf(A,b.mode,N),w.return=b,w):(w=r(w,A.children||[]),w.return=b,w)}function p(b,w,A,N,D){return w===null||w.tag!==7?(w=Or(A,b.mode,N,D),w.return=b,w):(w=r(w,A),w.return=b,w)}function _(b,w,A){if(typeof w=="string"&&w!==""||typeof w=="number")return w=Rf(""+w,b.mode,A),w.return=b,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Sl:return A=bu(w.type,w.key,w.props,null,b.mode,A),A.ref=Do(b,null,w),A.return=b,A;case vs:return w=Cf(w,b.mode,A),w.return=b,w;case Di:var N=w._init;return _(b,N(w._payload),A)}if(Yo(w)||Po(w))return w=Or(w,b.mode,A,null),w.return=b,w;Ol(b,w)}return null}function y(b,w,A,N){var D=w!==null?w.key:null;if(typeof A=="string"&&A!==""||typeof A=="number")return D!==null?null:u(b,w,""+A,N);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case Sl:return A.key===D?f(b,w,A,N):null;case vs:return A.key===D?d(b,w,A,N):null;case Di:return D=A._init,y(b,w,D(A._payload),N)}if(Yo(A)||Po(A))return D!==null?null:p(b,w,A,N,null);Ol(b,A)}return null}function E(b,w,A,N,D){if(typeof N=="string"&&N!==""||typeof N=="number")return b=b.get(A)||null,u(w,b,""+N,D);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case Sl:return b=b.get(N.key===null?A:N.key)||null,f(w,b,N,D);case vs:return b=b.get(N.key===null?A:N.key)||null,d(w,b,N,D);case Di:var W=N._init;return E(b,w,A,W(N._payload),D)}if(Yo(N)||Po(N))return b=b.get(A)||null,p(w,b,N,D,null);Ol(w,N)}return null}function T(b,w,A,N){for(var D=null,W=null,K=w,x=w=0,R=null;K!==null&&x<A.length;x++){K.index>x?(R=K,K=null):R=K.sibling;var P=y(b,K,A[x],N);if(P===null){K===null&&(K=R);break}t&&K&&P.alternate===null&&e(b,K),w=s(P,w,x),W===null?D=P:W.sibling=P,W=P,K=R}if(x===A.length)return n(b,K),qe&&xr(b,x),D;if(K===null){for(;x<A.length;x++)K=_(b,A[x],N),K!==null&&(w=s(K,w,x),W===null?D=K:W.sibling=K,W=K);return qe&&xr(b,x),D}for(K=i(b,K);x<A.length;x++)R=E(K,b,x,A[x],N),R!==null&&(t&&R.alternate!==null&&K.delete(R.key===null?x:R.key),w=s(R,w,x),W===null?D=R:W.sibling=R,W=R);return t&&K.forEach(function(U){return e(b,U)}),qe&&xr(b,x),D}function k(b,w,A,N){var D=Po(A);if(typeof D!="function")throw Error(se(150));if(A=D.call(A),A==null)throw Error(se(151));for(var W=D=null,K=w,x=w=0,R=null,P=A.next();K!==null&&!P.done;x++,P=A.next()){K.index>x?(R=K,K=null):R=K.sibling;var U=y(b,K,P.value,N);if(U===null){K===null&&(K=R);break}t&&K&&U.alternate===null&&e(b,K),w=s(U,w,x),W===null?D=U:W.sibling=U,W=U,K=R}if(P.done)return n(b,K),qe&&xr(b,x),D;if(K===null){for(;!P.done;x++,P=A.next())P=_(b,P.value,N),P!==null&&(w=s(P,w,x),W===null?D=P:W.sibling=P,W=P);return qe&&xr(b,x),D}for(K=i(b,K);!P.done;x++,P=A.next())P=E(K,b,x,P.value,N),P!==null&&(t&&P.alternate!==null&&K.delete(P.key===null?x:P.key),w=s(P,w,x),W===null?D=P:W.sibling=P,W=P);return t&&K.forEach(function(F){return e(b,F)}),qe&&xr(b,x),D}function M(b,w,A,N){if(typeof A=="object"&&A!==null&&A.type===Es&&A.key===null&&(A=A.props.children),typeof A=="object"&&A!==null){switch(A.$$typeof){case Sl:e:{for(var D=A.key,W=w;W!==null;){if(W.key===D){if(D=A.type,D===Es){if(W.tag===7){n(b,W.sibling),w=r(W,A.props.children),w.return=b,b=w;break e}}else if(W.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===Di&&Ry(D)===W.type){n(b,W.sibling),w=r(W,A.props),w.ref=Do(b,W,A),w.return=b,b=w;break e}n(b,W);break}else e(b,W);W=W.sibling}A.type===Es?(w=Or(A.props.children,b.mode,N,A.key),w.return=b,b=w):(N=bu(A.type,A.key,A.props,null,b.mode,N),N.ref=Do(b,w,A),N.return=b,b=N)}return l(b);case vs:e:{for(W=A.key;w!==null;){if(w.key===W)if(w.tag===4&&w.stateNode.containerInfo===A.containerInfo&&w.stateNode.implementation===A.implementation){n(b,w.sibling),w=r(w,A.children||[]),w.return=b,b=w;break e}else{n(b,w);break}else e(b,w);w=w.sibling}w=Cf(A,b.mode,N),w.return=b,b=w}return l(b);case Di:return W=A._init,M(b,w,W(A._payload),N)}if(Yo(A))return T(b,w,A,N);if(Po(A))return k(b,w,A,N);Ol(b,A)}return typeof A=="string"&&A!==""||typeof A=="number"?(A=""+A,w!==null&&w.tag===6?(n(b,w.sibling),w=r(w,A),w.return=b,b=w):(n(b,w),w=Rf(A,b.mode,N),w.return=b,b=w),l(b)):n(b,w)}return M}var Gs=Sw(!0),xw=Sw(!1),Ju=ur(null),ec=null,Cs=null,Hp=null;function jp(){Hp=Cs=ec=null}function $p(t){var e=Ju.current;$e(Ju),t._currentValue=e}function Gd(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Vs(t,e){ec=t,Hp=Cs=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Xt=!0),t.firstContext=null)}function Sn(t){var e=t._currentValue;if(Hp!==t)if(t={context:t,memoizedValue:e,next:null},Cs===null){if(ec===null)throw Error(se(308));Cs=t,ec.dependencies={lanes:0,firstContext:t}}else Cs=Cs.next=t;return e}var Ir=null;function Xp(t){Ir===null?Ir=[t]:Ir.push(t)}function Aw(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Xp(e)):(n.next=r.next,r.next=n),e.interleaved=n,Ti(t,i)}function Ti(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Fi=!1;function Yp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bw(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function yi(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function er(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Pe&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Ti(t,n)}return r=i.interleaved,r===null?(e.next=e,Xp(i)):(e.next=r.next,r.next=e),i.interleaved=e,Ti(t,n)}function Eu(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Np(t,n)}}function Cy(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=l:s=s.next=l,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function tc(t,e,n,i){var r=t.updateQueue;Fi=!1;var s=r.firstBaseUpdate,l=r.lastBaseUpdate,u=r.shared.pending;if(u!==null){r.shared.pending=null;var f=u,d=f.next;f.next=null,l===null?s=d:l.next=d,l=f;var p=t.alternate;p!==null&&(p=p.updateQueue,u=p.lastBaseUpdate,u!==l&&(u===null?p.firstBaseUpdate=d:u.next=d,p.lastBaseUpdate=f))}if(s!==null){var _=r.baseState;l=0,p=d=f=null,u=s;do{var y=u.lane,E=u.eventTime;if((i&y)===y){p!==null&&(p=p.next={eventTime:E,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var T=t,k=u;switch(y=e,E=n,k.tag){case 1:if(T=k.payload,typeof T=="function"){_=T.call(E,_,y);break e}_=T;break e;case 3:T.flags=T.flags&-65537|128;case 0:if(T=k.payload,y=typeof T=="function"?T.call(E,_,y):T,y==null)break e;_=rt({},_,y);break e;case 2:Fi=!0}}u.callback!==null&&u.lane!==0&&(t.flags|=64,y=r.effects,y===null?r.effects=[u]:y.push(u))}else E={eventTime:E,lane:y,tag:u.tag,payload:u.payload,callback:u.callback,next:null},p===null?(d=p=E,f=_):p=p.next=E,l|=y;if(u=u.next,u===null){if(u=r.shared.pending,u===null)break;y=u,u=y.next,y.next=null,r.lastBaseUpdate=y,r.shared.pending=null}}while(1);if(p===null&&(f=_),r.baseState=f,r.firstBaseUpdate=d,r.lastBaseUpdate=p,e=r.shared.interleaved,e!==null){r=e;do l|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Hr|=l,t.lanes=l,t.memoizedState=_}}function ky(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(se(191,r));r.call(i)}}}var tl={},ii=ur(tl),Ma=ur(tl),Oa=ur(tl);function Pr(t){if(t===tl)throw Error(se(174));return t}function qp(t,e){switch(He(Oa,e),He(Ma,t),He(ii,tl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Id(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Id(e,t)}$e(ii),He(ii,e)}function Zs(){$e(ii),$e(Ma),$e(Oa)}function Rw(t){Pr(Oa.current);var e=Pr(ii.current),n=Id(e,t.type);e!==n&&(He(Ma,t),He(ii,n))}function Kp(t){Ma.current===t&&($e(ii),$e(Ma))}var Je=ur(0);function nc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var wf=[];function Gp(){for(var t=0;t<wf.length;t++)wf[t]._workInProgressVersionPrimary=null;wf.length=0}var wu=bi.ReactCurrentDispatcher,Tf=bi.ReactCurrentBatchConfig,Wr=0,it=null,pt=null,vt=null,ic=!1,ca=!1,La=0,xC=0;function It(){throw Error(se(321))}function Zp(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!zn(t[n],e[n]))return!1;return!0}function Qp(t,e,n,i,r,s){if(Wr=s,it=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,wu.current=t===null||t.memoizedState===null?CC:kC,t=n(i,r),ca){s=0;do{if(ca=!1,La=0,25<=s)throw Error(se(301));s+=1,vt=pt=null,e.updateQueue=null,wu.current=IC,t=n(i,r)}while(ca)}if(wu.current=rc,e=pt!==null&&pt.next!==null,Wr=0,vt=pt=it=null,ic=!1,e)throw Error(se(300));return t}function Jp(){var t=La!==0;return La=0,t}function Kn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vt===null?it.memoizedState=vt=t:vt=vt.next=t,vt}function xn(){if(pt===null){var t=it.alternate;t=t!==null?t.memoizedState:null}else t=pt.next;var e=vt===null?it.memoizedState:vt.next;if(e!==null)vt=e,pt=t;else{if(t===null)throw Error(se(310));pt=t,t={memoizedState:pt.memoizedState,baseState:pt.baseState,baseQueue:pt.baseQueue,queue:pt.queue,next:null},vt===null?it.memoizedState=vt=t:vt=vt.next=t}return vt}function Da(t,e){return typeof e=="function"?e(t):e}function Sf(t){var e=xn(),n=e.queue;if(n===null)throw Error(se(311));n.lastRenderedReducer=t;var i=pt,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var l=r.next;r.next=s.next,s.next=l}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var u=l=null,f=null,d=s;do{var p=d.lane;if((Wr&p)===p)f!==null&&(f=f.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),i=d.hasEagerState?d.eagerState:t(i,d.action);else{var _={lane:p,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};f===null?(u=f=_,l=i):f=f.next=_,it.lanes|=p,Hr|=p}d=d.next}while(d!==null&&d!==s);f===null?l=i:f.next=u,zn(i,e.memoizedState)||(Xt=!0),e.memoizedState=i,e.baseState=l,e.baseQueue=f,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,it.lanes|=s,Hr|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function xf(t){var e=xn(),n=e.queue;if(n===null)throw Error(se(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var l=r=r.next;do s=t(s,l.action),l=l.next;while(l!==r);zn(s,e.memoizedState)||(Xt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function Cw(){}function kw(t,e){var n=it,i=xn(),r=e(),s=!zn(i.memoizedState,r);if(s&&(i.memoizedState=r,Xt=!0),i=i.queue,e_(Nw.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||vt!==null&&vt.memoizedState.tag&1){if(n.flags|=2048,Fa(9,Pw.bind(null,n,i,r,e),void 0,null),wt===null)throw Error(se(349));Wr&30||Iw(n,e,r)}return r}function Iw(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=it.updateQueue,e===null?(e={lastEffect:null,stores:null},it.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Pw(t,e,n,i){e.value=n,e.getSnapshot=i,Mw(e)&&Ow(t)}function Nw(t,e,n){return n(function(){Mw(e)&&Ow(t)})}function Mw(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!zn(t,n)}catch{return!0}}function Ow(t){var e=Ti(t,1);e!==null&&Bn(e,t,1,-1)}function Iy(t){var e=Kn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Da,lastRenderedState:t},e.queue=t,t=t.dispatch=RC.bind(null,it,t),[e.memoizedState,t]}function Fa(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=it.updateQueue,e===null?(e={lastEffect:null,stores:null},it.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Lw(){return xn().memoizedState}function Tu(t,e,n,i){var r=Kn();it.flags|=t,r.memoizedState=Fa(1|e,n,void 0,i===void 0?null:i)}function dh(t,e,n,i){var r=xn();i=i===void 0?null:i;var s=void 0;if(pt!==null){var l=pt.memoizedState;if(s=l.destroy,i!==null&&Zp(i,l.deps)){r.memoizedState=Fa(e,n,s,i);return}}it.flags|=t,r.memoizedState=Fa(1|e,n,s,i)}function Py(t,e){return Tu(8390656,8,t,e)}function e_(t,e){return dh(2048,8,t,e)}function Dw(t,e){return dh(4,2,t,e)}function Fw(t,e){return dh(4,4,t,e)}function Bw(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Uw(t,e,n){return n=n!=null?n.concat([t]):null,dh(4,4,Bw.bind(null,e,t),n)}function t_(){}function zw(t,e){var n=xn();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Zp(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Vw(t,e){var n=xn();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Zp(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Ww(t,e,n){return Wr&21?(zn(n,e)||(n=YE(),it.lanes|=n,Hr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Xt=!0),t.memoizedState=n)}function AC(t,e){var n=Fe;Fe=n!==0&&4>n?n:4,t(!0);var i=Tf.transition;Tf.transition={};try{t(!1),e()}finally{Fe=n,Tf.transition=i}}function Hw(){return xn().memoizedState}function bC(t,e,n){var i=nr(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},jw(t))$w(e,n);else if(n=Aw(t,e,n,i),n!==null){var r=zt();Bn(n,t,i,r),Xw(n,e,i)}}function RC(t,e,n){var i=nr(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(jw(t))$w(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var l=e.lastRenderedState,u=s(l,n);if(r.hasEagerState=!0,r.eagerState=u,zn(u,l)){var f=e.interleaved;f===null?(r.next=r,Xp(e)):(r.next=f.next,f.next=r),e.interleaved=r;return}}catch{}finally{}n=Aw(t,e,r,i),n!==null&&(r=zt(),Bn(n,t,i,r),Xw(n,e,i))}}function jw(t){var e=t.alternate;return t===it||e!==null&&e===it}function $w(t,e){ca=ic=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Xw(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Np(t,n)}}var rc={readContext:Sn,useCallback:It,useContext:It,useEffect:It,useImperativeHandle:It,useInsertionEffect:It,useLayoutEffect:It,useMemo:It,useReducer:It,useRef:It,useState:It,useDebugValue:It,useDeferredValue:It,useTransition:It,useMutableSource:It,useSyncExternalStore:It,useId:It,unstable_isNewReconciler:!1},CC={readContext:Sn,useCallback:function(t,e){return Kn().memoizedState=[t,e===void 0?null:e],t},useContext:Sn,useEffect:Py,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Tu(4194308,4,Bw.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Tu(4194308,4,t,e)},useInsertionEffect:function(t,e){return Tu(4,2,t,e)},useMemo:function(t,e){var n=Kn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Kn();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=bC.bind(null,it,t),[i.memoizedState,t]},useRef:function(t){var e=Kn();return t={current:t},e.memoizedState=t},useState:Iy,useDebugValue:t_,useDeferredValue:function(t){return Kn().memoizedState=t},useTransition:function(){var t=Iy(!1),e=t[0];return t=AC.bind(null,t[1]),Kn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=it,r=Kn();if(qe){if(n===void 0)throw Error(se(407));n=n()}else{if(n=e(),wt===null)throw Error(se(349));Wr&30||Iw(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,Py(Nw.bind(null,i,s,t),[t]),i.flags|=2048,Fa(9,Pw.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Kn(),e=wt.identifierPrefix;if(qe){var n=_i,i=pi;n=(i&~(1<<32-Fn(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=La++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=xC++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},kC={readContext:Sn,useCallback:zw,useContext:Sn,useEffect:e_,useImperativeHandle:Uw,useInsertionEffect:Dw,useLayoutEffect:Fw,useMemo:Vw,useReducer:Sf,useRef:Lw,useState:function(){return Sf(Da)},useDebugValue:t_,useDeferredValue:function(t){var e=xn();return Ww(e,pt.memoizedState,t)},useTransition:function(){var t=Sf(Da)[0],e=xn().memoizedState;return[t,e]},useMutableSource:Cw,useSyncExternalStore:kw,useId:Hw,unstable_isNewReconciler:!1},IC={readContext:Sn,useCallback:zw,useContext:Sn,useEffect:e_,useImperativeHandle:Uw,useInsertionEffect:Dw,useLayoutEffect:Fw,useMemo:Vw,useReducer:xf,useRef:Lw,useState:function(){return xf(Da)},useDebugValue:t_,useDeferredValue:function(t){var e=xn();return pt===null?e.memoizedState=t:Ww(e,pt.memoizedState,t)},useTransition:function(){var t=xf(Da)[0],e=xn().memoizedState;return[t,e]},useMutableSource:Cw,useSyncExternalStore:kw,useId:Hw,unstable_isNewReconciler:!1};function Pn(t,e){if(t&&t.defaultProps){e=rt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Zd(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:rt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var gh={isMounted:function(t){return(t=t._reactInternals)?Gr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=zt(),r=nr(t),s=yi(i,r);s.payload=e,n!=null&&(s.callback=n),e=er(t,s,r),e!==null&&(Bn(e,t,r,i),Eu(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=zt(),r=nr(t),s=yi(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=er(t,s,r),e!==null&&(Bn(e,t,r,i),Eu(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=zt(),i=nr(t),r=yi(n,i);r.tag=2,e!=null&&(r.callback=e),e=er(t,r,i),e!==null&&(Bn(e,t,i,n),Eu(e,t,i))}};function Ny(t,e,n,i,r,s,l){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,l):e.prototype&&e.prototype.isPureReactComponent?!ka(n,i)||!ka(r,s):!0}function Yw(t,e,n){var i=!1,r=or,s=e.contextType;return typeof s=="object"&&s!==null?s=Sn(s):(r=qt(e)?zr:Dt.current,i=e.contextTypes,s=(i=i!=null)?qs(t,r):or),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=gh,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function My(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&gh.enqueueReplaceState(e,e.state,null)}function Qd(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Yp(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Sn(s):(s=qt(e)?zr:Dt.current,r.context=qs(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Zd(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&gh.enqueueReplaceState(r,r.state,null),tc(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Qs(t,e){try{var n="",i=e;do n+=rR(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Af(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Jd(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var PC=typeof WeakMap=="function"?WeakMap:Map;function qw(t,e,n){n=yi(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){oc||(oc=!0,ug=i),Jd(t,e)},n}function Kw(t,e,n){n=yi(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){Jd(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Jd(t,e),typeof i!="function"&&(tr===null?tr=new Set([this]):tr.add(this));var l=e.stack;this.componentDidCatch(e.value,{componentStack:l!==null?l:""})}),n}function Oy(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new PC;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=$C.bind(null,t,e,n),e.then(t,t))}function Ly(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Dy(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=yi(-1,1),e.tag=2,er(n,e,1))),n.lanes|=1),t)}var NC=bi.ReactCurrentOwner,Xt=!1;function Ut(t,e,n,i){e.child=t===null?xw(e,null,n,i):Gs(e,t.child,n,i)}function Fy(t,e,n,i,r){n=n.render;var s=e.ref;return Vs(e,r),i=Qp(t,e,n,i,s,r),n=Jp(),t!==null&&!Xt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Si(t,e,r)):(qe&&n&&zp(e),e.flags|=1,Ut(t,e,i,r),e.child)}function By(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!u_(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Gw(t,e,s,i,r)):(t=bu(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var l=s.memoizedProps;if(n=n.compare,n=n!==null?n:ka,n(l,i)&&t.ref===e.ref)return Si(t,e,r)}return e.flags|=1,t=ir(s,i),t.ref=e.ref,t.return=e,e.child=t}function Gw(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(ka(s,i)&&t.ref===e.ref)if(Xt=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(Xt=!0);else return e.lanes=t.lanes,Si(t,e,r)}return eg(t,e,n,i,r)}function Zw(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},He(Is,en),en|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,He(Is,en),en|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,He(Is,en),en|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,He(Is,en),en|=i;return Ut(t,e,r,n),e.child}function Qw(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function eg(t,e,n,i,r){var s=qt(n)?zr:Dt.current;return s=qs(e,s),Vs(e,r),n=Qp(t,e,n,i,s,r),i=Jp(),t!==null&&!Xt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Si(t,e,r)):(qe&&i&&zp(e),e.flags|=1,Ut(t,e,n,r),e.child)}function Uy(t,e,n,i,r){if(qt(n)){var s=!0;Gu(e)}else s=!1;if(Vs(e,r),e.stateNode===null)Su(t,e),Yw(e,n,i),Qd(e,n,i,r),i=!0;else if(t===null){var l=e.stateNode,u=e.memoizedProps;l.props=u;var f=l.context,d=n.contextType;typeof d=="object"&&d!==null?d=Sn(d):(d=qt(n)?zr:Dt.current,d=qs(e,d));var p=n.getDerivedStateFromProps,_=typeof p=="function"||typeof l.getSnapshotBeforeUpdate=="function";_||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(u!==i||f!==d)&&My(e,l,i,d),Fi=!1;var y=e.memoizedState;l.state=y,tc(e,i,l,r),f=e.memoizedState,u!==i||y!==f||Yt.current||Fi?(typeof p=="function"&&(Zd(e,n,p,i),f=e.memoizedState),(u=Fi||Ny(e,n,u,i,y,f,d))?(_||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(e.flags|=4194308)):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=f),l.props=i,l.state=f,l.context=d,i=u):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{l=e.stateNode,bw(t,e),u=e.memoizedProps,d=e.type===e.elementType?u:Pn(e.type,u),l.props=d,_=e.pendingProps,y=l.context,f=n.contextType,typeof f=="object"&&f!==null?f=Sn(f):(f=qt(n)?zr:Dt.current,f=qs(e,f));var E=n.getDerivedStateFromProps;(p=typeof E=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(u!==_||y!==f)&&My(e,l,i,f),Fi=!1,y=e.memoizedState,l.state=y,tc(e,i,l,r);var T=e.memoizedState;u!==_||y!==T||Yt.current||Fi?(typeof E=="function"&&(Zd(e,n,E,i),T=e.memoizedState),(d=Fi||Ny(e,n,d,i,y,T,f)||!1)?(p||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(i,T,f),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(i,T,f)),typeof l.componentDidUpdate=="function"&&(e.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof l.componentDidUpdate!="function"||u===t.memoizedProps&&y===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||u===t.memoizedProps&&y===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=T),l.props=i,l.state=T,l.context=f,i=d):(typeof l.componentDidUpdate!="function"||u===t.memoizedProps&&y===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||u===t.memoizedProps&&y===t.memoizedState||(e.flags|=1024),i=!1)}return tg(t,e,n,i,s,r)}function tg(t,e,n,i,r,s){Qw(t,e);var l=(e.flags&128)!==0;if(!i&&!l)return r&&xy(e,n,!1),Si(t,e,s);i=e.stateNode,NC.current=e;var u=l&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&l?(e.child=Gs(e,t.child,null,s),e.child=Gs(e,null,u,s)):Ut(t,e,u,s),e.memoizedState=i.state,r&&xy(e,n,!0),e.child}function Jw(t){var e=t.stateNode;e.pendingContext?Sy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Sy(t,e.context,!1),qp(t,e.containerInfo)}function zy(t,e,n,i,r){return Ks(),Wp(r),e.flags|=256,Ut(t,e,n,i),e.child}var ng={dehydrated:null,treeContext:null,retryLane:0};function ig(t){return{baseLanes:t,cachePool:null,transitions:null}}function eT(t,e,n){var i=e.pendingProps,r=Je.current,s=!1,l=(e.flags&128)!==0,u;if((u=l)||(u=t!==null&&t.memoizedState===null?!1:(r&2)!==0),u?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),He(Je,r&1),t===null)return Kd(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(l=i.children,t=i.fallback,s?(i=e.mode,s=e.child,l={mode:"hidden",children:l},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=l):s=mh(l,i,0,null),t=Or(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=ig(n),e.memoizedState=ng,t):n_(e,l));if(r=t.memoizedState,r!==null&&(u=r.dehydrated,u!==null))return MC(t,e,l,i,u,r,n);if(s){s=i.fallback,l=e.mode,r=t.child,u=r.sibling;var f={mode:"hidden",children:i.children};return!(l&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=f,e.deletions=null):(i=ir(r,f),i.subtreeFlags=r.subtreeFlags&14680064),u!==null?s=ir(u,s):(s=Or(s,l,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,l=t.child.memoizedState,l=l===null?ig(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=t.childLanes&~n,e.memoizedState=ng,i}return s=t.child,t=s.sibling,i=ir(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function n_(t,e){return e=mh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ll(t,e,n,i){return i!==null&&Wp(i),Gs(e,t.child,null,n),t=n_(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function MC(t,e,n,i,r,s,l){if(n)return e.flags&256?(e.flags&=-257,i=Af(Error(se(422))),Ll(t,e,l,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=mh({mode:"visible",children:i.children},r,0,null),s=Or(s,r,l,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Gs(e,t.child,null,l),e.child.memoizedState=ig(l),e.memoizedState=ng,s);if(!(e.mode&1))return Ll(t,e,l,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var u=i.dgst;return i=u,s=Error(se(419)),i=Af(s,i,void 0),Ll(t,e,l,i)}if(u=(l&t.childLanes)!==0,Xt||u){if(i=wt,i!==null){switch(l&-l){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|l)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Ti(t,r),Bn(i,t,r,-1))}return l_(),i=Af(Error(se(421))),Ll(t,e,l,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=XC.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,nn=Ji(r.nextSibling),sn=e,qe=!0,Mn=null,t!==null&&(yn[vn++]=pi,yn[vn++]=_i,yn[vn++]=Vr,pi=t.id,_i=t.overflow,Vr=e),e=n_(e,i.children),e.flags|=4096,e)}function Vy(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Gd(t.return,e,n)}function bf(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function tT(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Ut(t,e,i.children,n),i=Je.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Vy(t,n,e);else if(t.tag===19)Vy(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(He(Je,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&nc(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),bf(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&nc(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}bf(e,!0,n,null,s);break;case"together":bf(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Su(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Si(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Hr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(se(153));if(e.child!==null){for(t=e.child,n=ir(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ir(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function OC(t,e,n){switch(e.tag){case 3:Jw(e),Ks();break;case 5:Rw(e);break;case 1:qt(e.type)&&Gu(e);break;case 4:qp(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;He(Ju,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(He(Je,Je.current&1),e.flags|=128,null):n&e.child.childLanes?eT(t,e,n):(He(Je,Je.current&1),t=Si(t,e,n),t!==null?t.sibling:null);He(Je,Je.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return tT(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),He(Je,Je.current),i)break;return null;case 22:case 23:return e.lanes=0,Zw(t,e,n)}return Si(t,e,n)}var nT,rg,iT,rT;nT=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};rg=function(){};iT=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Pr(ii.current);var s=null;switch(n){case"input":r=bd(t,r),i=bd(t,i),s=[];break;case"select":r=rt({},r,{value:void 0}),i=rt({},i,{value:void 0}),s=[];break;case"textarea":r=kd(t,r),i=kd(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=qu)}Pd(n,i);var l;n=null;for(d in r)if(!i.hasOwnProperty(d)&&r.hasOwnProperty(d)&&r[d]!=null)if(d==="style"){var u=r[d];for(l in u)u.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Ta.hasOwnProperty(d)?s||(s=[]):(s=s||[]).push(d,null));for(d in i){var f=i[d];if(u=r!=null?r[d]:void 0,i.hasOwnProperty(d)&&f!==u&&(f!=null||u!=null))if(d==="style")if(u){for(l in u)!u.hasOwnProperty(l)||f&&f.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in f)f.hasOwnProperty(l)&&u[l]!==f[l]&&(n||(n={}),n[l]=f[l])}else n||(s||(s=[]),s.push(d,n)),n=f;else d==="dangerouslySetInnerHTML"?(f=f?f.__html:void 0,u=u?u.__html:void 0,f!=null&&u!==f&&(s=s||[]).push(d,f)):d==="children"?typeof f!="string"&&typeof f!="number"||(s=s||[]).push(d,""+f):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Ta.hasOwnProperty(d)?(f!=null&&d==="onScroll"&&je("scroll",t),s||u===f||(s=[])):(s=s||[]).push(d,f))}n&&(s=s||[]).push("style",n);var d=s;(e.updateQueue=d)&&(e.flags|=4)}};rT=function(t,e,n,i){n!==i&&(e.flags|=4)};function Fo(t,e){if(!qe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Pt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function LC(t,e,n){var i=e.pendingProps;switch(Vp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pt(e),null;case 1:return qt(e.type)&&Ku(),Pt(e),null;case 3:return i=e.stateNode,Zs(),$e(Yt),$e(Dt),Gp(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Ml(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Mn!==null&&(fg(Mn),Mn=null))),rg(t,e),Pt(e),null;case 5:Kp(e);var r=Pr(Oa.current);if(n=e.type,t!==null&&e.stateNode!=null)iT(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(se(166));return Pt(e),null}if(t=Pr(ii.current),Ml(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Zn]=e,i[Na]=s,t=(e.mode&1)!==0,n){case"dialog":je("cancel",i),je("close",i);break;case"iframe":case"object":case"embed":je("load",i);break;case"video":case"audio":for(r=0;r<Ko.length;r++)je(Ko[r],i);break;case"source":je("error",i);break;case"img":case"image":case"link":je("error",i),je("load",i);break;case"details":je("toggle",i);break;case"input":Gm(i,s),je("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},je("invalid",i);break;case"textarea":Qm(i,s),je("invalid",i)}Pd(n,s),r=null;for(var l in s)if(s.hasOwnProperty(l)){var u=s[l];l==="children"?typeof u=="string"?i.textContent!==u&&(s.suppressHydrationWarning!==!0&&Nl(i.textContent,u,t),r=["children",u]):typeof u=="number"&&i.textContent!==""+u&&(s.suppressHydrationWarning!==!0&&Nl(i.textContent,u,t),r=["children",""+u]):Ta.hasOwnProperty(l)&&u!=null&&l==="onScroll"&&je("scroll",i)}switch(n){case"input":xl(i),Zm(i,s,!0);break;case"textarea":xl(i),Jm(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=qu)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{l=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=NE(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=l.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=l.createElement(n,{is:i.is}):(t=l.createElement(n),n==="select"&&(l=t,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):t=l.createElementNS(t,n),t[Zn]=e,t[Na]=i,nT(t,e,!1,!1),e.stateNode=t;e:{switch(l=Nd(n,i),n){case"dialog":je("cancel",t),je("close",t),r=i;break;case"iframe":case"object":case"embed":je("load",t),r=i;break;case"video":case"audio":for(r=0;r<Ko.length;r++)je(Ko[r],t);r=i;break;case"source":je("error",t),r=i;break;case"img":case"image":case"link":je("error",t),je("load",t),r=i;break;case"details":je("toggle",t),r=i;break;case"input":Gm(t,i),r=bd(t,i),je("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=rt({},i,{value:void 0}),je("invalid",t);break;case"textarea":Qm(t,i),r=kd(t,i),je("invalid",t);break;default:r=i}Pd(n,r),u=r;for(s in u)if(u.hasOwnProperty(s)){var f=u[s];s==="style"?LE(t,f):s==="dangerouslySetInnerHTML"?(f=f?f.__html:void 0,f!=null&&ME(t,f)):s==="children"?typeof f=="string"?(n!=="textarea"||f!=="")&&Sa(t,f):typeof f=="number"&&Sa(t,""+f):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ta.hasOwnProperty(s)?f!=null&&s==="onScroll"&&je("scroll",t):f!=null&&bp(t,s,f,l))}switch(n){case"input":xl(t),Zm(t,i,!1);break;case"textarea":xl(t),Jm(t);break;case"option":i.value!=null&&t.setAttribute("value",""+sr(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Fs(t,!!i.multiple,s,!1):i.defaultValue!=null&&Fs(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=qu)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Pt(e),null;case 6:if(t&&e.stateNode!=null)rT(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(se(166));if(n=Pr(Oa.current),Pr(ii.current),Ml(e)){if(i=e.stateNode,n=e.memoizedProps,i[Zn]=e,(s=i.nodeValue!==n)&&(t=sn,t!==null))switch(t.tag){case 3:Nl(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Nl(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Zn]=e,e.stateNode=i}return Pt(e),null;case 13:if($e(Je),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(qe&&nn!==null&&e.mode&1&&!(e.flags&128))Tw(),Ks(),e.flags|=98560,s=!1;else if(s=Ml(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(se(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(se(317));s[Zn]=e}else Ks(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Pt(e),s=!1}else Mn!==null&&(fg(Mn),Mn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Je.current&1?_t===0&&(_t=3):l_())),e.updateQueue!==null&&(e.flags|=4),Pt(e),null);case 4:return Zs(),rg(t,e),t===null&&Ia(e.stateNode.containerInfo),Pt(e),null;case 10:return $p(e.type._context),Pt(e),null;case 17:return qt(e.type)&&Ku(),Pt(e),null;case 19:if($e(Je),s=e.memoizedState,s===null)return Pt(e),null;if(i=(e.flags&128)!==0,l=s.rendering,l===null)if(i)Fo(s,!1);else{if(_t!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(l=nc(t),l!==null){for(e.flags|=128,Fo(s,!1),i=l.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,l=s.alternate,l===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,t=l.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return He(Je,Je.current&1|2),e.child}t=t.sibling}s.tail!==null&&lt()>Js&&(e.flags|=128,i=!0,Fo(s,!1),e.lanes=4194304)}else{if(!i)if(t=nc(l),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Fo(s,!0),s.tail===null&&s.tailMode==="hidden"&&!l.alternate&&!qe)return Pt(e),null}else 2*lt()-s.renderingStartTime>Js&&n!==1073741824&&(e.flags|=128,i=!0,Fo(s,!1),e.lanes=4194304);s.isBackwards?(l.sibling=e.child,e.child=l):(n=s.last,n!==null?n.sibling=l:e.child=l,s.last=l)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=lt(),e.sibling=null,n=Je.current,He(Je,i?n&1|2:n&1),e):(Pt(e),null);case 22:case 23:return a_(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?en&1073741824&&(Pt(e),e.subtreeFlags&6&&(e.flags|=8192)):Pt(e),null;case 24:return null;case 25:return null}throw Error(se(156,e.tag))}function DC(t,e){switch(Vp(e),e.tag){case 1:return qt(e.type)&&Ku(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Zs(),$e(Yt),$e(Dt),Gp(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Kp(e),null;case 13:if($e(Je),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(se(340));Ks()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return $e(Je),null;case 4:return Zs(),null;case 10:return $p(e.type._context),null;case 22:case 23:return a_(),null;case 24:return null;default:return null}}var Dl=!1,Lt=!1,FC=typeof WeakSet=="function"?WeakSet:Set,de=null;function ks(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){at(t,e,i)}else n.current=null}function sg(t,e,n){try{n()}catch(i){at(t,e,i)}}var Wy=!1;function BC(t,e){if(Wd=$u,t=uw(),Up(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var l=0,u=-1,f=-1,d=0,p=0,_=t,y=null;t:for(;;){for(var E;_!==n||r!==0&&_.nodeType!==3||(u=l+r),_!==s||i!==0&&_.nodeType!==3||(f=l+i),_.nodeType===3&&(l+=_.nodeValue.length),(E=_.firstChild)!==null;)y=_,_=E;for(;;){if(_===t)break t;if(y===n&&++d===r&&(u=l),y===s&&++p===i&&(f=l),(E=_.nextSibling)!==null)break;_=y,y=_.parentNode}_=E}n=u===-1||f===-1?null:{start:u,end:f}}else n=null}n=n||{start:0,end:0}}else n=null;for(Hd={focusedElem:t,selectionRange:n},$u=!1,de=e;de!==null;)if(e=de,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,de=t;else for(;de!==null;){e=de;try{var T=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(T!==null){var k=T.memoizedProps,M=T.memoizedState,b=e.stateNode,w=b.getSnapshotBeforeUpdate(e.elementType===e.type?k:Pn(e.type,k),M);b.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var A=e.stateNode.containerInfo;A.nodeType===1?A.textContent="":A.nodeType===9&&A.documentElement&&A.removeChild(A.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(se(163))}}catch(N){at(e,e.return,N)}if(t=e.sibling,t!==null){t.return=e.return,de=t;break}de=e.return}return T=Wy,Wy=!1,T}function ha(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&sg(e,n,s)}r=r.next}while(r!==i)}}function ph(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function og(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function sT(t){var e=t.alternate;e!==null&&(t.alternate=null,sT(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Zn],delete e[Na],delete e[Xd],delete e[EC],delete e[wC])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function oT(t){return t.tag===5||t.tag===3||t.tag===4}function Hy(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||oT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ag(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=qu));else if(i!==4&&(t=t.child,t!==null))for(ag(t,e,n),t=t.sibling;t!==null;)ag(t,e,n),t=t.sibling}function lg(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(lg(t,e,n),t=t.sibling;t!==null;)lg(t,e,n),t=t.sibling}var At=null,Nn=!1;function ki(t,e,n){for(n=n.child;n!==null;)aT(t,e,n),n=n.sibling}function aT(t,e,n){if(ni&&typeof ni.onCommitFiberUnmount=="function")try{ni.onCommitFiberUnmount(ah,n)}catch{}switch(n.tag){case 5:Lt||ks(n,e);case 6:var i=At,r=Nn;At=null,ki(t,e,n),At=i,Nn=r,At!==null&&(Nn?(t=At,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):At.removeChild(n.stateNode));break;case 18:At!==null&&(Nn?(t=At,n=n.stateNode,t.nodeType===8?vf(t.parentNode,n):t.nodeType===1&&vf(t,n),Ra(t)):vf(At,n.stateNode));break;case 4:i=At,r=Nn,At=n.stateNode.containerInfo,Nn=!0,ki(t,e,n),At=i,Nn=r;break;case 0:case 11:case 14:case 15:if(!Lt&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,l=s.destroy;s=s.tag,l!==void 0&&(s&2||s&4)&&sg(n,e,l),r=r.next}while(r!==i)}ki(t,e,n);break;case 1:if(!Lt&&(ks(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(u){at(n,e,u)}ki(t,e,n);break;case 21:ki(t,e,n);break;case 22:n.mode&1?(Lt=(i=Lt)||n.memoizedState!==null,ki(t,e,n),Lt=i):ki(t,e,n);break;default:ki(t,e,n)}}function jy(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new FC),e.forEach(function(i){var r=YC.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Rn(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,l=e,u=l;e:for(;u!==null;){switch(u.tag){case 5:At=u.stateNode,Nn=!1;break e;case 3:At=u.stateNode.containerInfo,Nn=!0;break e;case 4:At=u.stateNode.containerInfo,Nn=!0;break e}u=u.return}if(At===null)throw Error(se(160));aT(s,l,r),At=null,Nn=!1;var f=r.alternate;f!==null&&(f.return=null),r.return=null}catch(d){at(r,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)lT(e,t),e=e.sibling}function lT(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Rn(e,t),$n(t),i&4){try{ha(3,t,t.return),ph(3,t)}catch(k){at(t,t.return,k)}try{ha(5,t,t.return)}catch(k){at(t,t.return,k)}}break;case 1:Rn(e,t),$n(t),i&512&&n!==null&&ks(n,n.return);break;case 5:if(Rn(e,t),$n(t),i&512&&n!==null&&ks(n,n.return),t.flags&32){var r=t.stateNode;try{Sa(r,"")}catch(k){at(t,t.return,k)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,l=n!==null?n.memoizedProps:s,u=t.type,f=t.updateQueue;if(t.updateQueue=null,f!==null)try{u==="input"&&s.type==="radio"&&s.name!=null&&IE(r,s),Nd(u,l);var d=Nd(u,s);for(l=0;l<f.length;l+=2){var p=f[l],_=f[l+1];p==="style"?LE(r,_):p==="dangerouslySetInnerHTML"?ME(r,_):p==="children"?Sa(r,_):bp(r,p,_,d)}switch(u){case"input":Rd(r,s);break;case"textarea":PE(r,s);break;case"select":var y=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var E=s.value;E!=null?Fs(r,!!s.multiple,E,!1):y!==!!s.multiple&&(s.defaultValue!=null?Fs(r,!!s.multiple,s.defaultValue,!0):Fs(r,!!s.multiple,s.multiple?[]:"",!1))}r[Na]=s}catch(k){at(t,t.return,k)}}break;case 6:if(Rn(e,t),$n(t),i&4){if(t.stateNode===null)throw Error(se(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(k){at(t,t.return,k)}}break;case 3:if(Rn(e,t),$n(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Ra(e.containerInfo)}catch(k){at(t,t.return,k)}break;case 4:Rn(e,t),$n(t);break;case 13:Rn(e,t),$n(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(s_=lt())),i&4&&jy(t);break;case 22:if(p=n!==null&&n.memoizedState!==null,t.mode&1?(Lt=(d=Lt)||p,Rn(e,t),Lt=d):Rn(e,t),$n(t),i&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!p&&t.mode&1)for(de=t,p=t.child;p!==null;){for(_=de=p;de!==null;){switch(y=de,E=y.child,y.tag){case 0:case 11:case 14:case 15:ha(4,y,y.return);break;case 1:ks(y,y.return);var T=y.stateNode;if(typeof T.componentWillUnmount=="function"){i=y,n=y.return;try{e=i,T.props=e.memoizedProps,T.state=e.memoizedState,T.componentWillUnmount()}catch(k){at(i,n,k)}}break;case 5:ks(y,y.return);break;case 22:if(y.memoizedState!==null){Xy(_);continue}}E!==null?(E.return=y,de=E):Xy(_)}p=p.sibling}e:for(p=null,_=t;;){if(_.tag===5){if(p===null){p=_;try{r=_.stateNode,d?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(u=_.stateNode,f=_.memoizedProps.style,l=f!=null&&f.hasOwnProperty("display")?f.display:null,u.style.display=OE("display",l))}catch(k){at(t,t.return,k)}}}else if(_.tag===6){if(p===null)try{_.stateNode.nodeValue=d?"":_.memoizedProps}catch(k){at(t,t.return,k)}}else if((_.tag!==22&&_.tag!==23||_.memoizedState===null||_===t)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===t)break e;for(;_.sibling===null;){if(_.return===null||_.return===t)break e;p===_&&(p=null),_=_.return}p===_&&(p=null),_.sibling.return=_.return,_=_.sibling}}break;case 19:Rn(e,t),$n(t),i&4&&jy(t);break;case 21:break;default:Rn(e,t),$n(t)}}function $n(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(oT(n)){var i=n;break e}n=n.return}throw Error(se(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Sa(r,""),i.flags&=-33);var s=Hy(t);lg(t,s,r);break;case 3:case 4:var l=i.stateNode.containerInfo,u=Hy(t);ag(t,u,l);break;default:throw Error(se(161))}}catch(f){at(t,t.return,f)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function UC(t,e,n){de=t,uT(t)}function uT(t,e,n){for(var i=(t.mode&1)!==0;de!==null;){var r=de,s=r.child;if(r.tag===22&&i){var l=r.memoizedState!==null||Dl;if(!l){var u=r.alternate,f=u!==null&&u.memoizedState!==null||Lt;u=Dl;var d=Lt;if(Dl=l,(Lt=f)&&!d)for(de=r;de!==null;)l=de,f=l.child,l.tag===22&&l.memoizedState!==null?Yy(r):f!==null?(f.return=l,de=f):Yy(r);for(;s!==null;)de=s,uT(s),s=s.sibling;de=r,Dl=u,Lt=d}$y(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,de=s):$y(t)}}function $y(t){for(;de!==null;){var e=de;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Lt||ph(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Lt)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Pn(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&ky(e,s,i);break;case 3:var l=e.updateQueue;if(l!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}ky(e,l,n)}break;case 5:var u=e.stateNode;if(n===null&&e.flags&4){n=u;var f=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":f.autoFocus&&n.focus();break;case"img":f.src&&(n.src=f.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var p=d.memoizedState;if(p!==null){var _=p.dehydrated;_!==null&&Ra(_)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(se(163))}Lt||e.flags&512&&og(e)}catch(y){at(e,e.return,y)}}if(e===t){de=null;break}if(n=e.sibling,n!==null){n.return=e.return,de=n;break}de=e.return}}function Xy(t){for(;de!==null;){var e=de;if(e===t){de=null;break}var n=e.sibling;if(n!==null){n.return=e.return,de=n;break}de=e.return}}function Yy(t){for(;de!==null;){var e=de;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ph(4,e)}catch(f){at(e,n,f)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(f){at(e,r,f)}}var s=e.return;try{og(e)}catch(f){at(e,s,f)}break;case 5:var l=e.return;try{og(e)}catch(f){at(e,l,f)}}}catch(f){at(e,e.return,f)}if(e===t){de=null;break}var u=e.sibling;if(u!==null){u.return=e.return,de=u;break}de=e.return}}var zC=Math.ceil,sc=bi.ReactCurrentDispatcher,i_=bi.ReactCurrentOwner,wn=bi.ReactCurrentBatchConfig,Pe=0,wt=null,ht=null,Rt=0,en=0,Is=ur(0),_t=0,Ba=null,Hr=0,_h=0,r_=0,fa=null,$t=null,s_=0,Js=1/0,fi=null,oc=!1,ug=null,tr=null,Fl=!1,ji=null,ac=0,da=0,cg=null,xu=-1,Au=0;function zt(){return Pe&6?lt():xu!==-1?xu:xu=lt()}function nr(t){return t.mode&1?Pe&2&&Rt!==0?Rt&-Rt:SC.transition!==null?(Au===0&&(Au=YE()),Au):(t=Fe,t!==0||(t=window.event,t=t===void 0?16:ew(t.type)),t):1}function Bn(t,e,n,i){if(50<da)throw da=0,cg=null,Error(se(185));Qa(t,n,i),(!(Pe&2)||t!==wt)&&(t===wt&&(!(Pe&2)&&(_h|=n),_t===4&&Wi(t,Rt)),Kt(t,i),n===1&&Pe===0&&!(e.mode&1)&&(Js=lt()+500,fh&&cr()))}function Kt(t,e){var n=t.callbackNode;SR(t,e);var i=ju(t,t===wt?Rt:0);if(i===0)n!==null&&ny(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&ny(n),e===1)t.tag===0?TC(qy.bind(null,t)):vw(qy.bind(null,t)),yC(function(){!(Pe&6)&&cr()}),n=null;else{switch(qE(i)){case 1:n=Pp;break;case 4:n=$E;break;case 16:n=Hu;break;case 536870912:n=XE;break;default:n=Hu}n=mT(n,cT.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function cT(t,e){if(xu=-1,Au=0,Pe&6)throw Error(se(327));var n=t.callbackNode;if(Ws()&&t.callbackNode!==n)return null;var i=ju(t,t===wt?Rt:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=lc(t,i);else{e=i;var r=Pe;Pe|=2;var s=fT();(wt!==t||Rt!==e)&&(fi=null,Js=lt()+500,Mr(t,e));do try{HC();break}catch(u){hT(t,u)}while(1);jp(),sc.current=s,Pe=r,ht!==null?e=0:(wt=null,Rt=0,e=_t)}if(e!==0){if(e===2&&(r=Fd(t),r!==0&&(i=r,e=hg(t,r))),e===1)throw n=Ba,Mr(t,0),Wi(t,i),Kt(t,lt()),n;if(e===6)Wi(t,i);else{if(r=t.current.alternate,!(i&30)&&!VC(r)&&(e=lc(t,i),e===2&&(s=Fd(t),s!==0&&(i=s,e=hg(t,s))),e===1))throw n=Ba,Mr(t,0),Wi(t,i),Kt(t,lt()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(se(345));case 2:Ar(t,$t,fi);break;case 3:if(Wi(t,i),(i&130023424)===i&&(e=s_+500-lt(),10<e)){if(ju(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){zt(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=$d(Ar.bind(null,t,$t,fi),e);break}Ar(t,$t,fi);break;case 4:if(Wi(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var l=31-Fn(i);s=1<<l,l=e[l],l>r&&(r=l),i&=~s}if(i=r,i=lt()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*zC(i/1960))-i,10<i){t.timeoutHandle=$d(Ar.bind(null,t,$t,fi),i);break}Ar(t,$t,fi);break;case 5:Ar(t,$t,fi);break;default:throw Error(se(329))}}}return Kt(t,lt()),t.callbackNode===n?cT.bind(null,t):null}function hg(t,e){var n=fa;return t.current.memoizedState.isDehydrated&&(Mr(t,e).flags|=256),t=lc(t,e),t!==2&&(e=$t,$t=n,e!==null&&fg(e)),t}function fg(t){$t===null?$t=t:$t.push.apply($t,t)}function VC(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!zn(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Wi(t,e){for(e&=~r_,e&=~_h,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Fn(e),i=1<<n;t[n]=-1,e&=~i}}function qy(t){if(Pe&6)throw Error(se(327));Ws();var e=ju(t,0);if(!(e&1))return Kt(t,lt()),null;var n=lc(t,e);if(t.tag!==0&&n===2){var i=Fd(t);i!==0&&(e=i,n=hg(t,i))}if(n===1)throw n=Ba,Mr(t,0),Wi(t,e),Kt(t,lt()),n;if(n===6)throw Error(se(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ar(t,$t,fi),Kt(t,lt()),null}function o_(t,e){var n=Pe;Pe|=1;try{return t(e)}finally{Pe=n,Pe===0&&(Js=lt()+500,fh&&cr())}}function jr(t){ji!==null&&ji.tag===0&&!(Pe&6)&&Ws();var e=Pe;Pe|=1;var n=wn.transition,i=Fe;try{if(wn.transition=null,Fe=1,t)return t()}finally{Fe=i,wn.transition=n,Pe=e,!(Pe&6)&&cr()}}function a_(){en=Is.current,$e(Is)}function Mr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,mC(n)),ht!==null)for(n=ht.return;n!==null;){var i=n;switch(Vp(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Ku();break;case 3:Zs(),$e(Yt),$e(Dt),Gp();break;case 5:Kp(i);break;case 4:Zs();break;case 13:$e(Je);break;case 19:$e(Je);break;case 10:$p(i.type._context);break;case 22:case 23:a_()}n=n.return}if(wt=t,ht=t=ir(t.current,null),Rt=en=e,_t=0,Ba=null,r_=_h=Hr=0,$t=fa=null,Ir!==null){for(e=0;e<Ir.length;e++)if(n=Ir[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var l=s.next;s.next=r,i.next=l}n.pending=i}Ir=null}return t}function hT(t,e){do{var n=ht;try{if(jp(),wu.current=rc,ic){for(var i=it.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}ic=!1}if(Wr=0,vt=pt=it=null,ca=!1,La=0,i_.current=null,n===null||n.return===null){_t=1,Ba=e,ht=null;break}e:{var s=t,l=n.return,u=n,f=e;if(e=Rt,u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){var d=f,p=u,_=p.tag;if(!(p.mode&1)&&(_===0||_===11||_===15)){var y=p.alternate;y?(p.updateQueue=y.updateQueue,p.memoizedState=y.memoizedState,p.lanes=y.lanes):(p.updateQueue=null,p.memoizedState=null)}var E=Ly(l);if(E!==null){E.flags&=-257,Dy(E,l,u,s,e),E.mode&1&&Oy(s,d,e),e=E,f=d;var T=e.updateQueue;if(T===null){var k=new Set;k.add(f),e.updateQueue=k}else T.add(f);break e}else{if(!(e&1)){Oy(s,d,e),l_();break e}f=Error(se(426))}}else if(qe&&u.mode&1){var M=Ly(l);if(M!==null){!(M.flags&65536)&&(M.flags|=256),Dy(M,l,u,s,e),Wp(Qs(f,u));break e}}s=f=Qs(f,u),_t!==4&&(_t=2),fa===null?fa=[s]:fa.push(s),s=l;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var b=qw(s,f,e);Cy(s,b);break e;case 1:u=f;var w=s.type,A=s.stateNode;if(!(s.flags&128)&&(typeof w.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(tr===null||!tr.has(A)))){s.flags|=65536,e&=-e,s.lanes|=e;var N=Kw(s,u,e);Cy(s,N);break e}}s=s.return}while(s!==null)}gT(n)}catch(D){e=D,ht===n&&n!==null&&(ht=n=n.return);continue}break}while(1)}function fT(){var t=sc.current;return sc.current=rc,t===null?rc:t}function l_(){(_t===0||_t===3||_t===2)&&(_t=4),wt===null||!(Hr&268435455)&&!(_h&268435455)||Wi(wt,Rt)}function lc(t,e){var n=Pe;Pe|=2;var i=fT();(wt!==t||Rt!==e)&&(fi=null,Mr(t,e));do try{WC();break}catch(r){hT(t,r)}while(1);if(jp(),Pe=n,sc.current=i,ht!==null)throw Error(se(261));return wt=null,Rt=0,_t}function WC(){for(;ht!==null;)dT(ht)}function HC(){for(;ht!==null&&!gR();)dT(ht)}function dT(t){var e=_T(t.alternate,t,en);t.memoizedProps=t.pendingProps,e===null?gT(t):ht=e,i_.current=null}function gT(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=DC(n,e),n!==null){n.flags&=32767,ht=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{_t=6,ht=null;return}}else if(n=LC(n,e,en),n!==null){ht=n;return}if(e=e.sibling,e!==null){ht=e;return}ht=e=t}while(e!==null);_t===0&&(_t=5)}function Ar(t,e,n){var i=Fe,r=wn.transition;try{wn.transition=null,Fe=1,jC(t,e,n,i)}finally{wn.transition=r,Fe=i}return null}function jC(t,e,n,i){do Ws();while(ji!==null);if(Pe&6)throw Error(se(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(se(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(xR(t,s),t===wt&&(ht=wt=null,Rt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Fl||(Fl=!0,mT(Hu,function(){return Ws(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=wn.transition,wn.transition=null;var l=Fe;Fe=1;var u=Pe;Pe|=4,i_.current=null,BC(t,n),lT(n,t),cC(Hd),$u=!!Wd,Hd=Wd=null,t.current=n,UC(n),pR(),Pe=u,Fe=l,wn.transition=s}else t.current=n;if(Fl&&(Fl=!1,ji=t,ac=r),s=t.pendingLanes,s===0&&(tr=null),yR(n.stateNode),Kt(t,lt()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(oc)throw oc=!1,t=ug,ug=null,t;return ac&1&&t.tag!==0&&Ws(),s=t.pendingLanes,s&1?t===cg?da++:(da=0,cg=t):da=0,cr(),null}function Ws(){if(ji!==null){var t=qE(ac),e=wn.transition,n=Fe;try{if(wn.transition=null,Fe=16>t?16:t,ji===null)var i=!1;else{if(t=ji,ji=null,ac=0,Pe&6)throw Error(se(331));var r=Pe;for(Pe|=4,de=t.current;de!==null;){var s=de,l=s.child;if(de.flags&16){var u=s.deletions;if(u!==null){for(var f=0;f<u.length;f++){var d=u[f];for(de=d;de!==null;){var p=de;switch(p.tag){case 0:case 11:case 15:ha(8,p,s)}var _=p.child;if(_!==null)_.return=p,de=_;else for(;de!==null;){p=de;var y=p.sibling,E=p.return;if(sT(p),p===d){de=null;break}if(y!==null){y.return=E,de=y;break}de=E}}}var T=s.alternate;if(T!==null){var k=T.child;if(k!==null){T.child=null;do{var M=k.sibling;k.sibling=null,k=M}while(k!==null)}}de=s}}if(s.subtreeFlags&2064&&l!==null)l.return=s,de=l;else e:for(;de!==null;){if(s=de,s.flags&2048)switch(s.tag){case 0:case 11:case 15:ha(9,s,s.return)}var b=s.sibling;if(b!==null){b.return=s.return,de=b;break e}de=s.return}}var w=t.current;for(de=w;de!==null;){l=de;var A=l.child;if(l.subtreeFlags&2064&&A!==null)A.return=l,de=A;else e:for(l=w;de!==null;){if(u=de,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:ph(9,u)}}catch(D){at(u,u.return,D)}if(u===l){de=null;break e}var N=u.sibling;if(N!==null){N.return=u.return,de=N;break e}de=u.return}}if(Pe=r,cr(),ni&&typeof ni.onPostCommitFiberRoot=="function")try{ni.onPostCommitFiberRoot(ah,t)}catch{}i=!0}return i}finally{Fe=n,wn.transition=e}}return!1}function Ky(t,e,n){e=Qs(n,e),e=qw(t,e,1),t=er(t,e,1),e=zt(),t!==null&&(Qa(t,1,e),Kt(t,e))}function at(t,e,n){if(t.tag===3)Ky(t,t,n);else for(;e!==null;){if(e.tag===3){Ky(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(tr===null||!tr.has(i))){t=Qs(n,t),t=Kw(e,t,1),e=er(e,t,1),t=zt(),e!==null&&(Qa(e,1,t),Kt(e,t));break}}e=e.return}}function $C(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=zt(),t.pingedLanes|=t.suspendedLanes&n,wt===t&&(Rt&n)===n&&(_t===4||_t===3&&(Rt&130023424)===Rt&&500>lt()-s_?Mr(t,0):r_|=n),Kt(t,e)}function pT(t,e){e===0&&(t.mode&1?(e=Rl,Rl<<=1,!(Rl&130023424)&&(Rl=4194304)):e=1);var n=zt();t=Ti(t,e),t!==null&&(Qa(t,e,n),Kt(t,n))}function XC(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),pT(t,n)}function YC(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(se(314))}i!==null&&i.delete(e),pT(t,n)}var _T;_T=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Yt.current)Xt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Xt=!1,OC(t,e,n);Xt=!!(t.flags&131072)}else Xt=!1,qe&&e.flags&1048576&&Ew(e,Qu,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Su(t,e),t=e.pendingProps;var r=qs(e,Dt.current);Vs(e,n),r=Qp(null,e,i,t,r,n);var s=Jp();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,qt(i)?(s=!0,Gu(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Yp(e),r.updater=gh,e.stateNode=r,r._reactInternals=e,Qd(e,i,t,n),e=tg(null,e,i,!0,s,n)):(e.tag=0,qe&&s&&zp(e),Ut(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Su(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=KC(i),t=Pn(i,t),r){case 0:e=eg(null,e,i,t,n);break e;case 1:e=Uy(null,e,i,t,n);break e;case 11:e=Fy(null,e,i,t,n);break e;case 14:e=By(null,e,i,Pn(i.type,t),n);break e}throw Error(se(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Pn(i,r),eg(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Pn(i,r),Uy(t,e,i,r,n);case 3:e:{if(Jw(e),t===null)throw Error(se(387));i=e.pendingProps,s=e.memoizedState,r=s.element,bw(t,e),tc(e,i,null,n);var l=e.memoizedState;if(i=l.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Qs(Error(se(423)),e),e=zy(t,e,i,n,r);break e}else if(i!==r){r=Qs(Error(se(424)),e),e=zy(t,e,i,n,r);break e}else for(nn=Ji(e.stateNode.containerInfo.firstChild),sn=e,qe=!0,Mn=null,n=xw(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ks(),i===r){e=Si(t,e,n);break e}Ut(t,e,i,n)}e=e.child}return e;case 5:return Rw(e),t===null&&Kd(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,l=r.children,jd(i,r)?l=null:s!==null&&jd(i,s)&&(e.flags|=32),Qw(t,e),Ut(t,e,l,n),e.child;case 6:return t===null&&Kd(e),null;case 13:return eT(t,e,n);case 4:return qp(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Gs(e,null,i,n):Ut(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Pn(i,r),Fy(t,e,i,r,n);case 7:return Ut(t,e,e.pendingProps,n),e.child;case 8:return Ut(t,e,e.pendingProps.children,n),e.child;case 12:return Ut(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,l=r.value,He(Ju,i._currentValue),i._currentValue=l,s!==null)if(zn(s.value,l)){if(s.children===r.children&&!Yt.current){e=Si(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var u=s.dependencies;if(u!==null){l=s.child;for(var f=u.firstContext;f!==null;){if(f.context===i){if(s.tag===1){f=yi(-1,n&-n),f.tag=2;var d=s.updateQueue;if(d!==null){d=d.shared;var p=d.pending;p===null?f.next=f:(f.next=p.next,p.next=f),d.pending=f}}s.lanes|=n,f=s.alternate,f!==null&&(f.lanes|=n),Gd(s.return,n,e),u.lanes|=n;break}f=f.next}}else if(s.tag===10)l=s.type===e.type?null:s.child;else if(s.tag===18){if(l=s.return,l===null)throw Error(se(341));l.lanes|=n,u=l.alternate,u!==null&&(u.lanes|=n),Gd(l,n,e),l=s.sibling}else l=s.child;if(l!==null)l.return=s;else for(l=s;l!==null;){if(l===e){l=null;break}if(s=l.sibling,s!==null){s.return=l.return,l=s;break}l=l.return}s=l}Ut(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Vs(e,n),r=Sn(r),i=i(r),e.flags|=1,Ut(t,e,i,n),e.child;case 14:return i=e.type,r=Pn(i,e.pendingProps),r=Pn(i.type,r),By(t,e,i,r,n);case 15:return Gw(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Pn(i,r),Su(t,e),e.tag=1,qt(i)?(t=!0,Gu(e)):t=!1,Vs(e,n),Yw(e,i,r),Qd(e,i,r,n),tg(null,e,i,!0,t,n);case 19:return tT(t,e,n);case 22:return Zw(t,e,n)}throw Error(se(156,e.tag))};function mT(t,e){return jE(t,e)}function qC(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function En(t,e,n,i){return new qC(t,e,n,i)}function u_(t){return t=t.prototype,!(!t||!t.isReactComponent)}function KC(t){if(typeof t=="function")return u_(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Cp)return 11;if(t===kp)return 14}return 2}function ir(t,e){var n=t.alternate;return n===null?(n=En(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function bu(t,e,n,i,r,s){var l=2;if(i=t,typeof t=="function")u_(t)&&(l=1);else if(typeof t=="string")l=5;else e:switch(t){case Es:return Or(n.children,r,s,e);case Rp:l=8,r|=8;break;case Td:return t=En(12,n,e,r|2),t.elementType=Td,t.lanes=s,t;case Sd:return t=En(13,n,e,r),t.elementType=Sd,t.lanes=s,t;case xd:return t=En(19,n,e,r),t.elementType=xd,t.lanes=s,t;case RE:return mh(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case AE:l=10;break e;case bE:l=9;break e;case Cp:l=11;break e;case kp:l=14;break e;case Di:l=16,i=null;break e}throw Error(se(130,t==null?t:typeof t,""))}return e=En(l,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Or(t,e,n,i){return t=En(7,t,i,e),t.lanes=n,t}function mh(t,e,n,i){return t=En(22,t,i,e),t.elementType=RE,t.lanes=n,t.stateNode={isHidden:!1},t}function Rf(t,e,n){return t=En(6,t,null,e),t.lanes=n,t}function Cf(t,e,n){return e=En(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function GC(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lf(0),this.expirationTimes=lf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lf(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function c_(t,e,n,i,r,s,l,u,f){return t=new GC(t,e,n,u,f),e===1?(e=1,s===!0&&(e|=8)):e=0,s=En(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Yp(s),t}function ZC(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:vs,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function yT(t){if(!t)return or;t=t._reactInternals;e:{if(Gr(t)!==t||t.tag!==1)throw Error(se(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(qt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(se(171))}if(t.tag===1){var n=t.type;if(qt(n))return yw(t,n,e)}return e}function vT(t,e,n,i,r,s,l,u,f){return t=c_(n,i,!0,t,r,s,l,u,f),t.context=yT(null),n=t.current,i=zt(),r=nr(n),s=yi(i,r),s.callback=e??null,er(n,s,r),t.current.lanes=r,Qa(t,r,i),Kt(t,i),t}function yh(t,e,n,i){var r=e.current,s=zt(),l=nr(r);return n=yT(n),e.context===null?e.context=n:e.pendingContext=n,e=yi(s,l),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=er(r,e,l),t!==null&&(Bn(t,r,l,s),Eu(t,r,l)),l}function uc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Gy(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function h_(t,e){Gy(t,e),(t=t.alternate)&&Gy(t,e)}function QC(){return null}var ET=typeof reportError=="function"?reportError:function(t){console.error(t)};function f_(t){this._internalRoot=t}vh.prototype.render=f_.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(se(409));yh(t,e,null,null)};vh.prototype.unmount=f_.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;jr(function(){yh(null,t,null,null)}),e[wi]=null}};function vh(t){this._internalRoot=t}vh.prototype.unstable_scheduleHydration=function(t){if(t){var e=ZE();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Vi.length&&e!==0&&e<Vi[n].priority;n++);Vi.splice(n,0,t),n===0&&JE(t)}};function d_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Eh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Zy(){}function JC(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var d=uc(l);s.call(d)}}var l=vT(e,i,t,0,null,!1,!1,"",Zy);return t._reactRootContainer=l,t[wi]=l.current,Ia(t.nodeType===8?t.parentNode:t),jr(),l}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var u=i;i=function(){var d=uc(f);u.call(d)}}var f=c_(t,0,!1,null,null,!1,!1,"",Zy);return t._reactRootContainer=f,t[wi]=f.current,Ia(t.nodeType===8?t.parentNode:t),jr(function(){yh(e,f,n,i)}),f}function wh(t,e,n,i,r){var s=n._reactRootContainer;if(s){var l=s;if(typeof r=="function"){var u=r;r=function(){var f=uc(l);u.call(f)}}yh(e,l,t,r)}else l=JC(n,e,t,r,i);return uc(l)}KE=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=qo(e.pendingLanes);n!==0&&(Np(e,n|1),Kt(e,lt()),!(Pe&6)&&(Js=lt()+500,cr()))}break;case 13:jr(function(){var i=Ti(t,1);if(i!==null){var r=zt();Bn(i,t,1,r)}}),h_(t,1)}};Mp=function(t){if(t.tag===13){var e=Ti(t,134217728);if(e!==null){var n=zt();Bn(e,t,134217728,n)}h_(t,134217728)}};GE=function(t){if(t.tag===13){var e=nr(t),n=Ti(t,e);if(n!==null){var i=zt();Bn(n,t,e,i)}h_(t,e)}};ZE=function(){return Fe};QE=function(t,e){var n=Fe;try{return Fe=t,e()}finally{Fe=n}};Od=function(t,e,n){switch(e){case"input":if(Rd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=hh(i);if(!r)throw Error(se(90));kE(i),Rd(i,r)}}}break;case"textarea":PE(t,n);break;case"select":e=n.value,e!=null&&Fs(t,!!n.multiple,e,!1)}};BE=o_;UE=jr;var ek={usingClientEntryPoint:!1,Events:[el,xs,hh,DE,FE,o_]},Bo={findFiberByHostInstance:kr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tk={bundleType:Bo.bundleType,version:Bo.version,rendererPackageName:Bo.rendererPackageName,rendererConfig:Bo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:bi.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=WE(t),t===null?null:t.stateNode},findFiberByHostInstance:Bo.findFiberByHostInstance||QC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bl.isDisabled&&Bl.supportsFiber)try{ah=Bl.inject(tk),ni=Bl}catch{}}an.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ek;an.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d_(e))throw Error(se(200));return ZC(t,e,null,n)};an.createRoot=function(t,e){if(!d_(t))throw Error(se(299));var n=!1,i="",r=ET;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=c_(t,1,!1,null,null,n,!1,i,r),t[wi]=e.current,Ia(t.nodeType===8?t.parentNode:t),new f_(e)};an.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(se(188)):(t=Object.keys(t).join(","),Error(se(268,t)));return t=WE(e),t=t===null?null:t.stateNode,t};an.flushSync=function(t){return jr(t)};an.hydrate=function(t,e,n){if(!Eh(e))throw Error(se(200));return wh(null,t,e,!0,n)};an.hydrateRoot=function(t,e,n){if(!d_(t))throw Error(se(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",l=ET;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),e=vT(e,null,t,1,n??null,r,!1,s,l),t[wi]=e.current,Ia(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new vh(e)};an.render=function(t,e,n){if(!Eh(e))throw Error(se(200));return wh(null,t,e,!1,n)};an.unmountComponentAtNode=function(t){if(!Eh(t))throw Error(se(40));return t._reactRootContainer?(jr(function(){wh(null,null,t,!1,function(){t._reactRootContainer=null,t[wi]=null})}),!0):!1};an.unstable_batchedUpdates=o_;an.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Eh(n))throw Error(se(200));if(t==null||t._reactInternals===void 0)throw Error(se(38));return wh(t,e,n,!1,i)};an.version="18.3.1-next-f1338f8080-20240426";function wT(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(wT)}catch(t){console.error(t)}}wT(),wE.exports=an;var g_=wE.exports,TT,Qy=g_;TT=Qy.createRoot,Qy.hydrateRoot;function cc(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const p_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Jy=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Jy&&parseFloat(Jy[1]);const Ul=globalThis,hs=globalThis.process||{},nk=globalThis.navigator||{};function ST(t){var i,r;if(typeof window<"u"&&((i=window.process)==null?void 0:i.type)==="renderer"||typeof process<"u"&&((r=process.versions)!=null&&r.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Zr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||ST()}function ik(t){return!t&&!Zr()?"Node":ST(t)?"Electron":(t||nk.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const xT="4.1.0";function rk(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class sk{constructor(e,n,i="sessionStorage"){this.storage=rk(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function ok(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function ak(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var hc;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(hc||(hc={}));const lk=10;function ev(t){return typeof t!="string"?t:(t=t.toUpperCase(),hc[t]||hc.WHITE)}function uk(t,e,n){return!Zr&&typeof t=="string"&&(e&&(t=`\x1B[${ev(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${ev(n)+lk}m${t}\x1B[49m`)),t}function ck(t,e=["constructor"]){const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),r=t;for(const s of i){const l=r[s];typeof l=="function"&&(e.find(u=>s===u)||(r[s]=l.bind(t)))}}function __(t,e){if(!t)throw new Error(e||"Assertion failed")}function fs(){var e,n,i;let t;if(Zr()&&Ul.performance)t=(n=(e=Ul==null?void 0:Ul.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in hs){const r=(i=hs==null?void 0:hs.hrtime)==null?void 0:i.call(hs);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const ds={debug:Zr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},hk={enabled:!0,level:0};function gs(){}const tv={},nv={once:!0};class nl{constructor({id:e}={id:""}){this.VERSION=xT,this._startTs=fs(),this._deltaTs=fs(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new sk(`__probe-${this.id}__`,hk),this.timeStamp(`${this.id} started`),ck(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((fs()-this._startTs).toPrecision(10))}getDelta(){return Number((fs()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ds.warn,arguments,nv)}error(e){return this._getLogFunction(0,e,ds.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,ds.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,ds.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,ds.debug||ds.info,arguments,nv)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||gs,i&&[i],{tag:dk(n)}):gs}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||gs)}group(e,n,i={collapsed:!1}){const r=iv({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n,i={}){return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||gs)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=AT(e)}_getLogFunction(e,n,i,r,s){if(this._shouldLog(e)){s=iv({logLevel:e,message:n,args:r,opts:s}),i=i||s.method,__(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=fs();const l=s.tag||s.message;if(s.once&&l)if(!tv[l])tv[l]=fs();else return gs;return n=fk(this.id,s.message,s),i.bind(console,n,...s.args)}return gs}}nl.VERSION=xT;function AT(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return __(Number.isFinite(e)&&e>=0),e}function iv(t){const{logLevel:e,message:n}=t;t.logLevel=AT(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return __(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function fk(t,e,n){if(typeof e=="string"){const i=n.time?ak(ok(n.total)):"";e=n.time?`${t}: ${i}  ${e}`:`${t}: ${e}`,e=uk(e,n.color,n.background)}return e}function dk(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const kf="4.3.2",gk=kf[0]>="0"&&kf[0]<="9"?`v${kf}`:"";function pk(){const t=new nl({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=gk,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const _k=pk();function mk(t,e){return bT(t||{},e)}function bT(t,e,n=0){if(n>3)return e;const i={...t};for(const[r,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?i[r]=bT(i[r]||{},e[r],n+1):i[r]=e[r];return i}const yk="latest";function vk(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const Ek=vk();function ar(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Lr=typeof process!="object"||String(process)!=="[object process]"||process.browser,wk=typeof window<"u"&&typeof window.orientation<"u",rv=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);rv&&parseFloat(rv[1]);class Tk{constructor(e,n){C(this,"name");C(this,"workerThread");C(this,"isRunning",!0);C(this,"result");C(this,"_resolve",()=>{});C(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){ar(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ar(this.isRunning),this.isRunning=!1,this._reject(e)}}class If{terminate(){}}const Pf=new Map;function Sk(t){ar(t.source&&!t.url||!t.source&&t.url);let e=Pf.get(t.source||t.url);return e||(t.url&&(e=xk(t.url),Pf.set(t.url,e)),t.source&&(e=RT(t.source),Pf.set(t.source,e))),ar(e),e}function xk(t){if(!t.startsWith("http"))return t;const e=Ak(t);return RT(e)}function RT(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Ak(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function CT(t,e=!0,n){const i=n||new Set;if(t){if(sv(t))i.add(t);else if(sv(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)CT(t[r],e,i)}}return n===void 0?Array.from(i):[]}function sv(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Nf=()=>{};class dg{constructor(e){C(this,"name");C(this,"source");C(this,"url");C(this,"terminated",!1);C(this,"worker");C(this,"onMessage");C(this,"onError");C(this,"_loadableURL","");const{name:n,source:i,url:r}=e;ar(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=Nf,this.onError=s=>console.log(s),this.worker=Lr?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Lr||typeof If<"u"&&!Lr}destroy(){this.onMessage=Nf,this.onError=Nf,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||CT(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=Sk({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new If(i,{eval:!1})}else if(this.source)e=new If(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class bk{constructor(e){C(this,"name","unnamed");C(this,"source");C(this,"url");C(this,"maxConcurrency",1);C(this,"maxMobileConcurrency",1);C(this,"onDebug",()=>{});C(this,"reuseWorkers",!0);C(this,"props",{});C(this,"jobQueue",[]);C(this,"idleQueue",[]);C(this,"count",0);C(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return dg.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(r,s,l)=>r.done(l),i=(r,s)=>r.error(s)){const r=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new Tk(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Lr||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new dg({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return wk?this.maxMobileConcurrency:this.maxConcurrency}}const Rk={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Ui=class Ui{constructor(e){C(this,"props");C(this,"workerPools",new Map);this.props={...Rk},this.setProps(e),this.workerPools=new Map}static isSupported(){return dg.isSupported()}static getWorkerFarm(e={}){return Ui._workerFarm=Ui._workerFarm||new Ui({}),Ui._workerFarm.setProps(e),Ui._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let s=this.workerPools.get(n);return s||(s=new bk({name:n,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};C(Ui,"_workerFarm");let fc=Ui;function Ck(t,e={}){const n=e[t.id]||{},i=Lr?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(Lr?r=`modules/${t.module}/dist/${i}`:r=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!r){let s=t.version;s==="latest"&&(s=yk);const l=s?`@${s}`:"";r=`https://unpkg.com/@loaders.gl/${t.module}${l}/dist/${i}`}return ar(r),r}function kk(t,e=Ek){ar(t,"no worker provided");const n=t.version;return!(!e||!n)}function Ik(t,e){return!fc.isSupported()||!Lr&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function Pk(t,e,n,i,r){const s=t.id,l=Ck(t,n),f=fc.getWorkerFarm(n).getWorkerPool({name:s,url:l});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const d=await f.startJob("process-on-worker",Nk.bind(null,r));return d.postMessage("process",{input:e,options:n,context:i}),await(await d.result).result}async function Nk(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:l}=i;try{const u=await t(s,l);e.postMessage("done",{id:r,result:u})}catch(u){const f=u instanceof Error?u.message:"unknown error";e.postMessage("error",{id:r,error:f})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function Mk(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}function Ok(...t){return Lk(t)}function Lk(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,l)=>s+l.byteLength,0),i=new Uint8Array(n);let r=0;for(const s of e)i.set(s,r),r+=s.byteLength;return i.buffer}async function Dk(t){const e=[];for await(const n of t)e.push(n);return Ok(...e)}function ov(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class av{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ov(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ov()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Th{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:i}=e;let r=this.stats[n];return r||(e instanceof av?r=e:r=new av(n,i),this.stats[n]=r),r}}let Fk="";const lv={};function Bk(t){for(const e in lv)if(t.startsWith(e)){const n=lv[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${Fk}${t}`),t}function Uk(t){return t&&typeof t=="object"&&t.isBuffer}function kT(t){if(Uk(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function IT(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function zk(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const Vk=t=>typeof t=="boolean",ga=t=>typeof t=="function",il=t=>t!==null&&typeof t=="object",uv=t=>il(t)&&t.constructor==={}.constructor,Wk=t=>!!t&&typeof t[Symbol.iterator]=="function",Hk=t=>t&&typeof t[Symbol.asyncIterator]=="function",Qr=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Jr=t=>typeof Blob<"u"&&t instanceof Blob,jk=t=>t&&typeof t=="object"&&t.isBuffer,$k=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||il(t)&&ga(t.tee)&&ga(t.cancel)&&ga(t.getReader),Xk=t=>il(t)&&ga(t.read)&&ga(t.pipe)&&Vk(t.readable),PT=t=>$k(t)||Xk(t);class Yk extends Error{constructor(n,i){super(n);C(this,"reason");C(this,"url");C(this,"response");this.reason=i.reason,this.url=i.url,this.response=i.response}}const qk=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Kk=/^([-\w.]+\/[-\w.+]+)/;function cv(t,e){return t.toLowerCase()===e.toLowerCase()}function Gk(t){const e=Kk.exec(t);return e?e[1]:t}function hv(t){const e=qk.exec(t);return e?e[1]:""}const NT=/\?.*/;function Zk(t){const e=t.match(NT);return e&&e[0]}function m_(t){return t.replace(NT,"")}function Qk(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Sh(t){return Qr(t)?t.url:Jr(t)?t.name||"":typeof t=="string"?t:""}function y_(t){if(Qr(t)){const e=t,n=e.headers.get("content-type")||"",i=m_(e.url);return Gk(n)||hv(i)}return Jr(t)?t.type||"":typeof t=="string"?hv(t):""}function Jk(t){return Qr(t)?t.headers["content-length"]||-1:Jr(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function MT(t){if(Qr(t))return t;const e={},n=Jk(t);n>=0&&(e["content-length"]=String(n));const i=Sh(t),r=y_(t);r&&(e["content-type"]=r);const s=await nI(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const l=new Response(t,{headers:e});return Object.defineProperty(l,"url",{value:i}),l}async function eI(t){if(!t.ok)throw await tI(t)}async function tI(t){const e=Qk(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const i={reason:t.statusText,url:t.url,response:t};try{const r=t.headers.get("Content-Type");i.reason=!t.bodyUsed&&(r!=null&&r.includes("application/json"))?await t.json():await t.text()}catch{}return new Yk(n,i)}async function nI(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>{var l;return i((l=s==null?void 0:s.target)==null?void 0:l.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${iI(n)}`}return null}function iI(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}function rI(t){return!sI(t)&&!oI(t)}function sI(t){return t.startsWith("http:")||t.startsWith("https:")}function oI(t){return t.startsWith("data:")}async function fv(t,e){var n,i;if(typeof t=="string"){const r=Bk(t);return rI(r)&&(n=globalThis.loaders)!=null&&n.fetchNode?(i=globalThis.loaders)==null?void 0:i.fetchNode(r,e):await fetch(r,e)}return await MT(t)}const dv=new nl({id:"loaders.gl"});class aI{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class lI{constructor(){C(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const OT={fetch:null,mimeType:void 0,nothrow:!1,log:new lI,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:p_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},uI={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function LT(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function DT(){const t=LT();return t.globalOptions=t.globalOptions||{...OT},t.globalOptions}function cI(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],hI(t,n),dI(e,t,i)}function hI(t,e){gv(t,null,OT,uI,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};gv(i,n.id,r,s,e)}}function gv(t,e,n,i,r){const s=e||"Top level",l=e?`${e}.`:"";for(const u in t){const f=!e&&il(t[u]),d=u==="baseUri"&&!e,p=u==="workerUrl"&&e;if(!(u in n)&&!d&&!p){if(u in i)dv.warn(`${s} loader option '${l}${u}' no longer supported, use '${i[u]}'`)();else if(!f){const _=fI(u,r);dv.warn(`${s} loader option '${l}${u}' not recognized. ${_}`)()}}}}function fI(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const s in r.options){if(t===s)return`Did you mean '${r.id}.${s}'?`;const l=s.toLowerCase();(n.startsWith(l)||l.startsWith(n))&&(i=i||`Did you mean '${r.id}.${s}'?`)}return i}function dI(t,e,n){const r={...t.options||{}};return gI(r,n),r.log===null&&(r.log=new aI),pv(r,DT()),pv(r,e),r}function pv(t,e){for(const n in e)if(n in e){const i=e[n];uv(i)&&uv(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function gI(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function v_(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function E_(t){cc(t,"null loader"),cc(v_(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const FT=()=>{const t=LT();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function pI(t){const e=FT();t=Array.isArray(t)?t:[t];for(const n of t){const i=E_(n);e.find(r=>i===r)||e.unshift(i)}}function _I(){return FT()}const mI=/\.([^.]+)$/;async function yI(t,e=[],n,i){if(!BT(t))return null;let r=_v(t,e,{...n,nothrow:!0},i);if(r)return r;if(Jr(t)&&(t=await t.slice(0,10).arrayBuffer(),r=_v(t,e,n,i)),!r&&!(n!=null&&n.nothrow))throw new Error(UT(t));return r}function _v(t,e=[],n,i){if(!BT(t))return null;if(e&&!Array.isArray(e))return E_(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(..._I()),EI(r);const s=vI(t,r,n,i);if(!s&&!(n!=null&&n.nothrow))throw new Error(UT(t));return s}function vI(t,e,n,i){const r=Sh(t),s=y_(t),l=m_(r)||(i==null?void 0:i.url);let u=null,f="";return n!=null&&n.mimeType&&(u=Mf(e,n==null?void 0:n.mimeType),f=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),u=u||wI(e,l),f=f||(u?`matched url ${l}`:""),u=u||Mf(e,s),f=f||(u?`matched MIME type ${s}`:""),u=u||SI(e,t),f=f||(u?`matched initial data ${zT(t)}`:""),n!=null&&n.fallbackMimeType&&(u=u||Mf(e,n==null?void 0:n.fallbackMimeType),f=f||(u?`matched fallback MIME type ${s}`:"")),f&&_k.log(1,`selectLoader selected ${u==null?void 0:u.name}: ${f}.`),u}function BT(t){return!(t instanceof Response&&t.status===204)}function UT(t){const e=Sh(t),n=y_(t);let i="No valid loader found (";i+=e?`${IT(e)}, `:"no url provided, ",i+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=t?zT(t):"";return i+=r?` first bytes: "${r}"`:"first bytes: not available",i+=")",i}function EI(t){for(const e of t)E_(e)}function wI(t,e){const n=e&&mI.exec(e),i=n&&n[1];return i?TI(t,i):null}function TI(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function Mf(t,e){var n;for(const i of t)if((n=i.mimeTypes)!=null&&n.some(r=>cv(e,r))||cv(e,`application/x.${i.id}`))return i;return null}function SI(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(xI(e,n))return n}else if(ArrayBuffer.isView(e)){if(mv(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&mv(e,0,n))return n;return null}function xI(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function mv(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>AI(t,e,n,r))}function AI(t,e,n,i){if(i instanceof ArrayBuffer)return Mk(i,t,i.byteLength);switch(typeof i){case"function":return i(t);case"string":const r=gg(t,e,i.length);return i===r;default:return!1}}function zT(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?gg(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?gg(t,0,e):""}function gg(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}const bI=256*1024;function*RI(t,e){const n=(e==null?void 0:e.chunkSize)||bI;let i=0;const r=new TextEncoder;for(;i<t.length;){const s=Math.min(t.length-i,n),l=t.slice(i,i+s);i+=s,yield r.encode(l)}}const CI=256*1024;function*kI(t,e={}){const{chunkSize:n=CI}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),s=new ArrayBuffer(r),l=new Uint8Array(t,i,r);new Uint8Array(s).set(l),i+=r,yield s}}const II=1024*1024;async function*PI(t,e){const n=(e==null?void 0:e.chunkSize)||II;let i=0;for(;i<t.size;){const r=i+n,s=await t.slice(i,r).arrayBuffer();i=r,yield s}}function yv(t,e){return p_?NI(t,e):MI(t)}async function*NI(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:s,value:l}=await r;if(s)return;yield kT(l)}}catch{n.releaseLock()}}async function*MI(t,e){for await(const n of t)yield kT(n)}function OI(t,e){if(typeof t=="string")return RI(t,e);if(t instanceof ArrayBuffer)return kI(t,e);if(Jr(t))return PI(t,e);if(PT(t))return yv(t,e);if(Qr(t))return yv(t.body,e);throw new Error("makeIterator")}const VT="Cannot convert supplied data type";function LI(t,e,n){if(e.text&&typeof t=="string")return t;if(jk(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(VT)}async function DI(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return LI(t,e);if(Jr(t)&&(t=await MT(t)),Qr(t)){const r=t;return await eI(r),e.binary?await r.arrayBuffer():await r.text()}if(PT(t)&&(t=OI(t,n)),Wk(t)||Hk(t))return Dk(t);throw new Error(VT)}function WT(t,e){const n=DT(),i=t||n;return typeof i.fetch=="function"?i.fetch:il(i.fetch)?r=>fv(r,i.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:fv}function FI(t,e,n){if(n)return n;const i={fetch:WT(e,t),...t};if(i.url){const r=m_(i.url);i.baseUrl=r,i.queryString=Zk(i.url),i.filename=IT(r),i.baseUrl=zk(r)}return Array.isArray(i.loaders)||(i.loaders=null),i}function BI(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:void 0}async function dc(t,e,n,i){e&&!Array.isArray(e)&&!v_(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const r=Sh(t),l=BI(e,i),u=await yI(t,l,n);return u?(n=cI(n,u,l,r),i=FI({url:r,_parse:dc,loaders:l},n,i||null),await UI(u,t,n,i)):null}async function UI(t,e,n,i){if(kk(t),n=mk(t.options,n),Qr(e)){const s=e,{ok:l,redirected:u,status:f,statusText:d,type:p,url:_}=s,y=Object.fromEntries(s.headers.entries());i.response={headers:y,ok:l,redirected:u,status:f,statusText:d,type:p,url:_}}e=await DI(e,t,n);const r=t;if(r.parseTextSync&&typeof e=="string")return r.parseTextSync(e,n,i);if(Ik(t,n))return await Pk(t,e,n,i,dc);if(r.parseText&&typeof e=="string")return await r.parseText(e,n,i);if(r.parse)return await r.parse(e,n,i);throw ar(!r.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function gc(t,e,n,i){let r,s;!Array.isArray(e)&&!v_(e)?(r=[],s=e):(r=e,s=n);const l=WT(s);let u=t;return typeof t=="string"&&(u=await l(t)),Jr(t)&&(u=await l(t)),Array.isArray(r)?await dc(u,r,s):await dc(u,r,s)}const zI="4.3.2";var hE;const VI=(hE=globalThis.loaders)==null?void 0:hE.parseImageNode,pg=typeof Image<"u",_g=typeof ImageBitmap<"u",WI=!!VI,mg=p_?!0:WI;function HI(t){switch(t){case"auto":return _g||pg||mg;case"imagebitmap":return _g;case"image":return pg;case"data":return mg;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function jI(){if(_g)return"imagebitmap";if(pg)return"image";if(mg)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function $I(t){const e=YI(t);if(!e)throw new Error("Not an image");return e}function XI(t){switch($I(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function YI(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const qI=/^data:image\/svg\+xml/,KI=/\.svg((\?|#).*)?$/;function w_(t){return t&&(qI.test(t)||KI.test(t))}function GI(t,e){if(w_(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return HT(t,e)}function HT(t,e){if(w_(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function jT(t,e,n){const i=GI(t,n),r=self.URL||self.webkitURL,s=typeof i!="string"&&r.createObjectURL(i);try{return await ZI(s||i,e)}finally{s&&r.revokeObjectURL(s)}}async function ZI(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=s=>{const l=s instanceof Error?s.message:"error";r(new Error(l))}}catch(s){r(s)}})}const QI={};let vv=!0;async function JI(t,e,n){let i;w_(n)?i=await jT(t,e,n):i=HT(t,n);const r=e&&e.imagebitmap;return await eP(i,r)}async function eP(t,e=null){if((tP(e)||!vv)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),vv=!1}return await createImageBitmap(t)}function tP(t){for(const e in t||QI)return!1;return!0}function nP(t){return!oP(t,"ftyp",4)||!(t[8]&96)?null:iP(t)}function iP(t){switch(rP(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function rP(t,e,n){return String.fromCharCode(...t.slice(e,n))}function sP(t){return[...t].map(e=>e.charCodeAt(0))}function oP(t,e,n=0){const i=sP(e);for(let r=0;r<i.length;++r)if(i[r]!==t[r+n])return!1;return!0}const Qn=!1,pa=!0;function $T(t){const e=rl(t);return lP(e)||hP(e)||uP(e)||cP(e)||aP(e)}function aP(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=nP(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function lP(t){const e=rl(t);return e.byteLength>=24&&e.getUint32(0,Qn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Qn),height:e.getUint32(20,Qn)}:null}function uP(t){const e=rl(t);return e.byteLength>=10&&e.getUint32(0,Qn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,pa),height:e.getUint16(8,pa)}:null}function cP(t){const e=rl(t);return e.byteLength>=14&&e.getUint16(0,Qn)===16973&&e.getUint32(2,pa)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,pa),height:e.getUint32(22,pa)}:null}function hP(t){const e=rl(t);if(!(e.byteLength>=3&&e.getUint16(0,Qn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=fP();let s=2;for(;s+9<e.byteLength;){const l=e.getUint16(s,Qn);if(r.has(l))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Qn),width:e.getUint16(s+7,Qn)};if(!i.has(l))return null;s+=2,s+=e.getUint16(s,Qn)}return null}function fP(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function rl(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function dP(t,e){var r;const{mimeType:n}=$T(t)||{},i=(r=globalThis.loaders)==null?void 0:r.parseImageNode;return cc(i),await i(t,n)}async function gP(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:s}=n||{},l=pP(r);let u;switch(l){case"imagebitmap":u=await JI(t,e,s);break;case"image":u=await jT(t,e,s);break;case"data":u=await dP(t);break;default:cc(!1)}return r==="data"&&(u=XI(u)),u}function pP(t){switch(t){case"auto":case"data":return jI();default:return HI(t),t}}const _P=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],mP=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],yP={image:{type:"auto",decode:!0}},vP={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:zI,mimeTypes:mP,extensions:_P,parse:gP,tests:[t=>!!$T(new DataView(t))],options:yP},EP=new nl({id:"deck"}),be=EP;let yg={};function wP(t){yg=t}function Ot(t,e,n,i){be.level>0&&yg[t]&&yg[t].call(null,e,n,i)}function TP(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const SP={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:TP,parseTextSync:JSON.parse};function xP(){const t="9.1.0",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(be.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:be,_registerLoggers:wP},pI([SP,[vP,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const AP=xP();function T_(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Of={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function bP(t){const e={};for(const[n,i]of Object.entries(t))e[n]=RP(i);return e}function RP(t){let e=Ev(t);if(e!=="object")return{value:t,...Of[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Of[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Ev(t.value),{...t,...Of[e],type:e}):{type:"object",value:null};throw new Error("props")}function Ev(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const CP=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,kP=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,IP={vertex:CP,fragment:kP},wv=/void\s+main\s*\([^)]*\)\s*\{\n?/,Tv=/}\n?[^{}]*$/,Lf=[],Ru="__LUMA_INJECT_DECLARATIONS__";function PP(t){const e={vertex:{},fragment:{}};for(const n in t){let i=t[n];const r=NP(n);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function NP(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function pc(t,e,n,i=!1){const r=e==="vertex";for(const s in n){const l=n[s];l.sort((f,d)=>f.order-d.order),Lf.length=l.length;for(let f=0,d=l.length;f<d;++f)Lf[f]=l[f].injection;const u=`${Lf.join(`
`)}
`;switch(s){case"vs:#decl":r&&(t=t.replace(Ru,u));break;case"vs:#main-start":r&&(t=t.replace(wv,f=>f+u));break;case"vs:#main-end":r&&(t=t.replace(Tv,f=>u+f));break;case"fs:#decl":r||(t=t.replace(Ru,u));break;case"fs:#main-start":r||(t=t.replace(wv,f=>f+u));break;case"fs:#main-end":r||(t=t.replace(Tv,f=>u+f));break;default:t=t.replace(s,f=>f+u)}}return t=t.replace(Ru,""),i&&(t=t.replace(/\}\s*$/,s=>s+IP[e])),t}function _c(t){t.map(e=>MP(e))}function MP(t){if(t.instance)return;_c(t.dependencies||[]);const{propTypes:e={},deprecations:n=[],inject:i={}}=t,r={normalizedInjections:PP(i),parsedDeprecations:OP(n)};e&&(r.propValidators=bP(e)),t.instance=r;let s={};e&&(s=Object.entries(e).reduce((l,[u,f])=>{const d=f==null?void 0:f.value;return d&&(l[u]=d),l},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function XT(t,e,n){var i;(i=t.deprecations)==null||i.forEach(r=>{var s;(s=r.regex)!=null&&s.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}function OP(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function S_(t){_c(t);const e={},n={};YT({modules:t,level:0,moduleMap:e,moduleDepth:n});const i=Object.keys(n).sort((r,s)=>n[s]-n[r]).map(r=>e[r]);return _c(i),i}function YT(t){const{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)i[s.name]=s,(r[s.name]===void 0||r[s.name]<n)&&(r[s.name]=n);for(const s of e)s.dependencies&&YT({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function LP(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function DP(t,e){var i;if(Number(((i=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:i[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=Sv(t,FP),t;case"fragment":return t=Sv(t,BP),t;default:throw new Error(e)}}const qT=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],FP=[...qT,[vg("attribute"),"in $1"],[vg("varying"),"out $1"]],BP=[...qT,[vg("varying"),"in $1"]];function Sv(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function vg(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function KT(t,e){let n="";for(const i in t){const r=t[i];if(n+=`void ${r.signature} {
`,r.header&&(n+=`  ${r.header}`),e[i]){const s=e[i];s.sort((l,u)=>l.order-u.order);for(const l of s)n+=`  ${l.injection}
`}r.footer&&(n+=`  ${r.footer}`),n+=`}
`}return n}function GT(t){const e={vertex:{},fragment:{}};for(const n of t){let i,r;typeof n!="string"?(i=n,r=i.hook):(i={},r=n),r=r.trim();const[s,l]=r.split(":"),u=r.replace(/\(.+/,""),f=Object.assign(i,{signature:l});switch(s){case"vs":e.vertex[u]=f;break;case"fs":e.fragment[u]=f;break;default:throw new Error(s)}}return e}function UP(t,e){return{name:zP(t,e),language:"glsl",version:VP(t)}}function zP(t,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return i?i[1]:e}function VP(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const ZT=`

${Ru}
`,WP=`precision highp float;
`;function HP(t){const e=S_(t.modules||[]);return{source:$P(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:QT(e)}}function jP(t){const{vs:e,fs:n}=t,i=S_(t.modules||[]);return{vs:xv(t.platformInfo,{...t,source:e,stage:"vertex",modules:i}),fs:xv(t.platformInfo,{...t,source:n,stage:"fragment",modules:i}),getUniforms:QT(i)}}function $P(t,e){var k;const{source:n,stage:i,modules:r,hookFunctions:s=[],inject:l={},log:u}=e;T_(typeof n=="string","shader source must be a string");const f=n;let d="";const p=GT(s),_={},y={},E={};for(const M in l){const b=typeof l[M]=="string"?{injection:l[M],order:0}:l[M],w=/^(v|f)s:(#)?([\w-]+)$/.exec(M);if(w){const A=w[2],N=w[3];A?N==="decl"?y[M]=[b]:E[M]=[b]:_[M]=[b]}else E[M]=[b]}const T=r;for(const M of T){u&&XT(M,f,u);const b=JT(M,"wgsl");d+=b;const w=((k=M.injections)==null?void 0:k[i])||{};for(const A in w){const N=/^(v|f)s:#([\w-]+)$/.exec(A);if(N){const W=N[2]==="decl"?y:E;W[A]=W[A]||[],W[A].push(w[A])}else _[A]=_[A]||[],_[A].push(w[A])}}return d+=ZT,d=pc(d,i,y),d+=KT(p[i],_),d+=f,d=pc(d,i,E),d}function xv(t,e){var K;const{id:n,source:i,stage:r,language:s="glsl",modules:l,defines:u={},hookFunctions:f=[],inject:d={},prologue:p=!0,log:_}=e;T_(typeof i=="string","shader source must be a string");const y=s==="glsl"?UP(i).version:-1,E=t.shaderLanguageVersion,T=y===100?"#version 100":"#version 300 es",M=i.split(`
`).slice(1).join(`
`),b={};l.forEach(x=>{Object.assign(b,x.defines)}),Object.assign(b,u);let w="";switch(s){case"wgsl":break;case"glsl":w=p?`${T}

// ----- PROLOGUE -------------------------
${XP({id:n,source:i,stage:r})}
${`#define SHADER_TYPE_${r.toUpperCase()}`}

${LP(t)}
${r==="fragment"?WP:""}

// ----- APPLICATION DEFINES -------------------------

${YP(b)}

`:`${T}
`;break}const A=GT(f),N={},D={},W={};for(const x in d){const R=typeof d[x]=="string"?{injection:d[x],order:0}:d[x],P=/^(v|f)s:(#)?([\w-]+)$/.exec(x);if(P){const U=P[2],F=P[3];U?F==="decl"?D[x]=[R]:W[x]=[R]:N[x]=[R]}else W[x]=[R]}for(const x of l){_&&XT(x,M,_);const R=JT(x,r);w+=R;const P=((K=x.instance)==null?void 0:K.normalizedInjections[r])||{};for(const U in P){const F=/^(v|f)s:#([\w-]+)$/.exec(U);if(F){const B=F[2]==="decl"?D:W;B[U]=B[U]||[],B[U].push(P[U])}else N[U]=N[U]||[],N[U].push(P[U])}}return w+="// ----- MAIN SHADER SOURCE -------------------------",w+=ZT,w=pc(w,r,D),w+=KT(A[r],N),w+=M,w=pc(w,r,W),s==="glsl"&&y!==E&&(w=DP(w,r)),w.trim()}function QT(t){return function(n){var r;const i={};for(const s of t){const l=(r=s.getUniforms)==null?void 0:r.call(s,n,i);Object.assign(i,l)}return i}}function XP(t){const{id:e,source:n,stage:i}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function YP(t={}){let e="";for(const n in t){const i=t[n];(i||Number.isFinite(i))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}function JT(t,e){let n;switch(e){case"vertex":n=t.vs||"";break;case"fragment":n=t.fs||"";break;case"wgsl":n=t.source||"";break;default:T_(!1)}if(!t.name)throw new Error("Shader module must have a name");const i=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(r+=`#define MODULE_${i}
`),r+=`${n}
`,r}const qP=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,KP=/^\s*\#\s*endif\s*$/;function GP(t,e){var l;const n=t.split(`
`),i=[];let r=!0,s=null;for(const u of n){const f=u.match(qP),d=u.match(KP);f?(s=f[1],r=!!((l=e==null?void 0:e.defines)!=null&&l[s])):d?r=!0:r&&i.push(u)}return i.join(`
`)}const Cr=class Cr{constructor(){C(this,"_hookFunctions",[]);C(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Cr.defaultShaderAssembler=Cr.defaultShaderAssembler||new Cr,Cr.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const n=this._getModuleList(e.modules),i=this._hookFunctions,{source:r,getUniforms:s}=HP({...e,source:e.source,modules:n,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?GP(r):r,getUniforms:s,modules:n}}assembleGLSLShaderPair(e){const n=this._getModuleList(e.modules),i=this._hookFunctions;return{...jP({...e,vs:e.vs,fs:e.fs,modules:n,hookFunctions:i}),modules:n}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let s=0,l=this._defaultModules.length;s<l;++s){const u=this._defaultModules[s],f=u.name;n[r++]=u,i[f]=!0}for(let s=0,l=e.length;s<l;++s){const u=e[s],f=u.name;i[f]||(n[r++]=u,i[f]=!0)}return n.length=r,_c(n),n}};C(Cr,"defaultShaderAssembler");let mc=Cr;const ZP=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,QP=`#version 300 es
${ZP}`;function JP(t){const{input:e,inputChannels:n,output:i}=t||{};if(!e)return QP;if(!n)throw new Error("inputChannels");const r=eN(n),s=tN(e,n);return`#version 300 es
in ${r} ${e};
out vec4 ${i};
void main() {
  ${i} = ${s};
}`}function eN(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function tN(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class nN{constructor(){C(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Th({id:e})),this.stats.get(e)}}const eS=new nN,oe=new nl({id:"luma.gl"}),Df={};function xh(t="id"){Df[t]=Df[t]||1;const e=Df[t]++;return`${t}-${e}`}var Ed;let Ue=(Ed=class{constructor(e,n,i){C(this,"id");C(this,"props");C(this,"userData",{});C(this,"_device");C(this,"destroyed",!1);C(this,"allocatedBytes",0);C(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=iN(n,i);const r=this.props.id!=="undefined"?this.props.id:xh(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},C(Ed,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Ed);function iN(t,e){const n={...e};for(const i in t)t[i]!==void 0&&(n[i]=t[i]);return n}const St=class St extends Ue{constructor(n,i){const r={...i};(i.usage||0)&St.INDEX&&!i.indexType&&(i.data instanceof Uint32Array?r.indexType="uint32":i.data instanceof Uint16Array&&(r.indexType="uint16")),delete r.data;super(n,r,St.defaultProps);C(this,"usage");C(this,"indexType");C(this,"updateTimestamp");C(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=r.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(n){return this.device.createBuffer({...this.props,...n})}readSyncWebGL(n,i){throw new Error("not implemented")}_setDebugData(n,i,r){const s=ArrayBuffer.isView(n)?n.buffer:n,l=Math.min(n?n.byteLength:r,St.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(l):i===0&&r===s.byteLength?this.debugData=s.slice(0,l):this.debugData=s.slice(i,i+l)}};C(St,"defaultProps",{...Ue.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),C(St,"MAP_READ",1),C(St,"MAP_WRITE",2),C(St,"COPY_SRC",4),C(St,"COPY_DST",8),C(St,"INDEX",16),C(St,"VERTEX",32),C(St,"UNIFORM",64),C(St,"STORAGE",128),C(St,"INDIRECT",256),C(St,"QUERY_RESOLVE",512),C(St,"DEBUG_DATA_MAX_LENGTH",32);let Ke=St;function tS(t){const e=Av[t],n=rN(e),i=t.includes("norm"),r=!i&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:Av[t],byteLength:n,integer:r,signed:s,normalized:i}}function rN(t){return sN[t]}const Av={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},sN={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Nt="texture-compression-bc",Be="texture-compression-astc",Xn="texture-compression-etc2",oN="texture-compression-etc1-webgl",zl="texture-compression-pvrtc-webgl",Ff="texture-compression-atc-webgl",Vl="float32-renderable-webgl",Bf="float16-renderable-webgl",aN="rgb9e5ufloat-renderable-webgl",Uf="snorm8-renderable-webgl",Uo="norm16-renderable-webgl",zf="snorm16-renderable-webgl",Wl="float32-filterable",bv="float16-filterable-webgl";function nS(t){const e=lN[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const lN={r8unorm:{},r8snorm:{render:Uf},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Uf},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Bf,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Uo},"r16snorm-webgl":{f:zf},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Uf},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Bf,filter:bv},"rg16unorm-webgl":{render:Uo},"rg16snorm-webgl":{render:zf},r32uint:{},r32sint:{},r32float:{render:Vl,filter:Wl},rgb9e5ufloat:{channels:"rgb",packed:!0,render:aN},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Vl},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Uo},"rgb16snorm-webgl":{f:Uo},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Wl},rgba16uint:{},rgba16sint:{},rgba16float:{render:Bf,filter:bv},"rgba16unorm-webgl":{render:Uo},"rgba16snorm-webgl":{render:zf},"rgb32float-webgl":{render:Vl,filter:Wl},rgba32uint:{},rgba32sint:{},rgba32float:{render:Vl,filter:Wl},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Nt},"bc1-rgb-unorm-srgb-webgl":{f:Nt},"bc1-rgba-unorm":{f:Nt},"bc1-rgba-unorm-srgb":{f:Nt},"bc2-rgba-unorm":{f:Nt},"bc2-rgba-unorm-srgb":{f:Nt},"bc3-rgba-unorm":{f:Nt},"bc3-rgba-unorm-srgb":{f:Nt},"bc4-r-unorm":{f:Nt},"bc4-r-snorm":{f:Nt},"bc5-rg-unorm":{f:Nt},"bc5-rg-snorm":{f:Nt},"bc6h-rgb-ufloat":{f:Nt},"bc6h-rgb-float":{f:Nt},"bc7-rgba-unorm":{f:Nt},"bc7-rgba-unorm-srgb":{f:Nt},"etc2-rgb8unorm":{f:Xn},"etc2-rgb8unorm-srgb":{f:Xn},"etc2-rgb8a1unorm":{f:Xn},"etc2-rgb8a1unorm-srgb":{f:Xn},"etc2-rgba8unorm":{f:Xn},"etc2-rgba8unorm-srgb":{f:Xn},"eac-r11unorm":{f:Xn},"eac-r11snorm":{f:Xn},"eac-rg11unorm":{f:Xn},"eac-rg11snorm":{f:Xn},"astc-4x4-unorm":{f:Be},"astc-4x4-unorm-srgb":{f:Be},"astc-5x4-unorm":{f:Be},"astc-5x4-unorm-srgb":{f:Be},"astc-5x5-unorm":{f:Be},"astc-5x5-unorm-srgb":{f:Be},"astc-6x5-unorm":{f:Be},"astc-6x5-unorm-srgb":{f:Be},"astc-6x6-unorm":{f:Be},"astc-6x6-unorm-srgb":{f:Be},"astc-8x5-unorm":{f:Be},"astc-8x5-unorm-srgb":{f:Be},"astc-8x6-unorm":{f:Be},"astc-8x6-unorm-srgb":{f:Be},"astc-8x8-unorm":{f:Be},"astc-8x8-unorm-srgb":{f:Be},"astc-10x5-unorm":{f:Be},"astc-10x5-unorm-srgb":{f:Be},"astc-10x6-unorm":{f:Be},"astc-10x6-unorm-srgb":{f:Be},"astc-10x8-unorm":{f:Be},"astc-10x8-unorm-srgb":{f:Be},"astc-10x10-unorm":{f:Be},"astc-10x10-unorm-srgb":{f:Be},"astc-12x10-unorm":{f:Be},"astc-12x10-unorm-srgb":{f:Be},"astc-12x12-unorm":{f:Be},"astc-12x12-unorm-srgb":{f:Be},"pvrtc-rgb4unorm-webgl":{f:zl},"pvrtc-rgba4unorm-webgl":{f:zl},"pvrtc-rbg2unorm-webgl":{f:zl},"pvrtc-rgba2unorm-webgl":{f:zl},"etc1-rbg-unorm-webgl":{f:oN},"atc-rgb-unorm-webgl":{f:Ff},"atc-rgba-unorm-webgl":{f:Ff},"atc-rgbai-unorm-webgl":{f:Ff}},uN=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],cN=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function iS(t){return uN.some(e=>t.startsWith(e))}function x_(t){let e=hN(t);if(iS(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=fN(t);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const n=cN.exec(t);if(n){const[,i,r,s,l,u]=n,f=`${s}${r}`,d=tS(f),p=d.byteLength*8,_=i.length,y=[p,_>=2?p:0,_>=3?p:0,_>=4?p:0];e={format:t,attachment:e.attachment,dataType:d.dataType,components:_,channels:i,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:y,bytesPerPixel:d.byteLength*i.length,packed:e.packed,srgb:e.srgb},u==="-webgl"&&(e.webgl=!0),l==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function hN(t){var s;const e=nS(t),n=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((s=e.channels)==null?void 0:s.length)||1,bytesPerPixel:n,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function fN(t){const n=/.*-(\d+)x(\d+)-.*/.exec(t);if(n){const[,i,r]=n;return{blockWidth:Number(i),blockHeight:Number(r)}}return null}function dN(t){const e=nS(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=x_(t),r=t.startsWith("depth")||t.startsWith("stencil"),s=i==null?void 0:i.signed,l=i==null?void 0:i.integer,u=i==null?void 0:i.webgl;return n.render&&(n.render=!s),n.filter&&(n.filter=!r&&!s&&!l&&!u),n}class gN{}class pN{constructor(e=[],n){C(this,"features");C(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){var n;return!((n=this.disabledFeatures)!=null&&n[e])&&this.features.has(e)}}const Xc=class Xc{constructor(e){C(this,"id");C(this,"props");C(this,"userData",{});C(this,"statsManager",eS);C(this,"timestamp",0);C(this,"_lumaData",{});this.props={...Xc.defaultProps,...e},this.id=this.props.id||xh(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const n=dN(e),i=l=>(typeof l=="string"?this.features.has(l):l)??!0,r=i(n.create),s={format:e,create:r,render:r&&i(n.render),filter:r&&i(n.filter),blend:r&&i(n.blend),store:r&&i(n.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,n){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return iS(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&Ke.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":oe.warn("indices buffer content must be of integer type")()),n}};C(Xc,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>oe.error(e.message)(),_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:oe.get("debug")||void 0,debugShaders:oe.get("debug-shaders")||void 0,debugFramebuffers:!!oe.get("debug-framebuffers"),debugWebGL:!!oe.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Dr=Xc;const _N=Zr()&&typeof document<"u",mN=()=>_N&&document.readyState==="complete",yN="set luma.log.level=1 (or higher) to trace rendering",Rv="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",zi=class zi{constructor(){C(this,"stats",eS);C(this,"log",oe);C(this,"VERSION","9.1.0");C(this,"spector");C(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw oe.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),oe.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");oe.error("This version of luma.gl has already been initialized")()}oe.log(1,`${this.VERSION} - ${yN}`)(),globalThis.luma=this}registerAdapters(e){for(const n of e)this.preregisteredAdapters.set(n.type,n)}getSupportedAdapters(e=[]){const n=this.getAdapterMap(e);return Array.from(n).map(([,i])=>i).filter(i=>{var r;return(r=i.isSupported)==null?void 0:r.call(i)}).map(i=>i.type)}getBestAvailableAdapter(e=[]){var i,r,s,l;const n=this.getAdapterMap(e);return(r=(i=n.get("webgpu"))==null?void 0:i.isSupported)!=null&&r.call(i)?"webgpu":(l=(s=n.get("webgl"))==null?void 0:s.isSupported)!=null&&l.call(s)?"webgl":null}setDefaultDeviceProps(e){Object.assign(zi.defaultProps,e)}async createDevice(e={}){var u;e={...zi.defaultProps,...e},e.waitForPageLoad&&await zi.pageLoaded;const n=this.getAdapterMap(e.adapters);let i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);const s=(this.getAdapterMap(e.adapters)||n).get(i),l=await((u=s==null?void 0:s.create)==null?void 0:u.call(s,e));if(l)return l;throw new Error(Rv)}async attachDevice(e){var l;const n=this.getAdapterMap(e.adapters);let i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await zi.pageLoaded,e.handle===null&&(i="unknown");const r=n.get(i),s=await((l=r==null?void 0:r.attach)==null?void 0:l.call(r,null));if(s)return s;throw new Error(Rv)}enforceWebGL2(e=!0,n=[]){var s;const r=this.getAdapterMap(n).get("webgl");r||oe.warn("enforceWebGL2: webgl adapter not found")(),(s=r==null?void 0:r.enforceWebGL2)==null||s.call(r,e)}getAdapterMap(e=[]){const n=new Map(this.preregisteredAdapters);for(const i of e)n.set(i.type,i);return n}registerDevices(e){oe.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const n of e){const i=n.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}};C(zi,"defaultProps",{...Dr.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),C(zi,"pageLoaded",vN().then(()=>{oe.probe(2,"DOM is loaded")()}));let Eg=zi;const wg=new Eg;function vN(){return mN()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class EN{}const Yc=class Yc{constructor(e){C(this,"id");C(this,"props");C(this,"canvas");C(this,"htmlCanvas");C(this,"offscreenCanvas");C(this,"type");C(this,"width",1);C(this,"height",1);C(this,"resizeObserver");C(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...Yc.defaultProps,...e},e=this.props,!Zr()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=TN(e.canvas):this.canvas=e.canvas;else{const n=SN(e),i=wN((e==null?void 0:e.container)||null);i.insertBefore(n,i.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const i of n)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){var e;try{const[n]=this.getDrawingBufferSize(),i=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return i?n/i:1}catch{return 1}}cssToDevicePixels(e,n=!0){const i=this.cssToDeviceRatio(),[r,s]=this.getDrawingBufferSize();return xN(e,i,r,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let i="width"in n?n.width:this.htmlCanvas.clientWidth,r="height"in n?n.height:this.htmlCanvas.clientHeight;(!i||!r)&&(oe.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let l=e;const u=Math.floor(i*l),f=Math.floor(r*l);if(this.htmlCanvas.width=u,this.htmlCanvas.height=f,this.device.gl){const[p,_]=this.getDrawingBufferSize();(p!==u||_!==f)&&(l=Math.min(p/i,_/r),this.htmlCanvas.width=Math.floor(i*l),this.htmlCanvas.height=Math.floor(r*l),oe.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};C(Yc,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let Tg=Yc;function wN(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function TN(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function SN(t){const{width:e,height:n}=t,i=document.createElement("canvas");return i.id=xh("lumagl-auto-created-canvas"),i.width=e||1,i.height=n||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(n)?`${n}px`:"100%",i}function xN(t,e,n,i,r){const s=t,l=Cv(s[0],e,n);let u=kv(s[1],e,i,r),f=Cv(s[0]+1,e,n);const d=f===n-1?f:f-1;f=kv(s[1]+1,e,i,r);let p;return r?(f=f===0?f:f+1,p=u,u=f):p=f===i-1?f:f-1,{x:l,y:u,width:Math.max(d-l+1,1),height:Math.max(p-u+1,1)}}function Cv(t,e,n){return Math.min(Math.round(t*e),n-1)}function kv(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const xt=class xt extends Ue{constructor(n,i){i=xt.normalizeProps(n,i);super(n,i,xt.defaultProps);C(this,"dimension");C(this,"format");C(this,"width");C(this,"height");C(this,"depth");C(this,"mipLevels");C(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const r=xt.getTextureDataSize(this.props.data);this.width=(r==null?void 0:r.width)||1,this.height=(r==null?void 0:r.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?xt.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(n){return this.device.createTexture({...this.props,...n})}static isExternalImage(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}static getExternalImageSize(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(n){const i=n==null?void 0:n.data;return ArrayBuffer.isView(i)}static getTextureDataSize(n){if(!n||ArrayBuffer.isView(n))return null;if(Array.isArray(n))return xt.getTextureDataSize(n[0]);if(xt.isExternalImage(n))return xt.getExternalImageSize(n);if(n&&typeof n=="object"&&n.constructor===Object){const r=Object.values(n)[0];return{width:r.width,height:r.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(n,i){let r;return ArrayBuffer.isView(n)?r=[{data:n,width:i.width,height:i.height}]:Array.isArray(n)?r=n:r=[n],r}static getMipLevelCount(n,i){return Math.floor(Math.log2(Math.max(n,i)))+1}static getCubeFaceDepth(n){switch(n){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(n)}}static normalizeProps(n,i){var f,d;const r={...i},s=((d=(f=n==null?void 0:n.props)==null?void 0:f._resourceDefaults)==null?void 0:d.texture)||{};Object.assign(r,s);const{width:l,height:u}=r;return typeof l=="number"&&(r.width=Math.max(1,Math.ceil(l))),typeof u=="number"&&(r.height=Math.max(1,Math.ceil(u))),r}};C(xt,"COPY_SRC",1),C(xt,"COPY_DST",2),C(xt,"TEXTURE",4),C(xt,"STORAGE",8),C(xt,"RENDER_ATTACHMENT",16),C(xt,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),C(xt,"defaultProps",{...Ue.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),C(xt,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let ot=xt;const qc=class qc extends Ue{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,qc.defaultProps)}};C(qc,"defaultProps",{...Ue.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let yc=qc;function AN(t,e,n){let i="";const r=e.split(/\r?\n/),s=t.slice().sort((l,u)=>l.lineNum-u.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let l=0;for(let u=1;u<=r.length;u++)for(i+=rS(r[u-1],u,n);s.length>l&&s[l].lineNum===u;){const f=s[l++];i+=Iv(f,r,f.lineNum,{...n,inlineSource:!1})}return i;case"issues":case"no":for(const u of t)i+=Iv(u,r,u.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return i}}function Iv(t,e,n,i){if(i!=null&&i.inlineSource){const s=bN(e,n),l=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${l}${t.type.toUpperCase()}: ${t.message}

`}const r=t.type==="error"?"red":"#8B4000";return i!=null&&i.html?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function bN(t,e,n){let i="";for(let r=e-2;r<=e;r++){const s=t[r-1];s!==void 0&&(i+=rS(s,e,n))}return i}function rS(t,e,n){const i=n!=null&&n.html?CN(t):t;return`${RN(String(e),4)}: ${i}${n!=null&&n.html?"<br/>":`
`}`}function RN(t,e){let n="";for(let i=t.length;i<e;++i)n+=" ";return n+t}function CN(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Kc=class Kc extends Ue{constructor(n,i){i={...i,debugShaders:i.debugShaders||n.props.debugShaders||"errors"};super(n,{id:kN(i),...i},Kc.defaultProps);C(this,"stage");C(this,"source");C(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const n=this.props.debugShaders;switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const i=await this.getCompilationInfo();n==="warnings"&&(i==null?void 0:i.length)===0||this._displayShaderLog(i)}_displayShaderLog(n){var d;if(typeof document>"u"||!(document!=null&&document.createElement))return;const i=sS(this.source),r=`${this.stage} ${i}`;let s=AN(n,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const u=document.createElement("Button");u.innerHTML=`
<h1>Shader Compilation Error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,u.style.top="10px",u.style.left="10px",u.style.position="absolute",u.style.zIndex="9999",u.style.width="100%",u.style.textAlign="left",document.body.appendChild(u),(d=document.getElementsByClassName("luma-compiler-log-error")[0])==null||d.scrollIntoView(),u.onclick=()=>{const p=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(p)}}};C(Kc,"defaultProps",{...Ue.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let vc=Kc;function kN(t){return sS(t.source)||t.id||xh(`unnamed ${t.stage}-shader`)}function sS(t,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return i?i[1]:e}const Ea=class Ea extends Ue{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){n=Ea.normalizeProps(e,n),super(e,n,Ea.defaultProps)}static normalizeProps(e,n){var s,l;const i=((l=(s=e==null?void 0:e.props)==null?void 0:s._resourceDefaults)==null?void 0:l.sampler)||{};return{...n,...i}}};C(Ea,"defaultProps",{...Ue.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Ec=Ea;const Gc=class Gc extends Ue{constructor(n,i={}){super(n,i,Gc.defaultProps);C(this,"width");C(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(n){const i=this.colorAttachments.map(s=>s.texture.clone(n)),r=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(n);return this.device.createFramebuffer({...this.props,colorAttachments:i,depthStencilAttachment:r})}resize(n){let i=!n;if(n){const[r,s]=Array.isArray(n)?n:[n.width,n.height];i=i||s!==this.height||r!==this.width,this.width=r,this.height=s}i&&(oe.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((i,r)=>{if(typeof i=="string"){const s=this.createColorTexture(i,r);return this.attachResource(s),s.view}return i instanceof ot?i.view:i});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const i=this.createDepthStencilTexture(n);this.attachResource(i),this.depthStencilAttachment=i.view}else n instanceof ot?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n,i){return this.device.createTexture({id:`${this.id}-color-attachment-${i}`,usage:ot.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(n){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:ot.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,i){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){const s=this.colorAttachments[r].texture.clone({width:n,height:i});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const r=this.depthStencilAttachment.texture.clone({width:n,height:i});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}this.updateAttachments()}};C(Gc,"defaultProps",{...Ue.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let wc=Gc;const Zc=class Zc extends Ue{constructor(n,i){super(n,i,Zc.defaultProps);C(this,"shaderLayout");C(this,"bufferLayout");C(this,"linkStatus","pending");C(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};C(Zc,"defaultProps",{...Ue.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let eo=Zc;const In=class In extends Ue{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){n=In.normalizeProps(e,n),super(e,n,In.defaultProps)}static normalizeProps(e,n){var s;return{...(s=e.props._resourceDefaults)==null?void 0:s.renderPass,...n}}};C(In,"defaultClearColor",[0,0,0,1]),C(In,"defaultClearDepth",1),C(In,"defaultClearStencil",0),C(In,"defaultProps",{...Ue.defaultProps,framebuffer:null,parameters:void 0,clearColor:In.defaultClearColor,clearColors:void 0,clearDepth:In.defaultClearDepth,clearStencil:In.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Sg=In;const Qc=class Qc extends Ue{constructor(n,i){super(n,i,Qc.defaultProps);C(this,"hash","");C(this,"shaderLayout");this.shaderLayout=i.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};C(Qc,"defaultProps",{...Ue.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Tc=Qc;const Jc=class Jc extends Ue{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,Jc.defaultProps)}};C(Jc,"defaultProps",{...Ue.defaultProps,measureExecutionTime:void 0});let xg=Jc;const eh=class eh extends Ue{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,eh.defaultProps)}};C(eh,"defaultProps",{...Ue.defaultProps});let Ag=eh;function IN(t){const[e,n]=NN[t],i=e==="i32"||e==="u32",r=e!=="u32",s=MN[e]*n,l=PN(e,n);return{dataType:e,components:n,defaultVertexFormat:l,byteLength:s,integer:i,signed:r}}function PN(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const NN={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},MN={f32:4,f16:2,i32:4,u32:4};function oS(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,i]=t.split("x"),r=n,s=i?parseInt(i):1,l=tS(r),u={type:r,components:s,byteLength:l.byteLength*s,integer:l.integer,signed:l.signed,normalized:l.normalized};return e&&(u.webglOnly=!0),u}function aS(t,e){const n={};for(const i of t.attributes){const r=LN(t,e,i.name);r&&(n[i.name]=r)}return n}function ON(t,e,n=16){const i=aS(t,e),r=new Array(n).fill(null);for(const s of Object.values(i))r[s.location]=s;return r}function LN(t,e,n){const i=DN(t,n),r=FN(e,n);if(!i)return null;const s=IN(i.type),l=(r==null?void 0:r.vertexFormat)||s.defaultVertexFormat,u=oS(l);return{attributeName:(r==null?void 0:r.attributeName)||i.name,bufferName:(r==null?void 0:r.bufferName)||i.name,location:i.location,shaderType:i.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:l,bufferDataType:u.type,bufferComponents:u.components,normalized:u.normalized,integer:s.integer,stepMode:(r==null?void 0:r.stepMode)||i.stepMode||"vertex",byteOffset:(r==null?void 0:r.byteOffset)||0,byteStride:(r==null?void 0:r.byteStride)||0}}function DN(t,e){const n=t.attributes.find(i=>i.name===e);return n||oe.warn(`shader layout attribute "${e}" not present in shader`),n||null}function FN(t,e){BN(t);let n=UN(t,e);return n||(n=zN(t,e),n)?n:(oe.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function BN(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&oe.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function UN(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function zN(t,e){var n;for(const i of t){let r=i.byteStride;if(typeof i.byteStride!="number")for(const l of i.attributes||[]){const u=oS(l.format);r+=u.byteLength}const s=(n=i.attributes)==null?void 0:n.find(l=>l.attribute===e);if(s)return{attributeName:s.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:r}}return null}const th=class th extends Ue{constructor(n,i){super(n,i,th.defaultProps);C(this,"maxVertexAttributes");C(this,"attributeInfos");C(this,"indexBuffer",null);C(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:r,bufferLayout:s}=i.renderPipeline||{};if(!r||!s)throw new Error("VertexArray");this.attributeInfos=ON(r,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,i){throw new Error("constant attributes not supported")}};C(th,"defaultProps",{...Ue.defaultProps,renderPipeline:null});let bg=th;const nh=class nh extends Ue{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,nh.defaultProps)}};C(nh,"defaultProps",{...Ue.defaultProps,layout:void 0,buffers:{}});let Rg=nh;const ih=class ih extends Ue{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,ih.defaultProps)}};C(ih,"defaultProps",{...Ue.defaultProps,type:void 0,count:void 0});let Cg=ih;const VN={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function WN(t){return VN[t]}function HN(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Hl;function lS(t){return(!Hl||Hl.byteLength<t)&&(Hl=new ArrayBuffer(t)),Hl}function jN(t,e){const n=lS(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function $N(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Sc(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":$N(t)}const Pv=1024;class XN{constructor(e){C(this,"layout",{});C(this,"byteLength");let n=0;for(const[r,s]of Object.entries(e)){const l=WN(s),{type:u,components:f}=l;n=HN(n,f);const d=n;n+=f,this.layout[r]={type:u,size:f,offset:d}}n+=(4-n%4)%4;const i=n*4;this.byteLength=Math.max(i,Pv)}getData(e){const n=Math.max(this.byteLength,Pv),i=lS(n),r={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[s,l]of Object.entries(e)){const u=this.layout[s];if(!u){oe.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:f,size:d,offset:p}=u,_=r[f];if(d===1){if(typeof l!="number"&&typeof l!="boolean"){oe.warn(`Supplied value for single component uniform ${s} is not a number: ${l}`)();continue}_[p]=Number(l)}else{if(!Sc(l)){oe.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${l}`)();continue}_.set(l,p)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function YN(t,e,n=16){if(t!==e)return!1;const i=t,r=e;if(!Sc(i))return!1;if(Sc(r)&&i.length===r.length){for(let s=0;s<i.length;++s)if(r[s]!==i[s])return!1}return!0}function qN(t){return Sc(t)?t.slice():t}class KN{constructor(e){C(this,"name");C(this,"uniforms",{});C(this,"modifiedUniforms",{});C(this,"modified",!0);C(this,"bindingLayout",{});C(this,"needsRedraw","initialized");var n;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const i=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!i)throw new Error(e==null?void 0:e.name);const r=i;for(const s of r.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,i]of Object.entries(e))this._setUniform(n,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){YN(this.uniforms[e],n)||(this.uniforms[e]=qN(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class GN{constructor(e){C(this,"uniformBlocks",new Map);C(this,"uniformBufferLayouts",new Map);C(this,"uniformBuffers",new Map);for(const[n,i]of Object.entries(e)){const r=n,s=new XN(i.uniformTypes||{});this.uniformBufferLayouts.set(r,s);const l=new KN({name:n});l.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(r,l)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var n;for(const[i,r]of Object.entries(e))(n=this.uniformBlocks.get(i))==null||n.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){var n;return((n=this.uniformBufferLayouts.get(e))==null?void 0:n.byteLength)||0}getUniformBufferData(e){var i,r;const n=((i=this.uniformBlocks.get(e))==null?void 0:i.getAllUniforms())||{};return(r=this.uniformBufferLayouts.get(e))==null?void 0:r.getData(n)}createUniformBuffer(e,n,i){i&&this.setUniforms(i);const r=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:Ke.UNIFORM|Ke.COPY_DST,byteLength:r}),l=this.getUniformBufferData(n);return s.write(l),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const i=this.getUniformBufferByteLength(n),r=e.createBuffer({usage:Ke.UNIFORM|Ke.COPY_DST,byteLength:i});this.uniformBuffers.set(n,r)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(n);e||(e=i)}return e&&oe.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const n=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),r=!1;if(i&&(n!=null&&n.needsRedraw)){r||(r=n.needsRedraw);const l=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i==null||i.write(l);const u=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();oe.log(4,`Writing to uniform buffer ${String(e)}`,l,u)()}return r}}function uS(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function cS(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function ZN(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let r=uS(t);if(r==="uint8"&&n&&i===1)return"unorm8-webgl";if(r==="uint8"&&n&&i===3)return"unorm8x3-webgl";if(r==="uint8"||r==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}if(r==="uint16"||r==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}return i===1?r:`${r}x${i}`}class Vf{constructor(e){C(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(n=>n.name===e)||null}getAttributeNamesForBuffer(e){var n;return e.attributes?(n=e.attributes)==null?void 0:n.map(i=>i.attribute):[e.name]}mergeBufferLayouts(e,n){const i=[...e];for(const r of n){const s=i.findIndex(l=>l.name===r.name);s<0?i.push(r):i[s]=r}return i}}class QN{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}let Ri=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,n){if(e){n(xc.instance);for(const i of e)i instanceof Array?this.searchBlock(i,n):i.search(n);n(Ac.instance)}}};class xc extends Ri{}xc.instance=new xc;class Ac extends Ri{}Ac.instance=new Ac;class Ge extends Ri{constructor(){super()}}let kg=class extends Ge{constructor(e,n,i,r,s,l){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=i,this.body=r,this.startLine=s,this.endLine=l}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}};class JN extends Ge{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class e3 extends Ge{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class t3 extends Ge{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class n3 extends Ge{constructor(e,n,i,r){super(),this.init=e,this.condition=n,this.increment=i,this.body=r}get astNodeType(){return"for"}search(e){var n,i,r;(n=this.init)===null||n===void 0||n.search(e),(i=this.condition)===null||i===void 0||i.search(e),(r=this.increment)===null||r===void 0||r.search(e),this.searchBlock(this.body,e)}}class Rr extends Ge{constructor(e,n,i,r,s){super(),this.name=e,this.type=n,this.storage=i,this.access=r,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class hS extends Ge{constructor(e,n,i){super(),this.name=e,this.type=n,this.value=i}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class Ig extends Ge{constructor(e,n,i,r,s){super(),this.name=e,this.type=n,this.storage=i,this.access=r,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class Nv extends Ge{constructor(e,n,i,r,s){super(),this.name=e,this.type=n,this.storage=i,this.access=r,this.value=s}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var to;(function(t){t.increment="++",t.decrement="--"})(to||(to={}));(function(t){function e(n){const i=n;if(i=="parse")throw new Error("Invalid value for IncrementOperator");return t[i]}t.parse=e})(to||(to={}));class i3 extends Ge{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var Ua;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Ua||(Ua={}));(function(t){function e(n){const i=n;if(i=="parse")throw new Error("Invalid value for AssignOperator");return i}t.parse=e})(Ua||(Ua={}));class r3 extends Ge{constructor(e,n,i){super(),this.operator=e,this.variable=n,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class fS extends Ge{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}search(e){for(const n of this.args)n.search(e);e(this)}}class s3 extends Ge{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class o3 extends Ge{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class a3 extends Ge{constructor(e,n,i,r){super(),this.condition=e,this.body=n,this.elseif=i,this.else=r}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class l3 extends Ge{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class u3 extends Ge{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class c3 extends Ge{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class h3 extends Ge{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class dS extends Ge{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class f3 extends Ge{constructor(){super()}get astNodeType(){return"discard"}}class d3 extends Ge{constructor(){super()}get astNodeType(){return"break"}}class g3 extends Ge{constructor(){super()}get astNodeType(){return"continue"}}class es extends Ge{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class br extends es{constructor(e,n,i,r){super(e),this.members=n,this.startLine=i,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class gS extends es{constructor(e,n,i){super(e),this.format=n,this.access=i}get astNodeType(){return"template"}}class p3 extends es{constructor(e,n,i,r){super(e),this.storage=n,this.type=i,this.access=r}get astNodeType(){return"pointer"}}class pS extends es{constructor(e,n,i,r){super(e),this.attributes=n,this.format=i,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class Go extends es{constructor(e,n,i){super(e),this.format=n,this.access=i}get astNodeType(){return"sampler"}}class ai extends Ri{constructor(){super()}}class _3 extends ai{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Ps extends ai{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}evaluate(e){return this.args[0].evaluate(e)}}class _S extends ai{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const n of this.args)n.search(e);e(this)}}class Pg extends ai{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const n=e.constants.get(this.name);if(!n)throw new Error("Cannot evaluate node");return n.evaluate(e)}}class Mv extends ai{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,i;if(this.initializer instanceof Ps){const r=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),s=(i=this.initializer.type)===null||i===void 0?void 0:i.name,l=e.structs.get(s),u=l==null?void 0:l.getMemberIndex(r);return u!==void 0&&u!=-1?this.initializer.args[u].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class Ov extends ai{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class m3 extends ai{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Lv extends ai{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class y3 extends ai{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class mS extends ai{constructor(){super()}}class v3 extends mS{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Yn extends mS{constructor(e,n,i){super(),this.operator=e,this.left=n,this.right=i}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class yS extends Ri{constructor(){super()}}class E3 extends yS{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class w3 extends yS{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class T3 extends Ri{constructor(e,n,i){super(),this.name=e,this.type=n,this.attributes=i}get astNodeType(){return"argument"}}class S3 extends Ri{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class x3 extends Ri{constructor(e,n,i){super(),this.name=e,this.type=n,this.attributes=i}get astNodeType(){return"member"}}let A3=class extends Ri{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}};var Q,X;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(X||(X={}));class Y{constructor(e,n,i){this.name=e,this.type=n,this.rule=i}toString(){return this.name}}class O{}Q=O;O.none=new Y("",X.reserved,"");O.eof=new Y("EOF",X.token,"");O.reserved={asm:new Y("asm",X.reserved,"asm"),bf16:new Y("bf16",X.reserved,"bf16"),do:new Y("do",X.reserved,"do"),enum:new Y("enum",X.reserved,"enum"),f16:new Y("f16",X.reserved,"f16"),f64:new Y("f64",X.reserved,"f64"),handle:new Y("handle",X.reserved,"handle"),i8:new Y("i8",X.reserved,"i8"),i16:new Y("i16",X.reserved,"i16"),i64:new Y("i64",X.reserved,"i64"),mat:new Y("mat",X.reserved,"mat"),premerge:new Y("premerge",X.reserved,"premerge"),regardless:new Y("regardless",X.reserved,"regardless"),typedef:new Y("typedef",X.reserved,"typedef"),u8:new Y("u8",X.reserved,"u8"),u16:new Y("u16",X.reserved,"u16"),u64:new Y("u64",X.reserved,"u64"),unless:new Y("unless",X.reserved,"unless"),using:new Y("using",X.reserved,"using"),vec:new Y("vec",X.reserved,"vec"),void:new Y("void",X.reserved,"void")};O.keywords={array:new Y("array",X.keyword,"array"),atomic:new Y("atomic",X.keyword,"atomic"),bool:new Y("bool",X.keyword,"bool"),f32:new Y("f32",X.keyword,"f32"),i32:new Y("i32",X.keyword,"i32"),mat2x2:new Y("mat2x2",X.keyword,"mat2x2"),mat2x3:new Y("mat2x3",X.keyword,"mat2x3"),mat2x4:new Y("mat2x4",X.keyword,"mat2x4"),mat3x2:new Y("mat3x2",X.keyword,"mat3x2"),mat3x3:new Y("mat3x3",X.keyword,"mat3x3"),mat3x4:new Y("mat3x4",X.keyword,"mat3x4"),mat4x2:new Y("mat4x2",X.keyword,"mat4x2"),mat4x3:new Y("mat4x3",X.keyword,"mat4x3"),mat4x4:new Y("mat4x4",X.keyword,"mat4x4"),ptr:new Y("ptr",X.keyword,"ptr"),sampler:new Y("sampler",X.keyword,"sampler"),sampler_comparison:new Y("sampler_comparison",X.keyword,"sampler_comparison"),struct:new Y("struct",X.keyword,"struct"),texture_1d:new Y("texture_1d",X.keyword,"texture_1d"),texture_2d:new Y("texture_2d",X.keyword,"texture_2d"),texture_2d_array:new Y("texture_2d_array",X.keyword,"texture_2d_array"),texture_3d:new Y("texture_3d",X.keyword,"texture_3d"),texture_cube:new Y("texture_cube",X.keyword,"texture_cube"),texture_cube_array:new Y("texture_cube_array",X.keyword,"texture_cube_array"),texture_multisampled_2d:new Y("texture_multisampled_2d",X.keyword,"texture_multisampled_2d"),texture_storage_1d:new Y("texture_storage_1d",X.keyword,"texture_storage_1d"),texture_storage_2d:new Y("texture_storage_2d",X.keyword,"texture_storage_2d"),texture_storage_2d_array:new Y("texture_storage_2d_array",X.keyword,"texture_storage_2d_array"),texture_storage_3d:new Y("texture_storage_3d",X.keyword,"texture_storage_3d"),texture_depth_2d:new Y("texture_depth_2d",X.keyword,"texture_depth_2d"),texture_depth_2d_array:new Y("texture_depth_2d_array",X.keyword,"texture_depth_2d_array"),texture_depth_cube:new Y("texture_depth_cube",X.keyword,"texture_depth_cube"),texture_depth_cube_array:new Y("texture_depth_cube_array",X.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Y("texture_depth_multisampled_2d",X.keyword,"texture_depth_multisampled_2d"),texture_external:new Y("texture_external",X.keyword,"texture_external"),u32:new Y("u32",X.keyword,"u32"),vec2:new Y("vec2",X.keyword,"vec2"),vec3:new Y("vec3",X.keyword,"vec3"),vec4:new Y("vec4",X.keyword,"vec4"),bitcast:new Y("bitcast",X.keyword,"bitcast"),block:new Y("block",X.keyword,"block"),break:new Y("break",X.keyword,"break"),case:new Y("case",X.keyword,"case"),continue:new Y("continue",X.keyword,"continue"),continuing:new Y("continuing",X.keyword,"continuing"),default:new Y("default",X.keyword,"default"),diagnostic:new Y("diagnostic",X.keyword,"diagnostic"),discard:new Y("discard",X.keyword,"discard"),else:new Y("else",X.keyword,"else"),enable:new Y("enable",X.keyword,"enable"),fallthrough:new Y("fallthrough",X.keyword,"fallthrough"),false:new Y("false",X.keyword,"false"),fn:new Y("fn",X.keyword,"fn"),for:new Y("for",X.keyword,"for"),function:new Y("function",X.keyword,"function"),if:new Y("if",X.keyword,"if"),let:new Y("let",X.keyword,"let"),const:new Y("const",X.keyword,"const"),loop:new Y("loop",X.keyword,"loop"),while:new Y("while",X.keyword,"while"),private:new Y("private",X.keyword,"private"),read:new Y("read",X.keyword,"read"),read_write:new Y("read_write",X.keyword,"read_write"),return:new Y("return",X.keyword,"return"),requires:new Y("requires",X.keyword,"requires"),storage:new Y("storage",X.keyword,"storage"),switch:new Y("switch",X.keyword,"switch"),true:new Y("true",X.keyword,"true"),alias:new Y("alias",X.keyword,"alias"),type:new Y("type",X.keyword,"type"),uniform:new Y("uniform",X.keyword,"uniform"),var:new Y("var",X.keyword,"var"),override:new Y("override",X.keyword,"override"),workgroup:new Y("workgroup",X.keyword,"workgroup"),write:new Y("write",X.keyword,"write"),r8unorm:new Y("r8unorm",X.keyword,"r8unorm"),r8snorm:new Y("r8snorm",X.keyword,"r8snorm"),r8uint:new Y("r8uint",X.keyword,"r8uint"),r8sint:new Y("r8sint",X.keyword,"r8sint"),r16uint:new Y("r16uint",X.keyword,"r16uint"),r16sint:new Y("r16sint",X.keyword,"r16sint"),r16float:new Y("r16float",X.keyword,"r16float"),rg8unorm:new Y("rg8unorm",X.keyword,"rg8unorm"),rg8snorm:new Y("rg8snorm",X.keyword,"rg8snorm"),rg8uint:new Y("rg8uint",X.keyword,"rg8uint"),rg8sint:new Y("rg8sint",X.keyword,"rg8sint"),r32uint:new Y("r32uint",X.keyword,"r32uint"),r32sint:new Y("r32sint",X.keyword,"r32sint"),r32float:new Y("r32float",X.keyword,"r32float"),rg16uint:new Y("rg16uint",X.keyword,"rg16uint"),rg16sint:new Y("rg16sint",X.keyword,"rg16sint"),rg16float:new Y("rg16float",X.keyword,"rg16float"),rgba8unorm:new Y("rgba8unorm",X.keyword,"rgba8unorm"),rgba8unorm_srgb:new Y("rgba8unorm_srgb",X.keyword,"rgba8unorm_srgb"),rgba8snorm:new Y("rgba8snorm",X.keyword,"rgba8snorm"),rgba8uint:new Y("rgba8uint",X.keyword,"rgba8uint"),rgba8sint:new Y("rgba8sint",X.keyword,"rgba8sint"),bgra8unorm:new Y("bgra8unorm",X.keyword,"bgra8unorm"),bgra8unorm_srgb:new Y("bgra8unorm_srgb",X.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Y("rgb10a2unorm",X.keyword,"rgb10a2unorm"),rg11b10float:new Y("rg11b10float",X.keyword,"rg11b10float"),rg32uint:new Y("rg32uint",X.keyword,"rg32uint"),rg32sint:new Y("rg32sint",X.keyword,"rg32sint"),rg32float:new Y("rg32float",X.keyword,"rg32float"),rgba16uint:new Y("rgba16uint",X.keyword,"rgba16uint"),rgba16sint:new Y("rgba16sint",X.keyword,"rgba16sint"),rgba16float:new Y("rgba16float",X.keyword,"rgba16float"),rgba32uint:new Y("rgba32uint",X.keyword,"rgba32uint"),rgba32sint:new Y("rgba32sint",X.keyword,"rgba32sint"),rgba32float:new Y("rgba32float",X.keyword,"rgba32float"),static_assert:new Y("static_assert",X.keyword,"static_assert")};O.tokens={decimal_float_literal:new Y("decimal_float_literal",X.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Y("hex_float_literal",X.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Y("int_literal",X.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Y("uint_literal",X.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Y("ident",X.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Y("and",X.token,"&"),and_and:new Y("and_and",X.token,"&&"),arrow:new Y("arrow ",X.token,"->"),attr:new Y("attr",X.token,"@"),forward_slash:new Y("forward_slash",X.token,"/"),bang:new Y("bang",X.token,"!"),bracket_left:new Y("bracket_left",X.token,"["),bracket_right:new Y("bracket_right",X.token,"]"),brace_left:new Y("brace_left",X.token,"{"),brace_right:new Y("brace_right",X.token,"}"),colon:new Y("colon",X.token,":"),comma:new Y("comma",X.token,","),equal:new Y("equal",X.token,"="),equal_equal:new Y("equal_equal",X.token,"=="),not_equal:new Y("not_equal",X.token,"!="),greater_than:new Y("greater_than",X.token,">"),greater_than_equal:new Y("greater_than_equal",X.token,">="),shift_right:new Y("shift_right",X.token,">>"),less_than:new Y("less_than",X.token,"<"),less_than_equal:new Y("less_than_equal",X.token,"<="),shift_left:new Y("shift_left",X.token,"<<"),modulo:new Y("modulo",X.token,"%"),minus:new Y("minus",X.token,"-"),minus_minus:new Y("minus_minus",X.token,"--"),period:new Y("period",X.token,"."),plus:new Y("plus",X.token,"+"),plus_plus:new Y("plus_plus",X.token,"++"),or:new Y("or",X.token,"|"),or_or:new Y("or_or",X.token,"||"),paren_left:new Y("paren_left",X.token,"("),paren_right:new Y("paren_right",X.token,")"),semicolon:new Y("semicolon",X.token,";"),star:new Y("star",X.token,"*"),tilde:new Y("tilde",X.token,"~"),underscore:new Y("underscore",X.token,"_"),xor:new Y("xor",X.token,"^"),plus_equal:new Y("plus_equal",X.token,"+="),minus_equal:new Y("minus_equal",X.token,"-="),times_equal:new Y("times_equal",X.token,"*="),division_equal:new Y("division_equal",X.token,"/="),modulo_equal:new Y("modulo_equal",X.token,"%="),and_equal:new Y("and_equal",X.token,"&="),or_equal:new Y("or_equal",X.token,"|="),xor_equal:new Y("xor_equal",X.token,"^="),shift_right_equal:new Y("shift_right_equal",X.token,">>="),shift_left_equal:new Y("shift_left_equal",X.token,"<<=")};O.simpleTokens={"@":Q.tokens.attr,"{":Q.tokens.brace_left,"}":Q.tokens.brace_right,":":Q.tokens.colon,",":Q.tokens.comma,"(":Q.tokens.paren_left,")":Q.tokens.paren_right,";":Q.tokens.semicolon};O.literalTokens={"&":Q.tokens.and,"&&":Q.tokens.and_and,"->":Q.tokens.arrow,"/":Q.tokens.forward_slash,"!":Q.tokens.bang,"[":Q.tokens.bracket_left,"]":Q.tokens.bracket_right,"=":Q.tokens.equal,"==":Q.tokens.equal_equal,"!=":Q.tokens.not_equal,">":Q.tokens.greater_than,">=":Q.tokens.greater_than_equal,">>":Q.tokens.shift_right,"<":Q.tokens.less_than,"<=":Q.tokens.less_than_equal,"<<":Q.tokens.shift_left,"%":Q.tokens.modulo,"-":Q.tokens.minus,"--":Q.tokens.minus_minus,".":Q.tokens.period,"+":Q.tokens.plus,"++":Q.tokens.plus_plus,"|":Q.tokens.or,"||":Q.tokens.or_or,"*":Q.tokens.star,"~":Q.tokens.tilde,_:Q.tokens.underscore,"^":Q.tokens.xor,"+=":Q.tokens.plus_equal,"-=":Q.tokens.minus_equal,"*=":Q.tokens.times_equal,"/=":Q.tokens.division_equal,"%=":Q.tokens.modulo_equal,"&=":Q.tokens.and_equal,"|=":Q.tokens.or_equal,"^=":Q.tokens.xor_equal,">>=":Q.tokens.shift_right_equal,"<<=":Q.tokens.shift_left_equal};O.regexTokens={decimal_float_literal:Q.tokens.decimal_float_literal,hex_float_literal:Q.tokens.hex_float_literal,int_literal:Q.tokens.int_literal,uint_literal:Q.tokens.uint_literal,ident:Q.tokens.ident};O.storage_class=[Q.keywords.function,Q.keywords.private,Q.keywords.workgroup,Q.keywords.uniform,Q.keywords.storage];O.access_mode=[Q.keywords.read,Q.keywords.write,Q.keywords.read_write];O.sampler_type=[Q.keywords.sampler,Q.keywords.sampler_comparison];O.sampled_texture_type=[Q.keywords.texture_1d,Q.keywords.texture_2d,Q.keywords.texture_2d_array,Q.keywords.texture_3d,Q.keywords.texture_cube,Q.keywords.texture_cube_array];O.multisampled_texture_type=[Q.keywords.texture_multisampled_2d];O.storage_texture_type=[Q.keywords.texture_storage_1d,Q.keywords.texture_storage_2d,Q.keywords.texture_storage_2d_array,Q.keywords.texture_storage_3d];O.depth_texture_type=[Q.keywords.texture_depth_2d,Q.keywords.texture_depth_2d_array,Q.keywords.texture_depth_cube,Q.keywords.texture_depth_cube_array,Q.keywords.texture_depth_multisampled_2d];O.texture_external_type=[Q.keywords.texture_external];O.any_texture_type=[...Q.sampled_texture_type,...Q.multisampled_texture_type,...Q.storage_texture_type,...Q.depth_texture_type,...Q.texture_external_type];O.texel_format=[Q.keywords.r8unorm,Q.keywords.r8snorm,Q.keywords.r8uint,Q.keywords.r8sint,Q.keywords.r16uint,Q.keywords.r16sint,Q.keywords.r16float,Q.keywords.rg8unorm,Q.keywords.rg8snorm,Q.keywords.rg8uint,Q.keywords.rg8sint,Q.keywords.r32uint,Q.keywords.r32sint,Q.keywords.r32float,Q.keywords.rg16uint,Q.keywords.rg16sint,Q.keywords.rg16float,Q.keywords.rgba8unorm,Q.keywords.rgba8unorm_srgb,Q.keywords.rgba8snorm,Q.keywords.rgba8uint,Q.keywords.rgba8sint,Q.keywords.bgra8unorm,Q.keywords.bgra8unorm_srgb,Q.keywords.rgb10a2unorm,Q.keywords.rg11b10float,Q.keywords.rg32uint,Q.keywords.rg32sint,Q.keywords.rg32float,Q.keywords.rgba16uint,Q.keywords.rgba16sint,Q.keywords.rgba16float,Q.keywords.rgba32uint,Q.keywords.rgba32sint,Q.keywords.rgba32float];O.const_literal=[Q.tokens.int_literal,Q.tokens.uint_literal,Q.tokens.decimal_float_literal,Q.tokens.hex_float_literal,Q.keywords.true,Q.keywords.false];O.literal_or_ident=[Q.tokens.ident,Q.tokens.int_literal,Q.tokens.uint_literal,Q.tokens.decimal_float_literal,Q.tokens.hex_float_literal];O.element_count_expression=[Q.tokens.int_literal,Q.tokens.uint_literal,Q.tokens.ident];O.template_types=[Q.keywords.vec2,Q.keywords.vec3,Q.keywords.vec4,Q.keywords.mat2x2,Q.keywords.mat2x3,Q.keywords.mat2x4,Q.keywords.mat3x2,Q.keywords.mat3x3,Q.keywords.mat3x4,Q.keywords.mat4x2,Q.keywords.mat4x3,Q.keywords.mat4x4,Q.keywords.atomic,Q.keywords.bitcast,...Q.any_texture_type];O.attribute_name=[Q.tokens.ident,Q.keywords.block,Q.keywords.diagnostic];O.assignment_operators=[Q.tokens.equal,Q.tokens.plus_equal,Q.tokens.minus_equal,Q.tokens.times_equal,Q.tokens.division_equal,Q.tokens.modulo_equal,Q.tokens.and_equal,Q.tokens.or_equal,Q.tokens.xor_equal,Q.tokens.shift_right_equal,Q.tokens.shift_left_equal];O.increment_operators=[Q.tokens.plus_plus,Q.tokens.minus_minus];class Dv{constructor(e,n,i){this.type=e,this.lexeme=n,this.line=i}toString(){return this.lexeme}isTemplateType(){return O.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==O.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class b3{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Dv(O.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let l=1;for(;l>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),l--,l==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),l++)}return!0}}const n=O.simpleTokens[e];if(n)return this._addToken(n),!0;let i=O.none;const r=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let l=this._peekAhead();for(;this._isAlphaNumeric(l);)e+=this._advance(),l=this._peekAhead()}if(r){const l=O.keywords[e];if(l)return this._addToken(l),!0}if(r||s)return this._addToken(O.tokens.ident),!0;for(;;){let l=this._findType(e);const u=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(u=="=")return this._current++,e+=u,this._addToken(O.tokens.minus_equal),!0;if(u=="-")return this._current++,e+=u,this._addToken(O.tokens.minus_minus),!0;const f=this._tokens.length-1;if((O.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==O.tokens.paren_right)&&u!=">")return this._addToken(l),!0}if(e==">"&&(u==">"||u=="=")){let f=!1,d=this._tokens.length-1;for(let p=0;p<5&&d>=0&&O.assignment_operators.indexOf(this._tokens[d].type)===-1;++p,--d)if(this._tokens[d].type===O.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(l),!0}if(l===O.none){let f=e,d=0;const p=2;for(let _=0;_<p;++_)if(f+=this._peekAhead(_),l=this._findType(f),l!==O.none){d=_;break}if(l===O.none)return i===O.none?!1:(this._current--,this._addToken(i),!0);e=f,this._current+=d+1}if(i=l,this._isAtEnd())break;e+=this._advance()}return i===O.none?!1:(this._addToken(i),!0)}_findType(e){for(const i in O.regexTokens){const r=O.regexTokens[i];if(this._match(e,r.rule))return r}const n=O.literalTokens[e];return n||O.none}_match(e,n){const i=n.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new Dv(e,n,this._line))}}class R3{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new QN,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;n.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const r=i.arrayType,s=i.countNode;if(s instanceof Pg){const u=s.name,f=this._context.constants.get(u);if(f)try{const d=f.evaluate(this._context);r.count=d}catch{}}}this._deferArrayCountEval.length=0}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new b3(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==O.eof}_match(e){if(e instanceof Y)return this._check(e)?(this._advance(),!0):!1;for(let n=0,i=e.length;n<i;++n){const r=e[n];if(this._check(r))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const i=n.type;return e.indexOf(i)!=-1}return n.type==e}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(O.tokens.semicolon)&&!this._isAtEnd(););if(this._match(O.keywords.alias)){const n=this._type_alias();return this._consume(O.tokens.semicolon,"Expected ';'"),n}if(this._match(O.keywords.diagnostic)){const n=this._diagnostic();return this._consume(O.tokens.semicolon,"Expected ';'"),n}if(this._match(O.keywords.requires)){const n=this._requires_directive();return this._consume(O.tokens.semicolon,"Expected ';'"),n}if(this._match(O.keywords.enable)){const n=this._enable_directive();return this._consume(O.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(O.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(O.tokens.semicolon,"Expected ';'."),n}if(this._check(O.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(O.tokens.semicolon,"Expected ';'."),n}if(this._check(O.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(O.tokens.semicolon,"Expected ';'."),n}if(this._check(O.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(O.tokens.semicolon,"Expected ';'."),n}if(this._check(O.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(O.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(O.keywords.fn))return null;const e=this._currentLine,n=this._consume(O.tokens.ident,"Expected function name.").toString();this._consume(O.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(O.tokens.paren_right))do{if(this._check(O.tokens.paren_right))break;const u=this._attribute(),f=this._consume(O.tokens.ident,"Expected argument name.").toString();this._consume(O.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=d,i.push(new T3(f,p,u)))}while(this._match(O.tokens.comma));this._consume(O.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(O.tokens.arrow)){const u=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=u)}const s=this._compound_statement(),l=this._currentLine;return new kg(n,i,r,s,e,l)}_compound_statement(){const e=[];for(this._consume(O.tokens.brace_left,"Expected '{' for block.");!this._check(O.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(O.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(O.tokens.semicolon)&&!this._isAtEnd(););if(this._check(O.tokens.attr)&&this._attribute(),this._check(O.keywords.if))return this._if_statement();if(this._check(O.keywords.switch))return this._switch_statement();if(this._check(O.keywords.loop))return this._loop_statement();if(this._check(O.keywords.for))return this._for_statement();if(this._check(O.keywords.while))return this._while_statement();if(this._check(O.keywords.continuing))return this._continuing_statement();if(this._check(O.keywords.static_assert))return this._static_assert_statement();if(this._check(O.tokens.brace_left))return this._compound_statement();let e=null;return this._check(O.keywords.return)?e=this._return_statement():this._check([O.keywords.var,O.keywords.let,O.keywords.const])?e=this._variable_statement():this._match(O.keywords.discard)?e=new f3:this._match(O.keywords.break)?e=new d3:this._match(O.keywords.continue)?e=new g3:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(O.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(O.keywords.static_assert))return null;const e=this._optional_paren_expression();return new JN(e)}_while_statement(){if(!this._match(O.keywords.while))return null;const e=this._optional_paren_expression();this._check(O.tokens.attr)&&this._attribute();const n=this._compound_statement();return new e3(e,n)}_continuing_statement(){if(!this._match(O.keywords.continuing))return null;const e=this._compound_statement();return new t3(e)}_for_statement(){if(!this._match(O.keywords.for))return null;this._consume(O.tokens.paren_left,"Expected '('.");const e=this._check(O.tokens.semicolon)?null:this._for_init();this._consume(O.tokens.semicolon,"Expected ';'.");const n=this._check(O.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(O.tokens.semicolon,"Expected ';'.");const i=this._check(O.tokens.paren_right)?null:this._for_increment();this._consume(O.tokens.paren_right,"Expected ')'."),this._check(O.tokens.attr)&&this._attribute();const r=this._compound_statement();return new n3(e,n,i,r)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(O.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(O.tokens.equal)&&(n=this._short_circuit_or_expression()),new Rr(e.name,e.type,e.storage,e.access,n)}if(this._match(O.keywords.let)){const e=this._consume(O.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(O.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}this._consume(O.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return new Ig(e,n,null,null,i)}if(this._match(O.keywords.const)){const e=this._consume(O.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(O.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}this._consume(O.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return new Nv(e,n,null,null,i)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(O.increment_operators))return this._current=e,null;const i=this._consume(O.increment_operators,"Expected increment operator");return new i3(i.type===O.tokens.plus_plus?to.increment:to.decrement,n)}_assignment_statement(){let e=null;if(this._check(O.tokens.brace_right))return null;let n=this._match(O.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const i=this._consume(O.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return new r3(Ua.parse(i.lexeme),e,r)}_func_call_statement(){if(!this._check(O.tokens.ident))return null;const e=this._current,n=this._consume(O.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=e,null):new fS(n.lexeme,i)}_loop_statement(){if(!this._match(O.keywords.loop))return null;this._check(O.tokens.attr)&&this._attribute(),this._consume(O.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let r of n)e.push(r);else e.push(n);n=this._statement()}let i=null;return this._match(O.keywords.continuing)&&(i=this._compound_statement()),this._consume(O.tokens.brace_right,"Expected '}' for loop."),new s3(e,i)}_switch_statement(){if(!this._match(O.keywords.switch))return null;const e=this._optional_paren_expression();this._check(O.tokens.attr)&&this._attribute(),this._consume(O.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(O.tokens.brace_right,"Expected '}' for switch."),new o3(e,n)}_switch_body(){const e=[];if(this._match(O.keywords.case)){const n=this._case_selectors();this._match(O.tokens.colon),this._check(O.tokens.attr)&&this._attribute(),this._consume(O.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(O.tokens.brace_right,"Exected '}' for switch case."),e.push(new E3(n,i))}if(this._match(O.keywords.default)){this._match(O.tokens.colon),this._check(O.tokens.attr)&&this._attribute(),this._consume(O.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(O.tokens.brace_right,"Exected '}' for switch default."),e.push(new w3(n))}if(this._check([O.keywords.default,O.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(O.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(O.keywords.fallthrough))return this._consume(O.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(O.keywords.if))return null;const e=this._optional_paren_expression();this._check(O.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(O.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let r=null;return this._match(O.keywords.else)&&(this._check(O.tokens.attr)&&this._attribute(),r=this._compound_statement()),new a3(e,n,i,r)}_match_elseif(){return this._tokens[this._current].type===O.keywords.else&&this._tokens[this._current+1].type===O.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),i=this._compound_statement();return e.push(new S3(n,i)),this._match_elseif()&&(this._check(O.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(O.keywords.return))return null;const e=this._short_circuit_or_expression();return new l3(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(O.tokens.or_or);)e=new Yn(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(O.tokens.and_and);)e=new Yn(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(O.tokens.or);)e=new Yn(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(O.tokens.xor);)e=new Yn(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(O.tokens.and);)e=new Yn(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([O.tokens.equal_equal,O.tokens.not_equal])?new Yn(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([O.tokens.less_than,O.tokens.greater_than,O.tokens.less_than_equal,O.tokens.greater_than_equal]);)e=new Yn(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([O.tokens.shift_left,O.tokens.shift_right]);)e=new Yn(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([O.tokens.plus,O.tokens.minus]);)e=new Yn(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([O.tokens.star,O.tokens.forward_slash,O.tokens.modulo]);)e=new Yn(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([O.tokens.minus,O.tokens.bang,O.tokens.tilde,O.tokens.star,O.tokens.and])?new v3(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(O.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(O.tokens.bracket_right,"Expected ']'.");const n=new y3(e),i=this._postfix_expression();return i&&(n.postfix=i),n}if(this._match(O.tokens.period)){const e=this._consume(O.tokens.ident,"Expected member name."),n=this._postfix_expression(),i=new _3(e.lexeme);return n&&(i.postfix=n),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(O.tokens.ident)){const i=this._previous().toString();if(this._check(O.tokens.paren_left)){const r=this._argument_expression_list(),s=this._getStruct(i);return s!=null?new Ps(s,r):new _S(i,r)}if(this._context.constants.has(i)){const r=this._context.constants.get(i);return new Mv(i,r.value)}return new Pg(i)}if(this._match(O.const_literal))return new Ov(parseFloat(this._previous().toString()));if(this._check(O.tokens.paren_left))return this._paren_expression();if(this._match(O.keywords.bitcast)){this._consume(O.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(O.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return new m3(i,r)}const e=this._type_decl(),n=this._argument_expression_list();return new Ps(e,n)}_argument_expression_list(){if(!this._match(O.tokens.paren_left))return null;const e=[];do{if(this._check(O.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(O.tokens.comma));return this._consume(O.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(O.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(O.tokens.paren_right),new Lv([e])}_paren_expression(){this._consume(O.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(O.tokens.paren_right,"Expected ')'."),new Lv([e])}_struct_decl(){if(!this._match(O.keywords.struct))return null;const e=this._currentLine,n=this._consume(O.tokens.ident,"Expected name for struct.").toString();this._consume(O.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(O.tokens.brace_right);){const l=this._attribute(),u=this._consume(O.tokens.ident,"Expected variable name.").toString();this._consume(O.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=f),this._check(O.tokens.brace_right)?this._match(O.tokens.comma):this._consume(O.tokens.comma,"Expected ',' for struct member."),i.push(new x3(u,d,l))}this._consume(O.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,s=new br(n,i,e,r);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(O.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(O.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(O.keywords.const))return null;const e=this._consume(O.tokens.ident,"Expected variable name");let n=null;if(this._match(O.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let i=null;if(this._match(O.tokens.equal)){const s=this._short_circuit_or_expression();if(s instanceof Ps)i=s;else if(s instanceof Mv&&s.initializer instanceof Ps)i=s.initializer;else try{const l=s.evaluate(this._context);i=new Ov(l)}catch{i=s}}const r=new Nv(e.toString(),n,"","",i);return this._context.constants.set(r.name,r),r}_global_let_decl(){if(!this._match(O.keywords.let))return null;const e=this._consume(O.tokens.ident,"Expected variable name");let n=null;if(this._match(O.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}let i=null;return this._match(O.tokens.equal)&&(i=this._const_expression()),new Ig(e.toString(),n,"","",i)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(O.keywords.var))return null;let e="",n="";this._match(O.tokens.less_than)&&(e=this._consume(O.storage_class,"Expected storage_class.").toString(),this._match(O.tokens.comma)&&(n=this._consume(O.access_mode,"Expected access_mode.").toString()),this._consume(O.tokens.greater_than,"Expected '>'."));const i=this._consume(O.tokens.ident,"Expected variable name");let r=null;if(this._match(O.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}return new Rr(i.toString(),r,e,n,null)}_override_decl(){if(!this._match(O.keywords.override))return null;const e=this._consume(O.tokens.ident,"Expected variable name");let n=null;if(this._match(O.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}return new hS(e.toString(),n,null)}_diagnostic(){this._consume(O.tokens.paren_left,"Expected '('");const e=this._consume(O.tokens.ident,"Expected severity control name.");this._consume(O.tokens.comma,"Expected ','");const n=this._consume(O.tokens.ident,"Expected diagnostic rule name.");return this._consume(O.tokens.paren_right,"Expected ')'"),new h3(e.toString(),n.toString())}_enable_directive(){const e=this._consume(O.tokens.ident,"identity expected.");return new u3(e.toString())}_requires_directive(){const e=[this._consume(O.tokens.ident,"identity expected.").toString()];for(;this._match(O.tokens.comma);){const n=this._consume(O.tokens.ident,"identity expected.");e.push(n.toString())}return new c3(e)}_type_alias(){const e=this._consume(O.tokens.ident,"identity expected.");this._consume(O.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const i=new dS(e.toString(),n);return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([O.tokens.ident,...O.texel_format,O.keywords.bool,O.keywords.f32,O.keywords.i32,O.keywords.u32])){const i=this._advance(),r=i.toString();return this._context.structs.has(r)?this._context.structs.get(r):this._context.aliases.has(r)?this._context.aliases.get(r).type:new es(i.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(O.template_types)){let i=this._advance().toString(),r=null,s=null;return this._match(O.tokens.less_than)&&(r=this._type_decl(),s=null,this._match(O.tokens.comma)&&(s=this._consume(O.access_mode,"Expected access_mode for pointer").toString()),this._consume(O.tokens.greater_than,"Expected '>' for type.")),new gS(i,r,s)}if(this._match(O.keywords.ptr)){let i=this._previous().toString();this._consume(O.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(O.storage_class,"Expected storage_class for pointer");this._consume(O.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let l=null;return this._match(O.tokens.comma)&&(l=this._consume(O.access_mode,"Expected access_mode for pointer").toString()),this._consume(O.tokens.greater_than,"Expected '>' for pointer."),new p3(i,r.toString(),s,l)}const n=this._attribute();if(this._match(O.keywords.array)){let i=null,r=-1;const s=this._previous();let l=null;if(this._match(O.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let f="";if(this._match(O.tokens.comma)){l=this._shift_expression();try{f=l.evaluate(this._context).toString(),l=null}catch{f="1"}}this._consume(O.tokens.greater_than,"Expected '>' for array."),r=f?parseInt(f):0}const u=new pS(s.toString(),n,i,r);return l&&this._deferArrayCountEval.push({arrayType:u,countNode:l}),u}return null}_texture_sampler_types(){if(this._match(O.sampler_type))return new Go(this._previous().toString(),null,null);if(this._match(O.depth_texture_type))return new Go(this._previous().toString(),null,null);if(this._match(O.sampled_texture_type)||this._match(O.multisampled_texture_type)){const e=this._previous();this._consume(O.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(O.tokens.greater_than,"Expected '>' for sampler type."),new Go(e.toString(),n,null)}if(this._match(O.storage_texture_type)){const e=this._previous();this._consume(O.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(O.texel_format,"Invalid texel format.").toString();this._consume(O.tokens.comma,"Expected ',' after texel format.");const i=this._consume(O.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(O.tokens.greater_than,"Expected '>' for sampler type."),new Go(e.toString(),n,i)}return null}_attribute(){let e=[];for(;this._match(O.tokens.attr);){const n=this._consume(O.attribute_name,"Expected attribute name"),i=new A3(n.toString(),null);if(this._match(O.tokens.paren_left)){if(i.value=this._consume(O.literal_or_ident,"Expected attribute value").toString(),this._check(O.tokens.comma)){this._advance();do{const r=this._consume(O.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(r)}while(this._match(O.tokens.comma))}this._consume(O.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class Hs{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Fv{constructor(e,n,i){this.name=e,this.type=n,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class jl extends Hs{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Wf extends Hs{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class Bv extends Hs{constructor(e,n,i,r){super(e,i),this.format=n,this.access=r}get isTemplate(){return!0}}var Bi;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Bi||(Bi={}));class $l{constructor(e,n,i,r,s,l,u){this.name=e,this.type=n,this.group=i,this.binding=r,this.attributes=s,this.resourceType=l,this.access=u}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class C3{constructor(e,n){this.name=e,this.type=n}}class Xl{constructor(e,n){this.align=e,this.size=n}}class k3{constructor(e,n,i,r){this.name=e,this.type=n,this.locationType=i,this.location=r,this.interpolation=null}}class Uv{constructor(e,n,i,r){this.name=e,this.type=n,this.locationType=i,this.location=r}}class I3{constructor(e,n,i,r){this.name=e,this.type=n,this.attributes=i,this.id=r}}class P3{constructor(e,n){this.name=e,this.type=n}}class N3{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n}}class M3{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class O3{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class mi{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new M3,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const i=new R3().parse(e);for(const r of i)r instanceof kg&&this._functions.set(r.name,new O3(r));for(const r of i)if(r instanceof br){const s=this._getTypeInfo(r,null);s instanceof jl&&this.structs.push(s)}for(const r of i){if(r instanceof dS){this.aliases.push(this._getAliasInfo(r));continue}if(r instanceof hS){const s=r,l=this._getAttributeNum(s.attributes,"id",0),u=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new I3(s.name,u,s.attributes,l));continue}if(this._isUniformVar(r)){const s=r,l=this._getAttributeNum(s.attributes,"group",0),u=this._getAttributeNum(s.attributes,"binding",0),f=this._getTypeInfo(s.type,s.attributes),d=new $l(s.name,f,l,u,s.attributes,Bi.Uniform,s.access);this.uniforms.push(d);continue}if(this._isStorageVar(r)){const s=r,l=this._getAttributeNum(s.attributes,"group",0),u=this._getAttributeNum(s.attributes,"binding",0),f=this._getTypeInfo(s.type,s.attributes),d=this._isStorageTexture(f),p=new $l(s.name,f,l,u,s.attributes,d?Bi.StorageTexture:Bi.Storage,s.access);this.storage.push(p);continue}if(this._isTextureVar(r)){const s=r,l=this._getAttributeNum(s.attributes,"group",0),u=this._getAttributeNum(s.attributes,"binding",0),f=this._getTypeInfo(s.type,s.attributes),d=this._isStorageTexture(f),p=new $l(s.name,f,l,u,s.attributes,d?Bi.StorageTexture:Bi.Texture,s.access);d?this.storage.push(p):this.textures.push(p);continue}if(this._isSamplerVar(r)){const s=r,l=this._getAttributeNum(s.attributes,"group",0),u=this._getAttributeNum(s.attributes,"binding",0),f=this._getTypeInfo(s.type,s.attributes),d=new $l(s.name,f,l,u,s.attributes,Bi.Sampler,s.access);this.samplers.push(d);continue}if(r instanceof kg){const s=this._getAttribute(r,"vertex"),l=this._getAttribute(r,"fragment"),u=this._getAttribute(r,"compute"),f=s||l||u,d=new N3(r.name,f==null?void 0:f.name);d.startLine=r.startLine,d.endLine=r.endLine,this.functions.push(d),this._functions.get(r.name).info=d,f?(this._functions.get(r.name).inUse=!0,d.inUse=!0,d.resources=this._findResources(r,!!f),d.inputs=this._getInputs(r.args),d.outputs=this._getOutputs(r.returnType),this.entry[f.name].push(d)):(d.arguments=r.args.map(p=>new P3(p.name,this._getTypeInfo(p.type,p.attributes))),d.returnType=r.returnType?this._getTypeInfo(r.returnType,r.attributes):null);continue}}for(const r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(const r of this._functions.values())r.node.search(s=>{var l;if(s.astNodeType==="varExpr"){const u=s;for(const f of this.overrides)u.name==f.name&&((l=r.info)===null||l===void 0||l.overrides.push(f))}});for(const r of this.uniforms)this._markStructsInUse(r.type);for(const r of this.storage)this._markStructsInUse(r.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var i;for(const r of e.calls){const s=(i=this._functions.get(r.name))===null||i===void 0?void 0:i.info;s&&n.add(s)}}findResource(e,n){for(const i of this.uniforms)if(i.group==e&&i.binding==n)return i;for(const i of this.storage)if(i.group==e&&i.binding==n)return i;for(const i of this.textures)if(i.group==e&&i.binding==n)return i;for(const i of this.samplers)if(i.group==e&&i.binding==n)return i;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this._getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const i=[],r=this,s=[];return e.search(l=>{if(l instanceof xc)s.push({});else if(l instanceof Ac)s.pop();else if(l instanceof Rr){const u=l;n&&u.type!==null&&this._markStructsFromAST(u.type),s.length>0&&(s[s.length-1][u.name]=u)}else if(l instanceof Ps){const u=l;n&&u.type!==null&&this._markStructsFromAST(u.type)}else if(l instanceof Ig){const u=l;n&&u.type!==null&&this._markStructsFromAST(u.type),s.length>0&&(s[s.length-1][u.name]=u)}else if(l instanceof Pg){const u=l;if(s.length>0&&s[s.length-1][u.name])return;const f=r._findResource(u.name);f&&i.push(f)}else if(l instanceof _S){const u=l,f=r._functions.get(u.name);f&&(n&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=r._findResources(f.node,n)),i.push(...f.resources))}else if(l instanceof fS){const u=l,f=r._functions.get(u.name);f&&(n&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=r._findResources(f.node,n)),i.push(...f.resources))}}),[...new Map(i.map(l=>[l.name,l])).values()]}getBindGroups(){const e=[];function n(i,r){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),r>=e[i].length&&(e[i].length=r+1)}for(const i of this.uniforms){n(i.group,i.binding);const r=e[i.group];r[i.binding]=i}for(const i of this.storage){n(i.group,i.binding);const r=e[i.group];r[i.binding]=i}for(const i of this.textures){n(i.group,i.binding);const r=e[i.group];r[i.binding]=i}for(const i of this.samplers){n(i.group,i.binding);const r=e[i.group];r[i.binding]=i}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof br)this._getStructOutputs(e,n);else{const i=this._getOutputInfo(e);i!==null&&n.push(i)}return n}_getStructOutputs(e,n){for(const i of e.members)if(i.type instanceof br)this._getStructOutputs(i.type,n);else{const r=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(r!==null){const s=this._getTypeInfo(i.type,i.type.attributes),l=this._parseInt(r.value),u=new Uv(i.name,s,r.name,l);n.push(u)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const i=this._getTypeInfo(e,e.attributes),r=this._parseInt(n.value);return new Uv("",i,n.name,r)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const i of e)if(i.type instanceof br)this._getStructInputs(i.type,n);else{const r=this._getInputInfo(i);r!==null&&n.push(r)}return n}_getStructInputs(e,n){for(const i of e.members)if(i.type instanceof br)this._getStructInputs(i.type,n);else{const r=this._getInputInfo(i);r!==null&&n.push(r)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const i=this._getAttribute(e,"interpolation"),r=this._getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),l=new k3(e.name,r,n.name,s);return i!==null&&(l.interpolation=this._parseString(i.value)),l}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new C3(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof pS){const r=e,s=r.format?this._getTypeInfo(r.format,r.attributes):null,l=new Wf(r.name,n);return l.format=s,l.count=r.count,this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof br){const r=e,s=new jl(r.name,n);s.startLine=r.startLine,s.endLine=r.endLine;for(const l of r.members){const u=this._getTypeInfo(l.type,l.attributes);s.members.push(new Fv(l.name,u,l.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Go){const r=e,s=r.format instanceof es,l=r.format?s?this._getTypeInfo(r.format,null):new Hs(r.format,null):null,u=new Bv(r.name,l,n,r.access);return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof gS){const r=e,s=r.format?this._getTypeInfo(r.format,null):null,l=new Bv(r.name,s,n,r.access);return this._types.set(e,l),this._updateTypeInfo(l),l}const i=new Hs(e.name,n);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var n,i;const r=this._getTypeSize(e);if(e.size=(n=r==null?void 0:r.size)!==null&&n!==void 0?n:0,e instanceof Wf&&e.format){const s=this._getTypeSize(e.format);e.stride=(i=s==null?void 0:s.size)!==null&&i!==void 0?i:0,this._updateTypeInfo(e.format)}e instanceof jl&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let i=0,r=0,s=0,l=0;for(let u=0,f=e.members.length;u<f;++u){const d=e.members[u],p=this._getTypeSize(d);if(!p)continue;(n=this._getAlias(d.type.name))!==null&&n!==void 0||d.type;const _=p.align,y=p.size;i=this._roundUp(_,i+r),r=y,s=i,l=Math.max(l,_),d.offset=i,d.size=y,this._updateTypeInfo(d.type)}e.size=this._roundUp(l,s+r),e.align=l}_getTypeSize(e){var n,i;if(e==null)return null;const r=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Fv&&(e=e.type),e instanceof Hs){const l=this._getAlias(e.name);l!==null&&(e=l)}{const l=mi._typeInfo[e.name];if(l!==void 0){const u=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new Xl(Math.max(s,l.align/u),Math.max(r,l.size/u))}}{const l=mi._typeInfo[e.name.substring(0,e.name.length-1)];if(l){const u=e.name[e.name.length-1]==="h"?2:1;return new Xl(Math.max(s,l.align/u),Math.max(r,l.size/u))}}if(e instanceof Wf){let l=e,u=8,f=8;const d=this._getTypeSize(l.format);d!==null&&(f=d.size,u=d.align);const p=l.count,_=this._getAttributeNum((i=e==null?void 0:e.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(u,f));return f=p*_,r&&(f=r),new Xl(Math.max(s,u),Math.max(r,f))}if(e instanceof jl){let l=0,u=0,f=0,d=0,p=0;for(const _ of e.members){const y=this._getTypeSize(_.type);y!==null&&(l=Math.max(y.align,l),f=this._roundUp(y.align,f+d),d=y.size,p=f)}return u=this._roundUp(l,p+d),new Xl(Math.max(s,l),Math.max(r,u))}return null}_isUniformVar(e){return e instanceof Rr&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Rr&&e.storage=="storage"}_isTextureVar(e){return e instanceof Rr&&e.type!==null&&mi._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Rr&&e.type!==null&&mi._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const i=e;if(!i||!i.attributes)return null;const r=i.attributes;for(let s of r)if(s.name==n)return s;return null}_getAttributeNum(e,n,i){if(e===null)return i;for(let r of e)if(r.name==n){let s=r!==null&&r.value!==null?r.value:i;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):i}return i}_roundUp(e,n){return Math.ceil(n/e)*e}}mi._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};mi._textureTypes=O.any_texture_type.map(t=>t.name);mi._samplerTypes=O.sampler_type.map(t=>t.name);function L3(t){var s;const e={attributes:[],bindings:[]};let n;try{n=D3(t)}catch(l){return oe.error(l.message)(),e}for(const l of n.uniforms){const u=[];for(const f of((s=l.type)==null?void 0:s.members)||[])u.push({name:f.name,type:zv(f.type)});e.bindings.push({type:"uniform",name:l.name,group:l.group,location:l.binding,members:u})}for(const l of n.textures)e.bindings.push({type:"texture",name:l.name,group:l.group,location:l.binding});for(const l of n.samplers)e.bindings.push({type:"sampler",name:l.name,group:l.group,location:l.binding});const i=n.entry.vertex[0],r=(i==null?void 0:i.inputs.length)||0;for(let l=0;l<r;l++){const u=i.inputs[l];if(u.locationType==="location"){const f=zv(u.type);e.attributes.push({name:u.name,location:Number(u.location),type:f})}}return e}function zv(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function D3(t){try{return new mi(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const F3={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...F3}};const rn=globalThis.mathgl.config;function B3(t,{precision:e=rn.precision}={}){return t=U3(t),`${parseFloat(t.toPrecision(e))}`}function no(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function $i(t,e,n){return V3(t,i=>Math.max(e,Math.min(n,i)))}function bc(t,e,n){return no(t)?t.map((i,r)=>bc(i,e[r],n)):n*e+(1-n)*t}function za(t,e,n){const i=rn.EPSILON;n&&(rn.EPSILON=n);try{if(t===e)return!0;if(no(t)&&no(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!za(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=rn.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{rn.EPSILON=i}}function U3(t){return Math.round(t/rn.EPSILON)*rn.EPSILON}function z3(t){return t.clone?t.clone():new Array(t.length)}function V3(t,e,n){if(no(t)){const i=t;n=n||z3(i);for(let r=0;r<n.length&&r<i.length;++r){const s=typeof t=="number"?t:t[r];n[r]=e(s,r,n)}return n}return e(t)}class vS extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:no(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(rn)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+B3(this[i],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!za(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const s=e[r],l=typeof n=="number"?n:n[r];this[r]=s+i*(l-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(rn.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function W3(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function tn(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Hf(t,e,n=""){if(rn.debug&&!W3(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function Vv(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class H3 extends vS{get x(){return this[0]}set x(e){this[0]=tn(e)}get y(){return this[1]}set y(e){this[1]=tn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return tn(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return tn(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Vv(e>=0&&e<this.ELEMENTS,"index is out of range"),tn(this[e])}setComponent(e,n){return Vv(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const Cu=1e-6;let io=typeof Float32Array<"u"?Float32Array:Array;function j3(){const t=new io(2);return io!=Float32Array&&(t[0]=0,t[1]=0),t}function Wv(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function $3(t,e){return t[0]=-e[0],t[1]=-e[1],t}function ES(t,e,n,i){const r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}function X3(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){const t=j3();return function(e,n,i,r,s,l){let u,f;for(n||(n=2),i||(i=0),r?f=Math.min(r*n+i,e.length):f=e.length,u=i;u<f;u+=n)t[0]=e[u],t[1]=e[u+1],s(t,t,l),e[u]=t[0],e[u+1]=t[1];return e}})();function Y3(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}function wS(t,e,n){const i=e[0],r=e[1],s=e[2],l=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/l,t[1]=(n[1]*i+n[5]*r+n[9]*s)/l,t[2]=(n[2]*i+n[6]*r+n[10]*s)/l,t}function q3(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function K3(){const t=new io(3);return io!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function G3(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Z3(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Q3(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function J3(t,e,n){const i=e[0],r=e[1],s=e[2],l=n[0],u=n[1],f=n[2];return t[0]=r*f-s*u,t[1]=s*l-i*f,t[2]=i*u-r*l,t}function TS(t,e,n){const i=e[0],r=e[1],s=e[2];let l=n[3]*i+n[7]*r+n[11]*s+n[15];return l=l||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/l,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/l,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/l,t}function e2(t,e,n){const i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function t2(t,e,n){const i=n[0],r=n[1],s=n[2],l=n[3],u=e[0],f=e[1],d=e[2];let p=r*d-s*f,_=s*u-i*d,y=i*f-r*u,E=r*y-s*_,T=s*p-i*y,k=i*_-r*p;const M=l*2;return p*=M,_*=M,y*=M,E*=2,T*=2,k*=2,t[0]=u+p+E,t[1]=f+_+T,t[2]=d+y+k,t}function n2(t,e,n,i){const r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function i2(t,e,n,i){const r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function r2(t,e,n,i){const r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function s2(t,e){const n=t[0],i=t[1],r=t[2],s=e[0],l=e[1],u=e[2],f=Math.sqrt((n*n+i*i+r*r)*(s*s+l*l+u*u)),d=f&&Q3(t,e)/f;return Math.acos(Math.min(Math.max(d,-1),1))}const o2=G3;(function(){const t=K3();return function(e,n,i,r,s,l){let u,f;for(n||(n=3),i||(i=0),r?f=Math.min(r*n+i,e.length):f=e.length,u=i;u<f;u+=n)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],s(t,t,l),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2];return e}})();const jf=[0,0,0];let Yl;class ri extends H3{static get ZERO(){return Yl||(Yl=new ri(0,0,0),Object.freeze(Yl)),Yl}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&no(e)?this.copy(e):(rn.debug&&(tn(e),tn(n),tn(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return rn.debug&&(tn(e.x),tn(e.y),tn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=tn(e)}angle(e){return s2(this,e)}cross(e){return J3(this,this,e),this.check()}rotateX({radians:e,origin:n=jf}){return n2(this,this,n,e),this.check()}rotateY({radians:e,origin:n=jf}){return i2(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=jf}){return r2(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return TS(this,this,e),this.check()}transformAsVector(e){return wS(this,this,e),this.check()}transformByMatrix3(e){return e2(this,this,e),this.check()}transformByMatrix2(e){return q3(this,this,e),this.check()}transformByQuaternion(e){return t2(this,this,e),this.check()}}class a2 extends vS{toString(){let e="[";if(rn.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=tn(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function l2(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function u2(t,e){if(t===e){const n=e[1],i=e[2],r=e[3],s=e[6],l=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=l,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Ng(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],l=e[4],u=e[5],f=e[6],d=e[7],p=e[8],_=e[9],y=e[10],E=e[11],T=e[12],k=e[13],M=e[14],b=e[15],w=n*u-i*l,A=n*f-r*l,N=n*d-s*l,D=i*f-r*u,W=i*d-s*u,K=r*d-s*f,x=p*k-_*T,R=p*M-y*T,P=p*b-E*T,U=_*M-y*k,F=_*b-E*k,z=y*b-E*M;let B=w*z-A*F+N*U+D*P-W*R+K*x;return B?(B=1/B,t[0]=(u*z-f*F+d*U)*B,t[1]=(r*F-i*z-s*U)*B,t[2]=(k*K-M*W+b*D)*B,t[3]=(y*W-_*K-E*D)*B,t[4]=(f*P-l*z-d*R)*B,t[5]=(n*z-r*P+s*R)*B,t[6]=(M*N-T*K-b*A)*B,t[7]=(p*K-y*N+E*A)*B,t[8]=(l*F-u*P+d*x)*B,t[9]=(i*P-n*F-s*x)*B,t[10]=(T*W-k*N+b*w)*B,t[11]=(_*N-p*W-E*w)*B,t[12]=(u*R-l*U-f*x)*B,t[13]=(n*U-i*R+r*x)*B,t[14]=(k*A-T*D-M*w)*B,t[15]=(p*D-_*A+y*w)*B,t):null}function c2(t){const e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],l=t[5],u=t[6],f=t[7],d=t[8],p=t[9],_=t[10],y=t[11],E=t[12],T=t[13],k=t[14],M=t[15],b=e*l-n*s,w=e*u-i*s,A=n*u-i*l,N=d*T-p*E,D=d*k-_*E,W=p*k-_*T,K=e*W-n*D+i*N,x=s*W-l*D+u*N,R=d*A-p*w+_*b,P=E*A-T*w+k*b;return f*K-r*x+M*R-y*P}function Fr(t,e,n){const i=e[0],r=e[1],s=e[2],l=e[3],u=e[4],f=e[5],d=e[6],p=e[7],_=e[8],y=e[9],E=e[10],T=e[11],k=e[12],M=e[13],b=e[14],w=e[15];let A=n[0],N=n[1],D=n[2],W=n[3];return t[0]=A*i+N*u+D*_+W*k,t[1]=A*r+N*f+D*y+W*M,t[2]=A*s+N*d+D*E+W*b,t[3]=A*l+N*p+D*T+W*w,A=n[4],N=n[5],D=n[6],W=n[7],t[4]=A*i+N*u+D*_+W*k,t[5]=A*r+N*f+D*y+W*M,t[6]=A*s+N*d+D*E+W*b,t[7]=A*l+N*p+D*T+W*w,A=n[8],N=n[9],D=n[10],W=n[11],t[8]=A*i+N*u+D*_+W*k,t[9]=A*r+N*f+D*y+W*M,t[10]=A*s+N*d+D*E+W*b,t[11]=A*l+N*p+D*T+W*w,A=n[12],N=n[13],D=n[14],W=n[15],t[12]=A*i+N*u+D*_+W*k,t[13]=A*r+N*f+D*y+W*M,t[14]=A*s+N*d+D*E+W*b,t[15]=A*l+N*p+D*T+W*w,t}function Rc(t,e,n){const i=n[0],r=n[1],s=n[2];let l,u,f,d,p,_,y,E,T,k,M,b;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(l=e[0],u=e[1],f=e[2],d=e[3],p=e[4],_=e[5],y=e[6],E=e[7],T=e[8],k=e[9],M=e[10],b=e[11],t[0]=l,t[1]=u,t[2]=f,t[3]=d,t[4]=p,t[5]=_,t[6]=y,t[7]=E,t[8]=T,t[9]=k,t[10]=M,t[11]=b,t[12]=l*i+p*r+T*s+e[12],t[13]=u*i+_*r+k*s+e[13],t[14]=f*i+y*r+M*s+e[14],t[15]=d*i+E*r+b*s+e[15]),t}function A_(t,e,n){const i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function h2(t,e,n,i){let r=i[0],s=i[1],l=i[2],u=Math.sqrt(r*r+s*s+l*l),f,d,p,_,y,E,T,k,M,b,w,A,N,D,W,K,x,R,P,U,F,z,B,V;return u<Cu?null:(u=1/u,r*=u,s*=u,l*=u,d=Math.sin(n),f=Math.cos(n),p=1-f,_=e[0],y=e[1],E=e[2],T=e[3],k=e[4],M=e[5],b=e[6],w=e[7],A=e[8],N=e[9],D=e[10],W=e[11],K=r*r*p+f,x=s*r*p+l*d,R=l*r*p-s*d,P=r*s*p-l*d,U=s*s*p+f,F=l*s*p+r*d,z=r*l*p+s*d,B=s*l*p-r*d,V=l*l*p+f,t[0]=_*K+k*x+A*R,t[1]=y*K+M*x+N*R,t[2]=E*K+b*x+D*R,t[3]=T*K+w*x+W*R,t[4]=_*P+k*U+A*F,t[5]=y*P+M*U+N*F,t[6]=E*P+b*U+D*F,t[7]=T*P+w*U+W*F,t[8]=_*z+k*B+A*V,t[9]=y*z+M*B+N*V,t[10]=E*z+b*B+D*V,t[11]=T*z+w*B+W*V,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function SS(t,e,n){const i=Math.sin(n),r=Math.cos(n),s=e[4],l=e[5],u=e[6],f=e[7],d=e[8],p=e[9],_=e[10],y=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+d*i,t[5]=l*r+p*i,t[6]=u*r+_*i,t[7]=f*r+y*i,t[8]=d*r-s*i,t[9]=p*r-l*i,t[10]=_*r-u*i,t[11]=y*r-f*i,t}function f2(t,e,n){const i=Math.sin(n),r=Math.cos(n),s=e[0],l=e[1],u=e[2],f=e[3],d=e[8],p=e[9],_=e[10],y=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-d*i,t[1]=l*r-p*i,t[2]=u*r-_*i,t[3]=f*r-y*i,t[8]=s*i+d*r,t[9]=l*i+p*r,t[10]=u*i+_*r,t[11]=f*i+y*r,t}function xS(t,e,n){const i=Math.sin(n),r=Math.cos(n),s=e[0],l=e[1],u=e[2],f=e[3],d=e[4],p=e[5],_=e[6],y=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+d*i,t[1]=l*r+p*i,t[2]=u*r+_*i,t[3]=f*r+y*i,t[4]=d*r-s*i,t[5]=p*r-l*i,t[6]=_*r-u*i,t[7]=y*r-f*i,t}function d2(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],l=n+n,u=i+i,f=r+r,d=n*l,p=i*l,_=i*u,y=r*l,E=r*u,T=r*f,k=s*l,M=s*u,b=s*f;return t[0]=1-_-T,t[1]=p+b,t[2]=y-M,t[3]=0,t[4]=p-b,t[5]=1-d-T,t[6]=E+k,t[7]=0,t[8]=y+M,t[9]=E-k,t[10]=1-d-_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function g2(t,e,n,i,r,s,l){const u=1/(n-e),f=1/(r-i),d=1/(s-l);return t[0]=s*2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*f,t[6]=0,t[7]=0,t[8]=(n+e)*u,t[9]=(r+i)*f,t[10]=(l+s)*d,t[11]=-1,t[12]=0,t[13]=0,t[14]=l*s*2*d,t[15]=0,t}function p2(t,e,n,i,r){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0){const l=1/(i-r);t[10]=(r+i)*l,t[14]=2*r*i*l}else t[10]=-1,t[14]=-2*i;return t}const _2=p2;function m2(t,e,n,i,r,s,l){const u=1/(e-n),f=1/(i-r),d=1/(s-l);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+n)*u,t[13]=(r+i)*f,t[14]=(l+s)*d,t[15]=1,t}const y2=m2;function v2(t,e,n,i){let r,s,l,u,f,d,p,_,y,E;const T=e[0],k=e[1],M=e[2],b=i[0],w=i[1],A=i[2],N=n[0],D=n[1],W=n[2];return Math.abs(T-N)<Cu&&Math.abs(k-D)<Cu&&Math.abs(M-W)<Cu?l2(t):(_=T-N,y=k-D,E=M-W,r=1/Math.sqrt(_*_+y*y+E*E),_*=r,y*=r,E*=r,s=w*E-A*y,l=A*_-b*E,u=b*y-w*_,r=Math.sqrt(s*s+l*l+u*u),r?(r=1/r,s*=r,l*=r,u*=r):(s=0,l=0,u=0),f=y*u-E*l,d=E*s-_*u,p=_*l-y*s,r=Math.sqrt(f*f+d*d+p*p),r?(r=1/r,f*=r,d*=r,p*=r):(f=0,d=0,p=0),t[0]=s,t[1]=f,t[2]=_,t[3]=0,t[4]=l,t[5]=d,t[6]=y,t[7]=0,t[8]=u,t[9]=p,t[10]=E,t[11]=0,t[12]=-(s*T+l*k+u*M),t[13]=-(f*T+d*k+p*M),t[14]=-(_*T+y*k+E*M),t[15]=1,t)}function E2(){const t=new io(4);return io!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function w2(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function sl(t,e,n){const i=e[0],r=e[1],s=e[2],l=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*l,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*l,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*l,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*l,t}(function(){const t=E2();return function(e,n,i,r,s,l){let u,f;for(n||(n=4),i||(i=0),r?f=Math.min(r*n+i,e.length):f=e.length,u=i;u<f;u+=n)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],t[3]=e[u+3],s(t,t,l),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];return e}})();var Mg;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Mg||(Mg={}));const T2=45*Math.PI/180,S2=1,$f=.1,Xf=500,x2=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class si extends a2{static get IDENTITY(){return b2()}static get ZERO(){return A2()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Mg}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,s,l,u,f,d,p,_,y,E,T,k,M){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=l,this[6]=u,this[7]=f,this[8]=d,this[9]=p,this[10]=_,this[11]=y,this[12]=E,this[13]=T,this[14]=k,this[15]=M,this.check()}setRowMajor(e,n,i,r,s,l,u,f,d,p,_,y,E,T,k,M){return this[0]=e,this[1]=s,this[2]=d,this[3]=E,this[4]=n,this[5]=l,this[6]=p,this[7]=T,this[8]=i,this[9]=u,this[10]=_,this[11]=k,this[12]=r,this[13]=f,this[14]=y,this[15]=M,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(x2)}fromObject(e){return this.check()}fromQuaternion(e){return d2(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:s,near:l=$f,far:u=Xf}=e;return u===1/0?R2(this,n,i,r,s,l):g2(this,n,i,r,s,l,u),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return v2(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:s,near:l=$f,far:u=Xf}=e;return y2(this,n,i,r,s,l,u),this.check()}orthographic(e){const{fovy:n=T2,aspect:i=S2,focalDistance:r=1,near:s=$f,far:l=Xf}=e;Hv(n);const u=n/2,f=r*Math.tan(u),d=f*i;return this.ortho({left:-d,right:d,bottom:-f,top:f,near:s,far:l})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=e;return Hv(n),_2(this,n,i,r,s),this.check()}determinant(){return c2(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],l=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],l=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*l,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*l,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*l,e}transpose(){return u2(this,this),this.check()}invert(){return Ng(this,this),this.check()}multiplyLeft(e){return Fr(this,e,this),this.check()}multiplyRight(e){return Fr(this,this,e),this.check()}rotateX(e){return SS(this,this,e),this.check()}rotateY(e){return f2(this,this,e),this.check()}rotateZ(e){return xS(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return h2(this,this,e,n),this.check()}scale(e){return A_(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Rc(this,this,e),this.check()}transform(e,n){return e.length===4?(n=sl(n||[-0,-0,-0,-0],e,this),Hf(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=X3(n||[-0,-0],e,this);break;case 3:r=TS(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Hf(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=Y3(n||[-0,-0],e,this);break;case 3:i=wS(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Hf(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let ql,Kl;function A2(){return ql||(ql=new si([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ql)),ql}function b2(){return Kl||(Kl=new si,Object.freeze(Kl)),Kl}function Hv(t){if(t>Math.PI*2)throw Error("expected radians")}function R2(t,e,n,i,r,s){const l=2*s/(n-e),u=2*s/(r-i),f=(n+e)/(n-e),d=(r+i)/(r-i),p=-1,_=-1,y=-2*s;return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=f,t[9]=d,t[10]=p,t[11]=_,t[12]=0,t[13]=0,t[14]=y,t[15]=0,t}function AS(t,e=[],n=0){const i=Math.fround(t),r=t-i;return e[n]=i,e[n+1]=r,e}function C2(t){return t-Math.fround(t)}function k2(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const r=n*4+i;AS(t[i*4+n],e,r*2)}return e}const I2=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,P2={name:"fp32",vs:I2},N2=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,M2={ONE:1},O2={name:"fp64arithmetic",vs:N2,defaultUniforms:M2,uniformTypes:{ONE:"f32"},fp64ify:AS,fp64LowPart:C2,fp64ifyMatrix4:k2},L2=[0,1,1,1],D2=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,F2=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,jv={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:L2},vs:D2,fs:F2,getUniforms:B2};function B2(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const i=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=i}if(t.highlightColor){const i=Array.from(t.highlightColor,r=>r/255);Number.isFinite(i[3])||(i[3]=1),n.highlightColor=i}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const $v=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,U2=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,bS=3,z2=255;var Va;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(Va||(Va={}));const ku={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:bS},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Va.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:U2,vs:$v,fs:$v,getUniforms:V2};function V2(t,e={}){if(t=t&&{...t},!t)return{...ku.defaultUniforms};t.lights&&(t={...t,...H2(t.lights),lights:void 0});const{ambientLight:n,pointLights:i,directionalLights:r}=t||{};if(!(n||i&&i.length>0||r&&r.length>0))return{...ku.defaultUniforms,enabled:0};const l={...ku.defaultUniforms,...e,...W2({ambientLight:n,pointLights:i,directionalLights:r})};return t.enabled!==void 0&&(l.enabled=t.enabled?1:0),l}function W2({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const i={};i.ambientLightColor=Yf(t);let r=0;for(const s of e){i.lightType=Va.POINT;const l=r;i[`lightColor${l}`]=Yf(s),i[`lightPosition${l}`]=s.position,i[`lightAttenuation${l}`]=s.attenuation||[1,0,0],r++}for(const s of n){i.lightType=Va.DIRECTIONAL;const l=r;i[`lightColor${l}`]=Yf(s),i[`lightDirection${l}`]=s.direction,r++}return r>bS&&oe.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=n.length,i.pointLightCount=e.length,i}function H2(t){var n,i;const e={pointLights:[],directionalLights:[]};for(const r of t||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":(n=e.directionalLights)==null||n.push(r);break;case"point":(i=e.pointLights)==null||i.push(r);break}return e}function Yf(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(i=>i*n/z2)}const j2=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,$2=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,RS={props:{},name:"gouraudMaterial",vs:$2.replace("phongMaterial","gouraudMaterial"),fs:j2.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[ku],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(n=>n/255)),{...RS.defaultUniforms,...e}}},Xv=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,X2={name:"layer",vs:Xv,fs:Xv,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},CS="#define SMOOTH_EDGE_RADIUS 0.5",Y2=`
${CS}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,q2=`
${CS}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,kS={name:"geometry",vs:Y2,fs:q2},K2=25;var ft;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(ft||(ft={}));var gt;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(gt||(gt={}));var Te;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(Te||(Te={}));const G2="compute",Z2="auto",Og="manipulation",Iu="none",Lg="pan-x",Dg="pan-y";function Q2(t){if(t.includes(Iu))return Iu;const e=t.includes(Lg),n=t.includes(Dg);return e&&n?Iu:e||n?e?Lg:Dg:t.includes(Og)?Og:Z2}class J2{constructor(e,n){this.actions="",this.manager=e,this.set(n)}set(e){e===G2&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const n of this.manager.recognizers)n.options.enable&&(e=e.concat(n.getTouchAction()));return Q2(e.join(" "))}}function Cc(t){return t.trim().split(/\s+/g)}function qf(t,e,n){if(t)for(const i of Cc(e))t.addEventListener(i,n,!1)}function Kf(t,e,n){if(t)for(const i of Cc(e))t.removeEventListener(i,n,!1)}function Yv(t){return(t.ownerDocument||t).defaultView}function eM(t,e){let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1}function IS(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let n=0,i=0,r=0;for(;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:Math.round(n/e),y:Math.round(i/e)}}function qv(t){const e=[];let n=0;for(;n<t.pointers.length;)e[n]={clientX:Math.round(t.pointers[n].clientX),clientY:Math.round(t.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:e,center:IS(e),deltaX:t.deltaX,deltaY:t.deltaY}}function PS(t,e){const n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}function Kv(t,e){const n=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(n*n+i*i)}function tM(t,e){const n=e.x-t.x,i=e.y-t.y;return Math.atan2(i,n)*180/Math.PI}function Gv(t,e){const n=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.atan2(i,n)*180/Math.PI}function NS(t,e){return t===e?gt.None:Math.abs(t)>=Math.abs(e)?t<0?gt.Left:gt.Right:e<0?gt.Up:gt.Down}function nM(t,e){const n=e.center;let i=t.offsetDelta,r=t.prevDelta;const s=t.prevInput;return(e.eventType===ft.Start||(s==null?void 0:s.eventType)===ft.End)&&(r=t.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},i=t.offsetDelta={x:n.x,y:n.y}),{deltaX:r.x+(n.x-i.x),deltaY:r.y+(n.y-i.y)}}function MS(t,e,n){return{x:e/t||0,y:n/t||0}}function iM(t,e){return Kv(e[0],e[1])/Kv(t[0],t[1])}function rM(t,e){return Gv(e[1],e[0])-Gv(t[1],t[0])}function sM(t,e){const n=t.lastInterval||e,i=e.timeStamp-n.timeStamp;let r,s,l,u;if(e.eventType!==ft.Cancel&&(i>K2||n.velocity===void 0)){const f=e.deltaX-n.deltaX,d=e.deltaY-n.deltaY,p=MS(i,f,d);s=p.x,l=p.y,r=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,u=NS(f,d),t.lastInterval=e}else r=n.velocity,s=n.velocityX,l=n.velocityY,u=n.direction;e.velocity=r,e.velocityX=s,e.velocityY=l,e.direction=u}function oM(t,e){const{session:n}=t,{pointers:i}=e,{length:r}=i;n.firstInput||(n.firstInput=qv(e)),r>1&&!n.firstMultiple?n.firstMultiple=qv(e):r===1&&(n.firstMultiple=!1);const{firstInput:s,firstMultiple:l}=n,u=l?l.center:s.center,f=e.center=IS(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=tM(u,f),e.distance=PS(u,f);const{deltaX:d,deltaY:p}=nM(n,e);e.deltaX=d,e.deltaY=p,e.offsetDirection=NS(e.deltaX,e.deltaY);const _=MS(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=_.x,e.overallVelocityY=_.y,e.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,e.scale=l?iM(l.pointers,i):1,e.rotation=l?rM(l.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length;let y=t.element;return eM(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,sM(n,e),e}function aM(t,e,n){const i=n.pointers.length,r=n.changedPointers.length,s=e&ft.Start&&i-r===0,l=e&(ft.End|ft.Cancel)&&i-r===0;n.isFirst=!!s,n.isFinal=!!l,s&&(t.session={}),n.eventType=e;const u=oM(t,n);t.emit("hammer.input",u),t.recognize(u),t.session.prevInput=u}let lM=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=n=>{this.manager.options.enable&&this.handler(n)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,n){aM(this.manager,e,n)}init(){qf(this.element,this.evEl,this.domHandler),qf(this.target,this.evTarget,this.domHandler),qf(Yv(this.element),this.evWin,this.domHandler)}destroy(){Kf(this.element,this.evEl,this.domHandler),Kf(this.target,this.evTarget,this.domHandler),Kf(Yv(this.element),this.evWin,this.domHandler)}};const uM={pointerdown:ft.Start,pointermove:ft.Move,pointerup:ft.End,pointercancel:ft.Cancel,pointerout:ft.Cancel},cM="pointerdown",hM="pointermove pointerup pointercancel";class fM extends lM{constructor(e){super(e),this.evEl=cM,this.evWin=hM,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:n}=this;let i=!1;const r=uM[e.type],s=e.pointerType,l=s==="touch";let u=n.findIndex(f=>f.pointerId===e.pointerId);r&ft.Start&&(e.buttons||l)?u<0&&(n.push(e),u=n.length-1):r&(ft.End|ft.Cancel)&&(i=!0),!(u<0)&&(n[u]=e,this.callback(r,{pointers:n,changedPointers:[e],eventType:r,pointerType:s,srcEvent:e}),i&&n.splice(u,1))}}const dM=["","webkit","Moz","MS","ms","o"];function gM(t,e){const n=e[0].toUpperCase()+e.slice(1);for(const i of dM){const r=i?i+n:e;if(r in t)return r}}const pM=1,Zv=2,Qv={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class _M{constructor(e,n){this.options={...Qv,...n,cssProps:{...Qv.cssProps,...n.cssProps},inputTarget:n.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new fM(this),this.touchAction=new J2(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Zv:pM}recognize(e){const{session:n}=this;if(n.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:r}=this;let{curRecognizer:s}=n;(!s||s&&s.state&Te.Recognized)&&(s=n.curRecognizer=null);let l=0;for(;l<r.length;)i=r[l],n.stopped!==Zv&&(!s||i===s||i.canRecognizeWith(s))?i.recognize(e):i.reset(),!s&&i.state&(Te.Began|Te.Changed|Te.Ended)&&(s=n.curRecognizer=i),l++}get(e){const{recognizers:n}=this;for(let i=0;i<n.length;i++)if(n[i].options.event===e)return n[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const n=this.get(e.options.event);return n&&this.remove(n),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const n=typeof e=="string"?this.get(e):e;if(n){const{recognizers:i}=this,r=i.indexOf(n);r!==-1&&(i.splice(r,1),this.touchAction.update())}return this}on(e,n){if(!e||!n)return;const{handlers:i}=this;for(const r of Cc(e))i[r]=i[r]||[],i[r].push(n)}off(e,n){if(!e)return;const{handlers:i}=this;for(const r of Cc(e))n?i[r]&&i[r].splice(i[r].indexOf(n),1):delete i[r]}emit(e,n){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const r=n;r.type=e,r.preventDefault=function(){n.srcEvent.preventDefault()};let s=0;for(;s<i.length;)i[s](r),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:n}=this;if(n){for(const[i,r]of Object.entries(this.options.cssProps)){const s=gM(n.style,i);e?(this.oldCssProps[s]=n.style[s],n.style[s]=r):n.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let mM=1;function yM(){return mM++}function Jv(t){return t&Te.Cancelled?"cancel":t&Te.Ended?"end":t&Te.Changed?"move":t&Te.Began?"start":""}class OS{constructor(e){this.options=e,this.id=yM(),this.state=Te.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const r of e)this.recognizeWith(r);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{simultaneous:i}=this;return i[n.id]||(i[n.id]=n,n.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let n;return typeof e=="string"?n=this.manager.get(e):n=e,n&&delete this.simultaneous[n.id],this}requireFailure(e){if(Array.isArray(e)){for(const r of e)this.requireFailure(r);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{requireFail:i}=this;return i.indexOf(n)===-1&&(i.push(n),n.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let n;if(typeof e=="string"?n=this.manager.get(e):n=e,n){const i=this.requireFail.indexOf(n);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:n}=this;n<Te.Ended&&this.manager.emit(this.options.event+Jv(n),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),n>=Te.Ended&&this.manager.emit(this.options.event+Jv(n),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Te.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Te.Failed|Te.Possible)))return!1;e++}return!0}recognize(e){const n={...e};if(!this.options.enable){this.reset(),this.state=Te.Failed;return}this.state&(Te.Recognized|Te.Cancelled|Te.Failed)&&(this.state=Te.Possible),this.state=this.process(n),this.state&(Te.Began|Te.Changed|Te.Ended|Te.Cancelled)&&this.tryEmit(n)}getEventNames(){return[this.options.event]}reset(){}}class LS extends OS{attrTest(e){const n=this.options.pointers;return n===0||e.pointers.length===n}process(e){const{state:n}=this,{eventType:i}=e,r=n&(Te.Began|Te.Changed),s=this.attrTest(e);return r&&(i&ft.Cancel||!s)?n|Te.Cancelled:r||s?i&ft.End?n|Te.Ended:n&Te.Began?n|Te.Changed:Te.Began:Te.Failed}}class e0 extends OS{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Og]}process(e){const{options:n}=this,i=e.pointers.length===n.pointers,r=e.distance<n.threshold,s=e.deltaTime<n.time;if(this.reset(),e.eventType&ft.Start&&this.count===0)return this.failTimeout();if(r&&s&&i){if(e.eventType!==ft.End)return this.failTimeout();const l=this.pTime?e.timeStamp-this.pTime<n.interval:!0,u=!this.pCenter||PS(this.pCenter,e.center)<n.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!u||!l?this.count=1:this.count+=1,this._input=e,this.count%n.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Te.Recognized,this.tryEmit(this._input)},n.interval),Te.Began):Te.Recognized}return Te.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Te.Failed},this.options.interval),Te.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Te.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const vM=["","start","move","end","cancel","up","down","left","right"];class t0 extends LS{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:gt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,n=[];return e&gt.Horizontal&&n.push(Dg),e&gt.Vertical&&n.push(Lg),n}getEventNames(){return vM.map(e=>this.options.event+e)}directionTest(e){const{options:n}=this;let i=!0,{distance:r}=e,{direction:s}=e;const l=e.deltaX,u=e.deltaY;return s&n.direction||(n.direction&gt.Horizontal?(s=l===0?gt.None:l<0?gt.Left:gt.Right,i=l!==this.pX,r=Math.abs(e.deltaX)):(s=u===0?gt.None:u<0?gt.Up:gt.Down,i=u!==this.pY,r=Math.abs(e.deltaY))),e.direction=s,i&&r>n.threshold&&!!(s&n.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Te.Began)||!(this.state&Te.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const n=gt[e.direction].toLowerCase();n&&(e.additionalEvent=this.options.event+n),super.emit(e)}}const EM=["","start","move","end","cancel","in","out"];class wM extends LS{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Iu]}getEventNames(){return EM.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Te.Began))}emit(e){if(e.scale!==1){const n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}super.emit(e)}}class Ah{constructor(e,n,i){this.element=e,this.callback=n,this.options=i}}const TM=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",SM=TM.indexOf("firefox")!==-1,n0=4.000244140625,xM=40,AM=.25;class bM extends Ah{constructor(e,n,i){super(e,n,{enable:!0,...i}),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;globalThis.WheelEvent&&(SM&&r.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),r.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=xM)),s!==0&&s%n0===0&&(s=Math.floor(s/n0)),r.shiftKey&&s&&(s=s*AM),this.callback({type:"wheel",center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,n){e==="wheel"&&(this.options.enable=n)}}const i0=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class RM extends Ah{constructor(e,n,i){super(e,n,{enable:!0,...i}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,i0.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){i0.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){switch(e){case"pointermove":this.enableMoveEvent=n;break;case"pointerover":this.enableOverEvent=n;break;case"pointerout":this.enableOutEvent=n;break;case"pointerenter":this.enableEnterEvent=n;break;case"pointerleave":this.enableLeaveEvent=n;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const r0=["keydown","keyup"];class CM extends Ah{constructor(e,n,i){super(e,n,{enable:!0,tabIndex:0,...i}),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:"keydown",srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:"keyup",srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",r0.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){r0.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e==="keydown"&&(this.enableDownEvent=n),e==="keyup"&&(this.enableUpEvent=n)}}class kM extends Ah{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e==="contextmenu"&&(this.options.enable=n)}}const s0=1,Fg=2,o0=4,IM={pointerdown:s0,pointermove:Fg,pointerup:o0,mousedown:s0,mousemove:Fg,mouseup:o0},PM=0,NM=1,MM=2,OM=1,LM=2,DM=4;function FM(t){const e=IM[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i}=t.srcEvent;let r=!1,s=!1,l=!1;return e===Fg?(r=!!(n&OM),s=!!(n&DM),l=!!(n&LM)):(r=i===PM,s=i===NM,l=i===MM),{leftButton:r,middleButton:s,rightButton:l}}function BM(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,l={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s};return{center:n,offsetCenter:l}}const UM={srcElement:"root",priority:0};class zM{constructor(e,n){this.handleEvent=i=>{if(this.isEmpty())return;const r=this._normalizeEvent(i);let s=i.srcEvent.target;for(;s&&s!==r.rootElement;){if(this._emit(r,s),r.handled)return;s=s.parentNode}this._emit(r,"root")},this.eventManager=e,this.recognizerName=n,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,s=!1){const{handlers:l,handlersByElement:u}=this,f={...UM,...i};let d=u.get(f.srcElement);d||(d=[],u.set(f.srcElement,d));const p={type:e,handler:n,srcElement:f.srcElement,priority:f.priority};r&&(p.once=!0),s&&(p.passive=!0),l.push(p),this._active=this._active||!p.passive;let _=d.length-1;for(;_>=0&&!(d[_].priority>=p.priority);)_--;d.splice(_+1,0,p)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const l=i[s];if(l.type===e&&l.handler===n){i.splice(s,1);const u=r.get(l.srcElement);u.splice(u.indexOf(l),1),u.length===0&&r.delete(l.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const s=()=>{e.handled=!0},l=()=>{e.handled=!0,r=!0},u=[];for(let f=0;f<i.length;f++){const{type:d,handler:p,once:_}=i[f];if(p({...e,type:d,stopPropagation:s,stopImmediatePropagation:l}),_&&u.push(i[f]),r)break}for(let f=0;f<u.length;f++){const{type:d,handler:p}=u[f];this.remove(d,p)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...FM(e),...BM(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}function VM(t){if("recognizer"in t)return t;let e;const n=Array.isArray(t)?[...t]:[t];if(typeof n[0]=="function"){const i=n.shift(),r=n.shift()||{};e=new i(r)}else e=n.shift();return{recognizer:e,recognizeWith:typeof n[0]=="string"?[n[0]]:n[0],requireFailure:typeof n[1]=="string"?[n[1]]:n[1]}}class WM{constructor(e=null,n={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...n},this.events=new Map,this.element=e,!!e){this.manager=new _M(e,this.options);for(const i of this.options.recognizers){const{recognizer:r,recognizeWith:s,requireFailure:l}=VM(i);this.manager.add(r),s&&r.recognizeWith(s),l&&r.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new bM(e,this._onOtherEvent,{enable:!1}),this.moveInput=new RM(e,this._onOtherEvent,{enable:!1}),this.keyInput=new CM(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new kM(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){var s,l,u,f;const{manager:i}=this;if(!i)return;const r=i.get(e);r&&(r.set({enable:n}),i.touchAction.update()),(s=this.wheelInput)==null||s.enableEventType(e,n),(l=this.moveInput)==null||l.enableEventType(e,n),(u=this.keyInput)==null||u.enableEventType(e,n),(f=this.contextmenuInput)==null||f.enableEventType(e,n)}_addEventHandler(e,n,i,r,s){if(typeof e!="string"){i=n;for(const[d,p]of Object.entries(e))this._addEventHandler(d,p,i,r,s);return}const{manager:l,events:u}=this;if(!l)return;let f=u.get(e);if(!f){const d=this._getRecognizerName(e)||e;f=new zM(this,d),u.set(e,f),l&&l.on(e,f.handleEvent)}f.add(e,n,i,r,s),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const[s,l]of Object.entries(e))this._removeEventHandler(s,l);return}const{events:i}=this,r=i.get(e);if(r&&(r.remove(e,n),r.isEmpty())){const{recognizerName:s}=r;let l=!1;for(const u of i.values())if(u.recognizerName===s&&!u.isEmpty()){l=!0;break}l||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){var n;return(n=this.manager.recognizers.find(i=>i.getEventNames().includes(e)))==null?void 0:n.options.event}}const Me={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Me,"IDENTITY",{get:()=>(be.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Jn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},$r={common:0,meters:1,pixels:2},Bg={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},a0={multipan:[t0,{threshold:10,direction:gt.Vertical,pointers:2}],pinch:[wM,{},null,["multipan"]],pan:[t0,{threshold:1},["pinch"],["multipan"]],dblclick:[e0,{event:"dblclick",taps:2}],click:[e0,{event:"click"},null,["dblclick"]]},HM=Object.keys(Me).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Me[t]};`).join(""),jM=Object.keys(Jn).map(t=>`const int PROJECTION_MODE_${t} = ${Jn[t]};`).join(""),$M=Object.keys($r).map(t=>`const int UNIT_${t.toUpperCase()} = ${$r[t]};`).join(""),XM=`${HM}
${jM}
${$M}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`;function YM(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function ol(t){let e={},n;return i=>{for(const r in i)if(!YM(i[r],e[r])){n=t(i),e=i;break}return n}}const l0=[0,0,0,0],qM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],DS=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],KM=[0,0,0],FS=[0,0,0],GM=ol(JM);function BS(t,e,n=FS){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,s=!0;switch(e===Me.LNGLAT_OFFSETS||e===Me.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Jn.WEB_MERCATOR:(e===Me.LNGLAT||e===Me.CARTESIAN)&&(r=[0,0,0],s=!1);break;case Jn.WEB_MERCATOR_AUTO_OFFSET:e===Me.LNGLAT?i=r:e===Me.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case Jn.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case Jn.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}function ZM(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:l}=t,u=l0,f=l0,d=t.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:_,offsetMode:y}=BS(t,e,n);return y&&(f=t.projectPosition(p||_),d=[d[0]-f[0],d[1]-f[1],d[2]-f[2]],f[3]=1,u=sl([],f,l),s=i||s,l=Fr([],r,s),l=Fr([],l,qM)),{viewMatrix:s,viewProjectionMatrix:l,projectionCenter:u,originCommon:f,cameraPosCommon:d,shaderCoordinateOrigin:_,geospatialOrigin:p}}function QM({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=Me.DEFAULT,coordinateOrigin:r=FS,autoWrapLongitude:s=!1}){i===Me.DEFAULT&&(i=t.isGeospatial?Me.LNGLAT:Me.CARTESIAN);const l=GM({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return l.wrapLongitude=s,l.modelMatrix=n||DS,l}function JM({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:l,cameraPosCommon:u,shaderCoordinateOrigin:f,geospatialOrigin:d}=ZM(t,n,i),p=t.getDistanceScales(),_=[t.width*e,t.height*e],y=sl([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,E={coordinateSystem:n,projectionMode:t.projectionMode,coordinateOrigin:f,commonOrigin:l.slice(0,3),center:r,pseudoMeters:!!t._pseudoMeters,viewportSize:_,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:p.unitsPerMeter,commonUnitsPerWorldUnit:p.unitsPerMeter,commonUnitsPerWorldUnit2:KM,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:DS,cameraPosition:u};if(d){const T=t.getDistanceScales(d);switch(n){case Me.METER_OFFSETS:E.commonUnitsPerWorldUnit=T.unitsPerMeter,E.commonUnitsPerWorldUnit2=T.unitsPerMeter2;break;case Me.LNGLAT:case Me.LNGLAT_OFFSETS:t._pseudoMeters||(E.commonUnitsPerMeter=T.unitsPerMeter),E.commonUnitsPerWorldUnit=T.unitsPerDegree,E.commonUnitsPerWorldUnit2=T.unitsPerDegree2;break;case Me.CARTESIAN:E.commonUnitsPerWorldUnit=[1,1,T.unitsPerMeter[2]],E.commonUnitsPerWorldUnit2=[0,0,T.unitsPerMeter2[2]];break}}return E}const eO={};function tO(t=eO){return"viewport"in t?QM(t):{}}const b_={name:"project",dependencies:[P2,kS],vs:XM,getUniforms:tO,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},nO=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,al={name:"project32",dependencies:[b_],vs:nO};function iO(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function js(t,e){const n=sl([],e,t);return w2(n,n,1/n[3]),n}function u0(t,e){const n=t%e;return n<0?e+n:n}function Ug(t,e,n){return t<e?e:t>n?n:t}function rO(t){return Math.log(t)*Math.LOG2E}const R_=Math.log2||rO;function xi(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const On=Math.PI,US=On/4,Tn=On/180,zg=180/On,ro=512,kc=4003e4,Gl=85.051129,sO=1.5;function oO(t){return R_(t)}function Ic(t){const[e,n]=t;xi(Number.isFinite(e)),xi(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*Tn,r=n*Tn,s=ro*(i+On)/(2*On),l=ro*(On+Math.log(Math.tan(US+r*.5)))/(2*On);return[s,l]}function so(t){const[e,n]=t,i=e/ro*(2*On)-On,r=2*(Math.atan(Math.exp(n/ro*(2*On)-On))-US);return[i*zg,r*zg]}function aO(t){const{latitude:e}=t;xi(Number.isFinite(e));const n=Math.cos(e*Tn);return oO(kc*n)-9}function Gf(t){const e=Math.cos(t*Tn);return ro/kc/e}function Vg(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;xi(Number.isFinite(e)&&Number.isFinite(n));const r=ro,s=Math.cos(e*Tn),l=r/360,u=l/s,f=r/kc/s,d={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[l,u,f],degreesPerUnit:[1/l,1/u,1/f]};if(i){const p=Tn*Math.tan(e*Tn)/s,_=l*p/2,y=r/kc*p,E=y/u*f;d.unitsPerDegree2=[0,_,y],d.unitsPerMeter2=[E,0,E]}return d}function zS(t,e){const[n,i,r]=t,[s,l,u]=e,{unitsPerMeter:f,unitsPerMeter2:d}=Vg({longitude:n,latitude:i,highPrecision:!0}),p=Ic(t);p[0]+=s*(f[0]+d[0]*l),p[1]+=l*(f[1]+d[1]*l);const _=so(p),y=(r||0)+(u||0);return Number.isFinite(r)||Number.isFinite(u)?[_[0],_[1],y]:_}function lO(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:l}=t,u=iO();Rc(u,u,[0,0,-r]),SS(u,u,-n*Tn),xS(u,u,i*Tn);const f=s/e;return A_(u,u,[f,f,f]),l&&Rc(u,u,Z3([],l)),u}function uO(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:l,scale:u,nearZMultiplier:f=1,farZMultiplier:d=1}=t;let{fovy:p=Pc(sO)}=t;i!==void 0&&(p=Pc(i));const _=p*Tn,y=r*Tn,E=VS(p);let T=E;l&&(T+=l[2]*u/Math.cos(y)/n);const k=_*(.5+(s?s[1]:0)/n),M=Math.sin(k)*T/Math.sin(Ug(Math.PI/2-y-k,.01,Math.PI-.01)),b=Math.sin(y)*M+T,w=T*10,A=Math.min(b*d,w);return{fov:_,aspect:e/n,focalDistance:E,near:f,far:A}}function Pc(t){return 2*Math.atan(.5/t)*zg}function VS(t){return .5/Math.tan(.5*t*Tn)}function WS(t,e){const[n,i,r=0]=t;return xi(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),js(e,[n,i,r,1])}function C_(t,e,n=0){const[i,r,s]=t;if(xi(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return js(e,[i,r,s,1]);const l=js(e,[i,r,0,1]),u=js(e,[i,r,1,1]),f=l[2],d=u[2],p=f===d?0:((n||0)-f)/(d-f);return ES([],l,u,p)}function cO(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:l=[0,0]}=t,[[u,f],[d,p]]=i,_=hO(t.padding),y=Ic([u,Ug(p,-Gl,Gl)]),E=Ic([d,Ug(f,-Gl,Gl)]),T=[Math.max(Math.abs(E[0]-y[0]),r),Math.max(Math.abs(E[1]-y[1]),r)],k=[e-_.left-_.right-Math.abs(l[0])*2,n-_.top-_.bottom-Math.abs(l[1])*2];xi(k[0]>0&&k[1]>0);const M=k[0]/T[0],b=k[1]/T[1],w=(_.right-_.left)/2/M,A=(_.top-_.bottom)/2/b,N=[(E[0]+y[0])/2+w,(E[1]+y[1])/2+A],D=so(N),W=Math.min(s,R_(Math.abs(Math.min(M,b))));return xi(Number.isFinite(W)),{longitude:D[0],latitude:D[1],zoom:W}}function hO(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(xi(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const c0=Math.PI/180;function fO(t,e=0){const{width:n,height:i,unproject:r}=t,s={targetZ:e},l=r([0,i],s),u=r([n,i],s);let f,d;const p=t.fovy?.5*t.fovy*c0:Math.atan(.5/t.altitude),_=(90-t.pitch)*c0;return p>_-.01?(f=h0(t,0,e),d=h0(t,n,e)):(f=r([0,0],s),d=r([n,0],s)),[l,u,d,f]}function h0(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=js(i,[e,0,1,1]),s=js(i,[e,t.height,1,1]),u=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),f=ES([],r,s,u),d=so(f);return d.push(n),d}const f0=512;function dO(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:l,bearing:u=0}=t;(r<-180||r>180)&&(r=u0(r+180,360)-180),(u<-180||u>180)&&(u=u0(u+180,360)-180);const f=R_(n/f0);if(l<=f)l=f,s=0;else{const d=n/2/Math.pow(2,l),p=so([0,d])[1];if(s<p)s=p;else{const _=so([0,f0-d])[1];s>_&&(s=_)}}return{width:e,height:n,longitude:r,latitude:s,zoom:l,pitch:i,bearing:u}}const HS=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,gO=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,pO=`
${HS}
${gO}
`,_O=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,mO=`
${HS}
${_O}
`,yO=ol(SO),vO=ol(xO),EO=[0,0,0,1],wO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function TO(t,e){const[n,i,r]=t,s=C_([n,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}function SO({viewport:t,center:e}){return new si(t.viewProjectionMatrix).invert().transform(e)}function xO({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,s=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(l=>TO(l,i));for(const l of e){const u=l.clone().translate(new ri(t.center).negate()),f=s.map(p=>u.transform(p)),d=new si().ortho({left:Math.min(...f.map(p=>p[0])),right:Math.max(...f.map(p=>p[0])),bottom:Math.min(...f.map(p=>p[1])),top:Math.max(...f.map(p=>p[1])),near:Math.min(...f.map(p=>-p[2])),far:Math.max(...f.map(p=>-p[2]))});n.push(d.multiplyRight(l))}return n}function AO(t){const{shadowEnabled:e=!0,project:n}=t;if(!e||!n||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const i=b_.getUniforms(n),r=yO({viewport:n.viewport,center:i.center}),s=[],l=vO({shadowMatrices:t.shadowMatrices,viewport:n.viewport}).slice();for(let f=0;f<t.shadowMatrices.length;f++){const d=l[f],p=d.clone().translate(new ri(n.viewport.center).negate());i.coordinateSystem===Me.LNGLAT&&i.projectionMode===Jn.WEB_MERCATOR?(l[f]=p,s[f]=r):(l[f]=d.clone().multiplyRight(wO),s[f]=p.transform(r))}const u={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||EO,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let f=0;f<l.length;f++)u[`viewProjectionMatrix${f}`]=l[f],u[`projectCenter${f}`]=s[f];for(let f=0;f<2;f++)u[`shadow_uShadowMap${f}`]=t.shadowMaps&&t.shadowMaps[f]||t.dummyShadowMap;return u}const d0={name:"shadow",dependencies:[b_],vs:pO,fs:mO,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:AO,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},ll={...jv,defaultUniforms:{...jv.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},bO=[kS],RO=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function CO(){const t=mc.getDefaultShaderAssembler();for(const e of bO)t.addDefaultModule(e);for(const e of RO)t.addShaderHook(e);return t}const kO=[255,255,255],IO=1;let PO=0;class NO{constructor(e={}){this.type="ambient";const{color:n=kO}=e,{intensity:i=IO}=e;this.id=e.id||`ambient-${PO++}`,this.color=n,this.intensity=i}}const MO=[255,255,255],OO=1,LO=[0,0,-1];let DO=0;class g0{constructor(e={}){this.type="directional";const{color:n=MO}=e,{intensity:i=OO}=e,{direction:r=LO}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${DO++}`,this.color=n,this.intensity=i,this.type="directional",this.direction=new ri(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class FO{constructor(e,n={id:"pass"}){const{id:i}=n;this.id=i,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class k_ extends FO{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,i]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,s=e.clearColor??(r?[0,0,0,0]:!1),l=r?1:!1,u=r?0:!1,f=e.colorMask??15,d={viewport:[0,0,n,i]};e.colorMask&&(d.colorMask=f),e.scissorRect&&(d.scissorRect=e.scissorRect);const p=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:s,clearDepth:l,clearStencil:u});try{return this._drawLayers(p,e)}finally{p.end()}}_drawLayers(e,n){const{target:i,shaderModuleProps:r,viewports:s,views:l,onViewportActive:u,clearStack:f=!0}=n;n.pass=n.pass||"unknown",f&&(this._lastRenderIndex=-1);const d=[];for(const p of s){const _=l&&l[p.id];u==null||u(p);const y=this._getDrawLayerParams(p,n),E=p.subViewports||[p];for(const T of E){const k=this._drawLayersInViewport(e,{target:i,shaderModuleProps:r,viewport:T,view:_,pass:n.pass,layers:n.layers},y);d.push(k)}}return d}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:r=!1,layerFilter:s,cullRect:l,effects:u,shaderModuleProps:f},d=!1){var T;const p=[],_=jS(this._lastRenderIndex+1),y={layer:n[0],viewport:e,isPicking:r,renderPass:i,cullRect:l},E={};for(let k=0;k<n.length;k++){const M=n[k],b=this._shouldDrawLayer(M,y,s,E),w={shouldDrawLayer:b};b&&!d&&(w.shouldDrawLayer=!0,w.layerRenderIndex=_(M,b),w.shaderModuleProps=this._getShaderModuleProps(M,u,i,f),w.layerParameters={...(T=M.context.deck)==null?void 0:T.props.parameters,...this.getLayerParameters(M,k,e)}),p[k]=w}return p}_drawLayersInViewport(e,{layers:n,shaderModuleProps:i,pass:r,target:s,viewport:l,view:u},f){const d=BO(this.device,{shaderModuleProps:i,target:s,viewport:l});if(u&&u.props.clear){const _=u.props.clear===!0?{color:!0,depth:!0}:u.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:d,scissorRect:d},clearColor:_.color?[0,0,0,0]:!1,clearDepth:_.depth?1:!1}).end()}const p={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let _=0;_<n.length;_++){const y=n[_],E=f[_],{shouldDrawLayer:T}=E;if(T&&y.props.pickable&&p.pickableCount++,y.isComposite&&p.compositeCount++,y.isDrawable&&E.shouldDrawLayer){const{layerRenderIndex:k,shaderModuleProps:M,layerParameters:b}=E;p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,k),M.project&&(M.project.viewport=l),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:M,uniforms:{layerIndex:k},parameters:b})}catch(w){y.raiseError(w,`drawing ${y} to ${r}`)}}}return p}shouldDrawLayer(e){return!0}getShaderModuleProps(e,n,i){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(n))return!1;n.layer=l,l=l.parent}if(i){const u=n.layer.id;if(u in r||(r[u]=i(n)),!r[u])return!1}return e.activateViewport(n.viewport),!0}_getShaderModuleProps(e,n,i,r){var f,d;const s=this.device.canvasContext.cssToDeviceRatio(),l=((f=e.internalState)==null?void 0:f.propsInTransition)||e.props,u={layer:l,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(n)for(const p of n)p0(u,(d=p.getShaderModuleProps)==null?void 0:d.call(p,e,u));return p0(u,this.getShaderModuleProps(e,n,u),r)}}function jS(t=0,e={}){const n={},i=(r,s)=>{const l=r.props._offset,u=r.id,f=r.parent&&r.parent.id;let d;if(f&&!(f in e)&&i(r.parent,!1),f in n){const p=n[f]=n[f]||jS(e[f],e);d=p(r,s),n[u]=p}else Number.isFinite(l)?(d=l+(e[f]||0),n[u]=null):d=t;return s&&d>=t&&(t=d+1),e[u]=d,d};return i}function BO(t,{shaderModuleProps:e,target:n,viewport:i}){var f;const r=((f=e==null?void 0:e.project)==null?void 0:f.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),l=n?n.height:s,u=i;return[u.x*r,l-(u.y+u.height)*r,u.width*r,u.height*r]}function p0(t,...e){for(const n of e)if(n)for(const i in n)t[i]?Object.assign(t[i],n[i]):t[i]=n[i];return t}class UO extends k_{constructor(e,n){super(e,n);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),r=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:r})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const n=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],s=r.width*i,l=r.height*i,u=[1,1,1,1];(s!==n.width||l!==n.height)&&n.resize({width:s,height:l}),super.render({...e,clearColor:u,target:n,pass:"shadow"})}getLayerParameters(e,n,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,n,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const zO={color:[255,255,255],intensity:1},_0=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],VO=[0,0,0,200/255];class $S{constructor(e={}){this.id="lighting-effect",this.shadowColor=VO,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),i._addDefaultShaderModule(d0),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:i,onViewportActive:r,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:e,layerFilter:n,viewports:i,onViewportActive:r,views:s,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,n){const i=this.shadow?{project:n.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},r={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:i,lighting:r,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(d0))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new si().lookAt({eye:new ri(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new UO(e);this.shadowPasses[n]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new NO(zO),this.directionalLights.push(new g0(_0[0]),new g0(_0[1])))}}class WO{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:s=0,copy:l=!1,initialize:u=!1,maxCount:f}){const d=r||e&&e.constructor||Float32Array,p=n*i+s;if(ArrayBuffer.isView(e)){if(p<=e.length)return e;if(p*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,p)}let _=1/0;f&&(_=f*i+s);const y=this._allocate(d,p,u,_);return e&&l?y.set(e):u||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,n,i,r){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>r&&(s=r);const l=this._pool,u=e.BYTES_PER_ELEMENT*s,f=l.findIndex(d=>d.byteLength>=u);if(f>=0){const d=new e(l.splice(f,1)[0],0,s);return i&&d.fill(0),d}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,s=n.findIndex(l=>l.byteLength>=r);s<0?n.push(i):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,i),n.length>this.opts.poolSize&&n.shift()}}const oo=new WO;function Zo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function HO(t){return[t[12],t[13],t[14]]}function jO(t){return{left:ps(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:ps(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:ps(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:ps(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:ps(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:ps(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const m0=new ri;function ps(t,e,n,i){m0.set(t,e,n);const r=m0.len();return{distance:i/r,normal:new ri(-t/r,-e/r,-n/r)}}function $O(t){return t-Math.fround(t)}let zo;function Zf(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,s=(r-i)/n;zo=oo.allocate(zo,s,{type:Float32Array,size:n*2});let l=i,u=0;for(;l<r;){for(let f=0;f<n;f++){const d=t[l++];zo[u+f]=d,zo[u+f+n]=$O(d)}u+=n*2}return zo.subarray(0,s*n*2)}function XO(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const YO=Math.PI/180,qO=Zo(),y0=[0,0,0],KO={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function GO({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:l,far:u}){const f=t/e,d=n?new si().orthographic({fovy:i,aspect:f,focalDistance:r,near:l,far:u}):new si().perspective({fovy:i,aspect:f,near:l,far:u});if(s){const{left:p=0,right:_=0,top:y=0,bottom:E=0}=s,T=$i((p+t-_)/2,0,t)-t/2,k=$i((y+e-E)/2,0,e)-e/2;d[8]-=T*2/t,d[9]+=k*2/e}return d}class bh{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||KO,this.focalDistance=e.focalDistance||1,this.position=e.position||y0,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Jn.WEB_MERCATOR:Jn.WEB_MERCATOR_AUTO_OFFSET:Jn.IDENTITY}equals(e){return e instanceof bh?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&za(e.projectionMatrix,this.projectionMatrix)&&za(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=WS(i,this.pixelProjectionMatrix),[s,l]=r,u=n?l:this.height-l;return e.length===2?[s,u]:[s,u,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,l]=e,u=n?s:this.height-s,f=i&&i*this.distanceScales.unitsPerMeter[2],d=C_([r,u,l],this.pixelUnprojectionMatrix,f),[p,_,y]=this.unprojectPosition(d);return Number.isFinite(l)?[p,_,y]:Number.isFinite(i)?[p,_,i]:[p,_]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=Ic(e);return n[1]=$i(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?so(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),l=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],s[0],l[0]),Math.min(i[1],r[1],s[1],l[1]),Math.max(i[0],r[0],s[0],l[0]),Math.max(i[1],r[1],s[1],l[1])]}getDistanceScales(e){return e&&this.isGeospatial?Vg({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,jO(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=aO({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Vg({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:l}=e;let u=y0;if(s&&(u=l?new si(l).transformAsVector(s,[]):s),this.isGeospatial){const f=this.projectPosition([n,i,0]);this.center=new ri(u).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(u)}_initMatrices(e){const{viewMatrix:n=qO,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:l=75,near:u=.1,far:f=1e3,padding:d=null,focalDistance:p=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new si().multiplyRight(n).translate(new ri(this.center).negate()),this.projectionMatrix=i||GO({width:this.width,height:this.height,orthographic:r,fovyRadians:s||l*YO,focalDistance:p,padding:d,near:u,far:f});const _=Zo();Fr(_,_,this.projectionMatrix),Fr(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=Ng([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=HO(this.viewMatrixInverse);const y=Zo(),E=Zo();A_(y,y,[this.width/2,-this.height/2,1]),Rc(y,y,[1,-1,0]),Fr(E,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=Ng(Zo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||be.warn("Pixel project matrix not invertible")()}}bh.displayName="Viewport";const XS=bh;class Wa extends XS{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:l=0,nearZMultiplier:u=.1,farZMultiplier:f=1.01,nearZ:d,farZ:p,orthographic:_=!1,projectionMatrix:y,repeat:E=!1,worldOffset:T=0,position:k,padding:M,legacyMeterSizes:b=!1}=e;let{width:w,height:A,altitude:N=1.5}=e;const D=Math.pow(2,r);w=w||1,A=A||1;let W,K=null;if(y)N=y[5]/2,W=Pc(N);else{e.fovy?(W=e.fovy,N=VS(W)):W=Pc(N);let R;if(M){const{top:P=0,bottom:U=0}=M;R=[0,$i((P+A-U)/2,0,A)-A/2]}K=uO({width:w,height:A,scale:D,center:k&&[0,0,k[2]*Gf(n)],offset:R,pitch:s,fovy:W,nearZMultiplier:u,farZMultiplier:f}),Number.isFinite(d)&&(K.near=d),Number.isFinite(p)&&(K.far=p)}let x=lO({height:A,pitch:s,bearing:l,scale:D,altitude:N});T&&(x=new si().translate([512*T,0,0]).multiplyLeft(x)),super({...e,width:w,height:A,viewMatrix:x,longitude:i,latitude:n,zoom:r,...K,fovy:W,focalDistance:N}),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=l,this.altitude=N,this.fovy=W,this.orthographic=_,this._subViewports=E?[]:null,this._pseudoMeters=b,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const s=r?new Wa({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*Gf(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/Gf(i);return[n,i,r]}addMetersToLngLat(e,n){return zS(e,n)}panByPosition(e,n){const i=C_(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=Wv([],r,$3([],i)),l=Wv([],this.center,s),[u,f]=this.unprojectFlat(l);return{longitude:u,latitude:f}}getBounds(e={}){const n=fO(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:s,latitude:l,zoom:u}=cO({width:i,height:r,bounds:e,...n});return new Wa({width:i,height:r,longitude:s,latitude:l,zoom:u})}}Wa.displayName="WebMercatorViewport";const YS=Wa,v0=[0,0,0];function Qf(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof YS){const[r,s,l=0]=t,u=e.getDistanceScales([r,s]);i[2]=l*u.unitsPerMeter[2]}return i}function ZO(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:l}=t;return r===Me.DEFAULT&&(r=e.isGeospatial?Me.LNGLAT:Me.CARTESIAN),s===void 0&&(s=r),l===void 0&&(l=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:l}}function qS(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[l,u,f=0]=t;switch(n&&([l,u,f]=sl([],[l,u,f,1],n)),i){case Me.LNGLAT:return Qf([l,u,f],e,s);case Me.LNGLAT_OFFSETS:return Qf([l+r[0],u+r[1],f+(r[2]||0)],e,s);case Me.METER_OFFSETS:return Qf(zS(r,[l,u,f]),e,s);case Me.CARTESIAN:default:return e.isGeospatial?[l+r[0],u+r[1],f+r[2]]:e.projectPosition([l,u,f])}}function QO(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:l,fromCoordinateOrigin:u}=ZO(e),{autoOffset:f=!0}=e,{geospatialOrigin:d=v0,shaderCoordinateOrigin:p=v0,offsetMode:_=!1}=f?BS(n,i,r):{},y=qS(t,{viewport:n,modelMatrix:s,coordinateSystem:l,coordinateOrigin:u,offsetMode:_});if(_){const E=n.projectPosition(d||p);o2(y,y,E)}return y}let JO=1,eL=1;class KS{constructor(){C(this,"time",0);C(this,"channels",new Map);C(this,"animations",new Map);C(this,"playing",!1);C(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,l=JO++,u={time:0,delay:n,duration:i,rate:r,repeat:s};return this._setChannelTime(u,this.time),this.channels.set(l,u),l}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:l}=r;s.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=eL++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function tL(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function nL(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let iL=0;const rL={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:wg.stats.get(`animation-loop-${iL++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class sL{constructor(e){C(this,"device",null);C(this,"canvas",null);C(this,"props");C(this,"animationProps",null);C(this,"timeline",null);C(this,"stats");C(this,"cpuTime");C(this,"gpuTime");C(this,"frameRate");C(this,"display");C(this,"needsRedraw","initialized");C(this,"_initialized",!1);C(this,"_running",!1);C(this,"_animationFrameId",null);C(this,"_nextFramePromise",null);C(this,"_resolveNextFrame",null);C(this,"_cpuStartTime",0);C(this,"_error",null);if(this.props={...rL,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Th({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var i,r;if(this.props.onError(e),this._error=Error(),((r=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:r.canvas)instanceof HTMLCanvasElement){const s=document.createElement("h1");s.innerHTML=e.message,s.style.position="absolute",s.style.top="20%",s.style.left="10px",s.style.color="black",s.style.backgroundColor="red",document.body.appendChild(s)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=tL(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(nL(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var n;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(n=this.device)==null||n.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var n,i;const e=(i=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:i.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){var s,l,u,f;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((l=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:l.getPixelSize())||[1,1];let i=1;const r=(f=(u=this.device)==null?void 0:u.canvasContext)==null?void 0:f.canvas;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Jf={};function Rh(t="id"){Jf[t]=Jf[t]||1;const e=Jf[t]++;return`${t}-${e}`}class E0{constructor(e){C(this,"id");C(this,"userData",{});C(this,"topology");C(this,"bufferLayout",[]);C(this,"vertexCount");C(this,"indices");C(this,"attributes");if(this.id=e.id||Rh("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ke.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function oL(t,e){if(e instanceof E0)return e;const n=aL(t,e),{attributes:i,bufferLayout:r}=lL(t,e);return new E0({topology:e.topology||"triangle-list",bufferLayout:r,vertexCount:e.vertexCount,indices:n,attributes:i})}function aL(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:Ke.INDEX,data:n})}function lL(t,e){const n=[],i={};for(const[s,l]of Object.entries(e.attributes)){let u=s;switch(s){case"POSITION":u="positions";break;case"NORMAL":u="normals";break;case"TEXCOORD_0":u="texCoords";break;case"COLOR_0":u="colors";break}if(l){i[u]=t.createBuffer({data:l.value,id:`${s}-buffer`});const{value:f,size:d,normalized:p}=l;n.push({name:u,format:ZN(f,d,p)})}}const r=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:n,vertexCount:r}}const rh=class rh{constructor(e){C(this,"device");C(this,"destroyPolicy");C(this,"_hashCounter",0);C(this,"_hashes",{});C(this,"_renderPipelineCache",{});C(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new rh(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...eo.defaultProps,...e},i=this._hashRenderPipeline(n);if(!this._renderPipelineCache[i]){const r=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});r.hash=i,this._renderPipelineCache[i]={pipeline:r,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const n={...Tc.defaultProps,...e},i=this._hashComputePipeline(n);if(!this._computePipelineCache[i]){const r=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});r.hash=i,this._computePipelineCache[i]={pipeline:r,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const n=e.hash,i=e instanceof Tc?this._computePipelineCache:this._renderPipelineCache;i[n].useCount--,i[n].useCount===0&&this.destroyPolicy==="unused"&&(i[n].pipeline.destroy(),delete i[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,r="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${i}V${r}BL${s}`;default:const l=this._getHash(JSON.stringify(e.parameters));return`${n}/${i}V${r}T${e.topology}P${l}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};C(rh,"defaultProps",{...eo.defaultProps});let Wg=rh;const sh=class sh{constructor(e){C(this,"device");C(this,"destroyPolicy");C(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new sh(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let i=this._cache[n];if(!i){const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=i={shader:r,useCount:0}}return i.useCount++,i.shader}release(e){const n=this._hashShader(e),i=this._cache[n];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[n],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};C(sh,"defaultProps",{...vc.defaultProps});let Hg=sh;function uL(t,e){var r;const n={},i="Values";if(t.attributes.length===0&&!((r=t.varyings)!=null&&r.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const s of t.attributes)if(s){const l=`${s.location} ${s.name}: ${s.type}`;n[`in ${l}`]={[i]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const l=`${s.location} ${s.name}`;n[`out ${l}`]={[i]:JSON.stringify(s)}}return n}let mt=null,Er=null;function cL(t,{id:e,minimap:n,opaque:i,top:r="0",left:s="0",rgbaScale:l=1}){mt||(mt=document.createElement("canvas"),mt.id=e,mt.title=e,mt.style.zIndex="100",mt.style.position="absolute",mt.style.top=r,mt.style.left=s,mt.style.border="blue 5px solid",mt.style.transform="scaleY(-1)",document.body.appendChild(mt),Er=mt.getContext("2d")),(mt.width!==t.width||mt.height!==t.height)&&(mt.width=t.width/2,mt.height=t.height/2,mt.style.width="400px",mt.style.height="400px");const u=t.device.readPixelsToArrayWebGL(t),f=Er==null?void 0:Er.createImageData(t.width,t.height);if(f){for(let p=0;p<u.length;p+=4)f.data[0+p+0]=u[p+0]*l,f.data[0+p+1]=u[p+1]*l,f.data[0+p+2]=u[p+2]*l,f.data[0+p+3]=i?255:u[p+3]*l;Er==null||Er.putImageData(f,0,0)}}function jg(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!jg(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const s of i)if(!e.hasOwnProperty(s)||!jg(t[s],e[s],n-1))return!1;return!0}return!1}function hL(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function fL(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function GS(t){return hL(t)||fL(t)}function dL(t){return GS(t)||typeof t=="number"||typeof t=="boolean"}function ZS(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const i=t[n];dL(i)?e.uniforms[n]=i:e.bindings[n]=i}),e}class gL{constructor(e,n){C(this,"options",{disableWarnings:!1});C(this,"modules");C(this,"moduleUniforms");C(this,"moduleBindings");Object.assign(this.options,n);const i=S_(Object.values(e).filter(r=>r.dependencies));for(const r of i)e[r.name]=r;oe.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,s]of Object.entries(e))this._addModule(s),s.name&&r!==s.name&&!this.options.disableWarnings&&oe.warn(`Module name: ${r} vs ${s.name}`)()}destroy(){}setProps(e){var n;for(const i of Object.keys(e)){const r=i,s=e[r]||{},l=this.modules[r];if(!l){this.options.disableWarnings||oe.warn(`Module ${i} not found`)();continue}const u=this.moduleUniforms[r],f=this.moduleBindings[r],d=((n=l.getUniforms)==null?void 0:n.call(l,s,u))||s,{uniforms:p,bindings:_}=ZS(d);this.moduleUniforms[r]={...u,...p},this.moduleBindings[r]={...f,..._}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[i,r]of Object.entries(this.moduleUniforms))for(const[s,l]of Object.entries(r))e[`${i}.${s}`]={type:(n=this.modules[i].uniformTypes)==null?void 0:n[s],value:String(l)};return e}_addModule(e){const n=e.name;this.moduleUniforms[n]=e.defaultUniforms||{},this.moduleBindings[n]={}}}let pL="";async function _L(t,e){const n=new Image;return n.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",n.src=t.startsWith("http")?t:pL+t,await n.decode(),e?await createImageBitmap(n,e):await createImageBitmap(n)}class ed{constructor(e,n){C(this,"device");C(this,"id");C(this,"texture");C(this,"sampler");C(this,"view");C(this,"ready");C(this,"isReady",!1);C(this,"destroyed",!1);C(this,"resolveReady",()=>{});C(this,"rejectReady",()=>{});this.device=e,this.id=n.id||Rh("async-texture"),typeof(n==null?void 0:n.data)=="string"&&n.dimension==="2d"&&(n={...n,data:_L(n.data)}),this.ready=new Promise((i,r)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=r}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){let n,i;const r=e.data,s=await QS(r).then(n,i);if(this.destroyed)return;const l={...e,data:s};this.texture=this.device.createTexture(l),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const n=this.texture;this.texture=n.clone(e),n.destroy()}return!0}}async function QS(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(QS));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,n=await Promise.all(Object.values(e)),i=Object.keys(e),r={};for(let s=0;s<i.length;s++)r[i[s]]=n[s];return r}return t}const wr=2,mL=1e4,oh=class oh{constructor(e,n){C(this,"device");C(this,"id");C(this,"source");C(this,"vs");C(this,"fs");C(this,"pipelineFactory");C(this,"shaderFactory");C(this,"userData",{});C(this,"parameters");C(this,"topology");C(this,"bufferLayout");C(this,"isInstanced");C(this,"instanceCount",0);C(this,"vertexCount");C(this,"indexBuffer",null);C(this,"bufferAttributes",{});C(this,"constantAttributes",{});C(this,"bindings",{});C(this,"uniforms",{});C(this,"vertexArray");C(this,"transformFeedback",null);C(this,"pipeline");C(this,"shaderInputs");C(this,"_uniformStore");C(this,"_attributeInfos",{});C(this,"_gpuGeometry",null);C(this,"_getModuleUniforms");C(this,"props");C(this,"_pipelineNeedsUpdate","newly created");C(this,"_needsRedraw","initializing");C(this,"_destroyed",!1);C(this,"_lastDrawTimestamp",-1);C(this,"_lastLogTime",0);C(this,"_logOpen",!1);C(this,"_drawCount",0);var f,d,p,_;this.props={...oh.defaultProps,...n},n=this.props,this.id=n.id||Rh("model"),this.device=e,Object.assign(this.userData,n.userData);const i=Object.fromEntries(((f=this.props.modules)==null?void 0:f.map(y=>[y.name,y]))||[]),r=n.shaderInputs||new gL(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(r);const s=vL(e),l=(((d=this.props.modules)==null?void 0:d.length)>0?this.props.modules:(p=this.shaderInputs)==null?void 0:p.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(_=this.props).shaderLayout||(_.shaderLayout=L3(this.props.source));const{source:y,getUniforms:E}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:l});this.source=y,this._getModuleUniforms=E}else{const{vs:y,fs:E,getUniforms:T}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:l});this.vs=y,this.fs=E,this._getModuleUniforms=T}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||Wg.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Hg.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniformsWebGL(n.uniforms),n.moduleSettings&&this.updateModuleSettingsWebGL(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const n=this._areBindingsLoading();if(n)return oe.info(wr,`>>> DRAWING ABORTED ${this.id}: ${n} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings}),$g(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,l=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:l,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){var i;(i=this._gpuGeometry)==null||i.destroy();const n=e&&oL(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const r=new Vf(this.bufferLayout);this.bufferLayout=r.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const n=new Vf(this.bufferLayout);this.bufferLayout=this._gpuGeometry?n.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){jg(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new GN(this.shaderInputs.modules);for(const[n,i]of Object.entries(this.shaderInputs.modules))if(yL(i)){const r=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){const i=(n==null?void 0:n.disableWarnings)??this.props.disableWarnings;e.indices&&oe.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const r=new Vf(this.bufferLayout);for(const[s,l]of Object.entries(e)){const u=r.getBufferLayout(s);if(!u){i||oe.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const f=r.getAttributeNamesForBuffer(u);let d=!1;for(const p of f){const _=this._attributeInfos[p];_&&(this.vertexArray.setBuffer(_.location,l),d=!0)}!d&&!i&&oe.warn(`Model(${this.id}): Ignoring buffer "${l.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[i,r]of Object.entries(e)){const s=this._attributeInfos[i];s?this.vertexArray.setConstantWebGL(s.location,r):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||oe.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){$g(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:n,uniforms:i}=ZS(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof ed&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[n,i]of Object.entries(this.bindings))i instanceof ed?i.isReady&&(e[n]=i.texture):e[n]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof yc?e=Math.max(e,n.texture.updateTimestamp):n instanceof Ke||n instanceof ot?e=Math.max(e,n.updateTimestamp):n instanceof ed?e=n.texture?Math.max(e,n.texture.updateTimestamp):1/0:n instanceof Ec||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[i]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(r=>r.name===i)&&i!=="positions"&&delete n[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(oe.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=i:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:r}),this._attributeInfos=aS(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=oe.level>3?0:mL;oe.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,oe.group(wr,`>>> DRAWING MODEL ${this.id}`,{collapsed:oe.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=uL(this.pipeline.shaderLayout,this.id);oe.table(wr,e)();const n=this.shaderInputs.getDebugTable();for(const[r,s]of Object.entries(this.uniforms))n[r]={value:s};oe.table(wr,n)();const i=this._getAttributeDebugTable();oe.table(wr,this._attributeInfos)(),oe.table(wr,i)(),oe.groupEnd(wr)(),this._logOpen=!1}}_logFramebuffer(e){const n=this.device.props.debugFramebuffers;if(this._drawCount++,!n)return;const i=e.props.framebuffer;i&&cL(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,i]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[i.location];e[i.location]={name:n,type:i.shaderType,values:r?this._getBufferOrConstantValues(r,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,i=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,n){const i=cS(n);return(e instanceof Ke?new i(e.debugData):e).toString()}};C(oh,"defaultProps",{...eo.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:mc.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Un=oh;function yL(t){return!!(t.uniformTypes&&!$g(t.uniformTypes))}function vL(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function $g(t){for(const e in t)return!1;return!0}const wa=class wa{constructor(e,n=wa.defaultProps){C(this,"device");C(this,"model");C(this,"transformFeedback");if(!wa.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Un(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||JP(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(!n)throw new Error("BufferTransform#getBuffer");if(n instanceof Ke)return n.readAsync();const{buffer:i,byteOffset:r=0,byteLength:s=i.byteLength}=n;return i.readAsync(r,s)}};C(wa,"defaultProps",{...Un.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Ha=wa;class ao{constructor(e){C(this,"id");C(this,"topology");C(this,"vertexCount");C(this,"indices");C(this,"attributes");C(this,"userData",{});const{attributes:n={},indices:i=null,vertexCount:r=null}=e;this.id=e.id||Rh("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[s,l]of Object.entries(n)){const u=ArrayBuffer.isView(l)?{value:l}:l;if(!ArrayBuffer.isView(u.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!u.size&&(u.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=u}else this.attributes[s]=u}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r of Object.values(e)){const{value:s,size:l,constant:u}=r;!u&&s&&l!==void 0&&l>=1&&(i=Math.min(i,s.length/l))}return i}}const EL={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class JS extends k_{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,pickingFBO:l,deviceRect:{x:u,y:f,width:d,height:p},cullRect:_,effects:y,pass:E="picking",pickZ:T,shaderModuleProps:k}){this.pickZ=T;const M=this._resetColorEncoder(T),b=[u,f,d,p],w=super.render({target:l,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,cullRect:_,effects:y==null?void 0:y.filter(N=>N.useInPicking),pass:E,isPicking:!0,shaderModuleProps:k,clearColor:[0,0,0,0],colorMask:15,scissorRect:b});return this._colorEncoderState=null,{decodePickingColor:M&&TL.bind(null,M),stats:w}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,n,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,n,i){const r={...e.props.parameters},{pickable:s,operation:l}=e.props;return!this._colorEncoderState||l.includes("terrain")?r.blend=!1:s&&l.includes("draw")&&(Object.assign(r,EL),r.blend=!0,r.blendColor=wL(this._colorEncoderState,e,i)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function wL(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,l=i.get(e);return l?(l.viewports.push(n),s=l.a):(s=i.size+1,s<=255?(l={a:s,layer:e,viewports:[n]},i.set(e,l),r[s]=l):(be.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function TL(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const ys={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Nc=Symbol.for("component"),rr=Symbol.for("propTypes"),td=Symbol.for("deprecatedProps"),$s=Symbol.for("asyncPropDefaults"),Xr=Symbol.for("asyncPropOriginal"),Xi=Symbol.for("asyncPropResolved");function I_(t,e=()=>!0){return Array.isArray(t)?ex(t,e,[]):e(t)?[t]:[]}function ex(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?ex(r,e,n):e(r)&&n.push(r)}return n}function SL({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let l=0;for(let u=n;l<r;l++)t[u++]=e[l];for(;l<s;)l<s-l?(t.copyWithin(n+l,n,n+l),l*=2):(t.copyWithin(n+l,n,n+s-l),l=s);return t}class xL{constructor(e,n,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=gc(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class AL{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(n,i):(s=new xL(e,n,this._context),this._resources[e]=s),s.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const u=s[e];if(this._track(i,r,u,n),u)return u.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const s=this._consumers,l=s[e]=s[e]||{};let u=l[n];const f=u&&u.resourceId&&this._resources[u.resourceId];f&&(f.unsubscribe(u),this.prune()),i&&(u?(u.onChange=r,u.resourceId=i.id):u={onChange:r,resourceId:i.id},l[n]=u,i.subscribe(u))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const bL="layerManager.setLayers",RL="layerManager.activateViewport";class CL{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{Ot(RL,this,u),u&&(this.context.viewport=u)};const{deck:i,stats:r,viewport:s,timeline:l}=n||{};this.layers=[],this.resourceManager=new AL({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:i,shaderAssembler:CO(),defaultShaderModules:[X2],renderPass:void 0,stats:r||new Th({id:"deck.gl"}),viewport:s||new XS({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new KS,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Ot(bL,this,n,e),this._lastRenderedLayers=e;const i=I_(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(i=>i.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,i=n.findIndex(r=>r.name===e.name);i>=0&&(n.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,i){i.raiseError(n,`${e} of ${i}`)}_updateLayers(e,n){const i={};for(const l of e)i[l.id]?be.warn(`Multiple old layers with same id ${l.id}`)():i[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of e)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let s=!1;for(const l of r)if(l.hasUniformTransition()){s=`Uniform transition in ${l}`;break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const s=n[r.id];s===null&&be.warn(`Multiple new layers with same id ${r.id}`)(),n[r.id]=null;let l=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),l=r.isComposite?r.getSubLayers():null}catch(u){this._handleError("matching",u,r)}l&&this._updateSublayersRecursively(l,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ys.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=ys.MATCHED,n!==e&&(e.lifecycle=ys.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=ys.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ys.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Ln(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Ln(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const s of i)if(!e.hasOwnProperty(s)||!Ln(t[s],e[s],n-1))return!1;return!0}return!1}class kL{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const l=i[s];if(l.containsPixel(r)){const u=e.slice();return u[0]-=l.x,u[1]-=l.y,l.unproject(u,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=I_(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ln(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):be.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var l;return(l=this.getView(e.id))==null?void 0:l.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,i,r){const s=e.controller;if(s&&i){const l={...n,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!r||r.constructor!==s.type)&&(r=this._createController(e,l)),r&&r.setProps(l),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const s=e[r],l=this.getViewState(s),u=s.makeViewport({viewState:l,width:this.width,height:this.height});let f=n[s.id];const d=!!s.controller;d&&!f&&(i=!0),(i||!d)&&f&&(f.finalize(),f=null),this.controllers[s.id]=this._updateController(s,l,u,f),u&&this._viewports.unshift(u)}for(const r in n){const s=n[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const IL=/([0-9]+\.?[0-9]*)(%|px)/;function Ii(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=IL.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function Pi(t,e){return t.relative?Math.round(t.position*e):t.position}class lo{constructor(e){const{id:n,x:i=0,y:r=0,width:s="100%",height:l="100%",padding:u=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Ii(i),this._y=Ii(r),this._width=Ii(s),this._height=Ii(l),this._padding=u&&{left:Ii(u.left||0),right:Ii(u.right||0),top:Ii(u.top||0),bottom:Ii(u.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ln(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});if(!r.height||!r.width)return null;const s=this.getViewportType(i);return new s({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:Pi(this._x,e),y:Pi(this._y,n),width:Pi(this._width,e),height:Pi(this._height,n)};return this._padding&&(i.padding={left:Pi(this._padding.left,e),top:Pi(this._padding.top,n),right:Pi(this._padding.right,e),bottom:Pi(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Ch{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(i=(n=this.settings).onStart)==null||i.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const w0=()=>{},Xg={BREAK:1,SNAP_TO_END:2,IGNORE:3},PL=t=>t,NL=Xg.BREAK;class ML{constructor(e){this._onTransitionUpdate=n=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:l,duration:u,easing:f}}=n,d=f(i/u),p=r.interpolateProps(s,l,d);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Ch(e.timeline),this.onViewStateChange=e.onViewStateChange||w0,this.onStateChange=e.onStateChange||w0}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:l}=this.transition.settings;r={...i,...s===Xg.SNAP_TO_END?l:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Xg.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),s=n.transitionInterpolator,l=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(l===0)return;const u=s.initializeProps(e,r);this.propsInTransition={};const f={duration:l,easing:n.transitionEasing||PL,interpolator:s,interruption:n.transitionInterruption||NL,startProps:u.start,endProps:u.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function bt(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class OL{constructor(e){const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!za(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const s of this._propsToExtract)(s in e||s in n)&&(i[s]=e[s],r[s]=n[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];bt(Number.isFinite(i)||Array.isArray(i),`${n} is required for transition`)})}}const LL=["longitude","latitude","zoom","bearing","pitch"],DL=["longitude","latitude","zoom"];class tx extends OL{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:LL,required:DL},super(i.transitionProps),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:s}=this.opts;if(r&&s){const l=r(e),u=r(n),f=l.unproject(s);i.start.around=s,Object.assign(i.end,{around:u.project(f),aroundPosition:f,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const s of this._propsToExtract)r[s]=bc(e[s]||0,n[s]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...r});Object.assign(r,s.panByPosition(n.aroundPosition,bc(e.around,n.around,i)))}return r}}const Ni={transitionDuration:0},FL=300,Zl=t=>1-(1-t)*(1-t),_s={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Tr={};class BL{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new ML({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return n?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?FL:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:l=!0,touchZoom:u=!0,touchRotate:f=!1,keyboard:d=!0}=e,p=!!this.onViewStateChange;this.toggleEvents(_s.WHEEL,p&&i),this.toggleEvents(_s.PAN,p),this.toggleEvents(_s.PINCH,p&&(u||f)),this.toggleEvents(_s.MULTI_PAN,p&&f),this.toggleEvents(_s.DOUBLE_CLICK,p&&l),this.toggleEvents(_s.KEYBOARD,p&&d),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=l,this.touchZoom=u,this.touchRotate=f,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,Ni,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Ni,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Zl},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Ni,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Zl},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let l=2/(1+Math.exp(-Math.abs(s*i)));s<0&&l!==0&&(l=1/l);const u=this.controllerState.zoom({pos:n,scale:l});return this.updateViewport(u,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Ni,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Ni,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Zl},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Tr._startPinchRotation=e.rotation,Tr._lastPinchEvent=e,this.updateViewport(i,Ni,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:Tr._startPinchRotation-i})}return this.updateViewport(n,Ni,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Tr._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=Tr;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const l=Math.log2(e.scale),u=(l-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),f=Math.pow(2,l+u*n/2);s=s.zoom({pos:r,scale:f}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:Zl},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Tr._startPinchRotation=null,Tr._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:u}=this;let f;const d={};switch(e.srcEvent.code){case"Minus":f=n?u.zoomOut(i).zoomOut(i):u.zoomOut(i),d.isZooming=!0;break;case"Equal":f=n?u.zoomIn(i).zoomIn(i):u.zoomIn(i),d.isZooming=!0;break;case"ArrowLeft":n?(f=u.rotateLeft(s),d.isRotating=!0):(f=u.moveLeft(r),d.isPanning=!0);break;case"ArrowRight":n?(f=u.rotateRight(s),d.isRotating=!0):(f=u.moveRight(r),d.isPanning=!0);break;case"ArrowUp":n?(f=u.rotateUp(l),d.isRotating=!0):(f=u.moveUp(r),d.isPanning=!0);break;case"ArrowDown":n?(f=u.rotateDown(l),d.isRotating=!0):(f=u.moveDown(r),d.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Ni:e?{...n,transitionInterpolator:new tx({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class UL{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const T0=5,zL=1.2;class VL extends UL{constructor(e){const{width:n,height:i,latitude:r,longitude:s,zoom:l,bearing:u=0,pitch:f=0,altitude:d=1.5,position:p=[0,0,0],maxZoom:_=20,minZoom:y=0,maxPitch:E=60,minPitch:T=0,startPanLngLat:k,startZoomLngLat:M,startRotatePos:b,startBearing:w,startPitch:A,startZoom:N,normalize:D=!0}=e;bt(Number.isFinite(s)),bt(Number.isFinite(r)),bt(Number.isFinite(l)),super({width:n,height:i,latitude:r,longitude:s,zoom:l,bearing:u,pitch:f,altitude:d,maxZoom:_,minZoom:y,maxPitch:E,minPitch:T,normalize:D,position:p},{startPanLngLat:k,startZoomLngLat:M,startRotatePos:b,startBearing:w,startPitch:A,startZoom:N}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:l}=this.getState();if(!r||s===void 0||l===void 0)return this;let u;return e?u=this._getNewRotation(e,r,l,s):u={bearing:s+n,pitch:l+i},this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:l,minZoom:u}=this.getViewportProps();let f=r+Math.log2(i);f=$i(f,u,l);const d=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...d.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=$i(r,i,n);const{maxPitch:s,minPitch:l,pitch:u}=e;e.pitch=$i(u,l,s);const{normalize:f=!0}=e;return f&&Object.assign(e,dO(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const s=e[0]-n[0],l=e[1]-n[1],u=e[1],f=n[1],{width:d,height:p}=this.getViewportProps(),_=s/d;let y=0;l>0?Math.abs(p-f)>T0&&(y=l/(f-p)*zL):l<0&&f>T0&&(y=1-u/f),y=$i(y,-1,1);const{minPitch:E,maxPitch:T}=this.getViewportProps(),k=r+180*_;let M=i;return y>0?M=i+y*(T-i):y<0&&(M=i-y*(E-i)),{pitch:M,bearing:k}}}class WL extends BL{constructor(){super(...arguments),this.ControllerState=VL,this.transition={transitionDuration:300,transitionInterpolator:new tx({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class nx extends lo{constructor(e={}){super(e)}getViewportType(){return YS}get ControllerType(){return WL}}nx.displayName="MapView";const HL=nx,jL=new $S;function $L(t,e){const n=t.order??1/0,i=e.order??1/0;return n-i}class XL{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(r=>$L(r,e)>0);i<0?n.push(e):n.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ln(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const r of this.effects)n[r.id]=r;const i=[];for(const r of e){const s=n[r.id];let l=r;s&&s!==r?s.setProps?(s.setProps(r.props),l=s):s.cleanup(this._context):s||r.setup(this._context),i.push(l),delete n[r.id]}for(const r in n)n[r].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(r=>r instanceof $S)||this._resolvedEffects.push(jL),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class YL extends k_{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const qL="deckRenderer.renderLayers";class KL{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new YL(e),this.pickLayersPass=new JS(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const r=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const s=n.render({...i,target:r});i.effects&&this._postRender(i.effects,i),this.renderCount++,Ot(qL,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[r]}))});for(const i of e)i.resize(n)}_postRender(e,n){const{renderBuffers:i}=this,r={...n,inputBuffer:i[0],swapBuffer:i[1]};for(const s of e)if(s.postRender){r.target=s.id===this.lastPostProcessEffect?n.target:void 0;const l=s.postRender(r);r.inputBuffer=l,r.swapBuffer=l===i[0]?i[1]:i[0]}}}const GL={pickedColor:null,pickedObjectIndex:-1};function ZL({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:l,y:u,width:f,height:d}=s;let p=r*r,_=-1,y=0;for(let E=0;E<d;E++){const T=E+u-i,k=T*T;if(k>p)y+=4*f;else for(let M=0;M<f;M++){if(t[y+3]-1>=0){const w=M+l-n,A=w*w+k;A<=p&&(p=A,_=y)}y+=4}}if(_>=0){const E=t.slice(_,_+4),T=e(E);if(T){const k=Math.floor(_/4/f),M=_/4-k*f;return{...T,pickedColor:E,pickedX:l+M,pickedY:u+k}}be.error("Picked non-existent layer. Is picking buffer corrupt?")()}return GL}function QL({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const s=t.slice(i,i+4),l=s.join(",");if(!n.has(l)){const u=e(s);u?n.set(l,{...u,color:s}):be.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function ix({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:s}){let l=e[0];e.length>1&&(l=eD((t==null?void 0:t.pickedViewports)||e,{x:i,y:r}));let u;if(l){const f=[i-l.x,r-l.y];s!==void 0&&(f[2]=s),u=l.unproject(f)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:u,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function JL(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:l,pickedObjectIndex:u}=e,f=l?[l]:[];if(i==="hover"){const _=n.index,y=n.layerId,E=l?l.props.id:null;if(E!==y||u!==_){if(E!==y){const T=r.find(k=>k.props.id===y);T&&f.unshift(T)}n.layerId=E,n.index=u,n.info=null}}const d=ix(t),p=new Map;return p.set(null,d),f.forEach(_=>{let y={...d};_===l&&(y.color=s,y.index=u,y.picked=!0),y=rx({layer:_,info:y,mode:i});const E=y.layer;_===l&&i==="hover"&&(n.info=y),p.set(E.id,y),i==="hover"&&E.updateAutoHighlight(y)}),p}function rx({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function eD(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class tD{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new JS(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},s=this.lastPickedInfo.info){const l=s&&s.layer&&s.layer.id,u=s&&s.viewport&&s.viewport.id,f=l?i.find(y=>y.id===l):null,d=u&&r.find(y=>y.id===u)||r[0],p=d&&d.unproject([e-d.x,n-d.y]);return{...s,...{x:e,y:n,viewport:d,coordinate:p,layer:f}}}_resizeBuffer(){var n,i;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:e}=this.device.getDefaultCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(i=this.depthFBO)==null||i.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:s,radius:l=0,depth:u=1,mode:f="query",unproject3D:d,onViewportActive:p,effects:_}){const y=this.device.canvasContext.cssToDeviceRatio(),E=this._getPickable(e);if(!E||i.length===0)return{result:[],emptyInfo:ix({viewports:i,x:r,y:s,pixelRatio:y})};this._resizeBuffer();const T=this.device.canvasContext.cssToDevicePixels([r,s],!0),k=[T.x+Math.floor(T.width/2),T.y+Math.floor(T.height/2)],M=Math.round(l*y),{width:b,height:w}=this.pickingFBO,A=this._getPickingRect({deviceX:k[0],deviceY:k[1],deviceRadius:M,deviceWidth:b,deviceHeight:w}),N={x:r-l,y:s-l,width:l*2+1,height:l*2+1};let D;const W=[],K=new Set;for(let x=0;x<u;x++){let R;if(A){const U=this._drawAndSample({layers:E,views:n,viewports:i,onViewportActive:p,deviceRect:A,cullRect:N,effects:_,pass:`picking:${f}`});R=ZL({...U,deviceX:k[0],deviceY:k[1],deviceRadius:M,deviceRect:A})}else R={pickedColor:null,pickedObjectIndex:-1};let P;if(R.pickedLayer&&d&&this.depthFBO){const{pickedColors:U}=this._drawAndSample({layers:[R.pickedLayer],views:n,viewports:i,onViewportActive:p,deviceRect:{x:R.pickedX,y:R.pickedY,width:1,height:1},cullRect:N,effects:_,pass:`picking:${f}:z`},!0);U[3]&&(P=U[0])}R.pickedLayer&&x+1<u&&(K.add(R.pickedLayer),R.pickedLayer.disablePickingIndex(R.pickedObjectIndex)),D=JL({pickInfo:R,lastPickedInfo:this.lastPickedInfo,mode:f,layers:E,viewports:i,x:r,y:s,z:P,pixelRatio:y});for(const U of D.values())U.layer&&W.push(U);if(!R.pickedColor)break}for(const x of K)x.restorePickingColors();return{result:W,emptyInfo:D.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:s,width:l=1,height:u=1,mode:f="query",maxObjects:d=null,onViewportActive:p,effects:_}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const E=this.device.canvasContext.cssToDeviceRatio(),T=this.device.canvasContext.cssToDevicePixels([r,s],!0),k=T.x,M=T.y+T.height,b=this.device.canvasContext.cssToDevicePixels([r+l,s+u],!0),w=b.x+b.width,A=b.y,N={x:k,y:A,width:w-k,height:M-A},D=this._drawAndSample({layers:y,views:n,viewports:i,onViewportActive:p,deviceRect:N,cullRect:{x:r,y:s,width:l,height:u},effects:_,pass:`picking:${f}`}),W=QL(D),K=new Map,x=[],R=Number.isFinite(d);for(let P=0;P<W.length&&!(R&&x.length>=d);P++){const U=W[P];let F={color:U.pickedColor,layer:null,index:U.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:E};F=rx({layer:U.pickedLayer,info:F,mode:f});const z=F.layer.id;K.has(z)||K.set(z,new Set);const B=K.get(z),V=F.object??F.index;B.has(V)||(B.add(V),x.push(F))}return x}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:s,cullRect:l,effects:u,pass:f},d=!1){const p=d?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:p,deviceRect:s,cullRect:l,effects:u,pass:f,pickZ:d,preRenderStats:{}};for(const w of u)w.useInPicking&&(_.preRenderStats[w.id]=w.preRender(_));const{decodePickingColor:y}=this.pickLayersPass.render(_),{x:E,y:T,width:k,height:M}=s,b=new(d?Float32Array:Uint8Array)(k*M*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:E,sourceY:T,sourceWidth:k,sourceHeight:M,target:b}),{pickedColors:b,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const l=Math.max(0,e-i),u=Math.max(0,n-i),f=Math.min(r,e+i+1)-l,d=Math.min(s,n+i+1)-u;return f<=0||d<=0?null:{x:l,y:u,width:f,height:d}}}const nD={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},iD="top-left",S0="__root";class rD{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Ln(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const i of this.resolvedWidgets)n[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)n[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const r=n[i.id];r?r.viewId!==i.viewId||r.placement!==i.placement?(this._remove(r),this._add(i)):i!==r&&(r.setProps(i.props),i=r):this._add(i),n[i.id]=null,this.resolvedWidgets.push(i)}for(const i in n){const r=n[i];r&&this._remove(r)}this.widgets=e}_add(e){const{viewId:n=null,placement:i=iD}=e,r=e.onAdd({deck:this.deck,viewId:n});r&&this._getContainer(n,i).append(r),e._element=r}_remove(e){var n;(n=e.onRemove)==null||n.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var l;const i=e||S0;let r=this.containers[i];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",(l=this.parentElement)==null||l.append(r),this.containers[i]=r);let s=r.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,nD[n]),r.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const i in this.containers){const r=this.lastViewports[i]||null,s=i===S0||r,l=this.containers[i];s?(l.style.display="block",l.style.left=`${r?r.x:0}px`,l.style.top=`${r?r.y:0}px`,l.style.width=`${r?r.width:e}px`,l.style.height=`${r?r.height:n}px`):l.style.display="none"}}onRedraw({viewports:e,layers:n}){var r,s;const i=e.reduce((l,u)=>(l[u.id]=u,l),{});for(const l of this.getWidgets()){const{viewId:u}=l;if(u){const f=i[u];f&&(l.onViewportChange&&l.onViewportChange(f),(r=l.onRedraw)==null||r.call(l,{viewports:[f],layers:n}))}else{if(l.onViewportChange)for(const f of e)l.onViewportChange(f);(s=l.onRedraw)==null||s.call(l,{viewports:e,layers:n})}}this.lastViewports=i,this._updateContainers()}onHover(e,n){var i,r;for(const s of this.getWidgets()){const{viewId:l}=s;(!l||l===((i=e.viewport)==null?void 0:i.id))&&((r=s.onHover)==null||r.call(s,e,n))}}onEvent(e,n){var r,s;const i=Bg[n.type];if(i)for(const l of this.getWidgets()){const{viewId:u}=l;(!u||u===((r=e.viewport)==null?void 0:r.id))&&((s=l[i])==null||s.call(l,e,n))}}}const sD={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class oD{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,sD),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,i=n&&n.props.getTooltip;if(!i)return;const r=i(e);this.lastViewport=e.viewport,this.setTooltip(r,e.x,e.y)}setTooltip(e,n,i){const r=this.element;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${n}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(r.style,e.style)}}}var Ns;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Ns||(Ns={}));const P_={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ct=(t,e,n)=>e?t.enable(n):t.disable(n),x0=(t,e,n)=>t.hint(n,e),Jt=(t,e,n)=>t.pixelStorei(n,e),A0=(t,e,n)=>{const i=n===36006?36009:36008;return t.bindFramebuffer(i,e)},Vo=(t,e,n)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(r,e)};function nd(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const aD={3042:ct,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:ct,2885:(t,e)=>t.cullFace(e),2929:ct,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:ct,35723:x0,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:A0,36010:A0,34964:Vo,36662:Vo,36663:Vo,35053:Vo,35055:Vo,2886:(t,e)=>t.frontFace(e),33170:x0,2849:(t,e)=>t.lineWidth(e),32823:ct,32824:"polygonOffset",10752:"polygonOffset",35977:ct,32926:ct,32928:ct,32938:"sampleCoverage",32939:"sampleCoverage",3089:ct,3088:(t,e)=>t.scissor(...e),2960:ct,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:ct,10754:ct,12288:ct,12289:ct,12290:ct,12291:ct,12292:ct,12293:ct,12294:ct,12295:ct,3333:Jt,3317:Jt,37440:Jt,37441:Jt,37443:Jt,3330:Jt,3332:Jt,3331:Jt,3314:Jt,32878:Jt,3316:Jt,3315:Jt,32877:Jt,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=nd(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=nd(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,l,u]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,l,u)},stencilOp:(t,e)=>{e=nd(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,l,u]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,l,u)},viewport:(t,e)=>t.viewport(...e)};function st(t,e,n){return e[t]!==void 0?e[t]:n[t]}const lD={blendEquation:(t,e,n)=>t.blendEquationSeparate(st(32777,e,n),st(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(st(32969,e,n),st(32968,e,n),st(32971,e,n),st(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(st(32824,e,n),st(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(st(32938,e,n),st(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,st(2962,e,n),st(2967,e,n),st(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,st(34816,e,n),st(36003,e,n),st(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,st(2964,e,n),st(2965,e,n),st(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,st(34817,e,n),st(34818,e,n),st(34819,e,n))},b0={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?t({[i]:n}):{valueChanged:!0}},blendColor:(t,e,n,i,r)=>t({32773:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,r)=>t({32969:e,32968:n,32971:i,32970:r}),clearColor:(t,e,n,i,r)=>t({3106:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,r)=>t({3107:[e,n,i,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,r)=>t({3088:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({2978:[e,n,i,r]})},qn=(t,e)=>t.isEnabled(e),R0={3042:qn,2884:qn,2929:qn,3024:qn,32823:qn,32926:qn,32928:qn,3089:qn,2960:qn,35977:qn},uD=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function yo(t,e){if(hD(e))return;const n={};for(const r in e){const s=Number(r),l=aD[r];l&&(typeof l=="string"?n[l]=!0:l(t,e[r],s))}const i=t.state&&t.state.cache;if(i)for(const r in n){const s=lD[r];s(t,e,i)}}function sx(t,e=P_){if(typeof e=="number"){const r=e,s=R0[r];return s?s(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const s=R0[r];i[r]=s?s(t,Number(r)):t.getParameter(Number(r))}return i}function cD(t){yo(t,P_)}function hD(t){for(const e in t)return!1;return!0}function fD(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}class Br{constructor(e,n){C(this,"gl");C(this,"program",null);C(this,"stateStack",[]);C(this,"enable",!0);C(this,"cache",null);C(this,"log");C(this,"initialized",!1);this.gl=e,this.log=(n==null?void 0:n.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];yo(this.gl,e),this.stateStack.pop()}trackState(e,n){if(this.cache=n.copyState?sx(e):Object.assign({},P_),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,gD(e);for(const i in b0){const r=b0[i];dD(e,i,r)}C0(e,"getParameter"),C0(e,"isEnabled")}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const l=e[s],u=this.cache[s];fD(l,u)||(n=!0,i=u,r&&!(s in r)&&(r[s]=u),this.cache[s]=l)}return{valueChanged:n,oldValue:i}}}function C0(t,e){const n=t[e].bind(t);t[e]=function(r){if(r===void 0||uD.has(r))return n(r);const s=Br.get(t);return r in s.cache||(s.cache[r]=n(r)),s.enable?s.cache[r]:n(r)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function dD(t,e,n){if(!t[e])return;const i=t[e].bind(t);t[e]=function(...s){const l=Br.get(t),{valueChanged:u,oldValue:f}=n(l._updateCache,...s);return u&&i(...s),f},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function gD(t){const e=t.useProgram.bind(t);t.useProgram=function(i){const r=Br.get(t);r.program!==i&&(e(i),r.program=i)}}function pD(t,e,n){let i="";const r={preserveDrawingBuffer:!0,...n};let s=null;if(s||(s=t.getContext("webgl2",r)),r.failIfMajorPerformanceCaveat&&(i||(i="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!n.failIfMajorPerformanceCaveat&&(r.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",r),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,i||(i="Your browser only supports WebGL1"))),!s)throw i||(i="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:l,onContextRestored:u}=e;return t.addEventListener("webglcontextlost",f=>l(f),!1),t.addEventListener("webglcontextrestored",f=>u(f),!1),s.luma||(s.luma={}),s}function uo(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function _D(t,e){const n=t.getParameter(7936),i=t.getParameter(7937);uo(t,"WEBGL_debug_renderer_info",e);const r=e.WEBGL_debug_renderer_info,s=t.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936),l=t.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937),u=s||n,f=l||i,d=t.getParameter(7938),p=ox(u,f),_=mD(u,f),y=yD(u,f);return{type:"webgl",gpu:p,gpuType:y,gpuBackend:_,vendor:u,renderer:f,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function ox(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function mD(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function yD(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(ox(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function ax(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Qo="WEBGL_compressed_texture_s3tc",Jo="WEBGL_compressed_texture_s3tc_srgb",Ms="EXT_texture_compression_rgtc",Os="EXT_texture_compression_bptc",vD="WEBGL_compressed_texture_etc",ED="WEBGL_compressed_texture_astc",wD="WEBGL_compressed_texture_etc1",TD="WEBGL_compressed_texture_pvrtc",SD="WEBGL_compressed_texture_atc",k0="EXT_texture_norm16",I0="EXT_render_snorm",xD="EXT_color_buffer_float",N_={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[I0],"norm16-renderable-webgl":[k0],"snorm16-renderable-webgl":[k0,I0],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Qo,Jo,Ms,Os],"texture-compression-bc5-webgl":[Ms],"texture-compression-bc7-webgl":[Os],"texture-compression-etc2":[vD],"texture-compression-astc":[ED],"texture-compression-etc1-webgl":[wD],"texture-compression-pvrtc-webgl":[TD],"texture-compression-atc-webgl":[SD]};function AD(t){return t in N_}function bD(t,e,n){return(N_[e]||[]).every(r=>uo(t,r,n))}const M_={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:xD,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Qo},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Jo},"bc1-rgba-unorm":{gl:33777,x:Qo},"bc1-rgba-unorm-srgb":{gl:35916,x:Jo},"bc2-rgba-unorm":{gl:33778,x:Qo},"bc2-rgba-unorm-srgb":{gl:35918,x:Jo},"bc3-rgba-unorm":{gl:33779,x:Qo},"bc3-rgba-unorm-srgb":{gl:35919,x:Jo},"bc4-r-unorm":{gl:36283,x:Ms},"bc4-r-snorm":{gl:36284,x:Ms},"bc5-rg-unorm":{gl:36285,x:Ms},"bc5-rg-snorm":{gl:36286,x:Ms},"bc6h-rgb-ufloat":{gl:36495,x:Os},"bc6h-rgb-float":{gl:36494,x:Os},"bc7-rgba-unorm":{gl:36492,x:Os},"bc7-rgba-unorm-srgb":{gl:36493,x:Os},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function RD(t,e,n){let i=e.create;const r=M_[e.format];return(r==null?void 0:r.gl)===void 0&&(i=!1),r!=null&&r.x&&(i=i&&!!uo(t,r.x,n)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function lx(t){var r;const e=M_[t],n=ID(t),i=x_(t);return{internalFormat:n,format:(e==null?void 0:e.dataFormat)||kD(i.channels,i.integer,i.normalized,n),type:i.dataType?ax(i.dataType):((r=e==null?void 0:e.types)==null?void 0:r[0])||5121,compressed:i.compressed||!1}}function CD(t){switch(x_(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function kD(t,e,n,i){if(i===6408||i===6407)return i;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function ID(t){const e=M_[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}const P0={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class PD extends pN{constructor(n,i,r){super([],r);C(this,"gl");C(this,"extensions");C(this,"testedFeatures",new Set);this.gl=n,this.extensions=i,uo(n,"EXT_color_buffer_float",i)}*[Symbol.iterator](){const n=this.getFeatures();for(const i of n)this.has(i)&&(yield i);return[]}has(n){var i;return(i=this.disabledFeatures)!=null&&i[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),AD(n)&&bD(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(i=>i!=="polygon-mode-webgl");for(const i of n)this.has(i)}getFeatures(){return[...Object.keys(P0),...Object.keys(N_)]}getWebGLFeature(n){const i=P0[n];return typeof i=="string"?!!uo(this.gl,i,this.extensions):!!i}}class ND extends gN{constructor(n){super();C(this,"gl");C(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]||0}}class _a extends wc{constructor(n,i){super(n,i);C(this,"device");C(this,"gl");C(this,"handle");C(this,"colorAttachments",[]);C(this,"depthStencilAttachment",null);const r=i.handle===null;this.device=n,this.gl=n.gl,this.handle=this.props.handle||r?this.props.handle:this.gl.createFramebuffer(),r||(n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const n=this.gl.bindFramebuffer(36160,this.handle);for(let i=0;i<this.colorAttachments.length;++i){const r=this.colorAttachments[i];if(r){const s=36064+i;this._attachTextureView(s,r)}}if(this.depthStencilAttachment){const i=CD(this.depthStencilAttachment.props.format);this._attachTextureView(i,this.depthStencilAttachment)}if(this.device.props.debug){const i=this.gl.checkFramebufferStatus(36160);if(i!==36053)throw new Error(`Framebuffer ${OD(i)}`)}this.gl.bindFramebuffer(36160,n)}_attachTextureView(n,i){const{gl:r}=this.device,{texture:s}=i,l=i.props.baseMipLevel,u=i.props.baseArrayLayer;switch(r.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:r.framebufferTextureLayer(36160,n,s.handle,l,u);break;case 34067:const f=MD(u);r.framebufferTexture2D(36160,n,f,s.handle,l);break;case 3553:r.framebufferTexture2D(36160,n,3553,s.handle,l);break;default:throw new Error("Illegal texture type")}r.bindTexture(s.glTarget,null)}}function MD(t){return t<34069?t+34069:t}function OD(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class LD extends Tg{constructor(n,i){super(i);C(this,"device");C(this,"format","rgba8unorm");C(this,"depthStencilFormat","depth24plus");C(this,"presentationSize");C(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new _a(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const i=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(i,n);return}}commit(){}}async function ux(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",t),e&&(i.id=e),new Promise((r,s)=>{i.onload=r,i.onerror=l=>s(new Error(`Unable to load script '${t}': ${l}`)),n.appendChild(i)})}const DD=1;let Ve=null,N0=!1;const O_={debugSpectorJS:oe.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function FD(t){if(!globalThis.SPECTOR)try{await ux(t.debugSpectorJSUrl||O_.debugSpectorJSUrl)}catch(e){oe.warn(String(e))}}function BD(t){var e;if(t={...O_,...t},!t.debugSpectorJS)return null;if(!Ve&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){oe.probe(DD,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:n}=globalThis.SPECTOR;Ve=new n,globalThis.luma&&(globalThis.luma.spector=Ve)}if(!Ve)return null;if(N0||(N0=!0,Ve.spyCanvases(),Ve==null||Ve.onCaptureStarted.add(n=>oe.info("Spector capture started:",n)()),Ve==null||Ve.onCapture.add(n=>{oe.info("Spector capture complete:",n)(),Ve==null||Ve.getResultUI(),Ve==null||Ve.resultView.display(),Ve==null||Ve.resultView.addCapture(n)})),t.gl){const n=t.gl,i=n.device;Ve==null||Ve.startCapture(t.gl,500),n.device=i,new Promise(r=>setTimeout(r,2e3)).then(r=>{oe.info("Spector capture stopped after 2 seconds")(),Ve==null||Ve.stopCapture()})}return Ve}const UD="https://unpkg.com/webgl-debug@2.0.1/index.js";function cx(t){return t.luma=t.luma||{},t.luma}async function zD(){Zr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await ux(UD))}function VD(t,e={}){return e.debugWebGL||e.traceWebGL?HD(t,e):WD(t)}function WD(t){const e=cx(t);return e.realContext?e.realContext:t}function HD(t,e){if(!globalThis.WebGLDebugUtils)return oe.warn("webgl-debug not loaded")(),t;const n=cx(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...Ns,...t});const i=globalThis.WebGLDebugUtils.makeDebugContext(t,jD.bind(null,e),$D.bind(null,e));for(const l in Ns)!(l in i)&&typeof Ns[l]=="number"&&(i[l]=Ns[l]);class r{}Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.setPrototypeOf(r,i);const s=Object.create(r);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function M0(t,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function jD(t,e,n,i){i=Array.from(i).map(u=>u===void 0?"undefined":u);const r=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i),l=`${r} in gl.${n}(${s})`;oe.error(l)();debugger}function $D(t,e,n){let i="";oe.level>=1&&(i=M0(e,n),t.traceWebGL&&oe.log(1,i)());for(const r of n)if(r===void 0){i=i||M0(e,n);debugger}}const id={};function XD(t="id"){id[t]=id[t]||1;const e=id[t]++;return`${t}-${e}`}class ma extends Ke{constructor(n,i={}){super(n,i);C(this,"device");C(this,"gl");C(this,"handle");C(this,"glTarget");C(this,"glUsage");C(this,"glIndexType",5123);C(this,"byteLength");C(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const r=typeof i=="object"?i.handle:void 0;this.handle=r||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=YD(this.props.usage),this.glUsage=qD(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,i.data?this._initWithData(i.data,i.byteOffset,i.byteLength):this._initWithByteLength(i.byteLength||0)}_initWithData(n,i=0,r=n.byteLength+i){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,r,this.glUsage),this.gl.bufferSubData(s,i,n),this.gl.bindBuffer(s,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(n,i,r),this.trackAllocatedMemory(r)}_initWithByteLength(n){let i=n;n===0&&(i=new Float32Array(0));const r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,i=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,i,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,i,n.byteLength)}async readAsync(n=0,i){return this.readSyncWebGL(n,i)}readSyncWebGL(n=0,i){i=i??this.byteLength-n;const r=new Uint8Array(i),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,r,s,i),this.gl.bindBuffer(36662,null),this._setDebugData(r,n,i),r}}function YD(t){return t&Ke.INDEX?34963:t&Ke.VERTEX?34962:t&Ke.UNIFORM?35345:34962}function qD(t){return t&Ke.INDEX||t&Ke.VERTEX?35044:t&Ke.UNIFORM?35048:35044}function KD(t){const e=t.split(/\r?\n/),n=[];for(const i of e){if(i.length<=1)continue;const r=i.split(":");if(r.length===2){const[_,y]=r;n.push({message:y.trim(),type:O0(_),lineNum:0,linePos:0});continue}const[s,l,u,...f]=r;let d=parseInt(u,10);isNaN(d)&&(d=0);let p=parseInt(l,10);isNaN(p)&&(p=0),n.push({message:f.join(":").trim(),type:O0(s),lineNum:d,linePos:p})}return n}function O0(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class GD extends vc{constructor(n,i){super(n,i);C(this,"device");C(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return n?KD(n):[]}getTranslatedSource(){const i=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(i==null?void 0:i.getTranslatedShaderSource(this.handle))||null}async _compile(n){n=n.startsWith("#version ")?n:`#version 300 es
${n}`;const{gl:i}=this.device;if(i.shaderSource(this.handle,n),i.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}oe.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),oe.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(l=>setTimeout(l,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function ZD(t,e,n,i){if(tF(e))return i(t);const r=t;r.pushState();try{return QD(t,e),yo(r.gl,n),i(t)}finally{r.popState()}}function QD(t,e){const n=t,{gl:i}=n;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Ur("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=Ur("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=Ur("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,l),s==null||s.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&i.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(eF("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(Yg("depthCompare",e.depthCompare))),e.stencilWriteMask){const r=e.stencilWriteMask;i.stencilMaskSeparate(1028,r),i.stencilMaskSeparate(1029,r)}if(e.stencilReadMask&&oe.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const r=e.stencilReadMask||4294967295,s=Yg("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,s,0,r),i.stencilFuncSeparate(1029,s,0,r)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const r=rd("stencilPassOperation",e.stencilPassOperation),s=rd("stencilFailOperation",e.stencilFailOperation),l=rd("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,s,l,r),i.stencilOpSeparate(1029,s,l,r)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const r=L0("blendColorOperation",e.blendColorOperation||"add"),s=L0("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(r,s);const l=Ql("blendColorSrcFactor",e.blendColorSrcFactor||"one"),u=Ql("blendColorDstFactor",e.blendColorDstFactor||"zero"),f=Ql("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=Ql("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(l,u,f,d)}}function Yg(t,e){return Ur(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function rd(t,e){return Ur(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function L0(t,e){return Ur(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Ql(t,e){return Ur(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function JD(t,e){return`Illegal parameter ${e} for ${t}`}function Ur(t,e,n){if(!(e in n))throw new Error(JD(t,e));return n[e]}function eF(t,e){return e}function tF(t){let e=!0;for(const n in t){e=!1;break}return e}function hx(t){const e={};return t.addressModeU&&(e[10242]=sd(t.addressModeU)),t.addressModeV&&(e[10243]=sd(t.addressModeV)),t.addressModeW&&(e[32882]=sd(t.addressModeW)),t.magFilter&&(e[10240]=qg(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=nF(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Yg("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function sd(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function qg(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function nF(t,e="none"){if(!e)return qg(t);switch(e){case"none":return qg(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class Kg extends Ec{constructor(n,i){super(n,i);C(this,"device");C(this,"handle");C(this,"parameters");this.device=n,this.parameters=hx(i),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[i,r]of Object.entries(n)){const s=Number(i);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,r);break;default:this.device.gl.samplerParameteri(this.handle,s,r);break}}}}class Ls extends yc{constructor(n,i){super(n,{...ot.defaultProps,...i});C(this,"device");C(this,"gl");C(this,"handle");C(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=i.texture}}const iF="Failed to deduce GL constant from typed array";function rF(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(iF)}}function sF(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function fx(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function oF(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Mc(t,e,n){if(aF(e))return n(t);const{nocatch:i=!0}=e,r=Br.get(t);r.push(),yo(t,e);let s;if(i)s=n(t),r.pop();else try{s=n(t)}finally{r.pop()}return s}function aF(t){for(const e in t)return!1;return!0}function lF(t,e,n){const{dimension:i,width:r,height:s,depth:l=0}=n,{glInternalFormat:u}=n,f=n.glTarget;switch(i){case"2d-array":case"3d":t.texStorage3D(f,e,u,r,s,l);break;default:t.texStorage2D(f,e,u,r,s)}}function D0(t,e,n,i){const{width:r,height:s}=i,{dimension:l,depth:u=0,mipLevel:f=0}=i,{x:d=0,y:p=0,z:_=0}=i,{glFormat:y,glType:E}=i,T=dx(i.glTarget,l,u),k=i.flipY?{37440:!0}:{};Mc(t,k,()=>{switch(l){case"2d-array":case"3d":t.bindTexture(T,e),t.texSubImage3D(T,f,d,p,_,r,s,u,y,E,n),t.bindTexture(T,null);break;case"2d":case"cube":t.bindTexture(T,e),t.texSubImage2D(T,f,d,p,r,s,y,E,n),t.bindTexture(T,null);break;default:throw new Error(l)}})}function F0(t,e,n){const{dimension:i,width:r,height:s,depth:l=0,mipLevel:u=0,byteOffset:f=0}=n,{x:d=0,y:p=0,z:_=0}=n,{glFormat:y,glType:E,compressed:T}=n,k=dx(n.glTarget,i,l);switch(i){case"2d-array":case"3d":T?t.compressedTexSubImage3D(k,u,d,p,_,r,s,l,y,e,f):t.texSubImage3D(k,u,d,p,_,r,s,l,y,E,e,f);break;case"2d":case"cube":T?t.compressedTexSubImage2D(k,u,d,p,r,s,y,e,f):t.texSubImage2D(k,u,d,p,r,s,y,E,e,f);break;default:throw new Error(i)}}function uF(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function dx(t,e,n){return e==="cube"?34069+n:t}function cF(t,e){var b;const{sourceX:n=0,sourceY:i=0,sourceAttachment:r=0}=e||{};let{target:s=null,sourceWidth:l,sourceHeight:u,sourceDepth:f,sourceFormat:d,sourceType:p}=e||{};const{framebuffer:_,deleteFramebuffer:y}=gx(t),{gl:E,handle:T}=_;l||(l=_.width),u||(u=_.height);const k=(b=_.colorAttachments[r])==null?void 0:b.texture;if(!k)throw new Error(`Invalid framebuffer attachment ${r}`);f=(k==null?void 0:k.depth)||1,d||(d=(k==null?void 0:k.glFormat)||6408),p||(p=(k==null?void 0:k.glType)||5121),s=dF(s,p,d,l,u),p=p||rF(s);const M=E.bindFramebuffer(36160,T);return E.readBuffer(36064+r),E.readPixels(n,i,l,u,d,p,s),E.readBuffer(36064),E.bindFramebuffer(36160,M||null),y&&_.destroy(),s}function hF(t,e){const{target:n,sourceX:i=0,sourceY:r=0,sourceFormat:s=6408,targetByteOffset:l=0}=e||{};let{sourceWidth:u,sourceHeight:f,sourceType:d}=e||{};const{framebuffer:p,deleteFramebuffer:_}=gx(t);u=u||p.width,f=f||p.height;const y=p;d=d||5121;let E=n;if(!E){const k=fx(s),M=oF(d),b=l+u*f*k*M;E=y.device.createBuffer({byteLength:b})}const T=t.device.createCommandEncoder();return T.copyTextureToBuffer({sourceTexture:t,width:u,height:f,origin:[i,r],destinationBuffer:E,byteOffset:l}),T.destroy(),_&&p.destroy(),E}function gx(t){return t instanceof wc?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:fF(t),deleteFramebuffer:!0}}function fF(t,e){const{device:n,width:i,height:r,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:i,height:r,colorAttachments:[t]})}function dF(t,e,n,i,r,s){if(t)return t;e||(e=5121);const l=sF(e,{clamped:!1}),u=fx(n);return new l(i*r*u)}class ya extends ot{constructor(n,i){super(n,i);C(this,"device");C(this,"gl");C(this,"handle");C(this,"sampler");C(this,"view");C(this,"mipmaps");C(this,"compressed");C(this,"glTarget");C(this,"glFormat");C(this,"glType");C(this,"glInternalFormat");C(this,"textureUnit",0);const r={...this.props};r.data=i.data,this.device=n,this.gl=this.device.gl,this.glTarget=uF(this.props.dimension);const s=lx(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(r),Object.seal(this)}_initialize(n){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:n.data});let{width:i,height:r}=n;if(!i||!r){const s=ot.getTextureDataSize(n.data);i=(s==null?void 0:s.width)||1,r=(s==null?void 0:s.height)||1}if(this.width=i,this.height=r,this.depth=n.depth,this.setSampler(n.sampler),this.view=new Ls(this.device,{...this.props,texture:this}),this.bind(),lF(this.gl,this.mipLevels,this),n.data)switch(n.dimension){case"1d":this.setTexture1DData(n.data);break;case"2d":this.setTexture2DData(n.data);break;case"3d":this.setTexture3DData(n.data);break;case"cube":this.setTextureCubeData(n.data);break;case"2d-array":this.setTextureArrayData(n.data);break;case"cube-array":this.setTextureCubeArrayData(n.data);break;default:throw new Error(n.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(n){return new Ls(this.device,{...n,texture:this})}setSampler(n={}){let i;n instanceof Kg?(this.sampler=n,i=n.props):(this.sampler=new Kg(this.device,n),i=n);const r=hx(i);this._setSamplerParameters(r)}generateMipmap(n){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(oe.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(n!=null&&n.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(r){oe.warn(`Error generating mipmap for ${this}: ${r.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(n){const i=ot.getExternalImageSize(n.image),r={...ot.defaultCopyExternalImageOptions,...i,...n},{image:s,depth:l,mipLevel:u,x:f,y:d,z:p,flipY:_}=r;let{width:y,height:E}=r;const{dimension:T,glTarget:k,glFormat:M,glInternalFormat:b,glType:w}=this;if(y=Math.min(y,this.width-f),E=Math.min(E,this.height-d),n.sourceX||n.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return D0(this.device.gl,this.handle,s,{dimension:T,mipLevel:u,x:f,y:d,z:p,width:y,height:E,depth:l,glFormat:M,glInternalFormat:b,glType:w,glTarget:k,flipY:_}),{width:r.width,height:r.height}}setTexture1DData(n){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(n,i=0){this.bind();const r=ot.normalizeTextureData(n,this);r.length>1&&this.props.mipmaps!==!1&&oe.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<r.length;s++){const l=r[s];this._setMipLevel(i,s,l)}this.unbind()}setTexture3DData(n){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(n)&&(this.bind(),F0(this.device.gl,n,this),this.unbind())}setTextureCubeData(n,i=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const r of ot.CubeFaces)this.setTextureCubeFaceData(n[r],r)}setTextureArrayData(n){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(n){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(n,i,r=0){Array.isArray(n)&&n.length>1&&this.props.mipmaps!==!1&&oe.warn(`${this.id} has mipmap and multiple LODs.`)();const s=ot.CubeFaces.indexOf(i);this.setTexture2DData(n,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(n){const{face:i,width:r,height:s,pixels:l,data:u,format:f=6408,type:d=5121}=n,{gl:p}=this,_=l||u;this.bind(),_ instanceof Promise?_.then(y=>this.setImageDataForFace(Object.assign({},n,{face:i,data:y,pixels:y}))):this.width||this.height?p.texImage2D(i,0,f,r,s,0,f,d,_):p.texImage2D(i,0,f,f,d,_)}_getImageDataMap(n){for(let i=0;i<ot.CubeFaces.length;++i){const r=ot.CubeFaces[i];n[r]&&(n[34069+i]=n[r],delete n[r])}return n}_setSamplerParameters(n){oe.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(n))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[i,r]of Object.entries(n)){const s=Number(i),l=r;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,l);break;case 10241:this.gl.texParameteri(this.glTarget,s,l);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,l);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,l);break;default:this.gl.texParameteri(this.glTarget,s,l);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(n,i,r,s=this.glTarget){if(ot.isExternalImage(r)){D0(this.device.gl,this.handle,r,{...this,depth:n,mipLevel:i,glTarget:s,flipY:this.props.flipY});return}if(ot.isTextureLevelData(r)){F0(this.device.gl,r.data,{...this,depth:n,mipLevel:i,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n){const{gl:i}=this;return n!==void 0&&(this.textureUnit=n,i.activeTexture(33984+n)),i.bindTexture(this.glTarget,this.handle),n}unbind(n){const{gl:i}=this;return n!==void 0&&(this.textureUnit=n,i.activeTexture(33984+n)),i.bindTexture(this.glTarget,null),n}}const gF=[1,2,4,8];class pF extends Sg{constructor(n,i){var s;super(n,i);C(this,"device");C(this,"glParameters");this.device=n;let r;if(!((s=i==null?void 0:i.parameters)!=null&&s.viewport))if(i!=null&&i.framebuffer){const{width:l,height:u}=i.framebuffer;r=[0,0,l,u]}else{const[l,u]=n.getCanvasContext().getDrawingBufferSize();r=[0,0,l,u]}if(this.device.pushState(),this.setParameters({viewport:r,...this.props.parameters}),this.props.framebuffer){const l=this.props.framebuffer.colorAttachments.map((u,f)=>36064+f);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const i={...this.glParameters};i.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(i.depthMask=!this.props.depthReadOnly),i.stencilMask=this.props.stencilReadOnly?0:1,i[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(i.viewport=n.viewport.slice(0,4),i.depthRange=[n.viewport[4],n.viewport[5]]):i.viewport=n.viewport),n.scissorRect&&(i.scissorTest=!0,i.scissor=n.scissorRect),n.blendConstant&&(i.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(i.colorMask=gF.map(r=>!!(r&n.colorMask))),this.glParameters=i,yo(this.device.gl,i)}beginOcclusionQuery(n){const i=this.props.occlusionQuerySet;i==null||i.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let i=0;this.props.clearColors&&this.props.clearColors.forEach((r,s)=>{r&&this.clearColorBuffer(s,r)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(i|=16384,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(i|=256,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(i|=1024,n.clearStencil=this.props.clearStencil),i!==0&&Mc(this.device.gl,n,()=>{this.device.gl.clear(i)})}clearColorBuffer(n=0,i=[0,0,0,0]){Mc(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(i.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,n,i);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,n,i);break;case Float32Array:this.device.gl.clearBufferfv(6144,n,i);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function _F(t){return mF.includes(t)}const mF=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],px={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function _x(t){const e=px[t];if(!e)throw new Error("uniform");const[n,i,,r]=e;return{format:r,components:i,glType:n}}function yF(t){const e=px[t];if(!e)throw new Error("attribute");const[,n,,i,r]=e;return{attributeType:i,vertexFormat:r,components:n}}function vF(t,e){const n={attributes:[],bindings:[]};n.attributes=EF(t,e);const i=SF(t,e);for(const u of i){const f=u.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));n.bindings.push({type:"uniform",name:u.name,group:0,location:u.location,visibility:(u.vertex?1:0)&(u.fragment?2:0),minBindingSize:u.byteLength,uniforms:f})}const r=TF(t,e);let s=0;for(const u of r)if(_F(u.type)){const{viewDimension:f,sampleType:d}=AF(u.type);n.bindings.push({type:"texture",name:u.name,group:0,location:s,viewDimension:f,sampleType:d}),u.textureUnit=s,s+=1}r.length&&(n.uniforms=r);const l=wF(t,e);return l!=null&&l.length&&(n.varyings=l),n}function EF(t,e){const n=[],i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const s=t.getActiveAttrib(e,r);if(!s)throw new Error("activeInfo");const{name:l,type:u}=s,f=t.getAttribLocation(e,l);if(f>=0){const{attributeType:d}=yF(u),p=/instance/i.test(l)?"instance":"vertex";n.push({name:l,location:f,stepMode:p,type:d})}}return n.sort((r,s)=>r.location-s.location),n}function wF(t,e){const n=[],i=t.getProgramParameter(e,35971);for(let r=0;r<i;r++){const s=t.getTransformFeedbackVarying(e,r);if(!s)throw new Error("activeInfo");const{name:l,type:u,size:f}=s,{glType:d,components:p}=_x(u),_={location:r,name:l,type:d,size:f*p};n.push(_)}return n.sort((r,s)=>r.location-s.location),n}function TF(t,e){const n=[],i=t.getProgramParameter(e,35718);for(let r=0;r<i;r++){const s=t.getActiveUniform(e,r);if(!s)throw new Error("activeInfo");const{name:l,size:u,type:f}=s,{name:d,isArray:p}=bF(l);let _=t.getUniformLocation(e,d);const y={location:_,name:d,size:u,type:f,isArray:p};if(n.push(y),y.size>1)for(let E=0;E<y.size;E++){const T=`${d}[${E}]`;_=t.getUniformLocation(e,T);const k={...y,name:T,location:_};n.push(k)}}return n}function SF(t,e){const n=(s,l)=>t.getActiveUniformBlockParameter(e,s,l),i=[],r=t.getProgramParameter(e,35382);for(let s=0;s<r;s++){const l={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},u=n(s,35395)||[],f=t.getActiveUniforms(e,u,35383),d=t.getActiveUniforms(e,u,35384),p=t.getActiveUniforms(e,u,35387),_=t.getActiveUniforms(e,u,35388);for(let y=0;y<l.uniformCount;++y){const E=t.getActiveUniform(e,u[y]);if(!E)throw new Error("activeInfo");l.uniforms.push({name:E.name,format:_x(f[y]).format,type:f[y],arrayLength:d[y],byteOffset:p[y],byteStride:_[y]})}i.push(l)}return i.sort((s,l)=>s.location-l.location),i}const xF={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function AF(t){const e=xF[t];if(!e)throw new Error("sampler");const[n,i]=e;return{viewDimension:n,sampleType:i}}function bF(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function RF(t,e,n,i){const r=t;let s=i;s===!0&&(s=1),s===!1&&(s=0);const l=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,i);case 5126:return t.uniform1fv(e,l);case 35664:return t.uniform2fv(e,l);case 35665:return t.uniform3fv(e,l);case 35666:return t.uniform4fv(e,l);case 5124:return t.uniform1iv(e,l);case 35667:return t.uniform2iv(e,l);case 35668:return t.uniform3iv(e,l);case 35669:return t.uniform4iv(e,l);case 35670:return t.uniform1iv(e,l);case 35671:return t.uniform2iv(e,l);case 35672:return t.uniform3iv(e,l);case 35673:return t.uniform4iv(e,l);case 5125:return r.uniform1uiv(e,l,1);case 36294:return r.uniform2uiv(e,l,2);case 36295:return r.uniform3uiv(e,l,3);case 36296:return r.uniform4uiv(e,l,4);case 35674:return t.uniformMatrix2fv(e,!1,l);case 35675:return t.uniformMatrix3fv(e,!1,l);case 35676:return t.uniformMatrix4fv(e,!1,l);case 35685:return r.uniformMatrix2x3fv(e,!1,l);case 35686:return r.uniformMatrix2x4fv(e,!1,l);case 35687:return r.uniformMatrix3x2fv(e,!1,l);case 35688:return r.uniformMatrix3x4fv(e,!1,l);case 35689:return r.uniformMatrix4x2fv(e,!1,l);case 35690:return r.uniformMatrix4x3fv(e,!1,l)}throw new Error("Illegal uniform")}function CF(t){return GS(t)!==null||typeof t=="number"||typeof t=="boolean"}function kF(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const i=t[n];CF(i)?e.uniforms[n]=i:e.bindings[n]=i}),e}function IF(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function PF(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const B0=4;class NF extends eo{constructor(n,i){super(n,i);C(this,"device");C(this,"handle");C(this,"vs");C(this,"fs");C(this,"introspectedLayout");C(this,"uniforms",{});C(this,"bindings",{});C(this,"varyings",null);C(this,"_uniformCount",0);C(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=i.vs,this.fs=i.fs;const{varyings:r,bufferMode:s=35981}=i;r&&r.length>0&&(this.varyings=r,this.device.gl.transformFeedbackVaryings(this.handle,r,s)),this._linkShaders(),oe.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=vF(this.device.gl,this.handle),oe.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=MF(this.introspectedLayout,i.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,i){for(const[r,s]of Object.entries(n)){const l=this.shaderLayout.bindings.find(u=>u.name===r)||this.shaderLayout.bindings.find(u=>u.name===`${r}Uniforms`);if(!l){const u=this.shaderLayout.bindings.map(f=>`"${f.name}"`).join(", ");i!=null&&i.disableWarnings||oe.warn(`No binding "${r}" in render pipeline "${this.id}", expected one of ${u}`,s)();continue}switch(s||oe.warn(`Unsetting binding "${r}" in render pipeline "${this.id}"`)(),l.type){case"uniform":if(!(s instanceof ma)&&!(s.buffer instanceof ma))throw new Error("buffer value");break;case"texture":if(!(s instanceof Ls||s instanceof ya||s instanceof _a))throw new Error("texture value");break;case"sampler":oe.warn(`Ignoring sampler ${r}`)();break;default:throw new Error(l.type)}this.bindings[r]=s}}draw(n){var M;const{renderPass:i,parameters:r=this.props.parameters,topology:s=this.props.topology,vertexArray:l,vertexCount:u,instanceCount:f,isInstanced:d=!1,firstVertex:p=0,transformFeedback:_}=n,y=IF(s),E=!!l.indexBuffer,T=(M=l.indexBuffer)==null?void 0:M.glIndexType;if(this.linkStatus!=="success")return oe.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return oe.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),l.bindBeforeRender(i),_&&_.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const k=i;return ZD(this.device,r,k.glParameters,()=>{E&&d?this.device.gl.drawElementsInstanced(y,u||0,T,p,f||0):E?this.device.gl.drawElements(y,u||0,T,p):d?this.device.gl.drawArraysInstanced(y,p,u||0,f||0):this.device.gl.drawArrays(y,p,u||0),_&&_.end()}),l.unbindAfterRender(i),!0}setUniformsWebGL(n){const{bindings:i}=kF(n);Object.keys(i).forEach(r=>{oe.warn(`Unsupported value "${JSON.stringify(i[r])}" used in setUniforms() for key ${r}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),oe.time(B0,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),oe.timeEnd(B0,`linkProgram for ${this.id}`)(),oe.level,!this.device.features.has("compilation-status-async-webgl")){const r=this._getLinkStatus();this._reportLinkStatus(r);return}oe.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),oe.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const i=this._getLinkStatus();this._reportLinkStatus(i)}async _reportLinkStatus(n){var i;switch(n){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((i=this.fs)==null?void 0:i.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${n}: ${r}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(l=>setTimeout(l,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const i of this.shaderLayout.bindings)!this.bindings[i.name]&&!this.bindings[i.name.replace(/Uniforms$/,"")]&&(oe.warn(`Binding ${i.name} not found in ${this.id}`)(),n=!1);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let i=0,r=0;for(const s of this.shaderLayout.bindings){const l=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!l)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:u}=s,f=n.getUniformBlockIndex(this.handle,u);if(f===4294967295)throw new Error(`Invalid uniform block name ${u}`);n.uniformBlockBinding(this.handle,r,f),l instanceof ma?n.bindBufferBase(35345,r,l.handle):n.bindBufferRange(35345,r,l.buffer.handle,l.offset||0,l.size||l.buffer.byteLength-l.offset),r+=1;break;case"texture":if(!(l instanceof Ls||l instanceof ya||l instanceof _a))throw new Error("texture");let d;if(l instanceof Ls)d=l.texture;else if(l instanceof ya)d=l;else if(l instanceof _a&&l.colorAttachments[0]instanceof Ls)oe.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=l.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+i),n.bindTexture(d.glTarget,d.handle),i+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:i,location:r,type:s,textureUnit:l}=n,u=this.uniforms[i]??l;u!==void 0&&RF(this.device.gl,r,s,u)}}}function MF(t,e){const n={...t,attributes:t.attributes.map(i=>({...i}))};for(const i of(e==null?void 0:e.attributes)||[]){const r=n.attributes.find(s=>s.name===i.name);r?(r.type=i.type||r.type,r.stepMode=i.stepMode||r.stepMode):oe.warn(`shader layout attribute ${i.name} not present in shader`)}return n}class OF extends Ag{constructor(n){super(n,{});C(this,"device");C(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const i of n)switch(i.name){case"copy-buffer-to-buffer":LF(this.device,i.options);break;case"copy-buffer-to-texture":DF(this.device,i.options);break;case"copy-texture-to-buffer":FF(this.device,i.options);break;case"copy-texture-to-texture":BF(this.device,i.options);break;default:throw new Error(i.name)}}}function LF(t,e){const n=e.sourceBuffer,i=e.destinationBuffer;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,i.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function DF(t,e){throw new Error("Not implemented")}function FF(t,e){const{sourceTexture:n,mipLevel:i=0,aspect:r="all",width:s=e.sourceTexture.width,height:l=e.sourceTexture.height,depthOrArrayLayers:u=0,origin:f=[0,0],destinationBuffer:d,byteOffset:p=0,bytesPerRow:_,rowsPerImage:y}=e;if(r!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||u!==0||_||y)throw new Error("not implemented");const{framebuffer:E,destroyFramebuffer:T}=mx(n);let k;try{const M=d,b=s||E.width,w=l||E.height,A=lx(E.colorAttachments[0].texture.props.format),N=A.format,D=A.type;t.gl.bindBuffer(35051,M.handle),k=t.gl.bindFramebuffer(36160,E.handle),t.gl.readPixels(f[0],f[1],b,w,N,D,p)}finally{t.gl.bindBuffer(35051,null),k!==void 0&&t.gl.bindFramebuffer(36160,k),T&&E.destroy()}}function BF(t,e){const{sourceTexture:n,destinationMipLevel:i=0,origin:r=[0,0],destinationOrigin:s=[0,0],destinationTexture:l}=e;let{width:u=e.destinationTexture.width,height:f=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:p}=mx(n),[_,y]=r,[E,T,k]=s,M=t.gl.bindFramebuffer(36160,d.handle);let b=null,w;if(l instanceof ya)b=l,u=Number.isFinite(u)?u:b.width,f=Number.isFinite(f)?f:b.height,b.bind(0),w=b.glTarget;else throw new Error("invalid destination");switch(w){case 3553:case 34067:t.gl.copyTexSubImage2D(w,i,E,T,_,y,u,f);break;case 35866:case 32879:t.gl.copyTexSubImage3D(w,i,E,T,k,_,y,u,f);break}b&&b.unbind(),t.gl.bindFramebuffer(36160,M),p&&d.destroy()}function mx(t){if(t instanceof ot){const{width:e,height:n,id:i}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class UF extends xg{constructor(n,i){super(n,i);C(this,"device");C(this,"commandBuffer");this.device=n,this.commandBuffer=new OF(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,i,r){}}function zF(t){const{target:e,source:n,start:i=0,count:r=1}=t,s=n.length,l=r*s;let u=0;for(let f=i;u<s;u++)e[f++]=n[u];for(;u<l;)u<l-u?(e.copyWithin(i+u,i,i+u),u*=2):(e.copyWithin(i+u,i,i+l-u),u=l);return t.target}class L_ extends bg{constructor(n,i){super(n,i);C(this,"device");C(this,"handle");C(this,"buffer",null);C(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return ik()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const i=n;if(i&&i.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,i?i.handle:null),this.indexBuffer=i,this.device.gl.bindVertexArray(null)}setBuffer(n,i){const r=i;if(r.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:l,stride:u,offset:f,normalized:d,integer:p,divisor:_}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,r.handle),p?this.device.gl.vertexAttribIPointer(n,s,l,u,f):this.device.gl.vertexAttribPointer(n,s,l,d,u,f),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,_||0),this.attributes[n]=r,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,i){this._enable(n,!1),this.attributes[n]=i}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const i=this.attributes[n];ArrayBuffer.isView(i)&&this.device.setConstantAttributeWebGL(n,i)}}_getAccessor(n){const i=this.attributeInfos[n];if(!i)throw new Error(`Unknown attribute location ${n}`);const r=ax(i.bufferDataType);return{size:i.bufferComponents,type:r,stride:i.byteStride,offset:i.byteOffset,normalized:i.normalized,integer:i.integer,divisor:i.stepMode==="instance"?1:0}}_enable(n,i=!0){const s=L_.isConstantAttributeZeroSupported(this.device)||n!==0;(i||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),i?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,i){const r=VF(i),s=r.byteLength*n,l=r.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let u=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),u=u||!WF(r,this.bufferValue),u){const f=jN(i.constructor,l);zF({target:f,source:r,start:0,count:l}),this.buffer.write(f),this.bufferValue=i}return this.buffer}}function VF(t){return Array.isArray(t)?new Float32Array(t):t}function WF(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class HF extends Rg{constructor(n,i){super(n,i);C(this,"device");C(this,"gl");C(this,"handle");C(this,"layout");C(this,"buffers",{});C(this,"unusedBuffers",{});C(this,"bindOnUse",!0);C(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,i.buffers&&this.setBuffers(i.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(PF(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const i in n)this.setBuffer(i,n[i])})}setBuffer(n,i){const r=this._getVaryingIndex(n),{buffer:s,byteLength:l,byteOffset:u}=this._getBufferRange(i);if(r<0){this.unusedBuffers[n]=s,oe.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[r]={buffer:s,byteLength:l,byteOffset:u},this.bindOnUse||this._bindBuffer(r,s,u,l)}getBuffer(n){if(U0(n))return this.buffers[n]||null;const i=this._getVaryingIndex(n);return i>=0?this.buffers[i]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let i;return this._bound?i=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,i=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),i}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof ma)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:i,byteOffset:r=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:i,byteOffset:r,byteLength:s}}_getVaryingIndex(n){if(U0(n))return Number(n);for(const i of this.layout.varyings)if(n===i.name)return i.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:i,byteLength:r,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),i,s,r)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,i,r=0,s){const l=i&&i.handle;!l||s===void 0?this.gl.bindBufferBase(35982,n,l):this.gl.bindBufferRange(35982,n,l,r,s)}}function U0(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class jF extends Cg{constructor(n,i){super(n,i);C(this,"device");C(this,"handle");C(this,"target",null);C(this,"_queryPending",!1);C(this,"_pollingPromise",null);if(this.device=n,i.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((r,s)=>{const l=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):i++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}}class Yi extends Dr{constructor(n){var _,y;super({...n,id:n.id||XD("webgl-device")});C(this,"type","webgl");C(this,"handle");C(this,"features");C(this,"limits");C(this,"info");C(this,"canvasContext");C(this,"lost");C(this,"_resolveContextLost");C(this,"gl");C(this,"debug",!1);C(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});C(this,"_extensions",{});C(this,"_polyfilled",!1);C(this,"spectorJS");C(this,"renderPass",null);C(this,"_constants");if(!n.createCanvasContext)throw new Error("WebGLDevice requires props.createCanvasContext to be set");const i=n.createCanvasContext===!0?{}:n.createCanvasContext;let r=(y=(_=i.canvas)==null?void 0:_.gl)==null?void 0:y.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);this.canvasContext=new LD(this,i),this.lost=new Promise(E=>{this._resolveContextLost=E});const s={...n.webgl};i.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),n.powerPreference!==void 0&&(s.powerPreference=n.powerPreference);const u=this.props._handle||pD(this.canvasContext.canvas,{onContextLost:E=>{var T;return(T=this._resolveContextLost)==null?void 0:T.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:E=>console.log("WebGL context restored")},s);if(!u)throw new Error("WebGL context creation failed");if(r=u.device,r)throw new Error(`WebGL context already attached to device ${r.id}`);this.handle=u,this.gl=u,this.spectorJS=BD({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=_D(this.gl,this._extensions),this.limits=new ND(this.gl),this.features=new PD(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),i.autoResize!==!1&&this.canvasContext.resize(),new Br(this.gl,{log:(...E)=>oe.log(1,...E)()}).trackState(this.gl,{copyState:!1});const d=n.debugWebGL||n.debug,p=n.debugWebGL;d&&(this.gl=VD(this.gl,{debugWebGL:d,traceWebGL:p}),oe.warn("WebGL debug mode activated. Performance reduced.")(),n.debugWebGL&&(oe.level=Math.max(oe.level,1)))}destroy(){}get isLost(){return this.gl.isContextLost()}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const i=this._normalizeBufferProps(n);return new ma(this,i)}createTexture(n){return new ya(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new Kg(this,n)}createShader(n){return new GD(this,n)}createFramebuffer(n){return new _a(this,n)}createVertexArray(n){return new L_(this,n)}createTransformFeedback(n){return new HF(this,n)}createQuerySet(n){return new jF(this,n)}createRenderPipeline(n){return new NF(this,n)}beginRenderPass(n){return new pF(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n={}){return new UF(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,i){return cF(n,i)}readPixelsToBufferWebGL(n,i){return hF(n,i)}setParametersWebGL(n){yo(this.gl,n)}getParametersWebGL(n){return sx(this.gl,n)}withParametersWebGL(n,i){return Mc(this.gl,n,i)}resetWebGL(){oe.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),cD(this.gl)}_getDeviceSpecificTextureFormatCapabilities(n){return RD(this.gl,n,this._extensions)}loseDevice(){var s;let n=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(n=!0,r.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){Br.get(this.gl).push()}popState(){Br.get(this.gl).pop()}setSpectorMetadata(n,i){n.__SPECTOR_Metadata=i}getGLKey(n,i){const r=Number(n);for(const s in this.gl)if(this.gl[s]===r)return`GL.${s}`;return i!=null&&i.emptyIfUnknown?"":String(n)}getGLKeys(n){const i={emptyIfUnknown:!0};return Object.entries(n).reduce((r,[s,l])=>(r[`${s}:${this.getGLKey(s,i)}`]=`${l}:${this.getGLKey(l,i)}`,r),{})}setConstantAttributeWebGL(n,i){const r=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(r).fill(null);const s=this._constants[n];switch(s&&qF(s,i)&&oe.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=i,i.constructor){case Float32Array:$F(this,n,i);break;case Int32Array:XF(this,n,i);break;case Uint32Array:YF(this,n,i);break;default:throw new Error("constant")}}getExtension(n){return uo(this.gl,n,this._extensions),this._extensions}}function $F(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break}}function XF(t,e,n){t.gl.vertexAttribI4iv(e,n)}function YF(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function qF(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}const KF={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},GF=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),ZF=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),QF=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function JF(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(n,i){if(n==="webgl"||n==="experimental-webgl"){const r=this.originalGetContext("webgl2",i);return r instanceof HTMLElement&&eB(r),r}return this.originalGetContext(n,i)}}function eB(t){t.getExtension("EXT_color_buffer_float");const e={...KF,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:GF(t),OES_vertex_array_object:ZF(t),ANGLE_instanced_arrays:QF(t)},n=t.getExtension;t.getExtension=function(r){const s=n.call(t,r);return s||(r in e?e[r]:null)};const i=t.getSupportedExtensions;t.getSupportedExtensions=function(){const r=i.apply(t)||[];return r==null?void 0:r.concat(Object.keys(e))}}const Jl=1;class tB extends EN{constructor(){super();C(this,"type","webgl");Dr.defaultProps={...Dr.defaultProps,...O_},Yi.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(n){JF(n)}async attach(n){if(n instanceof Yi)return n;if((n==null?void 0:n.device)instanceof Dr)return n.device;if(!nB(n))throw new Error("Invalid WebGL2RenderingContext");return new Yi({_handle:n,createCanvasContext:{canvas:n.canvas,autoResize:!1}})}async create(n={}){oe.groupCollapsed(Jl,"WebGLDevice created")();const i=[];(n.debugWebGL||n.debug)&&i.push(zD()),n.debugSpectorJS&&i.push(FD(n));const r=await Promise.allSettled(i);for(const u of r)u.status==="rejected"&&oe.error(`Failed to initialize debug libraries ${u.reason}`)();const s=new Yi(n),l=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return oe.probe(Jl,l)(),oe.table(Jl,s.info)(),oe.groupEnd(Jl)(),s}}function nB(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const z0=new tB;function Mi(){}const iB=({isDragging:t})=>t?"grabbing":"grab",yx={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Mi,onWebGLInitialized:Mi,onResize:Mi,onViewStateChange:Mi,onInteractionStateChange:Mi,onBeforeRender:Mi,onAfterRender:Mi,onLoad:Mi,onError:t=>be.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:iB,getTooltip:null,debug:!1,drawPickingColors:!1};class D_{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Th({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:r}=this;if(i.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(i.leftButton||i.rightButton)return;{const s=i.offsetCenter;if(!s)return;r.x=s.x,r.y=s.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=i},this._onEvent=i=>{const r=Bg[i.type],s=i.offsetCenter;if(!r||!s||!this.layerManager)return;const l=this.layerManager.getLayers(),u=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:l,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:f}=u,d=f&&(f[r]||f.props[r]),p=this.props[r];let _=!1;d&&(_=d.call(f,u,i)),_||(p==null||p(u,i),this.widgetManager.onEvent(u,i))},this._onPointerDown=i=>{const r=i.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...yx,...e},e=this.props,e.viewState&&e.initialViewState&&be.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;!n&&e.gl&&(e.gl instanceof WebGLRenderingContext&&be.error("WebGL1 context not supported.")(),n=z0.attach(e.gl)),n||(n=wg.createDevice({type:"best-available",adapters:[z0],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&oo.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,r,s,l,u,f,d,p;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(i=this.layerManager)==null||i.finalize(),this.layerManager=null,(r=this.viewManager)==null||r.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(l=this.deckRenderer)==null||l.finalize(),this.deckRenderer=null,(u=this.deckPicker)==null||u.finalize(),this.deckPicker=null,(f=this.eventManager)==null||f.destroy(),this.eventManager=null,(d=this.widgetManager)==null||d.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((p=this.canvas.parentElement)==null||p.removeChild(this.canvas),this.canvas=null)}setProps(e){var i;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&be.removed("onLayerHover","onHover")(),"onLayerClick"in e&&be.removed("onLayerClick","onClick")(),e.initialViewState&&!Ln(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(i=this.animationLoop)==null||i.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return n=n||i||r||s||l,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return bt(this.viewManager),this.viewManager.views}getViewports(e){return bt(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,i){bt(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),bt(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var r;if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(i||i===0){const s=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=((r=e.style)==null?void 0:r.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var r,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,i=e.clientHeight??e.height;(n!==this.width||i!==this.height)&&(this.width=n,this.height=i,(r=this.viewManager)==null||r.setProps({width:n,height:i}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:i}))}_createAnimationLoop(e,n){const{gl:i,onError:r,useDevicePixels:s}=n;return new sL({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:l=>this._setDevice(l.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new HL({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,i,r;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:l}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let u=l,f=!1;for(const d of s)u=d,f=((n=d.layer)==null?void 0:n.onHover(d,e.event))||f;f||((r=(i=this.props).onHover)==null||r.call(i,u,e.event),this.widgetManager.onHover(u,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var r,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(r=this.device.canvasContext)==null?void 0:r.canvas),this.device instanceof Yi&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Yi&&this.props.onWebGLInitialized(this.device.gl);const n=new KS;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new WM(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(a0).map(l=>{var E;const[u,f,d,p]=a0[l],_=(E=this.props.eventRecognizerOptions)==null?void 0:E[l],y={...f,..._,event:l};return{recognizer:new u(y),recognizeWith:d,requestFailure:p}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const l in Bg)this.eventManager.on(l,this._onEvent);this.viewManager=new kL({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new CL(this.device,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new XL({deck:this,device:this.device}),this.deckRenderer=new KL(this.device),this.deckPicker=new tD(this.device),this.widgetManager=new rD({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new oD),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var l;const{device:i,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:r});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(l=this.deckRenderer)==null||l.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:i,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),be.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=wg.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}D_.defaultProps=yx;D_.VERSION=AP;const rB=D_;function sB(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return cS(t)}}const oB=uS;function eu(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Nr(t){return t.stride||t.size*t.bytesPerElement}function aB(t,e){return t.type===e.type&&t.size===e.size&&Nr(t)===Nr(e)&&(t.offset||0)===(e.offset||0)}function Gg(t,e){e.offset&&be.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Nr(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,s=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function lB(t,e){const n=Gg(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class uB{constructor(e,n,i){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,s=r==="float64";let{defaultValue:l}=n;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let u;s?u="float32":!r&&n.isIndexed?u="uint32":u=r||"float32";let f=sB(r||u);this.doublePrecision=s,s&&n.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...n,defaultType:f,defaultValue:l,logicalType:r,type:u,normalized:u.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Nr(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),oo.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const i={};if(this.state.constant){const r=this.value;if(n){const s=Gg(this.getAccessor(),n),l=s.offset/r.BYTES_PER_ELEMENT,u=s.size||this.size;i[e]=r.subarray(l,l+u)}else i[e]=r}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,n=null){const i=this.getAccessor(),r=[],s={name:this.id,byteStride:Nr(i),attributes:r};if(this.doublePrecision){const l=lB(i,n||{});r.push(eu(e,{...i,...l.high}),eu(`${e}64Low`,{...i,...l.low}))}else if(n){const l=Gg(i,n);r.push(eu(e,{...i,...l}))}else r.push(eu(e,i));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,s=i*r;if(n&&s&&n.length>=s){const l=new Array(r).fill(1/0),u=new Array(r).fill(-1/0);for(let f=0;f<s;)for(let d=0;d<r;d++){const p=n[f++];p<l[d]&&(l[d]=p),p>u[d]&&(u[d]=p)}e=[l,u]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof Ke?i={buffer:e}:i=e;const r={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)r.type="float32";else{const l=oB(i.value);r.type=r.normalized?l.replace("int","norm"):l}r.bytesPerElement=i.value.BYTES_PER_ELEMENT,r.stride=Nr(r)}if(n.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(i.buffer){const s=i.buffer;n.externalBuffer=s,n.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let s=i.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:l}=this;const u=Nr(r),f=(r.vertexOffset||0)*u;if(this.doublePrecision&&s instanceof Float64Array&&(s=Zf(s,r)),this.settings.isIndexed){const p=this.settings.defaultType;s.constructor!==p&&(s=new p(s))}const d=s.byteLength+f+u*2;(!l||l.byteLength<d)&&(l=this._createBuffer(d)),l.write(s,f)}return this.setAccessor(r),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?Zf(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),i*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,s=oo.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:l}=this;let{buffer:u}=this;return(!u||u.byteLength<s.byteLength+l)&&(u=this._createBuffer(s.byteLength+l),n&&r&&u.write(r instanceof Float64Array?Zf(r,this):r,l)),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&be.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let l=s;for(;--l>=0;)n[i+l]=r[l];return n}switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let l=s;for(;--l>=0;)n[i+l]=Number.isFinite(e[l])?e[l]:r[l]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}_createBuffer(e){var r;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:i}=this.settings;return this._buffer=this.device.createBuffer({...(r=this._buffer)==null?void 0:r.props,id:this.id,usage:n?Ke.INDEX:Ke.VERTEX,indexType:n?i:void 0,byteLength:e}),this._buffer}}const V0=[],W0=[];function kh(t,e=0,n=1/0){let i=V0;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(W0.length=t.length,i=W0):i=V0,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function vx(t){return t&&t[Symbol.asyncIterator]}function Ex(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:l}=e,u=t.BYTES_PER_ELEMENT,f=i?i/u:n,d=r?r/u:0,p=Math.floor((t.length-d)/f);return(_,{index:y,target:E})=>{if(!s){const b=y*f+d;for(let w=0;w<n;w++)E[w]=t[b+w];return E}const T=s[y],k=s[y+1]||p;let M;if(l){M=new Array(k-T);for(let b=T;b<k;b++){const w=b*f+d;E=new Array(n);for(let A=0;A<n;A++)E[A]=t[w+A];M[b-T]=E}}else if(f===n)M=t.subarray(T*n+d,k*n+d);else{M=new t.constructor((k-T)*n);let b=0;for(let w=T;w<k;w++){const A=w*f+d;for(let N=0;N<n;N++)M[b++]=t[A+N]}}return M}}const cB=[],Pu=[[0,1/0]];function hB(t,e){if(t===Pu||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const l=t[s];l[1]<e[0]?(n.push(l),r=s+1):l[0]>e[1]?n.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return n.splice(r,0,e),n}const fB={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function wx(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...fB[n],...e,...t,type:n}}class Tx extends uB{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Pu}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!aB(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return wx(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=hB(this.state.updateRanges,[i,r])}else this.state.updateRanges=Pu}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=cB}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==Pu),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:l,noAlloc:u}}=this;let f=!0;if(l){for(const[d,p]of s)l.call(r,this,{data:n,startRow:d,endRow:p,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,p]of s){const _=Number.isFinite(d)?this.getVertexOffset(d):0,y=Number.isFinite(p)?this.getVertexOffset(p):u||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:y})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;bt(ArrayBuffer.isView(l.value),`invalid ${r.accessor}`);const u=!!l.size&&l.size!==this.size;return i.binaryAccessor=Ex(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:n,nested:u}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const i in e)Object.assign(n,super.getValue(i,e[i]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:r}=this.settings;if(r==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=r??"vertex",!n)return i;for(const s in n){const l=super._getBufferLayout(s,n[s]);i.attributes.push(...l.attributes)}return i}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:s,numInstances:l}){if(e.constant)return;const{settings:u,state:f,value:d,size:p,startIndices:_}=e,{accessor:y,transform:E}=u,T=f.binaryAccessor||(typeof y=="function"?y:s[y]);bt(typeof T=="function",`accessor "${y}" is not a function`);let k=e.getVertexOffset(i);const{iterable:M,objectInfo:b}=kh(n,i,r);for(const w of M){b.index++;let A=T(w,b);if(E&&(A=E.call(this,A)),_){const N=(b.index<_.length-1?_[b.index+1]:l)-_[b.index];if(A&&Array.isArray(A[0])){let D=k;for(const W of A)e._normalizeValue(W,d,D),D+=p}else A&&A.length>p?d.set(A,k):(e._normalizeValue(A,b.target,0),SL({target:d,source:b.target,start:k,count:N}));k+=N*p}else e._normalizeValue(A,d,k),k+=p}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function od(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,l=t.end||n.length,u=e.length,f=l-i;if(u>f){n.set(e.subarray(0,f),i);return}if(n.set(e,i),!s)return;let d=u;for(;d<f;){const p=s(d,e);for(let _=0;_<r;_++)n[i+d]=p[_]||0,d++}}function dB({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!r||!s)return od({source:t,target:e,size:n,getData:i}),e;let l=0,u=0;const f=i&&((p,_)=>i(p+u,_)),d=Math.min(r.length,s.length);for(let p=1;p<d;p++){const _=r[p]*n,y=s[p]*n;od({source:t.subarray(l,_),target:e,start:u,end:y,size:n,getData:f}),l=_,u=y}return u<e.length&&od({source:[],target:e,start:u,size:n,getData:f}),e}function gB(t){const{device:e,settings:n,value:i}=t,r=new Tx(e,n);return r.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),r}function Sx(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function xx(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Ax(t){t.push(t.shift())}function pB(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,l=n&&r instanceof Float64Array?2:1;let u=0;const{shaderAttributes:f}=t.settings;if(f)for(const d of Object.values(f))u=Math.max(u,d.vertexOffset??0);return(i.noAlloc?r.length:(e+u)*s)*l}function bx({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function Rx({device:t,buffer:e,attribute:n,fromLength:i,toLength:r,fromStartIndices:s,getData:l=u=>u}){const u=n.doublePrecision&&n.value instanceof Float64Array?2:1,f=n.size*u,d=n.byteOffset,p=n.settings.bytesPerElement<4?d/n.settings.bytesPerElement*4:d,_=n.startIndices,y=s&&_,E=n.isConstant;if(!y&&e&&i>=r)return e;const T=n.value instanceof Float64Array?Float32Array:n.value.constructor,k=E?n.value:new T(n.getBuffer().readSyncWebGL(d,r*T.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!E){const A=l;l=(N,D)=>n.normalizeConstant(A(N,D))}const M=E?(A,N)=>l(k,N):(A,N)=>l(k.subarray(A+d,A+d+f),N),b=e?new Float32Array(e.readSyncWebGL(p,i*4).buffer):new Float32Array(0),w=new Float32Array(r);return dB({source:b,target:w,sourceStartIndices:s,targetStartIndices:_,size:f,getData:M}),(!e||e.byteLength<w.byteLength+p)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:w.byteLength+p,usage:35050})),e.write(w,p),e}class Cx{constructor({device:e,attribute:n,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Ch(i),this.attribute=n,this.attributeInTransition=gB(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=pB(this.attribute,n),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class _B extends Cx{constructor({device:e,attribute:n,timeline:i}){super({device:e,attribute:n,timeline:i}),this.type="interpolation",this.transform=EB(e,n)}start(e,n){const i=this.currentLength,r=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:l}=this;Ax(s),s[0]=Rx({device:this.device,buffer:s[0],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),s[1]=bx({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:u}=this,f=u.model;let d=Math.floor(this.currentLength/l.size);kx(l)&&(d/=2),f.setVertexCount(d),l.isConstant?(f.setAttributes({aFrom:s[0]}),f.setConstantAttributes({aTo:l.value})):f.setAttributes({aFrom:s[0],aTo:l.getBuffer()}),u.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:i}=this.transition;let r=i/e;n&&(r=n(r));const{model:s}=this.transform,l={time:r};s.shaderInputs.setProps({interpolation:l}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const mB=`uniform interpolationUniforms {
  float time;
} interpolation;
`,H0={name:"interpolation",vs:mB,uniformTypes:{time:"f32"}},yB=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,vB=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function kx(t){return t.doublePrecision&&t.value instanceof Float64Array}function EB(t,e){const n=e.size,i=Sx(n),r=xx(n),s=e.getBufferLayout();return kx(e)?new Ha(t,{vs:vB,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*n}]}],modules:[O2,H0],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Ha(t,{vs:yB,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:s.attributes[0].format}],modules:[H0],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class wB extends Cx{constructor({device:e,attribute:n,timeline:i}){super({device:e,attribute:n,timeline:i}),this.type="spring",this.texture=RB(e),this.framebuffer=CB(e,this.texture),this.transform=bB(e,n)}start(e,n){const i=this.currentLength,r=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:l}=this;for(let f=0;f<2;f++)s[f]=Rx({device:this.device,buffer:s[f],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});s[2]=bx({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:u}=this.transform;u.setVertexCount(Math.floor(this.currentLength/l.size)),l.isConstant?u.setConstantAttributes({aTo:l.value}):u.setAttributes({aTo:l.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]});const l={stiffness:s.stiffness,damping:s.damping};n.model.shaderInputs.setProps({spring:l}),n.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Ax(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const TB=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,SB={name:"spring",vs:TB,uniformTypes:{damping:"f32",stiffness:"f32"}},xB=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,AB=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function bB(t,e){const n=Sx(e.size),i=xx(e.size);return new Ha(t,{vs:xB,fs:AB,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[SB],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function RB(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function CB(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const kB={interpolation:_B,spring:wB};class IB{constructor(e,{id:n,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const s=e[r],l=s.getTransitionSetting(n);l&&this._updateAttribute(r,s,l)}for(const r in this.transitions){const s=e[r];(!s||!s.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let s=!r||r.type!==i.type;if(s){r&&this._removeTransition(e);const l=kB[i.type];l?this.transitions[e]=new l({attribute:n,timeline:this.timeline,device:this.device}):(be.error(`unsupported transition type '${i.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const j0="attributeManager.invalidate",PB="attributeManager.updateStart",NB="attributeManager.updateEnd",MB="attribute.updateStart",OB="attribute.allocate",LB="attribute.updateEnd";class DB{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){this.mergeBoundsMemoized=ol(XO),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new IB(e,{id:`${n}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);Ot(j0,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ot(j0,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:s={},buffers:l={},context:u={}}){let f=!1;Ot(PB,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const p=this.attributes[d],_=p.settings.accessor;p.startIndices=i,p.numInstances=n,s[d]&&be.removed(`props.${d}`,`data.attributes.${d}`)(),p.setExternalBuffer(l[d])||p.setBinaryValue(typeof _=="string"?l[_]:void 0,e.startIndices)||typeof _=="string"&&!l[_]&&p.setConstantValue(s[_])||p.needsUpdate()&&(f=!0,this._updateAttribute({attribute:p,numInstances:n,data:e,props:s,context:u})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}f&&Ot(NB,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(i=>{var r;return(r=this.attributes[i])==null?void 0:r.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in n){const l=n[s];l.needsRedraw(e)&&!i.hasAttribute(s)&&(r[s]=l)}return r}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const i in e){const r=e[i],s={...r,id:i,size:r.isIndexed&&1||r.size||1,...n};this.attributes[i]=new Tx(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,s=r[e];return s&&s.forEach(l=>{const u=i[l];u&&u.setNeedsUpdate(u.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Ot(MB,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Ot(OB,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Ot(LB,n,i))}}class FB extends Ch{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:s}}=this,l=s(e/r);this._value=bc(n,i,l)}}const $0=1e-5;function X0(t,e,n,i,r){const s=e-t,u=(n-e)*r,f=-s*i;return u+f+s+e}function BB(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let l=0;l<n.length;l++)s[l]=X0(t[l],e[l],n[l],i,r);return s}return X0(t,e,n,i,r)}function Y0(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class UB extends Ch{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:l=e}=this;let u=BB(s,l,n,i,r);const f=Y0(u,n),d=Y0(u,l);f<$0&&d<$0&&(u=n,this.end()),this._prevValue=l,this._currValue=u}}const zB={interpolation:FB,spring:UB};class VB{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:s}=this;if(s.has(e)){const f=s.get(e),{value:d=f.settings.fromValue}=f;n=d,this.remove(e)}if(r=wx(r),!r)return;const l=zB[r.type];if(!l){be.error(`unsupported transition type '${r.type}'`)();return}const u=new l(this.timeline);u.start({...r,fromValue:n,toValue:i}),s.set(e,u)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function WB(t){const e=t[rr];for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function HB(t,e){const n=Ix({newProps:t,oldProps:e,propTypes:t[rr],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=$B(t,e);let r=!1;return i||(r=XB(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:YB(t,e),transitionsChanged:jB(t,e)}}function jB(t,e){if(!t.transitions)return!1;const n={},i=t[rr];let r=!1;for(const s in t.transitions){const l=i[s],u=l&&l.type;(u==="number"||u==="color"||u==="array")&&Zg(t[s],e[s],l)&&(n[s]=!0,r=!0)}return r?n:!1}function Ix({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${r} changed shallowly`;if(typeof e!="object"||e===null)return`${r} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${r}.${s} added`;const l=Zg(t[s],e[s],i[s]);if(l)return`${r}.${s} ${l}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${r}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const l=Zg(t[s],e[s],i[s]);if(l)return`${r}.${s} ${l}`}}return!1}function Zg(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function $B(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function XB(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&q0(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&q0(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function YB(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function q0(t,e,n){let i=t.updateTriggers[n];i=i??{};let r=e.updateTriggers[n];return r=r??{},Ix({oldProps:r,newProps:i,triggerName:n})}const qB="count(): argument not an object",KB="count(): argument not a container";function GB(t){if(!QB(t))throw new Error(qB);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(ZB(t))return Object.keys(t).length;throw new Error(KB)}function ZB(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function QB(t){return t!==null&&typeof t=="object"}function K0(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const JB={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Qg={};function eU(t,e,n,i){if(n instanceof ot)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let r=null;n.compressed&&(r={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...JB,...r,...i},mipmaps:!0});return Qg[s.id]=t,s}function tU(t,e){!e||!(e instanceof ot)||Qg[e.id]===t&&(e.delete(),delete Qg[e.id])}const nU={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Jg(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Ln(t,e,1)}},accessor:{validate(t,e){const n=Oc(t);return n==="function"||n===Oc(e.value)},equal(t,e,n){return typeof e=="function"?!0:Ln(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Jg(t)},equal(t,e,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Ln(t,e,r):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Ln(t,e,r):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:i}=n.props;return i?i(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.device?null:eU(n.id,i.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{tU(n.id,t)}}};function iU(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const l=s==null?void 0:s.deprecatedFor;if(l)i[r]=Array.isArray(l)?l:[l];else{const u=rU(r,s);e[r]=u,n[r]=u.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function rU(t,e){switch(Oc(e)){case"object":return Wo(t,e);case"array":return Wo(t,{type:"array",value:e,compare:!1});case"boolean":return Wo(t,{type:"boolean",value:e});case"number":return Wo(t,{type:"number",value:e});case"function":return Wo(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Wo(t,e){return"type"in e?{name:t,...nU[e.type],...e}:"value"in e?{name:t,type:Oc(e.value),...e}:{name:t,type:"object",value:e}}function Jg(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Oc(t){return Jg(t)?"array":t===null?"null":typeof t}function sU(t,e){let n;for(let s=e.length-1;s>=0;s--){const l=e[s];"extensions"in l&&(n=l.extensions)}const i=ep(t.constructor,n),r=Object.create(i);r[Nc]=t,r[Xr]={},r[Xi]={};for(let s=0;s<e.length;++s){const l=e[s];for(const u in l)r[u]=l[u]}return Object.freeze(r),r}const oU="_mergedDefaultProps";function ep(t,e){if(!(t instanceof Nx.constructor))return{};let n=oU;if(e)for(const r of e){const s=r.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const i=Px(t,n);return i||(t[n]=aU(t,e||[]))}function aU(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),r=ep(i),s=Px(t,"defaultProps")||{},l=iU(s),u=Object.assign(Object.create(null),r,l.defaultProps),f=Object.assign(Object.create(null),r==null?void 0:r[rr],l.propTypes),d=Object.assign(Object.create(null),r==null?void 0:r[td],l.deprecatedProps);for(const p of e){const _=ep(p.constructor);_&&(Object.assign(u,_),Object.assign(f,_[rr]),Object.assign(d,_[td]))}return lU(u,t),cU(u,f),uU(u,d),u[rr]=f,u[td]=d,e.length===0&&!F_(t,"_propTypes")&&(t._propTypes=f),u}function lU(t,e){const n=fU(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function uU(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r=`${this.id}: ${n}`;for(const s of e[n])F_(this,s)||(this[s]=i);be.deprecated(r,e[n].join("/"))()}})}function cU(t,e){const n={},i={};for(const r in e){const s=e[r],{name:l,value:u}=s;s.async&&(n[l]=u,i[l]=hU(l))}t[$s]=n,t[Xr]={},Object.defineProperties(t,i)}function hU(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||vx(e)?this[Xr][t]=e:this[Xi][t]=e},get(){if(this[Xi]){if(t in this[Xi])return this[Xi][t]||this[$s][t];if(t in this[Xr]){const e=this[Nc]&&this[Nc].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[$s][t]}}return this[$s][t]}}}function F_(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Px(t,e){return F_(t,e)&&t[e]}function fU(t){const e=t.componentName;return e||be.warn(`${t.name}.componentName not specified`)(),e||t.name}let dU=0;class B_{constructor(...e){this.props=sU(this,e),this.id=this.props.id,this.count=dU++}clone(e){const{props:n}=this,i={};for(const r in n[$s])r in n[Xi]?i[r]=n[Xi][r]:r in n[Xr]&&(i[r]=n[Xr][r]);return new this.constructor({...n,...i,...e})}}B_.componentName="Component";B_.defaultProps={};const Nx=B_,gU=Object.freeze({});class pU{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||gU}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Nc]||this.component;const n=e[Xi]||{},i=e[Xr]||e,r=e[$s]||{};for(const s in n){const l=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,l),n[s]=this.getAsyncProp(s)}for(const s in i){const l=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,l)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(vx(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,r),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let s=[],l=0;for await(const u of n){if(!this.component)return;const{dataTransform:f}=this.component.props;f?s=f(u,s):s=s.concat(u),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:l,endRow:s.length}]}),l=s.length,this._setAsyncPropValue(e,s,r)}this._onResolve(e,s)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.props[rr];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class _U extends pU{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,r=i==null?void 0:i.props.fetch;return r?r(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const r=i.props.onDataLoad;e==="data"&&r&&r(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,`loading ${e} of ${this.layer}`)}}const mU="layer.changeFlag",yU="layer.initialize",vU="layer.update",EU="layer.finalize",wU="layer.matched",G0=2**24-1,TU=Object.freeze([]),SU=ol(({oldViewport:t,viewport:e})=>t.equals(e));let Cn=new Uint8ClampedArray(0);const xU={data:{type:"data",value:TU,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:l}=n.context;r=r||n.getLoadOptions(),i=i||n.props.loaders,s&&(r={...r,fetch:{...r==null?void 0:r.fetch,signal:s}});let u=l.contains(t);return!u&&!r&&(l.add({resourceId:t,data:gc(t,i),persistent:!1}),u=!0),u?l.subscribe({resourceId:t,onChange:f=>{var d;return(d=n.internalState)==null?void 0:d.reloadAsyncProp(e,f)},consumerId:n.id,requestId:e}):gc(t,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Me.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class U_ extends Nx{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ys.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){bt(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=qS(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,l]=WS(i,n.pixelProjectionMatrix);return e.length===2?[r,s]:[r,s,l]}unproject(e){return bt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){bt(this.internalState);const i=this.internalState.viewport||this.context.viewport;return QO(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Me.DEFAULT||e===Me.LNGLAT||e===Me.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){bt(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:GB(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=K0(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=K0(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const r of i)n.invalidateAll(r);else n.invalidateAll();if(n){const{props:r}=e,s=this.internalState.hasPickingBuffer,l=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(u=>u.getNeedsPickingBuffer.call(this,u));if(s!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:u,instancePickingColors:f}=n.attributes,d=u||f;d&&(l&&d.constant&&(d.constant=!1,n.invalidate(d.id)),!d.value&&!l&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e.renderPass)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var i,r,s,l;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(r=(i=this.props).onError)!=null&&r.call(i,e)||(l=(s=this.context)==null?void 0:s.onError)==null||l.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!SU({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const i in e)e[i].layoutChanged()&&(n=!0);for(const i of this.getModels())this._setModelAttributes(i,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(Cn.length/4);if(this.internalState.usesPickingColorCache=!0,i<n){n>G0&&be.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Cn=oo.allocate(Cn,n,{size:4,copy:!0,maxCount:Math.max(n,G0)});const r=Math.floor(Cn.length/4),s=[0,0,0];for(let l=i;l<r;l++)this.encodePickingColor(l,s),Cn[l*4+0]=s[0],Cn[l*4+1]=s[1],Cn[l*4+2]=s[2],Cn[l*4+3]=0}e.value=Cn.subarray(0,n*4)}_setModelAttributes(e,n,i=!1){var u;if(!Object.keys(n).length)return;if(i){const f=this.getAttributeManager();e.setBufferLayout(f.getBufferLayouts(e)),n=f.getAttributes()}const r=((u=e.userData)==null?void 0:u.excludeAttributes)||{},s={},l={};for(const f in n){if(r[f])continue;const d=n[f].getValue();for(const p in d){const _=d[p];_ instanceof Ke?n[f].settings.isIndexed?e.setIndexBuffer(_):s[p]=_:_&&(l[p]=_)}}e.setAttributes(s),e.setConstantAttributes(l)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,s=i||r,l=s&&n.attributes&&n.attributes[s.id];if(l&&l.value){const u=l.value,f=this.encodePickingColor(e);for(let d=0;d<n.length;d++){const p=s.getVertexOffset(d);u[p]===f[0]&&u[p+1]===f[1]&&u[p+2]===f[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const s=r.getVertexOffset(e),l=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(l-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Cn.buffer&&(i.value=Cn.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){bt(!this.internalState),bt(Number.isFinite(this.props.coordinateSystem)),Ot(yU,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new _U({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(be.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new VB(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ot(wU,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ot(vU,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,s=i.viewport,l=this._updateUniformTransition();r.propsInTransition=l,i.viewport=r.viewport||s,this.props=l;try{const u=this._getUpdateParams(),f=this.getModels();if(i.device)this.updateState(u);else try{this.updateState(u)}catch{}for(const p of this.props.extensions)p.updateState.call(this,u,p);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==f[0];this._postUpdate(u,d)}finally{i.viewport=s,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Ot(EU,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:n=null,uniforms:i={},parameters:r={}}){this._updateAttributeTransition();const s=this.props,l=this.context;this.props=this.internalState.propsInTransition||s;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:u}=this.props,f=u&&u(i)||[0,0];l.device instanceof Yi&&l.device.setParametersWebGL({polygonOffset:f});for(const d of this.getModels())d.setParameters(r);if(l.device instanceof Yi)l.device.withParametersWebGL(r,()=>{const d={renderPass:e,shaderModuleProps:n,uniforms:i,parameters:r,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:n,uniforms:i,parameters:r,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)}}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let s=!1;switch(r){case"dataChanged":const l=e[r],u=n[r];l&&Array.isArray(u)&&(n.dataChanged=Array.isArray(l)?u.concat(l):l,s=!0);default:n[r]||(n[r]=e[r],s=!0)}s&&Ot(mU,this,r,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var r;const i=HB(e,n);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(r=e.transitions)==null?void 0:r[s]);return this.setChangeFlags(i)}validateProps(){WB(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.highlightColor=i(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new DB(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:u,highlightColor:f}=i;if(n||r.autoHighlight!==l||r.highlightedObjectIndex!==u||r.highlightColor!==f){const d={};Array.isArray(f)&&(d.highlightColor=f),(n||r.autoHighlight!==l||u!==r.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(u)&&u>=0?this.encodePickingColor(u):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;if(n=n||r,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}U_.defaultProps=xU;U_.layerName="Layer";const ts=U_,AU="compositeLayer.renderLayers";class Mx extends ts{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){var K;const{opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:l,highlightedObjectIndex:u,autoHighlight:f,highlightColor:d,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:y,positionFormat:E,modelMatrix:T,extensions:k,fetch:M,operation:b,_subLayerProps:w}=this.props,A={id:"",updateTriggers:{},opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:l,highlightedObjectIndex:u,autoHighlight:f,highlightColor:d,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:y,positionFormat:E,modelMatrix:T,extensions:k,fetch:M,operation:b},N=w&&e.id&&w[e.id],D=N&&N.updateTriggers,W=e.id||"sublayer";if(N){const x=this.props[rr],R=e.type?e.type._propTypes:{};for(const P in N){const U=R[P]||x[P];U&&U.type==="accessor"&&(N[P]=this.getSubLayerAccessor(N[P]))}}Object.assign(A,e,N),A.id=`${this.props.id}-${W}`,A.updateTriggers={all:(K=this.props.updateTriggers)==null?void 0:K.all,...e.updateTriggers,...D};for(const x of k){const R=x.getSubLayerProps.call(this,x);R&&Object.assign(A,R,{updateTriggers:Object.assign(A.updateTriggers,R.updateTriggers)})}return A}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const s=this.renderLayers();i=I_(s,Boolean),this.internalState.subLayers=i}Ot(AU,this,r,i);for(const s of i)s.parent=this}}Mx.layerName="CompositeLayer";const Ox=Mx;class Lx{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:n={}}=e;this.typedArrayManager=oo,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:r,geometryBuffer:s,positionFormat:l,dataChanged:u,normalize:f=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=s&&s.size||(l==="XY"?2:3),this.buffers=i,this.normalize=f,s&&(bt(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),f||(i.vertexPositions=s)),this.geometryBuffer=i.vertexPositions,Array.isArray(u))for(const d of u)this._rebuildGeometry(d);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?Ex(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:r,_attributeDefs:s,typedArrayManager:l}=this;for(const u in s)if(u in r)l.release(i[u]),i[u]=null;else{const f=s[u];f.copy=n,i[u]=l.allocate(i[u],e,f)}}_forEachGeometry(e,n,i){const{data:r,getGeometry:s}=this,{iterable:l,objectInfo:u}=kh(r,n,i);for(const f of l){u.index++;const d=s?s(f,u):null;e(d,u.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:r}=this;const{data:s,geometryBuffer:l}=this,{startRow:u=0,endRow:f=1/0}=e||{},d={};if(e||(n=[0],i=[0]),this.normalize||!l)this._forEachGeometry((_,y)=>{const E=_&&this.normalizeGeometry(_);d[y]=E,i[y+1]=i[y]+(E?this.getGeometrySize(E):0)},u,f),r=i[i.length-1];else if(i=s.startIndices,r=i[s.length]||0,ArrayBuffer.isView(l))r=r||l.length/this.positionSize;else if(l instanceof Ke){const _=this.positionSize*4;r=r||l.byteLength/_}else if(l.buffer){const _=l.stride||this.positionSize*4;r=r||l.buffer.byteLength/_}else if(l.value){const _=l.value,y=l.stride/_.BYTES_PER_ELEMENT||this.positionSize;r=r||_.length/y}this._allocate(r,!!e),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=r;const p={};this._forEachGeometry((_,y)=>{const E=d[y]||_;p.vertexStart=i[y],p.indexStart=n[y];const T=y<i.length-1?i[y+1]:r;p.geometrySize=T-i[y],p.geometryIndex=y,this.updateGeometryAttributes(E,p)},u,f),this.vertexCount=n[n.length-1]}}const bU=typeof window<"u"?re.useLayoutEffect:re.useEffect,RU=bU;function Lc(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const CU={position:"absolute",zIndex:-1};function Dx(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>Dx(n,e));if(Ih(t)){if(kU(t))return e.style=CU,re.cloneElement(t,e);if(IU(t))return re.cloneElement(t,e)}return t}function Ih(t){return t&&typeof t=="object"&&"type"in t||!1}function kU(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function IU(t){const e=t.type;return e&&e.deckGLViewProps}function tp(t){if(typeof t=="function")return re.createElement(lo,{},t);if(Array.isArray(t))return t.map(tp);if(Ih(t)){if(t.type===re.Fragment)return tp(t.props.children);if(Lc(t.type,lo))return t}return t}function PU({children:t,layers:e=[],views:n=null}){const i=[],r=[],s={};return re.Children.forEach(tp(t),l=>{if(Ih(l)){const u=l.type;if(Lc(u,ts)){const f=NU(u,l.props);r.push(f)}else i.push(l);if(Lc(u,lo)&&u!==lo&&l.props.id){const f=new u(l.props);s[f.id]=f}}else l&&i.push(l)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(l=>{s[l.id]=l}):n&&(s[n.id]=n),n=Object.values(s)),e=r.length>0?[...r,...e]:e,{layers:e,children:i,views:n}}function NU(t,e){const n={},i=t.defaultProps||{};for(const r in e)i[r]!==e[r]&&(n[r]=e[r]);return new t(n)}const MU=re.createContext();function OU({children:t,deck:e,ContextProvider:n=MU.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const r={},s=i.views[0].id;for(const l of t){let u=s,f=l;Ih(l)&&Lc(l.type,lo)&&(u=l.props.id||s,f=l.props.children);const d=i.getViewport(u),p=i.getViewState(u);if(d){p.padding=d.padding;const{x:_,y,width:E,height:T}=d;f=Dx(f,{x:_,y,width:E,height:T,viewport:d,viewState:p}),r[u]||(r[u]={viewport:d,children:[]}),r[u].children.push(f)}}return Object.keys(r).map(l=>{const{viewport:u,children:f}=r[l],{x:d,y:p,width:_,height:y}=u,E={position:"absolute",left:d,top:p,width:_,height:y},T=`view-${l}`,k=re.createElement("div",{key:T,id:T,style:E},...f),M={deck:e,viewport:u,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:w=>{w.viewId=l,e._onViewStateChange(w)},widgets:[]},b=`view-${l}-context`;return re.createElement(n,{key:b,value:M},k)})}const LU={mixBlendMode:null};function DU({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},r={left:0,top:0};if(n)for(const s in n)s in LU?r[s]=n[s]:i[s]=n[s];return{containerStyle:i,canvasStyle:r}}function FU(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function Fx(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function BU(t,e,n){const i=new e({...n,_customRender:r=>{t.redrawReason=r;const s=i.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():Fx(t)}});return i}function UU(t,e){const[n,i]=re.useState(0),s=re.useRef({control:null,version:n,forceUpdate:()=>i(D=>D+1)}).current,l=re.useRef(null),u=re.useRef(null),f=re.useMemo(()=>PU(t),[t.layers,t.views,t.children]);let d=!0;const p=D=>{var W;return d&&t.viewState?(s.viewStateUpdateRequested=D,null):(s.viewStateUpdateRequested=null,(W=t.onViewStateChange)==null?void 0:W.call(t,D))},_=D=>{var W;d?s.interactionStateUpdateRequested=D:(s.interactionStateUpdateRequested=null,(W=t.onInteractionStateChange)==null||W.call(t,D))},y=re.useMemo(()=>{const D={widgets:[],...t,style:null,width:"100%",height:"100%",parent:l.current,canvas:u.current,layers:f.layers,views:f.views,onViewStateChange:p,onInteractionStateChange:_};return delete D._customRender,s.deck&&s.deck.setProps(D),D},[t]);re.useEffect(()=>{const D=t.Deck||rB;return s.deck=BU(s,D,{...y,parent:l.current,canvas:u.current}),()=>{var W;return(W=s.deck)==null?void 0:W.finalize()}},[]),RU(()=>{Fx(s);const{viewStateUpdateRequested:D,interactionStateUpdateRequested:W}=s;D&&p(D),W&&_(W)}),re.useImperativeHandle(e,()=>FU(s),[]);const E=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:T,width:k="100%",height:M="100%",id:b,style:w}=t,{containerStyle:A,canvasStyle:N}=re.useMemo(()=>DU({width:k,height:M,style:w}),[k,M,w]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===E||s.version!==n){s.lastRenderedViewports=E,s.version=n;const D=OU({children:f.children,deck:s.deck,ContextProvider:T}),W=re.createElement("canvas",{key:"canvas",id:b||"deckgl-overlay",ref:u,style:N});s.control=re.createElement("div",{id:`${b||"deckgl"}-wrapper`,ref:l,style:A},[W,D])}return d=!1,s.control}const zU=re.forwardRef(UU),VU=zU,Z0=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,WU={name:"icon",vs:Z0,fs:Z0,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},HU=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,jU=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,$U=1024,XU=4,Q0=()=>{},J0={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},YU={x:0,y:0,width:0,height:0};function qU(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function KU(t,e,n,i){const r=Math.min(n/e.width,i/e.height),s=Math.floor(e.width*r),l=Math.floor(e.height*r);return r===1?{image:e,width:s,height:l}:(t.canvas.height=l,t.canvas.width=s,t.clearRect(0,0,s,l),t.drawImage(e,0,0,e.width,e.height,0,0,s,l),{image:t.canvas,width:s,height:l})}function ja(t){return t&&(t.id||t.url)}function GU(t,e,n,i){const{width:r,height:s,device:l}=t,u=l.createTexture({format:"rgba8unorm",width:e,height:n,sampler:i,mipmaps:!0}),f=l.createCommandEncoder();return f.copyTextureToTexture({sourceTexture:t,destinationTexture:u,width:r,height:s}),f.finish(),t.destroy(),u}function e1(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i],l=ja(r);t[l]={...r,x:s,y:n}}}function ZU({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:l}){let u=[];for(let f=0;f<t.length;f++){const d=t[f],p=ja(d);if(!n[p]){const{height:_,width:y}=d;i+y+e>l&&(e1(n,u,r),i=0,r=s+r+e,s=0,u=[]),u.push({icon:d,xOffset:i}),i=i+y+e,s=Math.max(s,_)}}return u.length>0&&e1(n,u,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:l,canvasHeight:qU(s+r+e)}}function QU(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=kh(t);for(const l of r){s.index++;const u=e(l,s),f=ja(u);if(!u)throw new Error("Icon is missing.");if(!u.url)throw new Error("Icon url is missing.");!i[f]&&(!n[f]||u.url!==n[f].url)&&(i[f]={...u,source:l,sourceIndex:s.index})}return i}class JU{constructor(e,{onUpdate:n=Q0,onError:i=Q0}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=XU,this._canvasWidth=$U,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?ja(e):e;return this._mapping[n]||YU}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:r,textureParameters:s}){var l;e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),r&&(this._mapping=r),i&&((l=this._texture)==null||l.delete(),this._texture=null,this._externalTexture=i),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(QU(e,n,this._mapping)||{});if(i.length>0){const{mapping:r,xOffset:s,yOffset:l,rowHeight:u,canvasHeight:f}=ZU({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=u,this._mapping=r,this._xOffset=s,this._yOffset=l,this._canvasHeight=f,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||J0,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=GU(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||J0)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,gc(i.url,this._loadOptions).then(r=>{var T;const s=ja(i),l=this._mapping[s],{x:u,y:f,width:d,height:p}=l,{image:_,width:y,height:E}=KU(n,r,d,p);(T=this._texture)==null||T.copyExternalImage({image:_,x:u+(d-y)/2,y:f+(p-E)/2,width:y,height:E}),l.width=y,l.height=E,this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const Bx=[0,0,0,255],e4={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:Bx},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class z_ extends ts{getShaders(){return super.getShaders({vs:HU,fs:jU,modules:[al,ll,WU]})}initializeState(){this.state={iconManager:new JU(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:Bx},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var E;super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:l,iconMapping:u,data:f,getIcon:d,textureParameters:p}=n,{iconManager:_}=this.state;if(typeof l=="string")return;const y=l||this.internalState.isAsyncPropLoading("iconAtlas");_.setProps({loadOptions:n.loadOptions,autoPacking:!y,iconAtlas:l,iconMapping:y?u:null,textureParameters:p}),y?i.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&_.packIcons(f,d),r.extensionsChanged&&((E=this.state.model)==null||E.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:l,alphaCutoff:u}=this.props,{iconManager:f}=this.state,d=f.getTexture();if(d){const p=this.state.model,_={iconsTexture:d,iconsTextureDim:[d.width,d.height],sizeUnits:$r[s],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,billboard:l,alphaCutoff:u};p.shaderInputs.setProps({icon:_}),p.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Un(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ao({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var i;const n=(i=this.getCurrentLayer())==null?void 0:i.props.onIconError;n?n(e):be.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:r=n/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-r,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:r,height:s}=this.state.iconManager.getIconMapping(e);return[n,i,r,s]}}z_.defaultProps=e4;z_.layerName="IconLayer";const Ux=z_,t1=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  bool filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,t4={name:"scatterplot",vs:t1,fs:t1,uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},n4=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,i4=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled == false) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,n1=[0,0,0,255],r4={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:n1},getLineColor:{type:"accessor",value:n1},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class V_ extends ts{getShaders(){return super.getShaders({vs:n4,fs:i4,modules:[al,ll,t4]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,stroked:l,filled:u,billboard:f,antialiasing:d,lineWidthUnits:p,lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:E}=this.props,T={stroked:l,filled:u,billboard:f,antialiasing:d,radiusUnits:$r[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:$r[p],lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:E},k=this.state.model;k.shaderInputs.setProps({scatterplot:T}),k.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Un(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ao({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}V_.defaultProps=r4;V_.layerName="ScatterplotLayer";const np=V_,zx={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Vx(t,e,n={}){return s4(t,n)!==e?(a4(t,n),!0):!1}function s4(t,e={}){return Math.sign(o4(t,e))}const i1={x:0,y:1,z:2};function o4(t,e={}){const{start:n=0,end:i=t.length,plane:r="xy"}=e,s=e.size||2;let l=0;const u=i1[r[0]],f=i1[r[1]];for(let d=n,p=i-s;d<i;d+=s)l+=(t[d+u]-t[p+u])*(t[d+f]+t[p+f]),p=d;return l/2}function a4(t,e){const{start:n=0,end:i=t.length,size:r=2}=e,s=(i-n)/r,l=Math.floor(s/2);for(let u=0;u<l;++u){const f=n+u*r,d=n+(s-1-u)*r;for(let p=0;p<r;++p){const _=t[f+p];t[f+p]=t[d+p],t[d+p]=_}}}function Dn(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function ip(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function $a(t,e,n,i,r=[]){const s=i+e*n;for(let l=0;l<n;l++)r[l]=t[s+l];return r}function rp(t,e,n,i,r=[]){let s,l;if(n&8)s=(i[3]-t[1])/(e[1]-t[1]),l=3;else if(n&4)s=(i[1]-t[1])/(e[1]-t[1]),l=1;else if(n&2)s=(i[2]-t[0])/(e[0]-t[0]),l=2;else if(n&1)s=(i[0]-t[0])/(e[0]-t[0]),l=0;else return null;for(let u=0;u<t.length;u++)r[u]=(l&1)===u?i[l]:s*(e[u]-t[u])+t[u];return r}function Nu(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function Wx(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:l=0,endIndex:u=t.length}=e||{},f=(u-l)/n;let d=[];const p=[d],_=$a(t,0,n,l);let y,E;const T=jx(_,r,s,[]),k=[];Dn(d,_);for(let M=1;M<f;M++){for(y=$a(t,M,n,l,y),E=Nu(y,T);E;){rp(_,y,E,T,k);const b=Nu(k,T);b&&(rp(_,k,b,T,k),E=b),Dn(d,k),ip(_,k),u4(T,r,E),i&&d.length>n&&(d=[],p.push(d),Dn(d,_)),E=Nu(y,T)}Dn(d,y),ip(_,y)}return i?p:p[0]}const r1=0,l4=1;function Hx(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:l=!1}=n||{},u=[],f=[{pos:t,types:l?new Array(t.length/i).fill(l4):null,holes:e||[]}],d=[[],[]];let p=[];for(;f.length;){const{pos:_,types:y,holes:E}=f.shift();c4(_,i,E[0]||_.length,d),p=jx(d[0],r,s,p);const T=Nu(d[1],p);if(T){let k=s1(_,y,i,0,E[0]||_.length,p,T);const M={pos:k[0].pos,types:k[0].types,holes:[]},b={pos:k[1].pos,types:k[1].types,holes:[]};f.push(M,b);for(let w=0;w<E.length;w++)k=s1(_,y,i,E[w],E[w+1]||_.length,p,T),k[0]&&(M.holes.push(M.pos.length),M.pos=tu(M.pos,k[0].pos),l&&(M.types=tu(M.types,k[0].types))),k[1]&&(b.holes.push(b.pos.length),b.pos=tu(b.pos,k[1].pos),l&&(b.types=tu(b.types,k[1].types)))}else{const k={positions:_};l&&(k.edgeTypes=y),E.length&&(k.holeIndices=E),u.push(k)}}return u}function s1(t,e,n,i,r,s,l){const u=(r-i)/n,f=[],d=[],p=[],_=[],y=[];let E,T,k;const M=$a(t,u-1,n,i);let b=Math.sign(l&8?M[1]-s[3]:M[0]-s[2]),w=e&&e[u-1],A=0,N=0;for(let D=0;D<u;D++)E=$a(t,D,n,i,E),T=Math.sign(l&8?E[1]-s[3]:E[0]-s[2]),k=e&&e[i/n+D],T&&b&&b!==T&&(rp(M,E,l,s,y),Dn(f,y)&&p.push(w),Dn(d,y)&&_.push(w)),T<=0?(Dn(f,E)&&p.push(k),A-=T):p.length&&(p[p.length-1]=r1),T>=0?(Dn(d,E)&&_.push(k),N+=T):_.length&&(_[_.length-1]=r1),ip(M,E),b=T,w=k;return[A?{pos:f,types:e&&p}:null,N?{pos:d,types:e&&_}:null]}function jx(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function u4(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function c4(t,e,n,i){let r=1/0,s=-1/0,l=1/0,u=-1/0;for(let f=0;f<n;f+=e){const d=t[f],p=t[f+1];r=d<r?d:r,s=d>s?d:s,l=p<l?p:l,u=p>u?p:u}return i[0][0]=r,i[0][1]=l,i[1][0]=s,i[1][1]=u,i}function tu(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}const h4=85.051129;function f4(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},l=t.slice(i,r);$x(l,n,0,r-i);const u=Wx(l,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const f of u)Xx(f,n);return u}function d4(t,e=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};e=e||[];const l=[],u=[];let f=0,d=0;for(let _=0;_<=e.length;_++){const y=e[_]||t.length,E=d,T=g4(t,i,f,y);for(let k=T;k<y;k++)l[d++]=t[k];for(let k=f;k<T;k++)l[d++]=t[k];$x(l,i,E,d),p4(l,i,E,d,n==null?void 0:n.maxLatitude),f=y,u[_]=d}u.pop();const p=Hx(l,u,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const _ of p)Xx(_.positions,i);return p}function g4(t,e,n,i){let r=-1,s=-1;for(let l=n+1;l<i;l+=e){const u=Math.abs(t[l]);u>r&&(r=u,s=l-1)}return s}function p4(t,e,n,i,r=h4){const s=t[n],l=t[i-e];if(Math.abs(s-l)>180){const u=$a(t,0,e,n);u[0]+=Math.round((l-s)/360)*360,Dn(t,u),u[1]=Math.sign(u[1])*r,Dn(t,u),u[0]=s,Dn(t,u)}}function $x(t,e,n,i){let r=t[0],s;for(let l=n;l<i;l+=e){s=t[l];const u=s-r;(u>180||u<-180)&&(s-=Math.round(u/360)*360),t[l]=r=s}}function Xx(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360===0);s++);const r=-Math.round(n/360)*360;if(r!==0)for(let s=0;s<i;s++)t[s*e]+=r}function _4(t,e,n,i){let r;if(Array.isArray(t[0])){const s=t.length*e;r=new Array(s);for(let l=0;l<t.length;l++)for(let u=0;u<e;u++)r[l*e+u]=t[l][u]||0}else r=t;return n?Wx(r,{size:e,gridResolution:n}):i?f4(r,{size:e}):r}const m4=1,y4=2,ad=4;class v4 extends Lx{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?_4(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(o1(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&o1(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:l}=n;i.fill(0,s,s+l),r?(i[s]=ad,i[s+l-2]=ad):(i[s]+=m4,i[s+l-2]+=y4),i[s+l-1]=ad}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:s}=n,l=new Array(3);for(let u=r,f=0;f<s;u++,f++)this.getPointOnPath(e,f,l),i[u*3]=l[0],i[u*3+1]=l[1],i[u*3+2]=l[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const s=n*r;return i[0]=e[s],i[1]=e[s+1],i[2]=r===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function o1(t){return Array.isArray(t[0])}const a1=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,E4={name:"path",vs:a1,fs:a1,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},w4=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,T4=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Yx=[0,0,0,255],S4={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:Yx},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},ld={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class W_ extends ts{getShaders(){return super.getShaders({vs:w4,fs:T4,modules:[al,ll,E4]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:ld,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:ld,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:ld,defaultValue:Yx},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:r,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,s)}}),this.setState({pathTesselator:new v4({fp64:this.use64bitPositions()})})}updateState(e){var l;super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:u}=this.state,f=n.data.attributes||{};u.updateGeometry({data:n.data,geometryBuffer:f.getPath,buffers:f,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:u.instanceCount,startIndices:u.vertexStarts}),i.dataChanged||r.invalidateAll()}i.extensionsChanged&&((l=this.state.model)==null||l.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,r=this.props.data;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:r,miterLimit:s,widthUnits:l,widthScale:u,widthMinPixels:f,widthMaxPixels:d}=this.props,p=this.state.model,_={jointType:Number(n),capType:Number(i),billboard:r,widthUnits:$r[l],widthScale:u,miterLimit:s,widthMinPixels:f,widthMaxPixels:d};p.shaderInputs.setProps({path:_}),p.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],n=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Un(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ao({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(n),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}W_.defaultProps=S4;W_.layerName="PathLayer";const x4=W_;var H_={exports:{}};H_.exports=Ph;H_.exports.default=Ph;function Ph(t,e,n){n=n||2;var i=e&&e.length,r=i?e[0]*n:t.length,s=qx(t,0,r,n,!0),l=[];if(!s||s.next===s.prev)return l;var u,f,d,p,_,y,E;if(i&&(s=k4(t,e,s,n)),t.length>80*n){u=d=t[0],f=p=t[1];for(var T=n;T<r;T+=n)_=t[T],y=t[T+1],_<u&&(u=_),y<f&&(f=y),_>d&&(d=_),y>p&&(p=y);E=Math.max(d-u,p-f),E=E!==0?32767/E:0}return Xa(s,l,n,u,f,E,0),l}function qx(t,e,n,i,r){var s,l;if(r===ap(t,e,n,i)>0)for(s=e;s<n;s+=i)l=l1(s,t[s],t[s+1],l);else for(s=n-i;s>=e;s-=i)l=l1(s,t[s],t[s+1],l);return l&&Nh(l,l.next)&&(qa(l),l=l.next),l}function Yr(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(Nh(n,n.next)||nt(n.prev,n,n.next)===0)){if(qa(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Xa(t,e,n,i,r,s,l){if(t){!l&&s&&O4(t,i,r,s);for(var u=t,f,d;t.prev!==t.next;){if(f=t.prev,d=t.next,s?b4(t,i,r,s):A4(t)){e.push(f.i/n|0),e.push(t.i/n|0),e.push(d.i/n|0),qa(t),t=d.next,u=d.next;continue}if(t=d,t===u){l?l===1?(t=R4(Yr(t),e,n),Xa(t,e,n,i,r,s,2)):l===2&&C4(t,e,n,i,r,s):Xa(Yr(t),e,n,i,r,s,1);break}}}}function A4(t){var e=t.prev,n=t,i=t.next;if(nt(e,n,i)>=0)return!1;for(var r=e.x,s=n.x,l=i.x,u=e.y,f=n.y,d=i.y,p=r<s?r<l?r:l:s<l?s:l,_=u<f?u<d?u:d:f<d?f:d,y=r>s?r>l?r:l:s>l?s:l,E=u>f?u>d?u:d:f>d?f:d,T=i.next;T!==e;){if(T.x>=p&&T.x<=y&&T.y>=_&&T.y<=E&&Ds(r,u,s,f,l,d,T.x,T.y)&&nt(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function b4(t,e,n,i){var r=t.prev,s=t,l=t.next;if(nt(r,s,l)>=0)return!1;for(var u=r.x,f=s.x,d=l.x,p=r.y,_=s.y,y=l.y,E=u<f?u<d?u:d:f<d?f:d,T=p<_?p<y?p:y:_<y?_:y,k=u>f?u>d?u:d:f>d?f:d,M=p>_?p>y?p:y:_>y?_:y,b=sp(E,T,e,n,i),w=sp(k,M,e,n,i),A=t.prevZ,N=t.nextZ;A&&A.z>=b&&N&&N.z<=w;){if(A.x>=E&&A.x<=k&&A.y>=T&&A.y<=M&&A!==r&&A!==l&&Ds(u,p,f,_,d,y,A.x,A.y)&&nt(A.prev,A,A.next)>=0||(A=A.prevZ,N.x>=E&&N.x<=k&&N.y>=T&&N.y<=M&&N!==r&&N!==l&&Ds(u,p,f,_,d,y,N.x,N.y)&&nt(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;A&&A.z>=b;){if(A.x>=E&&A.x<=k&&A.y>=T&&A.y<=M&&A!==r&&A!==l&&Ds(u,p,f,_,d,y,A.x,A.y)&&nt(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;N&&N.z<=w;){if(N.x>=E&&N.x<=k&&N.y>=T&&N.y<=M&&N!==r&&N!==l&&Ds(u,p,f,_,d,y,N.x,N.y)&&nt(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function R4(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!Nh(r,s)&&Kx(r,i,i.next,s)&&Ya(r,s)&&Ya(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),qa(i),qa(i.next),i=t=s),i=i.next}while(i!==t);return Yr(i)}function C4(t,e,n,i,r,s){var l=t;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&F4(l,u)){var f=Gx(l,u);l=Yr(l,l.next),f=Yr(f,f.next),Xa(l,e,n,i,r,s,0),Xa(f,e,n,i,r,s,0);return}u=u.next}l=l.next}while(l!==t)}function k4(t,e,n,i){var r=[],s,l,u,f,d;for(s=0,l=e.length;s<l;s++)u=e[s]*i,f=s<l-1?e[s+1]*i:t.length,d=qx(t,u,f,i,!1),d===d.next&&(d.steiner=!0),r.push(D4(d));for(r.sort(I4),s=0;s<r.length;s++)n=P4(r[s],n);return n}function I4(t,e){return t.x-e.x}function P4(t,e){var n=N4(t,e);if(!n)return e;var i=Gx(n,t);return Yr(i,i.next),Yr(n,n.next)}function N4(t,e){var n=e,i=t.x,r=t.y,s=-1/0,l;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var u=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=i&&u>s&&(s=u,l=n.x<n.next.x?n:n.next,u===i))return l}n=n.next}while(n!==e);if(!l)return null;var f=l,d=l.x,p=l.y,_=1/0,y;n=l;do i>=n.x&&n.x>=d&&i!==n.x&&Ds(r<p?i:s,r,d,p,r<p?s:i,r,n.x,n.y)&&(y=Math.abs(r-n.y)/(i-n.x),Ya(n,t)&&(y<_||y===_&&(n.x>l.x||n.x===l.x&&M4(l,n)))&&(l=n,_=y)),n=n.next;while(n!==f);return l}function M4(t,e){return nt(t.prev,t,e.prev)<0&&nt(e.next,t,t.next)<0}function O4(t,e,n,i){var r=t;do r.z===0&&(r.z=sp(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,L4(r)}function L4(t){var e,n,i,r,s,l,u,f,d=1;do{for(n=t,t=null,s=null,l=0;n;){for(l++,i=n,u=0,e=0;e<d&&(u++,i=i.nextZ,!!i);e++);for(f=d;u>0||f>0&&i;)u!==0&&(f===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,u--):(r=i,i=i.nextZ,f--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,d*=2}while(l>1);return t}function sp(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function D4(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Ds(t,e,n,i,r,s,l,u){return(r-l)*(e-u)>=(t-l)*(s-u)&&(t-l)*(i-u)>=(n-l)*(e-u)&&(n-l)*(s-u)>=(r-l)*(i-u)}function F4(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!B4(t,e)&&(Ya(t,e)&&Ya(e,t)&&U4(t,e)&&(nt(t.prev,t,e.prev)||nt(t,e.prev,e))||Nh(t,e)&&nt(t.prev,t,t.next)>0&&nt(e.prev,e,e.next)>0)}function nt(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Nh(t,e){return t.x===e.x&&t.y===e.y}function Kx(t,e,n,i){var r=iu(nt(t,e,n)),s=iu(nt(t,e,i)),l=iu(nt(n,i,t)),u=iu(nt(n,i,e));return!!(r!==s&&l!==u||r===0&&nu(t,n,e)||s===0&&nu(t,i,e)||l===0&&nu(n,t,i)||u===0&&nu(n,e,i))}function nu(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function iu(t){return t>0?1:t<0?-1:0}function B4(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Kx(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Ya(t,e){return nt(t.prev,t,t.next)<0?nt(t,e,t.next)>=0&&nt(t,t.prev,e)>=0:nt(t,e,t.prev)<0||nt(t,t.next,e)<0}function U4(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function Gx(t,e){var n=new op(t.i,t.x,t.y),i=new op(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function l1(t,e,n,i){var r=new op(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function qa(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function op(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ph.deviation=function(t,e,n,i){var r=e&&e.length,s=r?e[0]*n:t.length,l=Math.abs(ap(t,0,s,n));if(r)for(var u=0,f=e.length;u<f;u++){var d=e[u]*n,p=u<f-1?e[u+1]*n:t.length;l-=Math.abs(ap(t,d,p,n))}var _=0;for(u=0;u<i.length;u+=3){var y=i[u]*n,E=i[u+1]*n,T=i[u+2]*n;_+=Math.abs((t[y]-t[T])*(t[E+1]-t[y+1])-(t[y]-t[E])*(t[T+1]-t[y+1]))}return l===0&&_===0?0:Math.abs((_-l)/l)};function ap(t,e,n,i){for(var r=0,s=e,l=n-i;s<n;s+=i)r+=(t[l]-t[s])*(t[s+1]+t[l+1]),l=s;return r}Ph.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var l=0;l<e;l++)n.vertices.push(t[r][s][l]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n};var z4=H_.exports;const V4=vp(z4),ru=zx.CLOCKWISE,u1=zx.COUNTER_CLOCKWISE,qi={isClosed:!0};function W4(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function ea(t){return"positions"in t?t.positions:t}function Mu(t){return"holeIndices"in t?t.holeIndices:null}function H4(t){return Array.isArray(t[0])}function j4(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function $4(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function X4(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}function c1(t,e,n,i,r){let s=e;const l=n.length;for(let u=0;u<l;u++)for(let f=0;f<i;f++)t[s++]=n[u][f]||0;if(!$4(n))for(let u=0;u<i;u++)t[s++]=n[0][u]||0;return qi.start=e,qi.end=s,qi.size=i,Vx(t,r,qi),s}function h1(t,e,n,i,r=0,s,l){s=s||n.length;const u=s-r;if(u<=0)return e;let f=e;for(let d=0;d<u;d++)t[f++]=n[r+d];if(!X4(n,i,r,s))for(let d=0;d<i;d++)t[f++]=n[r+d];return qi.start=e,qi.end=f,qi.size=i,Vx(t,l,qi),f}function Y4(t,e){W4(t);const n=[],i=[];if("positions"in t){const{positions:r,holeIndices:s}=t;if(s){let l=0;for(let u=0;u<=s.length;u++)l=h1(n,l,r,e,s[u-1],s[u],u===0?ru:u1),i.push(l);return i.pop(),{positions:n,holeIndices:i}}t=r}if(!H4(t))return h1(n,0,t,e,0,n.length,ru),n;if(!j4(t)){let r=0;for(const[s,l]of t.entries())r=c1(n,r,l,e,s===0?ru:u1),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return c1(n,0,t,e,ru),n}function ud(t,e,n){const i=t.length/3;let r=0;for(let s=0;s<i;s++){const l=(s+1)%i;r+=t[s*3+e]*t[l*3+n],r-=t[l*3+e]*t[s*3+n]}return Math.abs(r/2)}function f1(t,e,n,i){const r=t.length/3;for(let s=0;s<r;s++){const l=s*3,u=t[l+0],f=t[l+1],d=t[l+2];t[l+e]=u,t[l+n]=f,t[l+i]=d}}function q4(t,e,n,i){let r=Mu(t);r&&(r=r.map(u=>u/e));let s=ea(t);const l=i&&e===3;if(n){const u=s.length;s=s.slice();const f=[];for(let d=0;d<u;d+=e){f[0]=s[d],f[1]=s[d+1],l&&(f[2]=s[d+2]);const p=n(f);s[d]=p[0],s[d+1]=p[1],l&&(s[d+2]=p[2])}}if(l){const u=ud(s,0,1),f=ud(s,0,2),d=ud(s,1,2);if(!u&&!f&&!d)return[];u>f&&u>d||(f>d?(n||(s=s.slice()),f1(s,0,2,1)):(n||(s=s.slice()),f1(s,2,0,1)))}return V4(s,r,e)}class K4 extends Lx{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=Y4(e,this.positionSize);return this.opts.resolution?Hx(ea(n),Mu(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?d4(ea(n),Mu(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(d1(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return ea(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&d1(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r,n.indexStart=this.indexStarts[n.geometryIndex+1]}else{const i=e;this._updateIndices(i,n),this._updatePositions(i,n),this._updateVertexValid(i,n)}}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:r}){const{attributes:s,indexStarts:l,typedArrayManager:u}=this;let f=s.indices;if(!f||!e)return;let d=r;const p=q4(e,this.positionSize,this.opts.preproject,this.opts.full3d);f=u.allocate(f,r+p.length,{copy:!0});for(let _=0;_<p.length;_++)f[d++]=p[_]+i;l[n+1]=r+p.length,s.indices=f}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!e)return;const l=ea(e);for(let u=n,f=0;f<i;u++,f++){const d=l[f*s],p=l[f*s+1],_=s>2?l[f*s+2]:0;r[u*3]=d,r[u*3+1]=p,r[u*3+2]=_}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:r}=this,s=this.attributes.vertexValid,l=e&&Mu(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+i),l)for(let u=0;u<l.length;u++)s[n+l[u]/r-1]=0;s[n+i-1]=0}}function d1(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const g1=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,G4={name:"solidPolygon",vs:g1,fs:g1,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},Zx=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Z4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${Zx}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,Q4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${Zx}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,J4=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Dc=[0,0,0,255],e6={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Dc},getLineColor:{type:"accessor",value:Dc},material:!0},su={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class j_ extends ts{getShaders(e){return super.getShaders({vs:e==="top"?Z4:Q4,fs:J4,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[al,RS,ll,G4]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:n}=this.props;const{_full3d:i}=this.props;e.isGeospatial&&n===Me.DEFAULT&&(n=Me.LNGLAT);let r;n===Me.LNGLAT&&(i?r=e.projectPosition.bind(e):r=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new K4({preproject:r,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),l=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:su,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,stepMode:"dynamic",transition:su,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:su,accessor:"getFillColor",defaultValue:Dc},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:su,accessor:"getLineColor",defaultValue:Dc},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(u,{index:f,target:d})=>this.encodePickingColor(u&&u.__source?u.__source.index:f,d)}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,r=this.props.data;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:r,elevationScale:s}=this.props,{topModel:l,sideModel:u,wireframeModel:f,polygonTesselator:d}=this.state,p={extruded:!!n,elevationScale:s,isWireframe:!1};f&&r&&(f.setInstanceCount(d.instanceCount-1),f.shaderInputs.setProps({solidPolygon:{...p,isWireframe:!0}}),f.draw(this.context.renderPass)),u&&i&&(u.setInstanceCount(d.instanceCount-1),u.shaderInputs.setProps({solidPolygon:p}),u.draw(this.context.renderPass)),l&&i&&(l.setVertexCount(d.vertexCount),l.shaderInputs.setProps({solidPolygon:p}),l.draw(this.context.renderPass))}updateState(e){var u;super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded)&&((u=this.state.models)==null||u.forEach(f=>f.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,l=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:l.getPolygon,buffers:l,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:n,extruded:i}=this.props;let r,s,l;if(n){const u=this.getShaders("top");u.defines.NON_INSTANCED_MODEL=1;const f=this.getAttributeManager().getBufferLayouts({isInstanced:!1});r=new Un(this.context.device,{...u,id:`${e}-top`,topology:"triangle-list",bufferLayout:f,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){const u=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new Un(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:u,geometry:new ao({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),l=new Un(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:u,geometry:new ao({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,l,r].filter(Boolean),topModel:r,sideModel:s,wireframeModel:l}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}j_.defaultProps=e6;j_.layerName="SolidPolygonLayer";const t6=j_;function n6({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,l=t.length;let u=l,f=l;for(let y=0;y<l;y++){const E=e(t[y]);if(u>y&&E>=r&&(u=y),E>=s){f=y;break}}let d=u;const _=f-u!==i.length?t.slice(f):void 0;for(let y=0;y<i.length;y++)t[d++]=i[y];if(_){for(let y=0;y<_.length;y++)t[d++]=_[y];t.length=d}return{startRow:u,endRow:u+i.length}}function i6(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?r6(t,i,n):null}function r6(t,e,n){const i={properties:{...t.properties[e]}};for(const r in t.numericProps)i.properties[r]=t.numericProps[r].value[n];return i}function s6(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(r.length*4);const s=[];for(let l=0;l<r.length;l++)e(r[l],s),n[i][l*4+0]=s[0],n[i][l*4+1]=s[1],n[i][l*4+2]=s[2],n[i][l*4+3]=255}return n}const p1=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,o6={name:"sdf",vs:p1,fs:p1,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},a6=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,cd=192/256,_1=[],l6={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class $_ extends Ux{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,o6],fs:a6}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(n,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:r}=n;r!==i.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!n.sdf&&n.outlineWidth&&be.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:n,smoothing:i,outlineWidth:r}=this.props,{outlineColor:s}=this.state,l=r?Math.max(i,cd*(1-r)):-1,u=this.state.model,f={buffer:cd,outlineBuffer:l,gamma:i,enabled:!!n,outlineColor:s};if(u.shaderInputs.setProps({sdf:f}),super.draw(e),n&&r){const{iconManager:d}=this.state;d.getTexture()&&(u.shaderInputs.setProps({sdf:{...f,outlineBuffer:cd}}),u.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):_1}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):_1}}$_.defaultProps=l6;$_.layerName="MultiIconLayer";const u6=$_,va=1e20;class c6{constructor({fontSize:e=24,buffer:n=3,radius:i=8,cutoff:r=.25,fontFamily:s="sans-serif",fontWeight:l="normal",fontStyle:u="normal"}={}){this.buffer=n,this.cutoff=r,this.radius=i;const f=this.size=e+n*4,d=this._createCanvas(f),p=this.ctx=d.getContext("2d",{willReadFrequently:!0});p.font=`${u} ${l} ${e}px ${s}`,p.textBaseline="alphabetic",p.textAlign="left",p.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:l}=this.ctx.measureText(e),u=Math.ceil(i),f=0,d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-s))),p=Math.min(this.size-this.buffer,u+Math.ceil(r)),_=d+2*this.buffer,y=p+2*this.buffer,E=Math.max(_*y,0),T=new Uint8ClampedArray(E),k={data:T,width:_,height:y,glyphWidth:d,glyphHeight:p,glyphTop:u,glyphLeft:f,glyphAdvance:n};if(d===0||p===0)return k;const{ctx:M,buffer:b,gridInner:w,gridOuter:A}=this;M.clearRect(b,b,d,p),M.fillText(e,b,b+u);const N=M.getImageData(b,b,d,p);A.fill(va,0,E),w.fill(0,0,E);for(let D=0;D<p;D++)for(let W=0;W<d;W++){const K=N.data[4*(D*d+W)+3]/255;if(K===0)continue;const x=(D+b)*_+W+b;if(K===1)A[x]=0,w[x]=va;else{const R=.5-K;A[x]=R>0?R*R:0,w[x]=R<0?R*R:0}}m1(A,0,0,_,y,_,this.f,this.v,this.z),m1(w,b,b,d,p,_,this.f,this.v,this.z);for(let D=0;D<E;D++){const W=Math.sqrt(A[D])-Math.sqrt(w[D]);T[D]=Math.round(255-255*(W/this.radius+this.cutoff))}return k}}function m1(t,e,n,i,r,s,l,u,f){for(let d=e;d<e+i;d++)y1(t,n*s+d,s,r,l,u,f);for(let d=n;d<n+r;d++)y1(t,d*s+e,1,i,l,u,f)}function y1(t,e,n,i,r,s,l){s[0]=0,l[0]=-va,l[1]=va,r[0]=t[e];for(let u=1,f=0,d=0;u<i;u++){r[u]=t[e+u*n];const p=u*u;do{const _=s[f];d=(r[u]-r[_]+p-_*_)/(u-_)/2}while(d<=l[f]&&--f>-1);f++,s[f]=u,l[f]=d,l[f+1]=va}for(let u=0,f=0;u<i;u++){for(;l[f+1]<u;)f++;const d=s[f],p=u-d;t[e+u*n]=r[d]+p*p}}const h6=32,f6=[];function d6(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function g6({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:l=0,yOffset:u=0}){let f=0,d=l;const p=n+i*2;for(const _ of t)if(!s[_]){const y=e(_);d+y+i*2>r&&(d=0,f++),s[_]={x:d+i,y:u+f*p+i,width:y,height:p,layoutWidth:y,layoutHeight:n},d+=y+i*2}return{mapping:s,xOffset:d,yOffset:u+f*p,canvasHeight:d6(u+(f+1)*p)}}function Qx(t,e,n,i){var s;let r=0;for(let l=e;l<n;l++){const u=t[l];r+=((s=i[u])==null?void 0:s.layoutWidth)||0}return r}function Jx(t,e,n,i,r,s){let l=e,u=0;for(let f=e;f<n;f++){const d=Qx(t,f,f+1,r);u+d>i&&(l<f&&s.push(f),l=f,u=0),u+=d}return u}function p6(t,e,n,i,r,s){let l=e,u=e,f=e,d=0;for(let p=e;p<n;p++)if((t[p]===" "||t[p+1]===" "||p+1===n)&&(f=p+1),f>u){let _=Qx(t,u,f,r);d+_>i&&(l<u&&(s.push(u),l=u,d=0),_>i&&(_=Jx(t,u,f,i,r,s),l=s[s.length-1])),u=f,d+=_}return d}function _6(t,e,n,i,r=0,s){s===void 0&&(s=t.length);const l=[];return e==="break-all"?Jx(t,r,s,n,i,l):p6(t,r,s,n,i,l),l}function m6(t,e,n,i,r,s){let l=0,u=0;for(let f=e;f<n;f++){const d=t[f],p=i[d];p?(u||(u=p.layoutHeight),r[f]=l+p.layoutWidth/2,l+=p.layoutWidth):(be.warn(`Missing character: ${d} (${d.codePointAt(0)})`)(),r[f]=l,l+=h6)}s[0]=l,s[1]=u}function y6(t,e,n,i,r){var M;const s=Array.from(t),l=s.length,u=new Array(l),f=new Array(l),d=new Array(l),p=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,_=[0,0],y=[0,0];let E=0,T=0,k=0;for(let b=0;b<=l;b++){const w=s[b];if((w===`
`||b===l)&&(k=b),k>T){const A=p?_6(s,n,i,r,T,k):f6;for(let N=0;N<=A.length;N++){const D=N===0?T:A[N-1],W=N<A.length?A[N]:k;m6(s,D,W,r,u,y);for(let K=D;K<W;K++){const x=s[K],R=((M=r[x])==null?void 0:M.layoutOffsetY)||0;f[K]=E+y[1]/2+R,d[K]=y[0]}E=E+y[1]*e,_[0]=Math.max(_[0],y[0])}T=k}w===`
`&&(u[T]=0,f[T]=0,d[T]=0,T++)}return _[1]=E,{x:u,y:f,rowWidth:d,size:_}}function v6({value:t,length:e,stride:n,offset:i,startIndices:r,characterSet:s}){const l=t.BYTES_PER_ELEMENT,u=n?n/l:1,f=i?i/l:0,d=r[e]||Math.ceil((t.length-f)/u),p=s&&new Set,_=new Array(e);let y=t;if(u>1||f>0){const E=t.constructor;y=new E(d);for(let T=0;T<d;T++)y[T]=t[T*u+f]}for(let E=0;E<e;E++){const T=r[E],k=r[E+1]||d,M=y.subarray(T,k);_[E]=String.fromCodePoint.apply(null,M),p&&M.forEach(p.add,p)}if(p)for(const E of p)s.add(String.fromCodePoint(E));return{texts:_,characterCount:d}}class eA{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function E6(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Xs={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:E6(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},v1=1024,E1=.9,w1=1.2,tA=3;let Fc=new eA(tA);function w6(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=Fc.get(t);if(!i)return n;for(const r in i.mapping)n.has(r)&&n.delete(r);return n}function T6(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function T1(t,e,n,i){t.font=`${i} ${n}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function S6(t){be.assert(Number.isFinite(t)&&t>=tA,"Invalid cache limit"),Fc=new eA(t)}class x6{constructor(){this.props={...Xs}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*w1+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=w6(this._key,this.props.characterSet),i=Fc.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}const r=this._generateFontAtlas(n,i);this._atlas=r,Fc.set(this._key,r)}_generateFontAtlas(e,n){const{fontFamily:i,fontWeight:r,fontSize:s,buffer:l,sdf:u,radius:f,cutoff:d}=this.props;let p=n&&n.data;p||(p=document.createElement("canvas"),p.width=v1);const _=p.getContext("2d",{willReadFrequently:!0});T1(_,i,s,r);const{mapping:y,canvasHeight:E,xOffset:T,yOffset:k}=g6({getFontWidth:M=>_.measureText(M).width,fontHeight:s*w1,buffer:l,characterSet:e,maxCanvasWidth:v1,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(p.height!==E){const M=_.getImageData(0,0,p.width,p.height);p.height=E,_.putImageData(M,0,0)}if(T1(_,i,s,r),u){const M=new c6({fontSize:s,buffer:l,radius:f,cutoff:d,fontFamily:i,fontWeight:`${r}`});for(const b of e){const{data:w,width:A,height:N,glyphTop:D}=M.draw(b);y[b].width=A,y[b].layoutOffsetY=s*E1-D;const W=_.createImageData(A,N);T6(w,W),_.putImageData(W,y[b].x,y[b].y)}}else for(const M of e)_.fillText(M,y[M].x,y[M].y+l+s*E1);return{xOffset:T,yOffset:k,mapping:y,data:p,width:p.width,height:p.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:r,sdf:s,radius:l,cutoff:u}=this.props;return s?`${e} ${n} ${i} ${r} ${l} ${u}`:`${e} ${n} ${i} ${r}`}}const S1=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,A6={name:"textBackground",vs:S1,fs:S1,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},b6=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,R6=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (textBackground.stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,C6={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class X_ extends ts{getShaders(){return super.getShaders({vs:b6,fs:R6,modules:[al,ll,A6]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e);const{changeFlags:n}=e;n.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:l,getLineWidth:u}=this.props;let{padding:f}=this.props;f.length<4&&(f=[f[0],f[1],f[0],f[1]]);const d=this.state.model,p={billboard:n,stroked:!!u,padding:f,sizeUnits:$r[r],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:l};d.shaderInputs.setProps({textBackground:p}),d.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Un(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ao({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}X_.defaultProps=C6;X_.layerName="TextBackgroundLayer";const k6=X_,x1={start:1,middle:0,end:-1},A1={top:1,center:0,bottom:-1},hd=[0,0,0,255],I6=1,P6={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:hd},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Xs.characterSet},fontFamily:Xs.fontFamily,fontWeight:Xs.fontWeight,lineHeight:I6,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:hd},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:hd},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Y_ extends Ox{constructor(){super(...arguments),this.getBoundingRect=(e,n)=>{let{size:[i,r]}=this.transformParagraph(e,n);const{fontSize:s}=this.state.fontAtlasManager.props;i/=s,r/=s;const{getTextAnchor:l,getAlignmentBaseline:u}=this.props,f=x1[typeof l=="function"?l(e,n):l],d=A1[typeof u=="function"?u(e,n):u];return[(f-1)*i/2,(d-1)*r/2,i,r]},this.getIconOffsets=(e,n)=>{const{getTextAnchor:i,getAlignmentBaseline:r}=this.props,{x:s,y:l,rowWidth:u,size:[f,d]}=this.transformParagraph(e,n),p=x1[typeof i=="function"?i(e,n):i],_=A1[typeof r=="function"?r(e,n):r],y=s.length,E=new Array(y*2);let T=0;for(let k=0;k<y;k++){const M=(1-p)*(f-u[k])/2;E[T++]=(p-1)*f/2+M+s[k],E[T++]=(_-1)*d/2+l[k]}return E}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new x6},this.props.maxWidth>0&&be.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,l={...e,characterSet:s,fontFamily:n,fontWeight:i};if(!r.mapping)return r.setProps(l),!0;for(const u in l)if(l[u]!==r.props[u])return r.setProps(l),!0;return!1}_updateText(){var f;const{data:e,characterSet:n}=this.props,i=(f=e.attributes)==null?void 0:f.getText;let{getText:r}=this.props,s=e.startIndices,l;const u=n==="auto"&&new Set;if(i&&s){const{texts:d,characterCount:p}=v6({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:s,characterSet:u});l=p,r=(_,{index:y})=>d[y]}else{const{iterable:d,objectInfo:p}=kh(e);s=[0],l=0;for(const _ of d){p.index++;const y=Array.from(r(_,p)||"");u&&y.forEach(u.add,u),l+=y.length,s.push(l)}}this.setState({getText:r,startIndices:s,numInstances:l,characterSet:u||n})}transformParagraph(e,n){const{fontAtlasManager:i}=this.state,r=i.mapping,s=this.state.getText,{wordBreak:l,lineHeight:u,maxWidth:f}=this.props,d=s(e,n)||"";return y6(d,u,l,f*i.props.fontSize,r)}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:r,atlas:s,mapping:l},styleVersion:u}=this.state,{data:f,_dataDiff:d,getPosition:p,getColor:_,getSize:y,getAngle:E,getPixelOffset:T,getBackgroundColor:k,getBorderColor:M,getBorderWidth:b,backgroundPadding:w,background:A,billboard:N,fontSettings:D,outlineWidth:W,outlineColor:K,sizeScale:x,sizeUnits:R,sizeMinPixels:P,sizeMaxPixels:U,transitions:F,updateTriggers:z}=this.props,B=this.getSubLayerClass("characters",u6),V=this.getSubLayerClass("background",k6);return[A&&new V({getFillColor:k,getLineColor:M,getLineWidth:b,padding:w,getPosition:p,getSize:y,getAngle:E,getPixelOffset:T,billboard:N,sizeScale:x,sizeUnits:R,sizeMinPixels:P,sizeMaxPixels:U,transitions:F&&{getPosition:F.getPosition,getAngle:F.getAngle,getSize:F.getSize,getFillColor:F.getBackgroundColor,getLineColor:F.getBorderColor,getLineWidth:F.getBorderWidth,getPixelOffset:F.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:z.getPosition,getAngle:z.getAngle,getSize:z.getSize,getFillColor:z.getBackgroundColor,getLineColor:z.getBorderColor,getLineWidth:z.getBorderWidth,getPixelOffset:z.getPixelOffset,getBoundingRect:{getText:z.getText,getTextAnchor:z.getTextAnchor,getAlignmentBaseline:z.getAlignmentBaseline,styleVersion:u}}}),{data:f.attributes&&f.attributes.background?{length:f.length,attributes:f.attributes.background}:f,_dataDiff:d,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new B({sdf:D.sdf,smoothing:Number.isFinite(D.smoothing)?D.smoothing:Xs.smoothing,outlineWidth:W/(D.radius||Xs.radius),outlineColor:K,iconAtlas:s,iconMapping:l,getPosition:p,getColor:_,getSize:y,getAngle:E,getPixelOffset:T,billboard:N,sizeScale:x*r,sizeUnits:R,sizeMinPixels:P*r,sizeMaxPixels:U*r,transitions:F&&{getPosition:F.getPosition,getAngle:F.getAngle,getColor:F.getColor,getSize:F.getSize,getPixelOffset:F.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:z.getText,getPosition:z.getPosition,getAngle:z.getAngle,getColor:z.getColor,getSize:z.getSize,getPixelOffset:z.getPixelOffset,getIconOffsets:{getTextAnchor:z.getTextAnchor,getAlignmentBaseline:z.getAlignmentBaseline,styleVersion:u}}}),{data:f,_dataDiff:d,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){S6(e)}}Y_.defaultProps=P6;Y_.layerName="TextLayer";const N6=Y_,Ou={circle:{type:np,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Ux,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:N6,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Lu={type:x4,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},lp={type:t6,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Ho({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function fd(t,e){const{transitions:n,updateTriggers:i}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const l=e[s];let u=t.props[s];s.startsWith("get")&&(u=t.getSubLayerAccessor(u),r.updateTriggers[l]=i[s],n&&(r.transitions[l]=n[s])),r[l]=u}return r}function M6(t){if(Array.isArray(t))return t;switch(be.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return be.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function b1(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=t.length}=n;for(let l=r;l<s;l++){const u=t[l],{geometry:f}=u;if(f)if(f.type==="GeometryCollection"){be.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");const{geometries:d}=f;for(let p=0;p<d.length;p++){const _=d[p];R1(_,i,e,u,l)}}else R1(f,i,e,u,l)}return i}function R1(t,e,n,i,r){const{type:s,coordinates:l}=t,{pointFeatures:u,lineFeatures:f,polygonFeatures:d,polygonOutlineFeatures:p}=e;if(!L6(s,l)){be.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":u.push(n({geometry:t},i,r));break;case"MultiPoint":l.forEach(_=>{u.push(n({geometry:{type:"Point",coordinates:_}},i,r))});break;case"LineString":f.push(n({geometry:t},i,r));break;case"MultiLineString":l.forEach(_=>{f.push(n({geometry:{type:"LineString",coordinates:_}},i,r))});break;case"Polygon":d.push(n({geometry:t},i,r)),l.forEach(_=>{p.push(n({geometry:{type:"LineString",coordinates:_}},i,r))});break;case"MultiPolygon":l.forEach(_=>{d.push(n({geometry:{type:"Polygon",coordinates:_}},i,r)),_.forEach(y=>{p.push(n({geometry:{type:"LineString",coordinates:y}},i,r))})});break}}const O6={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function L6(t,e){let n=O6[t];for(be.assert(n,`Unknown GeoJSON type ${t}`);e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function nA(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function ou(t){return t.geometry.coordinates}function D6(t,e){const n=nA(),{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:l}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=ou,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=ou,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=ou,n.polygonsOutline.data=l,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=ou,n}function F6(t,e){const n=nA(),{points:i,lines:r,polygons:s}=t,l=s6(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:l.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:4,value:l.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:4,value:l.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:l.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const B6=["points","linestrings","polygons"],U6={...Ho(Ou.circle),...Ho(Ou.icon),...Ho(Ou.text),...Ho(Lu),...Ho(lp),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class q_ extends Ox{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,r=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=F6(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=M6(e.data),r=this.getSubLayerRow.bind(this);let s={};const l={};if(Array.isArray(n.dataChanged)){const f=this.state.features;for(const d in f)s[d]=f[d].slice(),l[d]=[];for(const d of n.dataChanged){const p=b1(i,r,d);for(const _ in f)l[_].push(n6({data:s[_],getIndex:y=>y.__source.index,dataRange:d,replace:p[_]}))}}else s=b1(i,r);const u=D6(s,l);this.setState({features:s,featuresDiff:l,layerProps:u})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:r}=n;return n.featureType=B6.find(s=>r.id.startsWith(`${this.id}-${s}-`)),i>=0&&r.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n=`${this.id}-points-`,i=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(n)===i&&r.updateAutoHighlight(e)}_renderPolygonLayer(){var l;const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,(l=i.polygons)==null?void 0:l.data)&&this.getSubLayerClass(r,lp.type);if(s){const u=fd(this,lp.props),f=e&&n;return f||delete u.getLineColor,u.updateTriggers.lineColors=f,new s(u,this.getSubLayerProps({id:r,updateTriggers:u.updateTriggers}),i.polygons)}return null}_renderLineLayers(){var f,d;const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,r="polygons-stroke",s="linestrings",l=!e&&n&&this.shouldRenderSubLayer(r,(f=i.polygonsOutline)==null?void 0:f.data)&&this.getSubLayerClass(r,Lu.type),u=this.shouldRenderSubLayer(s,(d=i.lines)==null?void 0:d.data)&&this.getSubLayerClass(s,Lu.type);if(l||u){const p=fd(this,Lu.props);return[l&&new l(p,this.getSubLayerProps({id:r,updateTriggers:p.updateTriggers}),i.polygonsOutline),u&&new u(p,this.getSubLayerProps({id:s,updateTriggers:p.updateTriggers}),i.lines)]}return null}_renderPointLayers(){var u;const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=n.points.data.findIndex(f=>f.__source.index===r));const s=new Set(e.split("+")),l=[];for(const f of s){const d=`points-${f}`,p=Ou[f],_=p&&this.shouldRenderSubLayer(d,(u=n.points)==null?void 0:u.data)&&this.getSubLayerClass(d,p.type);if(_){const y=fd(this,p.props);let E=n.points;if(f==="text"&&i){const{instancePickingColors:T,...k}=E.data.attributes;E={...E,data:{...E.data,attributes:k}}}l.push(new _(y,this.getSubLayerProps({id:d,updateTriggers:y.updateTriggers,highlightedObjectIndex:r}),E))}}return l}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&n,i,r,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,r)=>{const{data:s,index:l}=r,u=i6(s,l);return e(u,r)}}}q_.layerName="GeoJsonLayer";q_.defaultProps=U6;const C1=q_,z6="modulepreload",V6=function(t,e){return new URL(t,e).href},k1={},W6=function(e,n,i){if(!n||n.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=V6(s,i),s in k1)return;k1[s]=!0;const l=s.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(!!i)for(let p=r.length-1;p>=0;p--){const _=r[p];if(_.href===s&&(!l||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${u}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":z6,l||(d.as="script",d.crossOrigin=""),d.href=s,document.head.appendChild(d),l)return new Promise((p,_)=>{d.addEventListener("load",p),d.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s})},H6=re.createContext(null);function j6(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===s}function gi(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!gi(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!gi(t[r],e[r]))return!1;return!0}return!1}function $6(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function I1(t,e){if(!t.getProjection)return;const n=t.getProjection(),i=e.getProjection();gi(n,i)||e.setProjection(n)}function P1(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function N1(t,e){const n=e.viewState||e;let i=!1;if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}if(n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),"longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}return i}const X6=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function M1(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let r=null;"interactive"in i&&(r=Object.assign({},i),delete r.interactive);const s=e[i.ref];if(s){r=r||Object.assign({},i),delete r.ref;for(const l of X6)l in s&&(r[l]=s[l])}return r||i});return{...t,layers:n}}const O1={version:8,sources:{},layers:[]},L1={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},dd={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},D1={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Y6=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],q6=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class co{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const s=this.props[D1[r.type]];s?s(r):r.type==="error"&&console.error(r.error)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const s=this.props[L1[r.type]];s&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),s(r),delete r.features)},this._onCameraEvent=r=>{if(!this._internalUpdate){const s=this.props[dd[r.type]];s&&s(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=co.savedMaps.pop();if(!i)return null;const r=i.map,s=r.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);r._container=n;const l=r._resizeObserver;l&&(l.disconnect(),l.observe(n)),i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:u}=e;return u&&(u.bounds?r.fitBounds(u.bounds,{...u.fitBoundsOptions,duration:0}):i._updateViewState(u,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),r._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=O1}=n,r={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||K6()||null,container:e,style:M1(i)},s=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const p=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=p,n.gl)}const l=new this._MapClass(r);s.padding&&l.setPadding(s.padding),n.cursor&&(l.getCanvas().style.cursor=n.cursor),this._createShadowTransform(l);const u=l._render;l._render=p=>{this._inRender=!0,u.call(l,p),this._inRender=!1};const f=l._renderTaskQueue.run;l._renderTaskQueue.run=p=>{f.call(l._renderTaskQueue,p),this._onBeforeRepaint()},l.on("render",()=>this._onAfterRepaint());const d=l.fire;l.fire=this._fireEvent.bind(this,d),l.on("resize",()=>{this._renderTransform.resize(l.transform.width,l.transform.height)}),l.on("styledata",()=>{this._updateStyleComponents(this.props,{}),I1(l.transform,this._renderTransform)}),l.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const p in L1)l.on(p,this._onPointerEvent);for(const p in dd)l.on(p,this._onCameraEvent);for(const p in D1)l.on(p,this._onEvent);this._map=l}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),co.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=$6(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:s,pitch:l,bearing:u}=r,f=i.isMoving();f&&(r.cameraElevationReference="sea");const d=N1(r,{...P1(i.transform),...e});if(f&&(r.cameraElevationReference="ground"),d&&n){const p=this._deferredEvents;p.move=!0,p.zoom||(p.zoom=s!==r.zoom),p.rotate||(p.rotate=u!==r.bearing),p.pitch||(p.pitch=l!==r.pitch)}return f||N1(i.transform,e),d}_updateSettings(e,n){const i=this._map;let r=!1;for(const s of Y6)if(s in e&&!gi(e[s],n[s])){r=!0;const l=i[`set${s[0].toUpperCase()}${s.slice(1)}`];l==null||l.call(i,e[s])}return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=O1,styleDiffing:r=!0}=e,s={diff:r};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(M1(i),s),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!gi(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!gi(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!gi(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){var i,r;const s=this._map;let l=!1;for(const u of q6){const f=(i=e[u])!==null&&i!==void 0?i:!0,d=(r=n[u])!==null&&r!==void 0?r:!0;gi(f,d)||(l=!0,f?s[u].enable(f):s[u].disable())}return l}_queryRenderedFeatures(e){const n=this._map,i=n.transform,{interactiveLayerIds:r=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:r.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=i}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const s=e.type,l=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,u=this._queryRenderedFeatures(e.point),f=u.length>0;!f&&l&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=u,f&&!l&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,s=r.transform,l=typeof n=="string"?n:n.type;return l==="move"&&this._updateViewState(this.props,!1),l in dd&&(typeof n=="object"&&(n.viewState=P1(s)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=s,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{I1(this._renderTransform,n),e.transform=n}}}co.savedMaps=[];function K6(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const G6=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Z6(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:i=>{const r=e.transform;e.transform=t.transform;const s=e.project(i);return e.transform=r,s},unproject:i=>{const r=e.transform;e.transform=t.transform;const s=e.unproject(i);return e.transform=r,s},queryTerrainElevation:(i,r)=>{const s=e.transform;e.transform=t.transform;const l=e.queryTerrainElevation(i,r);return e.transform=s,l},queryRenderedFeatures:(i,r)=>{const s=e.transform;e.transform=t.transform;const l=e.queryRenderedFeatures(i,r);return e.transform=s,l}};for(const i of Q6(e))!(i in n)&&!G6.includes(i)&&(n[i]=e[i].bind(e));return n}function Q6(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const J6=typeof document<"u"?re.useLayoutEffect:re.useEffect,ez=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function tz(t,e){for(const i of ez)i in e&&(t[i]=e[i]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,i=>{i&&console.error(i)},!0)}const Mh=re.createContext(null);function nz(t,e,n){const i=re.useContext(H6),[r,s]=re.useState(null),l=re.useRef(),{current:u}=re.useRef({mapLib:null,map:null});re.useEffect(()=>{const p=t.mapLib;let _=!0,y;return Promise.resolve(p||n).then(E=>{if(!_)return;if(!E)throw new Error("Invalid mapLib");const T="Map"in E?E:E.default;if(!T.Map)throw new Error("Invalid mapLib");if(tz(T,t),!T.supported||T.supported(t))t.reuseMaps&&(y=co.reuse(t,l.current)),y||(y=new co(T.Map,t,l.current)),u.map=Z6(y),u.mapLib=T,s(y),i==null||i.onMapMount(u.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(E=>{const{onError:T}=t;T?T({type:"error",target:null,originalEvent:null,error:E}):console.error(E)}),()=>{_=!1,y&&(i==null||i.onMapUnmount(t.id),t.reuseMaps?y.recycle():y.destroy())}},[]),J6(()=>{r&&r.setProps(t)}),re.useImperativeHandle(e,()=>u.map,[r]);const f=re.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),d={height:"100%"};return re.createElement("div",{id:t.id,ref:l,style:f},r&&re.createElement(Mh.Provider,{value:u},re.createElement("div",{"mapboxgl-children":"",style:d},t.children)))}const iz=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function ns(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!iz.test(i)?n[i]=`${r}px`:n[i]=r}}function rz(t,e){const{map:n,mapLib:i}=re.useContext(Mh),r=re.useRef({props:t});r.current.props=t;const s=re.useMemo(()=>{let k=!1;re.Children.forEach(t.children,w=>{w&&(k=!0)});const M={...t,element:k?document.createElement("div"):null},b=new i.Marker(M);return b.setLngLat([t.longitude,t.latitude]),b.getElement().addEventListener("click",w=>{var A,N;(N=(A=r.current.props).onClick)===null||N===void 0||N.call(A,{type:"click",target:b,originalEvent:w})}),b.on("dragstart",w=>{var A,N;const D=w;D.lngLat=s.getLngLat(),(N=(A=r.current.props).onDragStart)===null||N===void 0||N.call(A,D)}),b.on("drag",w=>{var A,N;const D=w;D.lngLat=s.getLngLat(),(N=(A=r.current.props).onDrag)===null||N===void 0||N.call(A,D)}),b.on("dragend",w=>{var A,N;const D=w;D.lngLat=s.getLngLat(),(N=(A=r.current.props).onDragEnd)===null||N===void 0||N.call(A,D)}),b},[]);re.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:l,latitude:u,offset:f,style:d,draggable:p=!1,popup:_=null,rotation:y=0,rotationAlignment:E="auto",pitchAlignment:T="auto"}=t;return re.useEffect(()=>{ns(s.getElement(),d)},[d]),re.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==l||s.getLngLat().lat!==u)&&s.setLngLat([l,u]),f&&!j6(s.getOffset(),f)&&s.setOffset(f),s.isDraggable()!==p&&s.setDraggable(p),s.getRotation()!==y&&s.setRotation(y),s.getRotationAlignment()!==E&&s.setRotationAlignment(E),s.getPitchAlignment()!==T&&s.setPitchAlignment(T),s.getPopup()!==_&&s.setPopup(_),g_.createPortal(t.children,s.getElement())}re.memo(re.forwardRef(rz));function F1(t){return new Set(t?t.trim().split(/\s+/):[])}function sz(t,e){const{map:n,mapLib:i}=re.useContext(Mh),r=re.useMemo(()=>document.createElement("div"),[]),s=re.useRef({props:t});s.current.props=t;const l=re.useMemo(()=>{const u={...t},f=new i.Popup(u);return f.setLngLat([t.longitude,t.latitude]),f.once("open",d=>{var p,_;(_=(p=s.current.props).onOpen)===null||_===void 0||_.call(p,d)}),f},[]);if(re.useEffect(()=>{const u=f=>{var d,p;(p=(d=s.current.props).onClose)===null||p===void 0||p.call(d,f)};return l.on("close",u),l.setDOMContent(r).addTo(n.getMap()),()=>{l.off("close",u),l.isOpen()&&l.remove()}},[]),re.useEffect(()=>{ns(l.getElement(),t.style)},[t.style]),re.useImperativeHandle(e,()=>l,[]),l.isOpen()&&((l.getLngLat().lng!==t.longitude||l.getLngLat().lat!==t.latitude)&&l.setLngLat([t.longitude,t.latitude]),t.offset&&!gi(l.options.offset,t.offset)&&l.setOffset(t.offset),(l.options.anchor!==t.anchor||l.options.maxWidth!==t.maxWidth)&&(l.options.anchor=t.anchor,l.setMaxWidth(t.maxWidth)),l.options.className!==t.className)){const u=F1(l.options.className),f=F1(t.className);for(const d of u)f.has(d)||l.removeClassName(d);for(const d of f)u.has(d)||l.addClassName(d);l.options.className=t.className}return g_.createPortal(t.children,r)}re.memo(re.forwardRef(sz));function ul(t,e,n,i){const r=re.useContext(Mh),s=re.useMemo(()=>t(r),[]);return re.useEffect(()=>{const l=i||n||e,u=typeof e=="function"&&typeof n=="function"?e:null,f=typeof n=="function"?n:typeof e=="function"?e:null,{map:d}=r;return d.hasControl(s)||(d.addControl(s,l==null?void 0:l.position),u&&u(r)),()=>{f&&f(r),d.hasControl(s)&&d.removeControl(s)}},[]),s}function oz(t){const e=ul(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return re.useEffect(()=>{ns(e._container,t.style)},[t.style]),null}re.memo(oz);function az(t){const e=ul(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return re.useEffect(()=>{ns(e._controlContainer,t.style)},[t.style]),null}re.memo(az);function lz(t,e){const n=re.useRef({props:t}),i=ul(({mapLib:r})=>{const s=new r.GeolocateControl(t),l=s._setupUI;return s._setupUI=u=>{s._container.hasChildNodes()||l(u)},s.on("geolocate",u=>{var f,d;(d=(f=n.current.props).onGeolocate)===null||d===void 0||d.call(f,u)}),s.on("error",u=>{var f,d;(d=(f=n.current.props).onError)===null||d===void 0||d.call(f,u)}),s.on("outofmaxbounds",u=>{var f,d;(d=(f=n.current.props).onOutOfMaxBounds)===null||d===void 0||d.call(f,u)}),s.on("trackuserlocationstart",u=>{var f,d;(d=(f=n.current.props).onTrackUserLocationStart)===null||d===void 0||d.call(f,u)}),s.on("trackuserlocationend",u=>{var f,d;(d=(f=n.current.props).onTrackUserLocationEnd)===null||d===void 0||d.call(f,u)}),s},{position:t.position});return n.current.props=t,re.useImperativeHandle(e,()=>i,[]),re.useEffect(()=>{ns(i._container,t.style)},[t.style]),null}re.memo(re.forwardRef(lz));function uz(t){const e=ul(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return re.useEffect(()=>{ns(e._container,t.style)},[t.style]),null}re.memo(uz);function cz(t){const e=ul(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=re.useRef(t),i=n.current;n.current=t;const{style:r}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),re.useEffect(()=>{ns(e._container,r)},[r]),null}re.memo(cz);const hz=W6(()=>import("./maplibre-gl-92bfe0bd.js").then(t=>t.m),[],import.meta.url),fz=(()=>re.forwardRef(function(e,n){return nz(e,n,hz)}))();var Ht=63710088e-1,iA={centimeters:Ht*100,centimetres:Ht*100,degrees:360/(2*Math.PI),feet:Ht*3.28084,inches:Ht*39.37,kilometers:Ht/1e3,kilometres:Ht/1e3,meters:Ht,metres:Ht,miles:Ht/1609.344,millimeters:Ht*1e3,millimetres:Ht*1e3,nauticalmiles:Ht/1852,radians:1,yards:Ht*1.0936};function Oh(t,e,n={}){const i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=e||{},i.geometry=t,i}function ta(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!B1(t[0])||!B1(t[1]))throw new Error("coordinates must contain numbers");return Oh({type:"Point",coordinates:t},e,n)}function dz(t,e,n={}){for(const r of t){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let s=0;s<r[r.length-1].length;s++)if(r[r.length-1][s]!==r[0][s])throw new Error("First and last Position are not equivalent.")}return Oh({type:"Polygon",coordinates:t},e,n)}function Ka(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function gz(t,e,n={}){return Oh({type:"MultiPolygon",coordinates:t},e,n)}function pz(t,e="kilometers"){const n=iA[e];if(!n)throw new Error(e+" units is invalid");return t*n}function _z(t,e="kilometers"){const n=iA[e];if(!n)throw new Error(e+" units is invalid");return t/n}function B1(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function mz(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function yz(t){return t.type==="Feature"?t.geometry:t}function rA(t,e,n){if(t!==null)for(var i,r,s,l,u,f,d,p=0,_=0,y,E=t.type,T=E==="FeatureCollection",k=E==="Feature",M=T?t.features.length:1,b=0;b<M;b++){d=T?t.features[b].geometry:k?t.geometry:t,y=d?d.type==="GeometryCollection":!1,u=y?d.geometries.length:1;for(var w=0;w<u;w++){var A=0,N=0;if(l=y?d.geometries[w]:d,l!==null){f=l.coordinates;var D=l.type;switch(p=n&&(D==="Polygon"||D==="MultiPolygon")?1:0,D){case null:break;case"Point":if(e(f,_,b,A,N)===!1)return!1;_++,A++;break;case"LineString":case"MultiPoint":for(i=0;i<f.length;i++){if(e(f[i],_,b,A,N)===!1)return!1;_++,D==="MultiPoint"&&A++}D==="LineString"&&A++;break;case"Polygon":case"MultiLineString":for(i=0;i<f.length;i++){for(r=0;r<f[i].length-p;r++){if(e(f[i][r],_,b,A,N)===!1)return!1;_++}D==="MultiLineString"&&A++,D==="Polygon"&&N++}D==="Polygon"&&A++;break;case"MultiPolygon":for(i=0;i<f.length;i++){for(N=0,r=0;r<f[i].length;r++){for(s=0;s<f[i][r].length-p;s++){if(e(f[i][r][s],_,b,A,N)===!1)return!1;_++}N++}A++}break;case"GeometryCollection":for(i=0;i<l.geometries.length;i++)if(rA(l.geometries[i],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function vz(t,e={}){if(t.bbox!=null&&e.recompute!==!0)return t.bbox;const n=[1/0,1/0,-1/0,-1/0];return rA(t,i=>{n[0]>i[0]&&(n[0]=i[0]),n[1]>i[1]&&(n[1]=i[1]),n[2]<i[0]&&(n[2]=i[0]),n[3]<i[1]&&(n[3]=i[1])}),n}const vi=11102230246251565e-32,Mt=134217729,Ez=(3+8*vi)*vi;function gd(t,e,n,i,r){let s,l,u,f,d=e[0],p=i[0],_=0,y=0;p>d==p>-d?(s=d,d=e[++_]):(s=p,p=i[++y]);let E=0;if(_<t&&y<n)for(p>d==p>-d?(l=d+s,u=s-(l-d),d=e[++_]):(l=p+s,u=s-(l-p),p=i[++y]),s=l,u!==0&&(r[E++]=u);_<t&&y<n;)p>d==p>-d?(l=s+d,f=l-s,u=s-(l-f)+(d-f),d=e[++_]):(l=s+p,f=l-s,u=s-(l-f)+(p-f),p=i[++y]),s=l,u!==0&&(r[E++]=u);for(;_<t;)l=s+d,f=l-s,u=s-(l-f)+(d-f),d=e[++_],s=l,u!==0&&(r[E++]=u);for(;y<n;)l=s+p,f=l-s,u=s-(l-f)+(p-f),p=i[++y],s=l,u!==0&&(r[E++]=u);return(s!==0||E===0)&&(r[E++]=s),E}function wz(t,e){let n=e[0];for(let i=1;i<t;i++)n+=e[i];return n}function cl(t){return new Float64Array(t)}const Tz=(3+16*vi)*vi,Sz=(2+12*vi)*vi,xz=(9+64*vi)*vi*vi,ms=cl(4),U1=cl(8),z1=cl(12),V1=cl(16),Bt=cl(4);function Az(t,e,n,i,r,s,l){let u,f,d,p,_,y,E,T,k,M,b,w,A,N,D,W,K,x;const R=t-r,P=n-r,U=e-s,F=i-s;N=R*F,y=Mt*R,E=y-(y-R),T=R-E,y=Mt*F,k=y-(y-F),M=F-k,D=T*M-(N-E*k-T*k-E*M),W=U*P,y=Mt*U,E=y-(y-U),T=U-E,y=Mt*P,k=y-(y-P),M=P-k,K=T*M-(W-E*k-T*k-E*M),b=D-K,_=D-b,ms[0]=D-(b+_)+(_-K),w=N+b,_=w-N,A=N-(w-_)+(b-_),b=A-W,_=A-b,ms[1]=A-(b+_)+(_-W),x=w+b,_=x-w,ms[2]=w-(x-_)+(b-_),ms[3]=x;let z=wz(4,ms),B=Sz*l;if(z>=B||-z>=B||(_=t-R,u=t-(R+_)+(_-r),_=n-P,d=n-(P+_)+(_-r),_=e-U,f=e-(U+_)+(_-s),_=i-F,p=i-(F+_)+(_-s),u===0&&f===0&&d===0&&p===0)||(B=xz*l+Ez*Math.abs(z),z+=R*p+F*u-(U*d+P*f),z>=B||-z>=B))return z;N=u*F,y=Mt*u,E=y-(y-u),T=u-E,y=Mt*F,k=y-(y-F),M=F-k,D=T*M-(N-E*k-T*k-E*M),W=f*P,y=Mt*f,E=y-(y-f),T=f-E,y=Mt*P,k=y-(y-P),M=P-k,K=T*M-(W-E*k-T*k-E*M),b=D-K,_=D-b,Bt[0]=D-(b+_)+(_-K),w=N+b,_=w-N,A=N-(w-_)+(b-_),b=A-W,_=A-b,Bt[1]=A-(b+_)+(_-W),x=w+b,_=x-w,Bt[2]=w-(x-_)+(b-_),Bt[3]=x;const V=gd(4,ms,4,Bt,U1);N=R*p,y=Mt*R,E=y-(y-R),T=R-E,y=Mt*p,k=y-(y-p),M=p-k,D=T*M-(N-E*k-T*k-E*M),W=U*d,y=Mt*U,E=y-(y-U),T=U-E,y=Mt*d,k=y-(y-d),M=d-k,K=T*M-(W-E*k-T*k-E*M),b=D-K,_=D-b,Bt[0]=D-(b+_)+(_-K),w=N+b,_=w-N,A=N-(w-_)+(b-_),b=A-W,_=A-b,Bt[1]=A-(b+_)+(_-W),x=w+b,_=x-w,Bt[2]=w-(x-_)+(b-_),Bt[3]=x;const $=gd(V,U1,4,Bt,z1);N=u*p,y=Mt*u,E=y-(y-u),T=u-E,y=Mt*p,k=y-(y-p),M=p-k,D=T*M-(N-E*k-T*k-E*M),W=f*d,y=Mt*f,E=y-(y-f),T=f-E,y=Mt*d,k=y-(y-d),M=d-k,K=T*M-(W-E*k-T*k-E*M),b=D-K,_=D-b,Bt[0]=D-(b+_)+(_-K),w=N+b,_=w-N,A=N-(w-_)+(b-_),b=A-W,_=A-b,Bt[1]=A-(b+_)+(_-W),x=w+b,_=x-w,Bt[2]=w-(x-_)+(b-_),Bt[3]=x;const G=gd($,z1,4,Bt,V1);return V1[G-1]}function bz(t,e,n,i,r,s){const l=(e-s)*(n-r),u=(t-r)*(i-s),f=l-u,d=Math.abs(l+u);return Math.abs(f)>=Tz*d?f:-Az(t,e,n,i,r,s,d)}function Rz(t,e){var n,i,r=0,s,l,u,f,d,p,_,y=t[0],E=t[1],T=e.length;for(n=0;n<T;n++){i=0;var k=e[n],M=k.length-1;if(p=k[0],p[0]!==k[M][0]&&p[1]!==k[M][1])throw new Error("First and last coordinates in a ring must be the same");for(l=p[0]-y,u=p[1]-E,i;i<M;i++){if(_=k[i+1],f=_[0]-y,d=_[1]-E,u===0&&d===0){if(f<=0&&l>=0||l<=0&&f>=0)return 0}else if(d>=0&&u<=0||d<=0&&u>=0){if(s=bz(l,f,u,d,0,0),s===0)return 0;(s>0&&d>0&&u<=0||s<0&&d<=0&&u>0)&&r++}p=_,u=d,l=f}}return r%2!==0}function au(t,e,n={}){if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");const i=mz(t),r=yz(e),s=r.type,l=e.bbox;let u=r.coordinates;if(l&&Cz(i,l)===!1)return!1;s==="Polygon"&&(u=[u]);let f=!1;for(var d=0;d<u.length;++d){const p=Rz(i,u[d]);if(p===0)return!n.ignoreBoundary;p&&(f=!0)}return f}function Cz(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function kz(t,e={}){const n=vz(t),i=(n[0]+n[2])/2,r=(n[1]+n[3])/2;return ta([i,r],e.properties,e)}var sA={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(Db,function(){function n(h,o){(o==null||o>h.length)&&(o=h.length);for(var a=0,c=Array(o);a<o;a++)c[a]=h[a];return c}function i(h,o,a){return o=p(o),function(c,g){if(g&&(typeof g=="object"||typeof g=="function"))return g;if(g!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(m){if(m===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m}(c)}(h,y()?Reflect.construct(o,a||[],p(h).constructor):o.apply(h,a))}function r(h,o){if(!(h instanceof o))throw new TypeError("Cannot call a class as a function")}function s(h,o,a){if(y())return Reflect.construct.apply(null,arguments);var c=[null];c.push.apply(c,o);var g=new(h.bind.apply(h,c));return a&&E(g,a.prototype),g}function l(h,o){for(var a=0;a<o.length;a++){var c=o[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(h,M(c.key),c)}}function u(h,o,a){return o&&l(h.prototype,o),a&&l(h,a),Object.defineProperty(h,"prototype",{writable:!1}),h}function f(h,o){var a=typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(!a){if(Array.isArray(h)||(a=b(h))||o){a&&(h=a);var c=0,g=function(){};return{s:g,n:function(){return c>=h.length?{done:!0}:{done:!1,value:h[c++]}},e:function(I){throw I},f:g}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var m,v=!0,S=!1;return{s:function(){a=a.call(h)},n:function(){var I=a.next();return v=I.done,I},e:function(I){S=!0,m=I},f:function(){try{v||a.return==null||a.return()}finally{if(S)throw m}}}}function d(){return d=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(h,o,a){var c=function(m,v){for(;!{}.hasOwnProperty.call(m,v)&&(m=p(m))!==null;);return m}(h,o);if(c){var g=Object.getOwnPropertyDescriptor(c,o);return g.get?g.get.call(arguments.length<3?h:a):g.value}},d.apply(null,arguments)}function p(h){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},p(h)}function _(h,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(o&&o.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),o&&E(h,o)}function y(){try{var h=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(y=function(){return!!h})()}function E(h,o){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,c){return a.__proto__=c,a},E(h,o)}function T(h,o,a,c){var g=d(p(1&c?h.prototype:h),o,a);return 2&c&&typeof g=="function"?function(m){return g.apply(a,m)}:g}function k(h){return function(o){if(Array.isArray(o))return n(o)}(h)||function(o){if(typeof Symbol<"u"&&o[Symbol.iterator]!=null||o["@@iterator"]!=null)return Array.from(o)}(h)||b(h)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function M(h){var o=function(a,c){if(typeof a!="object"||!a)return a;var g=a[Symbol.toPrimitive];if(g!==void 0){var m=g.call(a,c);if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(h,"string");return typeof o=="symbol"?o:o+""}function b(h,o){if(h){if(typeof h=="string")return n(h,o);var a={}.toString.call(h).slice(8,-1);return a==="Object"&&h.constructor&&(a=h.constructor.name),a==="Map"||a==="Set"?Array.from(h):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(h,o):void 0}}function w(h){var o=typeof Map=="function"?new Map:void 0;return w=function(a){if(a===null||!function(g){try{return Function.toString.call(g).indexOf("[native code]")!==-1}catch{return typeof g=="function"}}(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(a))return o.get(a);o.set(a,c)}function c(){return s(a,arguments,p(this).constructor)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),E(c,a)},w(h)}var A=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(o){this._quadrantSegments=o,this._quadrantSegments===0&&(this._joinStyle=h.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=h.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),o<=0&&(this._quadrantSegments=1),this._joinStyle!==h.JOIN_ROUND&&(this._quadrantSegments=h.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(o){this._joinStyle=o}},{key:"setSimplifyFactor",value:function(o){this._simplifyFactor=o<0?0:o}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(o){this._endCapStyle=o}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(o){this._mitreLimit=o}},{key:"setSingleSided",value:function(o){this._isSingleSided=o}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=h.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=h.CAP_ROUND,this._joinStyle=h.JOIN_ROUND,this._mitreLimit=h.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=h.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var o=arguments[0];this.setQuadrantSegments(o)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.setQuadrantSegments(a),this.setEndCapStyle(c)}else if(arguments.length===4){var g=arguments[0],m=arguments[1],v=arguments[2],S=arguments[3];this.setQuadrantSegments(g),this.setEndCapStyle(m),this.setJoinStyle(v),this.setMitreLimit(S)}}}},{key:"bufferDistanceError",value:function(o){var a=Math.PI/2/o;return 1-Math.cos(a/2)}}])}();A.CAP_ROUND=1,A.CAP_FLAT=2,A.CAP_SQUARE=3,A.JOIN_ROUND=1,A.JOIN_MITRE=2,A.JOIN_BEVEL=3,A.DEFAULT_QUADRANT_SEGMENTS=8,A.DEFAULT_MITRE_LIMIT=5,A.DEFAULT_SIMPLIFY_FACTOR=.01;var N=function(h){function o(a){var c;return r(this,o),(c=i(this,o,[a])).name=Object.keys({Exception:o})[0],c}return _(o,h),u(o,[{key:"toString",value:function(){return this.message}}])}(w(Error)),D=function(h){function o(a){var c;return r(this,o),(c=i(this,o,[a])).name=Object.keys({IllegalArgumentException:o})[0],c}return _(o,h),u(o)}(N),W=function(){return u(function h(){r(this,h)},[{key:"filter",value:function(h){}}])}();function K(){}function x(){}function R(){}var P,U,F,z,B,V,$,G,H=function(){return u(function h(){r(this,h)},null,[{key:"equalsWithTolerance",value:function(h,o,a){return Math.abs(h-o)<=a}}])}(),Z=function(){return u(function h(o,a){r(this,h),this.low=a||0,this.high=o||0},null,[{key:"toBinaryString",value:function(h){var o,a="";for(o=2147483648;o>0;o>>>=1)a+=(h.high&o)===o?"1":"0";for(o=2147483648;o>0;o>>>=1)a+=(h.low&o)===o?"1":"0";return a}}])}();function te(){}function ie(){}te.NaN=NaN,te.isNaN=function(h){return Number.isNaN(h)},te.isInfinite=function(h){return!Number.isFinite(h)},te.MAX_VALUE=Number.MAX_VALUE,te.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,te.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(V=2146435072,$=new Float64Array(1),G=new Int32Array($.buffer),te.doubleToLongBits=function(h){$[0]=h;var o=0|G[0],a=0|G[1];return(a&V)===V&&1048575&a&&o!==0&&(o=0,a=2146959360),new Z(a,o)},te.longBitsToDouble=function(h){return G[0]=h.low,G[1]=h.high,$[0]}):(P=1023,U=Math.log2,F=Math.floor,z=Math.pow,B=function(){for(var h=53;h>0;h--){var o=z(2,h)-1;if(F(U(o))+1===h)return o}return 0}(),te.doubleToLongBits=function(h){var o,a,c,g,m,v,S,I,L;if(h<0||1/h===Number.NEGATIVE_INFINITY?(v=1<<31,h=-h):v=0,h===0)return new Z(I=v,L=0);if(h===1/0)return new Z(I=2146435072|v,L=0);if(h!=h)return new Z(I=2146959360,L=0);if(g=0,L=0,(o=F(h))>1)if(o<=B)(g=F(U(o)))<=20?(L=0,I=o<<20-g&1048575):(L=o%(a=z(2,c=g-20))<<32-c,I=o/a&1048575);else for(c=o,L=0;(c=F(a=c/2))!==0;)g++,L>>>=1,L|=(1&I)<<31,I>>>=1,a!==c&&(I|=524288);if(S=g+P,m=o===0,o=h-o,g<52&&o!==0)for(c=0;;){if((a=2*o)>=1?(o=a-1,m?(S--,m=!1):(c<<=1,c|=1,g++)):(o=a,m?--S==0&&(g++,m=!1):(c<<=1,g++)),g===20)I|=c,c=0;else if(g===52){L|=c;break}if(a===1){g<20?I|=c<<20-g:g<52&&(L|=c<<52-g);break}}return I|=S<<20,new Z(I|=v,L)},te.longBitsToDouble=function(h){var o,a,c,g,m=h.high,v=h.low,S=m&1<<31?-1:1;for(c=((2146435072&m)>>20)-P,g=0,a=1<<19,o=1;o<=20;o++)m&a&&(g+=z(2,-o)),a>>>=1;for(a=1<<31,o=21;o<=52;o++)v&a&&(g+=z(2,-o)),a>>>=1;if(c===-1023){if(g===0)return 0*S;c=-1022}else{if(c===1024)return g===0?S/0:NaN;g+=1}return S*g*z(2,c)});var ce=function(h){function o(a){var c;return r(this,o),(c=i(this,o,[a])).name=Object.keys({RuntimeException:o})[0],c}return _(o,h),u(o)}(N),Ee=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,null,[{key:"constructor_",value:function(){if(arguments.length===0)ce.constructor_.call(this);else if(arguments.length===1){var a=arguments[0];ce.constructor_.call(this,a)}}}])}(ce),he=function(){function h(){r(this,h)}return u(h,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)h.shouldNeverReachHere(null);else if(arguments.length===1){var o=arguments[0];throw new Ee("Should never reach here"+(o!==null?": "+o:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var o=arguments[0];h.isTrue(o,null)}else if(arguments.length===2){var a=arguments[1];if(!arguments[0])throw a===null?new Ee:new Ee(a)}}},{key:"equals",value:function(){if(arguments.length===2){var o=arguments[0],a=arguments[1];h.equals(o,a,null)}else if(arguments.length===3){var c=arguments[0],g=arguments[1],m=arguments[2];if(!g.equals(c))throw new Ee("Expected "+c+" but encountered "+g+(m!==null?": "+m:""))}}}])}(),ye=new ArrayBuffer(8),xe=new Float64Array(ye),Xe=new Int32Array(ye),J=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"getM",value:function(){return te.NaN}},{key:"setOrdinate",value:function(o,a){switch(o){case h.X:this.x=a;break;case h.Y:this.y=a;break;case h.Z:this.setZ(a);break;default:throw new D("Invalid ordinate index: "+o)}}},{key:"equals2D",value:function(){if(arguments.length===1){var o=arguments[0];return this.x===o.x&&this.y===o.y}if(arguments.length===2){var a=arguments[0],c=arguments[1];return!!H.equalsWithTolerance(this.x,a.x,c)&&!!H.equalsWithTolerance(this.y,a.y,c)}}},{key:"setM",value:function(o){throw new D("Invalid ordinate index: "+h.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(o){switch(o){case h.X:return this.x;case h.Y:return this.y;case h.Z:return this.getZ()}throw new D("Invalid ordinate index: "+o)}},{key:"equals3D",value:function(o){return this.x===o.x&&this.y===o.y&&(this.getZ()===o.getZ()||te.isNaN(this.getZ())&&te.isNaN(o.getZ()))}},{key:"equals",value:function(o){return o instanceof h&&this.equals2D(o)}},{key:"equalInZ",value:function(o,a){return H.equalsWithTolerance(this.getZ(),o.getZ(),a)}},{key:"setX",value:function(o){this.x=o}},{key:"compareTo",value:function(o){var a=o;return this.x<a.x?-1:this.x>a.x?1:this.y<a.y?-1:this.y>a.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(o){this.z=o}},{key:"clone",value:function(){try{return null}catch(o){if(o instanceof CloneNotSupportedException)return he.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw o}}},{key:"copy",value:function(){return new h(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(o){var a=this.x-o.x,c=this.y-o.y,g=this.getZ()-o.getZ();return Math.sqrt(a*a+c*c+g*g)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(o){this.y=o}},{key:"distance",value:function(o){var a=this.x-o.x,c=this.y-o.y;return Math.sqrt(a*a+c*c)}},{key:"hashCode",value:function(){var o=17;return o=37*(o=37*o+h.hashCode(this.x))+h.hashCode(this.y)}},{key:"setCoordinate",value:function(o){this.x=o.x,this.y=o.y,this.z=o.getZ()}},{key:"interfaces_",get:function(){return[K,x,R]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)h.constructor_.call(this,0,0);else if(arguments.length===1){var o=arguments[0];h.constructor_.call(this,o.x,o.y,o.getZ())}else if(arguments.length===2){var a=arguments[0],c=arguments[1];h.constructor_.call(this,a,c,h.NULL_ORDINATE)}else if(arguments.length===3){var g=arguments[0],m=arguments[1],v=arguments[2];this.x=g,this.y=m,this.z=v}}},{key:"hashCode",value:function(o){return xe[0]=o,Xe[0]^Xe[1]}}])}(),Eo=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"compare",value:function(o,a){var c=h.compare(o.x,a.x);if(c!==0)return c;var g=h.compare(o.y,a.y);return g!==0?g:this._dimensionsToTest<=2?0:h.compare(o.getZ(),a.getZ())}},{key:"interfaces_",get:function(){return[ie]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)h.constructor_.call(this,2);else if(arguments.length===1){var o=arguments[0];if(o!==2&&o!==3)throw new D("only 2 or 3 dimensions may be specified");this._dimensionsToTest=o}}},{key:"compare",value:function(o,a){return o<a?-1:o>a?1:te.isNaN(o)?te.isNaN(a)?0:-1:te.isNaN(a)?1:0}}])}();J.DimensionalComparator=Eo,J.NULL_ORDINATE=te.NaN,J.X=0,J.Y=1,J.Z=2,J.M=3;var De=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(o){if(!(o instanceof h))return!1;var a=o;return this.isNull()?a.isNull():this._maxx===a.getMaxX()&&this._maxy===a.getMaxY()&&this._minx===a.getMinX()&&this._miny===a.getMinY()}},{key:"intersection",value:function(o){if(this.isNull()||o.isNull()||!this.intersects(o))return new h;var a=this._minx>o._minx?this._minx:o._minx,c=this._miny>o._miny?this._miny:o._miny;return new h(a,this._maxx<o._maxx?this._maxx:o._maxx,c,this._maxy<o._maxy?this._maxy:o._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof J){var o=arguments[0];return this.covers(o.x,o.y)}if(arguments[0]instanceof h){var a=arguments[0];return!this.isNull()&&!a.isNull()&&a.getMinX()>=this._minx&&a.getMaxX()<=this._maxx&&a.getMinY()>=this._miny&&a.getMaxY()<=this._maxy}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];return!this.isNull()&&c>=this._minx&&c<=this._maxx&&g>=this._miny&&g<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof h){var o=arguments[0];return!this.isNull()&&!o.isNull()&&!(o._minx>this._maxx||o._maxx<this._minx||o._miny>this._maxy||o._maxy<this._miny)}if(arguments[0]instanceof J){var a=arguments[0];return this.intersects(a.x,a.y)}}else if(arguments.length===2){if(arguments[0]instanceof J&&arguments[1]instanceof J){var c=arguments[0],g=arguments[1];return!this.isNull()&&!((c.x<g.x?c.x:g.x)>this._maxx)&&!((c.x>g.x?c.x:g.x)<this._minx)&&!((c.y<g.y?c.y:g.y)>this._maxy)&&!((c.y>g.y?c.y:g.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var m=arguments[0],v=arguments[1];return!this.isNull()&&!(m>this._maxx||m<this._minx||v>this._maxy||v<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var o=this.getWidth(),a=this.getHeight();return Math.sqrt(o*o+a*a)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof J){var o=arguments[0];this.expandToInclude(o.x,o.y)}else if(arguments[0]instanceof h){var a=arguments[0];if(a.isNull())return null;this.isNull()?(this._minx=a.getMinX(),this._maxx=a.getMaxX(),this._miny=a.getMinY(),this._maxy=a.getMaxY()):(a._minx<this._minx&&(this._minx=a._minx),a._maxx>this._maxx&&(this._maxx=a._maxx),a._miny<this._miny&&(this._miny=a._miny),a._maxy>this._maxy&&(this._maxy=a._maxy))}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];this.isNull()?(this._minx=c,this._maxx=c,this._miny=g,this._maxy=g):(c<this._minx&&(this._minx=c),c>this._maxx&&(this._maxx=c),g<this._miny&&(this._miny=g),g>this._maxy&&(this._maxy=g))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var o=this.getWidth(),a=this.getHeight();return o<a?o:a}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(o){var a=o;return this.isNull()?a.isNull()?0:-1:a.isNull()?1:this._minx<a._minx?-1:this._minx>a._minx?1:this._miny<a._miny?-1:this._miny>a._miny?1:this._maxx<a._maxx?-1:this._maxx>a._maxx?1:this._maxy<a._maxy?-1:this._maxy>a._maxy?1:0}},{key:"translate",value:function(o,a){if(this.isNull())return null;this.init(this.getMinX()+o,this.getMaxX()+o,this.getMinY()+a,this.getMaxY()+a)}},{key:"copy",value:function(){return new h(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(o){return!(!this.isNull()&&!o.isNull())||o._minx>this._maxx||o._maxx<this._minx||o._miny>this._maxy||o._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var o=this.getWidth(),a=this.getHeight();return o>a?o:a}},{key:"expandBy",value:function(){if(arguments.length===1){var o=arguments[0];this.expandBy(o,o)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];if(this.isNull())return null;this._minx-=a,this._maxx+=a,this._miny-=c,this._maxy+=c,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof h){var o=arguments[0];return this.covers(o)}if(arguments[0]instanceof J){var a=arguments[0];return this.covers(a)}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];return this.covers(c,g)}}},{key:"centre",value:function(){return this.isNull()?null:new J((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof J){var o=arguments[0];this.init(o.x,o.x,o.y,o.y)}else if(arguments[0]instanceof h){var a=arguments[0];this._minx=a._minx,this._maxx=a._maxx,this._miny=a._miny,this._maxy=a._maxy}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];this.init(c.x,g.x,c.y,g.y)}else if(arguments.length===4){var m=arguments[0],v=arguments[1],S=arguments[2],I=arguments[3];m<v?(this._minx=m,this._maxx=v):(this._minx=v,this._maxx=m),S<I?(this._miny=S,this._maxy=I):(this._miny=I,this._maxy=S)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(o){if(this.intersects(o))return 0;var a=0;this._maxx<o._minx?a=o._minx-this._maxx:this._minx>o._maxx&&(a=this._minx-o._maxx);var c=0;return this._maxy<o._miny?c=o._miny-this._maxy:this._miny>o._maxy&&(c=this._miny-o._maxy),a===0?c:c===0?a:Math.sqrt(a*a+c*c)}},{key:"hashCode",value:function(){var o=17;return o=37*(o=37*(o=37*(o=37*o+J.hashCode(this._minx))+J.hashCode(this._maxx))+J.hashCode(this._miny))+J.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[K,R]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof J){var o=arguments[0];this.init(o.x,o.x,o.y,o.y)}else if(arguments[0]instanceof h){var a=arguments[0];this.init(a)}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];this.init(c.x,g.x,c.y,g.y)}else if(arguments.length===4){var m=arguments[0],v=arguments[1],S=arguments[2],I=arguments[3];this.init(m,v,S,I)}}},{key:"intersects",value:function(){if(arguments.length===3){var o=arguments[0],a=arguments[1],c=arguments[2];return c.x>=(o.x<a.x?o.x:a.x)&&c.x<=(o.x>a.x?o.x:a.x)&&c.y>=(o.y<a.y?o.y:a.y)&&c.y<=(o.y>a.y?o.y:a.y)}if(arguments.length===4){var g=arguments[0],m=arguments[1],v=arguments[2],S=arguments[3],I=Math.min(v.x,S.x),L=Math.max(v.x,S.x),q=Math.min(g.x,m.x),ee=Math.max(g.x,m.x);return!(q>L)&&!(ee<I)&&(I=Math.min(v.y,S.y),L=Math.max(v.y,S.y),q=Math.min(g.y,m.y),ee=Math.max(g.y,m.y),!(q>L)&&!(ee<I))}}}])}(),fe=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===h.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(o){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(o){return this===o||this.equalsExact(o,0)}},{key:"geometryChanged",value:function(){this.apply(h.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(o){return o!==null&&this.norm().equalsExact(o.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var o;if(arguments.length===1){var a=arguments[0];return o=a,this.getTypeCode()!==o.getTypeCode()?this.getTypeCode()-o.getTypeCode():this.isEmpty()&&o.isEmpty()?0:this.isEmpty()?-1:o.isEmpty()?1:this.compareToSameClass(a)}if(arguments.length===2){var c=arguments[0],g=arguments[1];return o=c,this.getTypeCode()!==o.getTypeCode()?this.getTypeCode()-o.getTypeCode():this.isEmpty()&&o.isEmpty()?0:this.isEmpty()?-1:o.isEmpty()?1:this.compareToSameClass(c,g)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(o){if(o.getTypeCode()===h.TYPECODE_GEOMETRYCOLLECTION)throw new D("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(o,a,c){return c===0?o.equals(a):o.distance(a)<=c}},{key:"norm",value:function(){var o=this.copy();return o.normalize(),o}},{key:"reverse",value:function(){var o=this.reverseInternal();return this.envelope!=null&&(o.envelope=this.envelope.copy()),o.setSRID(this.getSRID()),o}},{key:"copy",value:function(){var o=this.copyInternal();return o.envelope=this._envelope==null?null:this._envelope.copy(),o._SRID=this._SRID,o._userData=this._userData,o}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new De(this._envelope)}},{key:"setSRID",value:function(o){this._SRID=o}},{key:"setUserData",value:function(o){this._userData=o}},{key:"compare",value:function(o,a){for(var c=o.iterator(),g=a.iterator();c.hasNext()&&g.hasNext();){var m=c.next(),v=g.next(),S=m.compareTo(v);if(S!==0)return S}return c.hasNext()?1:g.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(o){return this.getClass()===o.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===h.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===h.TYPECODE_MULTIPOINT||this.getTypeCode()===h.TYPECODE_MULTILINESTRING||this.getTypeCode()===h.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[x,K,R]}},{key:"getClass",value:function(){return h}}],[{key:"hasNonEmptyElements",value:function(o){for(var a=0;a<o.length;a++)if(!o[a].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(o){for(var a=0;a<o.length;a++)if(o[a]===null)return!0;return!1}}])}();fe.constructor_=function(h){h&&(this._envelope=null,this._userData=null,this._factory=h,this._SRID=h.getSRID())},fe.TYPECODE_POINT=0,fe.TYPECODE_MULTIPOINT=1,fe.TYPECODE_LINESTRING=2,fe.TYPECODE_LINEARRING=3,fe.TYPECODE_MULTILINESTRING=4,fe.TYPECODE_POLYGON=5,fe.TYPECODE_MULTIPOLYGON=6,fe.TYPECODE_GEOMETRYCOLLECTION=7,fe.TYPENAME_POINT="Point",fe.TYPENAME_MULTIPOINT="MultiPoint",fe.TYPENAME_LINESTRING="LineString",fe.TYPENAME_LINEARRING="LinearRing",fe.TYPENAME_MULTILINESTRING="MultiLineString",fe.TYPENAME_POLYGON="Polygon",fe.TYPENAME_MULTIPOLYGON="MultiPolygon",fe.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",fe.geometryChangedFilter={get interfaces_(){return[W]},filter:function(h){h.geometryChangedAction()}};var j=function(){function h(){r(this,h)}return u(h,null,[{key:"toLocationSymbol",value:function(o){switch(o){case h.EXTERIOR:return"e";case h.BOUNDARY:return"b";case h.INTERIOR:return"i";case h.NONE:return"-"}throw new D("Unknown location value: "+o)}}])}();j.INTERIOR=0,j.BOUNDARY=1,j.EXTERIOR=2,j.NONE=-1;var Ze=function(){return u(function h(){r(this,h)},[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])}(),ut=function(h){function o(a){var c;return r(this,o),(c=i(this,o,[a])).name=Object.keys({NoSuchElementException:o})[0],c}return _(o,h),u(o)}(N),Oe=function(h){function o(a){var c;return r(this,o),(c=i(this,o,[a])).name=Object.keys({UnsupportedOperationException:o})[0],c}return _(o,h),u(o)}(N),G_=function(h){function o(){return r(this,o),i(this,o,arguments)}return _(o,h),u(o,[{key:"contains",value:function(){}}])}(Ze),Lh=function(h){function o(a){var c;return r(this,o),(c=i(this,o)).map=new Map,a instanceof Ze&&c.addAll(a),c}return _(o,h),u(o,[{key:"contains",value:function(a){var c=a.hashCode?a.hashCode():a;return!!this.map.has(c)}},{key:"add",value:function(a){var c=a.hashCode?a.hashCode():a;return!this.map.has(c)&&!!this.map.set(c,a)}},{key:"addAll",value:function(a){var c,g=f(a);try{for(g.s();!(c=g.n()).done;){var m=c.value;this.add(m)}}catch(v){g.e(v)}finally{g.f()}return!0}},{key:"remove",value:function(){throw new Oe}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new CA(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])}(G_),CA=function(){return u(function h(o){r(this,h),this.iterator=o.values();var a=this.iterator.next(),c=a.done,g=a.value;this.done=c,this.value=g},[{key:"next",value:function(){if(this.done)throw new ut;var h=this.value,o=this.iterator.next(),a=o.done,c=o.value;return this.done=a,this.value=c,h}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Oe}}])}(),ae=function(){function h(){r(this,h)}return u(h,null,[{key:"opposite",value:function(o){return o===h.LEFT?h.RIGHT:o===h.RIGHT?h.LEFT:o}}])}();ae.ON=0,ae.LEFT=1,ae.RIGHT=2;var Z_=function(h){function o(a){var c;return r(this,o),(c=i(this,o,[a])).name=Object.keys({EmptyStackException:o})[0],c}return _(o,h),u(o)}(N),Q_=function(h){function o(a){var c;return r(this,o),(c=i(this,o,[a])).name=Object.keys({IndexOutOfBoundsException:o})[0],c}return _(o,h),u(o)}(N),fr=function(h){function o(){return r(this,o),i(this,o,arguments)}return _(o,h),u(o,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])}(Ze),kA=function(h){function o(){var a;return r(this,o),(a=i(this,o)).array=[],a}return _(o,h),u(o,[{key:"add",value:function(a){return this.array.push(a),!0}},{key:"get",value:function(a){if(a<0||a>=this.size())throw new Q_;return this.array[a]}},{key:"push",value:function(a){return this.array.push(a),a}},{key:"pop",value:function(){if(this.array.length===0)throw new Z_;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new Z_;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(a){return this.array.indexOf(a)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])}(fr);function Se(h,o){return h.interfaces_&&h.interfaces_.indexOf(o)>-1}var wo=function(){return u(function h(o){r(this,h),this.str=o},[{key:"append",value:function(h){this.str+=h}},{key:"setCharAt",value:function(h,o){this.str=this.str.substr(0,h)+o+this.str.substr(h+1)}},{key:"toString",value:function(){return this.str}}])}(),hl=function(){function h(o){r(this,h),this.value=o}return u(h,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(o){return this.value<o?-1:this.value>o?1:0}}],[{key:"compare",value:function(o,a){return o<a?-1:o>a?1:0}},{key:"isNan",value:function(o){return Number.isNaN(o)}},{key:"valueOf",value:function(o){return new h(o)}}])}(),Dh=function(){return u(function h(){r(this,h)},null,[{key:"isWhitespace",value:function(h){return h<=32&&h>=0||h===127}},{key:"toUpperCase",value:function(h){return h.toUpperCase()}}])}(),me=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"le",value:function(o){return this._hi<o._hi||this._hi===o._hi&&this._lo<=o._lo}},{key:"extractSignificantDigits",value:function(o,a){var c=this.abs(),g=h.magnitude(c._hi),m=h.TEN.pow(g);(c=c.divide(m)).gt(h.TEN)?(c=c.divide(h.TEN),g+=1):c.lt(h.ONE)&&(c=c.multiply(h.TEN),g-=1);for(var v=g+1,S=new wo,I=h.MAX_PRINT_DIGITS-1,L=0;L<=I;L++){o&&L===v&&S.append(".");var q=Math.trunc(c._hi);if(q<0)break;var ee=!1,ne=0;q>9?(ee=!0,ne="9"):ne="0"+q,S.append(ne),c=c.subtract(h.valueOf(q)).multiply(h.TEN),ee&&c.selfAdd(h.TEN);var ue=!0,ge=h.magnitude(c._hi);if(ge<0&&Math.abs(ge)>=I-L&&(ue=!1),!ue)break}return a[0]=g,S.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof h){var o=arguments[0];return this.add(o.negate())}if(typeof arguments[0]=="number"){var a=arguments[0];return this.add(-a)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof h){var o=arguments[0];return this._hi===o._hi&&this._lo===o._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof h){var o=arguments[0];return this.isNaN()?this:this.selfAdd(-o._hi,-o._lo)}if(typeof arguments[0]=="number"){var a=arguments[0];return this.isNaN()?this:this.selfAdd(-a,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(o){return this.le(o)?this:o}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof h){var o=arguments[0];return this.selfDivide(o._hi,o._lo)}if(typeof arguments[0]=="number"){var a=arguments[0];return this.selfDivide(a,0)}}else if(arguments.length===2){var c,g,m,v,S=arguments[0],I=arguments[1],L=null,q=null,ee=null,ne=null;return m=this._hi/S,ne=(L=(ee=h.SPLIT*m)-(L=ee-m))*(q=(ne=h.SPLIT*S)-(q=ne-S))-(v=m*S)+L*(g=S-q)+(c=m-L)*q+c*g,ne=m+(ee=(this._hi-v-ne+this._lo-m*I)/S),this._hi=ne,this._lo=m-ne+ee,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof h){var o,a,c,g,m=arguments[0],v=null,S=null,I=null,L=null;return o=(c=this._hi/m._hi)-(v=(I=h.SPLIT*c)-(v=I-c)),L=v*(S=(L=h.SPLIT*m._hi)-(S=L-m._hi))-(g=c*m._hi)+v*(a=m._hi-S)+o*S+o*a,new h(L=c+(I=(this._hi-g-L+this._lo-c*m._lo)/m._hi),c-L+I)}if(typeof arguments[0]=="number"){var q=arguments[0];return te.isNaN(q)?h.createNaN():h.copy(this).selfDivide(q,0)}}},{key:"ge",value:function(o){return this._hi>o._hi||this._hi===o._hi&&this._lo>=o._lo}},{key:"pow",value:function(o){if(o===0)return h.valueOf(1);var a=new h(this),c=h.valueOf(1),g=Math.abs(o);if(g>1)for(;g>0;)g%2==1&&c.selfMultiply(a),(g/=2)>0&&(a=a.sqr());else c=a;return o<0?c.reciprocal():c}},{key:"ceil",value:function(){if(this.isNaN())return h.NaN;var o=Math.ceil(this._hi),a=0;return o===this._hi&&(a=Math.ceil(this._lo)),new h(o,a)}},{key:"compareTo",value:function(o){var a=o;return this._hi<a._hi?-1:this._hi>a._hi?1:this._lo<a._lo?-1:this._lo>a._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof h){var o=arguments[0];return this.init(o),this}if(typeof arguments[0]=="number"){var a=arguments[0];return this.init(a),this}}},{key:"max",value:function(o){return this.ge(o)?this:o}},{key:"sqrt",value:function(){if(this.isZero())return h.valueOf(0);if(this.isNegative())return h.NaN;var o=1/Math.sqrt(this._hi),a=this._hi*o,c=h.valueOf(a),g=this.subtract(c.sqr())._hi*(.5*o);return c.add(g)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof h){var o=arguments[0];return this.selfAdd(o._hi,o._lo)}if(typeof arguments[0]=="number"){var a,c,g,m,v,S=arguments[0],I=null;return I=(g=this._hi+S)-(m=g-this._hi),c=(v=(I=S-m+(this._hi-I))+this._lo)+(g-(a=g+v)),this._hi=a+c,this._lo=c+(a-this._hi),this}}else if(arguments.length===2){var L,q,ee,ne,ue=arguments[0],ge=arguments[1],pe=null,Ie=null,Re=null;ee=this._hi+ue,q=this._lo+ge,Ie=ee-(Re=ee-this._hi),pe=q-(ne=q-this._lo);var ze=(L=ee+(Re=(Ie=ue-Re+(this._hi-Ie))+q))+(Re=(pe=ge-ne+(this._lo-pe))+(Re+(ee-L))),Tt=Re+(L-ze);return this._hi=ze,this._lo=Tt,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof h){var o=arguments[0];return this.selfMultiply(o._hi,o._lo)}if(typeof arguments[0]=="number"){var a=arguments[0];return this.selfMultiply(a,0)}}else if(arguments.length===2){var c,g,m=arguments[0],v=arguments[1],S=null,I=null,L=null,q=null;S=(L=h.SPLIT*this._hi)-this._hi,q=h.SPLIT*m,S=L-S,c=this._hi-S,I=q-m;var ee=(L=this._hi*m)+(q=S*(I=q-I)-L+S*(g=m-I)+c*I+c*g+(this._hi*v+this._lo*m)),ne=q+(S=L-ee);return this._hi=ee,this._lo=ne,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return h.NaN;var o=Math.floor(this._hi),a=0;return o===this._hi&&(a=Math.floor(this._lo)),new h(o,a)}},{key:"negate",value:function(){return this.isNaN()?this:new h(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(o){if(o instanceof CloneNotSupportedException)return null;throw o}}},{key:"multiply",value:function(){if(arguments[0]instanceof h){var o=arguments[0];return o.isNaN()?h.createNaN():h.copy(this).selfMultiply(o)}if(typeof arguments[0]=="number"){var a=arguments[0];return te.isNaN(a)?h.createNaN():h.copy(this).selfMultiply(a,0)}}},{key:"isNaN",value:function(){return te.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var o=h.magnitude(this._hi);return o>=-3&&o<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var o=this.getSpecialNumberString();if(o!==null)return o;var a=new Array(1).fill(null),c=this.extractSignificantDigits(!0,a),g=a[0]+1,m=c;if(c.charAt(0)===".")m="0"+c;else if(g<0)m="0."+h.stringOfChar("0",-g)+c;else if(c.indexOf(".")===-1){var v=g-c.length;m=c+h.stringOfChar("0",v)+".0"}return this.isNegative()?"-"+m:m}},{key:"reciprocal",value:function(){var o,a,c,g,m=null,v=null,S=null,I=null;o=(c=1/this._hi)-(m=(S=h.SPLIT*c)-(m=S-c)),v=(I=h.SPLIT*this._hi)-this._hi;var L=c+(S=(1-(g=c*this._hi)-(I=m*(v=I-v)-g+m*(a=this._hi-v)+o*v+o*a)-c*this._lo)/this._hi);return new h(L,c-L+S)}},{key:"toSciNotation",value:function(){if(this.isZero())return h.SCI_NOT_ZERO;var o=this.getSpecialNumberString();if(o!==null)return o;var a=new Array(1).fill(null),c=this.extractSignificantDigits(!1,a),g=h.SCI_NOT_EXPONENT_CHAR+a[0];if(c.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+c);var m="";c.length>1&&(m=c.substring(1));var v=c.charAt(0)+"."+m;return this.isNegative()?"-"+v+g:v+g}},{key:"abs",value:function(){return this.isNaN()?h.NaN:this.isNegative()?this.negate():new h(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(o){return this._hi<o._hi||this._hi===o._hi&&this._lo<o._lo}},{key:"add",value:function(){if(arguments[0]instanceof h){var o=arguments[0];return h.copy(this).selfAdd(o)}if(typeof arguments[0]=="number"){var a=arguments[0];return h.copy(this).selfAdd(a)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var o=arguments[0];this._hi=o,this._lo=0}else if(arguments[0]instanceof h){var a=arguments[0];this._hi=a._hi,this._lo=a._lo}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];this._hi=c,this._lo=g}}},{key:"gt",value:function(o){return this._hi>o._hi||this._hi===o._hi&&this._lo>o._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?h.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[R,K,x]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var o=arguments[0];this.init(o)}else if(arguments[0]instanceof h){var a=arguments[0];this.init(a)}else if(typeof arguments[0]=="string"){var c=arguments[0];h.constructor_.call(this,h.parse(c))}}else if(arguments.length===2){var g=arguments[0],m=arguments[1];this.init(g,m)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],a=arguments[1],c=arguments[2],g=arguments[3];return h.determinant(h.valueOf(o),h.valueOf(a),h.valueOf(c),h.valueOf(g))}if(arguments[3]instanceof h&&arguments[2]instanceof h&&arguments[0]instanceof h&&arguments[1]instanceof h){var m=arguments[1],v=arguments[2],S=arguments[3];return arguments[0].multiply(S).selfSubtract(m.multiply(v))}}},{key:"sqr",value:function(o){return h.valueOf(o).selfMultiply(o)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var o=arguments[0];return h.parse(o)}if(typeof arguments[0]=="number")return new h(arguments[0])}},{key:"sqrt",value:function(o){return h.valueOf(o).sqrt()}},{key:"parse",value:function(o){for(var a=0,c=o.length;Dh.isWhitespace(o.charAt(a));)a++;var g=!1;if(a<c){var m=o.charAt(a);m!=="-"&&m!=="+"||(a++,m==="-"&&(g=!0))}for(var v=new h,S=0,I=0,L=0,q=!1;!(a>=c);){var ee=o.charAt(a);if(a++,Dh.isDigit(ee)){var ne=ee-"0";v.selfMultiply(h.TEN),v.selfAdd(ne),S++}else{if(ee!=="."){if(ee==="e"||ee==="E"){var ue=o.substring(a);try{L=hl.parseInt(ue)}catch(ze){throw ze instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+ue+" in string "+o):ze}break}throw new NumberFormatException("Unexpected character '"+ee+"' at position "+a+" in string "+o)}I=S,q=!0}}var ge=v;q||(I=S);var pe=S-I-L;if(pe===0)ge=v;else if(pe>0){var Ie=h.TEN.pow(pe);ge=v.divide(Ie)}else if(pe<0){var Re=h.TEN.pow(-pe);ge=v.multiply(Re)}return g?ge.negate():ge}},{key:"createNaN",value:function(){return new h(te.NaN,te.NaN)}},{key:"copy",value:function(o){return new h(o)}},{key:"magnitude",value:function(o){var a=Math.abs(o),c=Math.log(a)/Math.log(10),g=Math.trunc(Math.floor(c));return 10*Math.pow(10,g)<=a&&(g+=1),g}},{key:"stringOfChar",value:function(o,a){for(var c=new wo,g=0;g<a;g++)c.append(o);return c.toString()}}])}();me.PI=new me(3.141592653589793,12246467991473532e-32),me.TWO_PI=new me(6.283185307179586,24492935982947064e-32),me.PI_2=new me(1.5707963267948966,6123233995736766e-32),me.E=new me(2.718281828459045,14456468917292502e-32),me.NaN=new me(te.NaN,te.NaN),me.EPS=123259516440783e-46,me.SPLIT=134217729,me.MAX_PRINT_DIGITS=32,me.TEN=me.valueOf(10),me.ONE=me.valueOf(1),me.SCI_NOT_EXPONENT_CHAR="E",me.SCI_NOT_ZERO="0.0E0";var Fh=function(){function h(){r(this,h)}return u(h,null,[{key:"orientationIndex",value:function(o,a,c){var g=h.orientationIndexFilter(o,a,c);if(g<=1)return g;var m=me.valueOf(a.x).selfAdd(-o.x),v=me.valueOf(a.y).selfAdd(-o.y),S=me.valueOf(c.x).selfAdd(-a.x),I=me.valueOf(c.y).selfAdd(-a.y);return m.selfMultiply(I).selfSubtract(v.selfMultiply(S)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof me&&arguments[2]instanceof me&&arguments[0]instanceof me&&arguments[1]instanceof me){var o=arguments[1],a=arguments[2],c=arguments[3];return arguments[0].multiply(c).selfSubtract(o.multiply(a)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var g=arguments[0],m=arguments[1],v=arguments[2],S=arguments[3],I=me.valueOf(g),L=me.valueOf(m),q=me.valueOf(v),ee=me.valueOf(S);return I.multiply(ee).selfSubtract(L.multiply(q)).signum()}}},{key:"intersection",value:function(o,a,c,g){var m=new me(o.y).selfSubtract(a.y),v=new me(a.x).selfSubtract(o.x),S=new me(o.x).selfMultiply(a.y).selfSubtract(new me(a.x).selfMultiply(o.y)),I=new me(c.y).selfSubtract(g.y),L=new me(g.x).selfSubtract(c.x),q=new me(c.x).selfMultiply(g.y).selfSubtract(new me(g.x).selfMultiply(c.y)),ee=v.multiply(q).selfSubtract(L.multiply(S)),ne=I.multiply(S).selfSubtract(m.multiply(q)),ue=m.multiply(L).selfSubtract(I.multiply(v)),ge=ee.selfDivide(ue).doubleValue(),pe=ne.selfDivide(ue).doubleValue();return te.isNaN(ge)||te.isInfinite(ge)||te.isNaN(pe)||te.isInfinite(pe)?null:new J(ge,pe)}},{key:"orientationIndexFilter",value:function(o,a,c){var g=null,m=(o.x-c.x)*(a.y-c.y),v=(o.y-c.y)*(a.x-c.x),S=m-v;if(m>0){if(v<=0)return h.signum(S);g=m+v}else{if(!(m<0)||v>=0)return h.signum(S);g=-m-v}var I=h.DP_SAFE_EPSILON*g;return S>=I||-S>=I?h.signum(S):2}},{key:"signum",value:function(o){return o>0?1:o<0?-1:0}}])}();Fh.DP_SAFE_EPSILON=1e-15;var ke=function(){return u(function h(){r(this,h)},[{key:"getM",value:function(h){if(this.hasM()){var o=this.getDimension()-this.getMeasures();return this.getOrdinate(h,o)}return te.NaN}},{key:"setOrdinate",value:function(h,o,a){}},{key:"getZ",value:function(h){return this.hasZ()?this.getOrdinate(h,2):te.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(h,o){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(h){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(h){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(h){}},{key:"copy",value:function(){}},{key:"getY",value:function(h){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[x]}}])}();ke.X=0,ke.Y=1,ke.Z=2,ke.M=3;var ve=function(){function h(){r(this,h)}return u(h,null,[{key:"index",value:function(o,a,c){return Fh.orientationIndex(o,a,c)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var o=arguments[0],a=o.length-1;if(a<3)throw new D("Ring has fewer than 4 points, so orientation cannot be determined");for(var c=o[0],g=0,m=1;m<=a;m++){var v=o[m];v.y>c.y&&(c=v,g=m)}var S=g;do(S-=1)<0&&(S=a);while(o[S].equals2D(c)&&S!==g);var I=g;do I=(I+1)%a;while(o[I].equals2D(c)&&I!==g);var L=o[S],q=o[I];if(L.equals2D(c)||q.equals2D(c)||L.equals2D(q))return!1;var ee=h.index(L,c,q);return ee===0?L.x>q.x:ee>0}if(Se(arguments[0],ke)){var ne=arguments[0],ue=ne.size()-1;if(ue<3)throw new D("Ring has fewer than 4 points, so orientation cannot be determined");for(var ge=ne.getCoordinate(0),pe=0,Ie=1;Ie<=ue;Ie++){var Re=ne.getCoordinate(Ie);Re.y>ge.y&&(ge=Re,pe=Ie)}var ze=null,Tt=pe;do(Tt-=1)<0&&(Tt=ue),ze=ne.getCoordinate(Tt);while(ze.equals2D(ge)&&Tt!==pe);var kt=null,vr=pe;do vr=(vr+1)%ue,kt=ne.getCoordinate(vr);while(kt.equals2D(ge)&&vr!==pe);if(ze.equals2D(ge)||kt.equals2D(ge)||ze.equals2D(kt))return!1;var Io=h.index(ze,ge,kt);return Io===0?ze.x>kt.x:Io>0}}}])}();ve.CLOCKWISE=-1,ve.RIGHT=ve.CLOCKWISE,ve.COUNTERCLOCKWISE=1,ve.LEFT=ve.COUNTERCLOCKWISE,ve.COLLINEAR=0,ve.STRAIGHT=ve.COLLINEAR;var IA=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(h,o){var a=this.getRightmostSideOfSegment(h,o);return a<0&&(a=this.getRightmostSideOfSegment(h,o-1)),a<0&&(this._minCoord=null,this.checkForRightmostCoordinate(h)),a}},{key:"findRightmostEdgeAtVertex",value:function(){var h=this._minDe.getEdge().getCoordinates();he.isTrue(this._minIndex>0&&this._minIndex<h.length,"rightmost point expected to be interior vertex of edge");var o=h[this._minIndex-1],a=h[this._minIndex+1],c=ve.index(this._minCoord,a,o),g=!1;(o.y<this._minCoord.y&&a.y<this._minCoord.y&&c===ve.COUNTERCLOCKWISE||o.y>this._minCoord.y&&a.y>this._minCoord.y&&c===ve.CLOCKWISE)&&(g=!0),g&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(h,o){var a=h.getEdge().getCoordinates();if(o<0||o+1>=a.length||a[o].y===a[o+1].y)return-1;var c=ae.LEFT;return a[o].y<a[o+1].y&&(c=ae.RIGHT),c}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(h){for(var o=h.getEdge().getCoordinates(),a=0;a<o.length-1;a++)(this._minCoord===null||o[a].x>this._minCoord.x)&&(this._minDe=h,this._minIndex=a,this._minCoord=o[a])}},{key:"findRightmostEdgeAtNode",value:function(){var h=this._minDe.getNode().getEdges();this._minDe=h.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(h){for(var o=h.iterator();o.hasNext();){var a=o.next();a.isForward()&&this.checkForRightmostCoordinate(a)}he.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===ae.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])}(),li=function(h){function o(a,c){var g;return r(this,o),(g=i(this,o,[c?a+" [ "+c+" ]":a])).pt=c?new J(c):void 0,g.name=Object.keys({TopologyException:o})[0],g}return _(o,h),u(o,[{key:"getCoordinate",value:function(){return this.pt}}])}(ce),PA=function(){return u(function h(){r(this,h),this.array=[]},[{key:"addLast",value:function(h){this.array.push(h)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])}(),_e=function(h){function o(a){var c;return r(this,o),(c=i(this,o)).array=[],a instanceof Ze&&c.addAll(a),c}return _(o,h),u(o,[{key:"interfaces_",get:function(){return[fr,Ze]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(a){return arguments.length===1?this.array.push(a):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(a){var c,g=f(a);try{for(g.s();!(c=g.n()).done;){var m=c.value;this.array.push(m)}}catch(v){g.e(v)}finally{g.f()}}},{key:"set",value:function(a,c){var g=this.array[a];return this.array[a]=c,g}},{key:"iterator",value:function(){return new NA(this)}},{key:"get",value:function(a){if(a<0||a>=this.size())throw new Q_;return this.array[a]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(a){a?this.array.sort(function(c,g){return a.compare(c,g)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(a){for(var c=0,g=this.array.length;c<g;c++)if(this.array[c]===a)return!!this.array.splice(c,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])}(fr),NA=function(){return u(function h(o){r(this,h),this.arrayList=o,this.position=0},[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new ut;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(h){return this.arrayList.set(this.position-1,h)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])}(),MA=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"clearVisitedEdges",value:function(){for(var h=this._dirEdgeList.iterator();h.hasNext();)h.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(h){for(var o=null,a=h.getEdges().iterator();a.hasNext();){var c=a.next();if(c.isVisited()||c.getSym().isVisited()){o=c;break}}if(o===null)throw new li("unable to find edge to compute depths at "+h.getCoordinate());h.getEdges().computeDepths(o);for(var g=h.getEdges().iterator();g.hasNext();){var m=g.next();m.setVisited(!0),this.copySymDepths(m)}}},{key:"computeDepth",value:function(h){this.clearVisitedEdges();var o=this._finder.getEdge();o.getNode(),o.getLabel(),o.setEdgeDepths(ae.RIGHT,h),this.copySymDepths(o),this.computeDepths(o)}},{key:"create",value:function(h){this.addReachable(h),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var h=this._dirEdgeList.iterator();h.hasNext();){var o=h.next();o.getDepth(ae.RIGHT)>=1&&o.getDepth(ae.LEFT)<=0&&!o.isInteriorAreaEdge()&&o.setInResult(!0)}}},{key:"computeDepths",value:function(h){var o=new Lh,a=new PA,c=h.getNode();for(a.addLast(c),o.add(c),h.setVisited(!0);!a.isEmpty();){var g=a.removeFirst();o.add(g),this.computeNodeDepth(g);for(var m=g.getEdges().iterator();m.hasNext();){var v=m.next().getSym();if(!v.isVisited()){var S=v.getNode();o.contains(S)||(a.addLast(S),o.add(S))}}}}},{key:"compareTo",value:function(h){var o=h;return this._rightMostCoord.x<o._rightMostCoord.x?-1:this._rightMostCoord.x>o._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var h=new De,o=this._dirEdgeList.iterator();o.hasNext();)for(var a=o.next().getEdge().getCoordinates(),c=0;c<a.length-1;c++)h.expandToInclude(a[c]);this._env=h}return this._env}},{key:"addReachable",value:function(h){var o=new kA;for(o.add(h);!o.empty();){var a=o.pop();this.add(a,o)}}},{key:"copySymDepths",value:function(h){var o=h.getSym();o.setDepth(ae.LEFT,h.getDepth(ae.RIGHT)),o.setDepth(ae.RIGHT,h.getDepth(ae.LEFT))}},{key:"add",value:function(h,o){h.setVisited(!0),this._nodes.add(h);for(var a=h.getEdges().iterator();a.hasNext();){var c=a.next();this._dirEdgeList.add(c);var g=c.getSym().getNode();g.isVisited()||o.push(g)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[K]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new _e,this._nodes=new _e,this._rightMostCoord=null,this._env=null,this._finder=new IA}}])}(),Bh=function(){return u(function h(){r(this,h)},null,[{key:"intersection",value:function(h,o,a,c){var g=h.x<o.x?h.x:o.x,m=h.y<o.y?h.y:o.y,v=h.x>o.x?h.x:o.x,S=h.y>o.y?h.y:o.y,I=a.x<c.x?a.x:c.x,L=a.y<c.y?a.y:c.y,q=a.x>c.x?a.x:c.x,ee=a.y>c.y?a.y:c.y,ne=((g>I?g:I)+(v<q?v:q))/2,ue=((m>L?m:L)+(S<ee?S:ee))/2,ge=h.x-ne,pe=h.y-ue,Ie=o.x-ne,Re=o.y-ue,ze=a.x-ne,Tt=a.y-ue,kt=c.x-ne,vr=c.y-ue,Io=pe-Re,Bm=Ie-ge,Um=ge*Re-Ie*pe,zm=Tt-vr,Vm=kt-ze,Wm=ze*vr-kt*Tt,Hm=Io*Vm-zm*Bm,ef=(Bm*Wm-Vm*Um)/Hm,tf=(zm*Um-Io*Wm)/Hm;return te.isNaN(ef)||te.isInfinite(ef)||te.isNaN(tf)||te.isInfinite(tf)?null:new J(ef+ne,tf+ue)}}])}(),un=function(){return u(function h(){r(this,h)},null,[{key:"arraycopy",value:function(h,o,a,c,g){for(var m=0,v=o;v<o+g;v++)a[c+m]=h[v],m++}},{key:"getProperty",value:function(h){return{"line.separator":`
`}[h]}}])}(),To=function(){function h(){r(this,h)}return u(h,null,[{key:"log10",value:function(o){var a=Math.log(o);return te.isInfinite(a)||te.isNaN(a)?a:a/h.LOG_10}},{key:"min",value:function(o,a,c,g){var m=o;return a<m&&(m=a),c<m&&(m=c),g<m&&(m=g),m}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],a=arguments[1],c=arguments[2];return o<a?a:o>c?c:o}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var g=arguments[0],m=arguments[1],v=arguments[2];return g<m?m:g>v?v:g}}},{key:"wrap",value:function(o,a){return o<0?a- -o%a:o%a}},{key:"max",value:function(){if(arguments.length===3){var o=arguments[1],a=arguments[2],c=arguments[0];return o>c&&(c=o),a>c&&(c=a),c}if(arguments.length===4){var g=arguments[1],m=arguments[2],v=arguments[3],S=arguments[0];return g>S&&(S=g),m>S&&(S=m),v>S&&(S=v),S}}},{key:"average",value:function(o,a){return(o+a)/2}}])}();To.LOG_10=Math.log(10);var Vn=function(){function h(){r(this,h)}return u(h,null,[{key:"segmentToSegment",value:function(o,a,c,g){if(o.equals(a))return h.pointToSegment(o,c,g);if(c.equals(g))return h.pointToSegment(g,o,a);var m=!1;if(De.intersects(o,a,c,g)){var v=(a.x-o.x)*(g.y-c.y)-(a.y-o.y)*(g.x-c.x);if(v===0)m=!0;else{var S=(o.y-c.y)*(g.x-c.x)-(o.x-c.x)*(g.y-c.y),I=((o.y-c.y)*(a.x-o.x)-(o.x-c.x)*(a.y-o.y))/v,L=S/v;(L<0||L>1||I<0||I>1)&&(m=!0)}}else m=!0;return m?To.min(h.pointToSegment(o,c,g),h.pointToSegment(a,c,g),h.pointToSegment(c,o,a),h.pointToSegment(g,o,a)):0}},{key:"pointToSegment",value:function(o,a,c){if(a.x===c.x&&a.y===c.y)return o.distance(a);var g=(c.x-a.x)*(c.x-a.x)+(c.y-a.y)*(c.y-a.y),m=((o.x-a.x)*(c.x-a.x)+(o.y-a.y)*(c.y-a.y))/g;if(m<=0)return o.distance(a);if(m>=1)return o.distance(c);var v=((a.y-o.y)*(c.x-a.x)-(a.x-o.x)*(c.y-a.y))/g;return Math.abs(v)*Math.sqrt(g)}},{key:"pointToLinePerpendicular",value:function(o,a,c){var g=(c.x-a.x)*(c.x-a.x)+(c.y-a.y)*(c.y-a.y),m=((a.y-o.y)*(c.x-a.x)-(a.x-o.x)*(c.y-a.y))/g;return Math.abs(m)*Math.sqrt(g)}},{key:"pointToSegmentString",value:function(o,a){if(a.length===0)throw new D("Line array must contain at least one vertex");for(var c=o.distance(a[0]),g=0;g<a.length-1;g++){var m=h.pointToSegment(o,a[g],a[g+1]);m<c&&(c=m)}return c}}])}(),J_=function(){return u(function h(){r(this,h)},[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||Se(arguments[0],ke);else if(arguments.length!==2){if(arguments.length===3){var h=arguments[0],o=arguments[1];return this.create(h,o)}}}}])}(),fl=function(){return u(function h(){r(this,h)},[{key:"filter",value:function(h){}}])}(),OA=function(){return u(function h(){r(this,h)},null,[{key:"ofLine",value:function(h){var o=h.size();if(o<=1)return 0;var a=0,c=new J;h.getCoordinate(0,c);for(var g=c.x,m=c.y,v=1;v<o;v++){h.getCoordinate(v,c);var S=c.x,I=c.y,L=S-g,q=I-m;a+=Math.sqrt(L*L+q*q),g=S,m=I}return a}}])}(),em=u(function h(){r(this,h)}),dr=function(){function h(){r(this,h)}return u(h,null,[{key:"copyCoord",value:function(o,a,c,g){for(var m=Math.min(o.getDimension(),c.getDimension()),v=0;v<m;v++)c.setOrdinate(g,v,o.getOrdinate(a,v))}},{key:"isRing",value:function(o){var a=o.size();return a===0||!(a<=3)&&o.getOrdinate(0,ke.X)===o.getOrdinate(a-1,ke.X)&&o.getOrdinate(0,ke.Y)===o.getOrdinate(a-1,ke.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(Se(arguments[0],ke)&&Number.isInteger(arguments[1])){var o=arguments[0],a=arguments[1];h.scroll(o,a,h.isRing(o))}else if(Se(arguments[0],ke)&&arguments[1]instanceof J){var c=arguments[0],g=arguments[1],m=h.indexOf(g,c);if(m<=0)return null;h.scroll(c,m)}}else if(arguments.length===3){var v=arguments[0],S=arguments[1],I=arguments[2];if(S<=0)return null;for(var L=v.copy(),q=I?v.size()-1:v.size(),ee=0;ee<q;ee++)for(var ne=0;ne<v.getDimension();ne++)v.setOrdinate(ee,ne,L.getOrdinate((S+ee)%q,ne));if(I)for(var ue=0;ue<v.getDimension();ue++)v.setOrdinate(q,ue,v.getOrdinate(0,ue))}}},{key:"isEqual",value:function(o,a){var c=o.size();if(c!==a.size())return!1;for(var g=Math.min(o.getDimension(),a.getDimension()),m=0;m<c;m++)for(var v=0;v<g;v++){var S=o.getOrdinate(m,v),I=a.getOrdinate(m,v);if(o.getOrdinate(m,v)!==a.getOrdinate(m,v)&&(!te.isNaN(S)||!te.isNaN(I)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var o=arguments[0];return h.minCoordinateIndex(o,0,o.size()-1)}if(arguments.length===3){for(var a=arguments[0],c=arguments[2],g=-1,m=null,v=arguments[1];v<=c;v++){var S=a.getCoordinate(v);(m===null||m.compareTo(S)>0)&&(m=S,g=v)}return g}}},{key:"extend",value:function(o,a,c){var g=o.create(c,a.getDimension()),m=a.size();if(h.copy(a,0,g,0,m),m>0)for(var v=m;v<c;v++)h.copy(a,m-1,g,v,1);return g}},{key:"reverse",value:function(o){for(var a=o.size()-1,c=Math.trunc(a/2),g=0;g<=c;g++)h.swap(o,g,a-g)}},{key:"swap",value:function(o,a,c){if(a===c)return null;for(var g=0;g<o.getDimension();g++){var m=o.getOrdinate(a,g);o.setOrdinate(a,g,o.getOrdinate(c,g)),o.setOrdinate(c,g,m)}}},{key:"copy",value:function(o,a,c,g,m){for(var v=0;v<m;v++)h.copyCoord(o,a+v,c,g+v)}},{key:"ensureValidRing",value:function(o,a){var c=a.size();return c===0?a:c<=3?h.createClosedRing(o,a,4):a.getOrdinate(0,ke.X)===a.getOrdinate(c-1,ke.X)&&a.getOrdinate(0,ke.Y)===a.getOrdinate(c-1,ke.Y)?a:h.createClosedRing(o,a,c+1)}},{key:"indexOf",value:function(o,a){for(var c=0;c<a.size();c++)if(o.x===a.getOrdinate(c,ke.X)&&o.y===a.getOrdinate(c,ke.Y))return c;return-1}},{key:"createClosedRing",value:function(o,a,c){var g=o.create(c,a.getDimension()),m=a.size();h.copy(a,0,g,0,m);for(var v=m;v<c;v++)h.copy(a,0,g,v,1);return g}},{key:"minCoordinate",value:function(o){for(var a=null,c=0;c<o.size();c++){var g=o.getCoordinate(c);(a===null||a.compareTo(g)>0)&&(a=g)}return a}}])}(),le=function(){function h(){r(this,h)}return u(h,null,[{key:"toDimensionSymbol",value:function(o){switch(o){case h.FALSE:return h.SYM_FALSE;case h.TRUE:return h.SYM_TRUE;case h.DONTCARE:return h.SYM_DONTCARE;case h.P:return h.SYM_P;case h.L:return h.SYM_L;case h.A:return h.SYM_A}throw new D("Unknown dimension value: "+o)}},{key:"toDimensionValue",value:function(o){switch(Dh.toUpperCase(o)){case h.SYM_FALSE:return h.FALSE;case h.SYM_TRUE:return h.TRUE;case h.SYM_DONTCARE:return h.DONTCARE;case h.SYM_P:return h.P;case h.SYM_L:return h.L;case h.SYM_A:return h.A}throw new D("Unknown dimension symbol: "+o)}}])}();le.P=0,le.L=1,le.A=2,le.FALSE=-1,le.TRUE=-2,le.DONTCARE=-3,le.SYM_FALSE="F",le.SYM_TRUE="T",le.SYM_DONTCARE="*",le.SYM_P="0",le.SYM_L="1",le.SYM_A="2";var dl=function(){return u(function h(){r(this,h)},[{key:"filter",value:function(h){}}])}(),gl=function(){return u(function h(){r(this,h)},[{key:"filter",value:function(h,o){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])}(),So=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new De:this._points.expandEnvelope(new De)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new o(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var a=arguments[0],c=arguments[1];if(!this.isEquivalentClass(a))return!1;var g=a;if(this._points.size()!==g._points.size())return!1;for(var m=0;m<this._points.size();m++)if(!this.equal(this._points.getCoordinate(m),g._points.getCoordinate(m),c))return!1;return!0}return T(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var a=0;a<Math.trunc(this._points.size()/2);a++){var c=this._points.size()-1-a;if(!this._points.getCoordinate(a).equals(this._points.getCoordinate(c))){if(this._points.getCoordinate(a).compareTo(this._points.getCoordinate(c))>0){var g=this._points.copy();dr.reverse(g),this._points=g}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?le.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var a=this._points.copy();return dr.reverse(a),this.getFactory().createLineString(a)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return OA.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var a=arguments[0],c=0,g=0;c<this._points.size()&&g<a._points.size();){var m=this._points.getCoordinate(c).compareTo(a._points.getCoordinate(g));if(m!==0)return m;c++,g++}return c<this._points.size()?1:g<a._points.size()?-1:0}if(arguments.length===2){var v=arguments[0];return arguments[1].compare(this._points,v._points)}}},{key:"apply",value:function(){if(Se(arguments[0],fl))for(var a=arguments[0],c=0;c<this._points.size();c++)a.filter(this._points.getCoordinate(c));else if(Se(arguments[0],gl)){var g=arguments[0];if(this._points.size()===0)return null;for(var m=0;m<this._points.size()&&(g.filter(this._points,m),!g.isDone());m++);g.isGeometryChanged()&&this.geometryChanged()}else Se(arguments[0],dl)?arguments[0].filter(this):Se(arguments[0],W)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new Oe}},{key:"isEquivalentClass",value:function(a){return a instanceof o}},{key:"getCoordinateN",value:function(a){return this._points.getCoordinate(a)}},{key:"getGeometryType",value:function(){return fe.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(a){if(a===null&&(a=this.getFactory().getCoordinateSequenceFactory().create([])),a.size()===1)throw new D("Invalid number of points in LineString (found "+a.size()+" - must be 0 or >= 2)");this._points=a}},{key:"isCoordinate",value:function(a){for(var c=0;c<this._points.size();c++)if(this._points.getCoordinate(c).equals(a))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(a){return this.getFactory().createPoint(this._points.getCoordinate(a))}},{key:"interfaces_",get:function(){return[em]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var a=arguments[0],c=arguments[1];fe.constructor_.call(this,c),this.init(a)}}}}])}(fe),tm=u(function h(){r(this,h)}),Uh=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new De;var a=new De;return a.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),a}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new o(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var a=arguments[0],c=arguments[1];return!!this.isEquivalentClass(a)&&(!(!this.isEmpty()||!a.isEmpty())||this.isEmpty()===a.isEmpty()&&this.equal(a.getCoordinate(),this.getCoordinate(),c))}return T(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return fe.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0];return this.getCoordinate().compareTo(a.getCoordinate())}if(arguments.length===2){var c=arguments[0];return arguments[1].compare(this._coordinates,c._coordinates)}}},{key:"apply",value:function(){if(Se(arguments[0],fl)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this.getCoordinate())}else if(Se(arguments[0],gl)){var c=arguments[0];if(this.isEmpty())return null;c.filter(this._coordinates,0),c.isGeometryChanged()&&this.geometryChanged()}else Se(arguments[0],dl)?arguments[0].filter(this):Se(arguments[0],W)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return fe.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(a){a===null&&(a=this.getFactory().getCoordinateSequenceFactory().create([])),he.isTrue(a.size()<=1),this._coordinates=a}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[tm]}}],[{key:"constructor_",value:function(){this._coordinates=null;var a=arguments[0],c=arguments[1];fe.constructor_.call(this,c),this.init(a)}}])}(fe),nm=function(){function h(){r(this,h)}return u(h,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var o=arguments[0];return Math.abs(h.ofRingSigned(o))}if(Se(arguments[0],ke)){var a=arguments[0];return Math.abs(h.ofRingSigned(a))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var o=arguments[0];if(o.length<3)return 0;for(var a=0,c=o[0].x,g=1;g<o.length-1;g++){var m=o[g].x-c,v=o[g+1].y;a+=m*(o[g-1].y-v)}return a/2}if(Se(arguments[0],ke)){var S=arguments[0],I=S.size();if(I<3)return 0;var L=new J,q=new J,ee=new J;S.getCoordinate(0,q),S.getCoordinate(1,ee);var ne=q.x;ee.x-=ne;for(var ue=0,ge=1;ge<I-1;ge++)L.y=q.y,q.x=ee.x,q.y=ee.y,S.getCoordinate(ge+1,ee),ee.x-=ne,ue+=q.x*(L.y-ee.y);return ue/2}}}])}(),gr=function(){return u(function h(){r(this,h)},null,[{key:"sort",value:function(){var h=arguments,o=arguments[0];if(arguments.length===1)o.sort(function(ne,ue){return ne.compareTo(ue)});else if(arguments.length===2)o.sort(function(ne,ue){return h[1].compare(ne,ue)});else if(arguments.length===3){var a=o.slice(arguments[1],arguments[2]);a.sort();var c=o.slice(0,arguments[1]).concat(a,o.slice(arguments[2],o.length));o.splice(0,o.length);var g,m=f(c);try{for(m.s();!(g=m.n()).done;){var v=g.value;o.push(v)}}catch(ne){m.e(ne)}finally{m.f()}}else if(arguments.length===4){var S=o.slice(arguments[1],arguments[2]);S.sort(function(ne,ue){return h[3].compare(ne,ue)});var I=o.slice(0,arguments[1]).concat(S,o.slice(arguments[2],o.length));o.splice(0,o.length);var L,q=f(I);try{for(q.s();!(L=q.n()).done;){var ee=L.value;o.push(ee)}}catch(ne){q.e(ne)}finally{q.f()}}}},{key:"asList",value:function(h){var o,a=new _e,c=f(h);try{for(c.s();!(o=c.n()).done;){var g=o.value;a.add(g)}}catch(m){c.e(m)}finally{c.f()}return a}},{key:"copyOf",value:function(h,o){return h.slice(0,o)}}])}(),im=u(function h(){r(this,h)}),pl=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var a=new Array(this.getNumPoints()).fill(null),c=-1,g=this._shell.getCoordinates(),m=0;m<g.length;m++)a[++c]=g[m];for(var v=0;v<this._holes.length;v++)for(var S=this._holes[v].getCoordinates(),I=0;I<S.length;I++)a[++c]=S[I];return a}},{key:"getArea",value:function(){var a=0;a+=nm.ofRing(this._shell.getCoordinateSequence());for(var c=0;c<this._holes.length;c++)a-=nm.ofRing(this._holes[c].getCoordinateSequence());return a}},{key:"copyInternal",value:function(){for(var a=this._shell.copy(),c=new Array(this._holes.length).fill(null),g=0;g<this._holes.length;g++)c[g]=this._holes[g].copy();return new o(a,c,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var a=this._shell.getCoordinateSequence(),c=this.getEnvelopeInternal(),g=0;g<5;g++){var m=a.getX(g);if(m!==c.getMinX()&&m!==c.getMaxX())return!1;var v=a.getY(g);if(v!==c.getMinY()&&v!==c.getMaxY())return!1}for(var S=a.getX(0),I=a.getY(0),L=1;L<=4;L++){var q=a.getX(L),ee=a.getY(L);if(q!==S==(ee!==I))return!1;S=q,I=ee}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var a=arguments[0],c=arguments[1];if(!this.isEquivalentClass(a))return!1;var g=a,m=this._shell,v=g._shell;if(!m.equalsExact(v,c)||this._holes.length!==g._holes.length)return!1;for(var S=0;S<this._holes.length;S++)if(!this._holes[S].equalsExact(g._holes[S],c))return!1;return!0}return T(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var a=0;a<this._holes.length;a++)this._holes[a]=this.normalized(this._holes[a],!1);gr.sort(this._holes)}else if(arguments.length===2){var c=arguments[0],g=arguments[1];if(c.isEmpty())return null;var m=c.getCoordinateSequence(),v=dr.minCoordinateIndex(m,0,m.size()-2);dr.scroll(m,v,!0),ve.isCCW(m)===g&&dr.reverse(m)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var a=this.getExteriorRing().reverse(),c=new Array(this.getNumInteriorRing()).fill(null),g=0;g<c.length;g++)c[g]=this.getInteriorRingN(g).reverse();return this.getFactory().createPolygon(a,c)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var a=0;a+=this._shell.getLength();for(var c=0;c<this._holes.length;c++)a+=this._holes[c].getLength();return a}},{key:"getNumPoints",value:function(){for(var a=this._shell.getNumPoints(),c=0;c<this._holes.length;c++)a+=this._holes[c].getNumPoints();return a}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(a,c){var g=a.copy();return this.normalize(g,c),g}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0],c=this._shell,g=a._shell;return c.compareToSameClass(g)}if(arguments.length===2){var m=arguments[1],v=arguments[0],S=this._shell,I=v._shell,L=S.compareToSameClass(I,m);if(L!==0)return L;for(var q=this.getNumInteriorRing(),ee=v.getNumInteriorRing(),ne=0;ne<q&&ne<ee;){var ue=this.getInteriorRingN(ne),ge=v.getInteriorRingN(ne),pe=ue.compareToSameClass(ge,m);if(pe!==0)return pe;ne++}return ne<q?1:ne<ee?-1:0}}},{key:"apply",value:function(){if(Se(arguments[0],fl)){var a=arguments[0];this._shell.apply(a);for(var c=0;c<this._holes.length;c++)this._holes[c].apply(a)}else if(Se(arguments[0],gl)){var g=arguments[0];if(this._shell.apply(g),!g.isDone())for(var m=0;m<this._holes.length&&(this._holes[m].apply(g),!g.isDone());m++);g.isGeometryChanged()&&this.geometryChanged()}else if(Se(arguments[0],dl))arguments[0].filter(this);else if(Se(arguments[0],W)){var v=arguments[0];v.filter(this),this._shell.apply(v);for(var S=0;S<this._holes.length;S++)this._holes[S].apply(v)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var a=new Array(this._holes.length+1).fill(null);a[0]=this._shell;for(var c=0;c<this._holes.length;c++)a[c+1]=this._holes[c];return a.length<=1?this.getFactory().createLinearRing(a[0].getCoordinateSequence()):this.getFactory().createMultiLineString(a)}},{key:"getGeometryType",value:function(){return fe.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(a){return this._holes[a]}},{key:"interfaces_",get:function(){return[im]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var a=arguments[0],c=arguments[1],g=arguments[2];if(fe.constructor_.call(this,g),a===null&&(a=this.getFactory().createLinearRing()),c===null&&(c=[]),fe.hasNullElements(c))throw new D("holes must not contain null elements");if(a.isEmpty()&&fe.hasNonEmptyElements(c))throw new D("shell is empty but holes are not");this._shell=a,this._holes=c}}])}(fe),LA=function(h){function o(){return r(this,o),i(this,o,arguments)}return _(o,h),u(o)}(G_),rm=function(h){function o(a){var c;return r(this,o),(c=i(this,o)).array=[],a instanceof Ze&&c.addAll(a),c}return _(o,h),u(o,[{key:"contains",value:function(a){var c,g=f(this.array);try{for(g.s();!(c=g.n()).done;)if(c.value.compareTo(a)===0)return!0}catch(m){g.e(m)}finally{g.f()}return!1}},{key:"add",value:function(a){if(this.contains(a))return!1;for(var c=0,g=this.array.length;c<g;c++)if(this.array[c].compareTo(a)===1)return!!this.array.splice(c,0,a);return this.array.push(a),!0}},{key:"addAll",value:function(a){var c,g=f(a);try{for(g.s();!(c=g.n()).done;){var m=c.value;this.add(m)}}catch(v){g.e(v)}finally{g.f()}return!0}},{key:"remove",value:function(){throw new Oe}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new DA(this.array)}}])}(LA),DA=function(){return u(function h(o){r(this,h),this.array=o,this.position=0},[{key:"next",value:function(){if(this.position===this.array.length)throw new ut;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Oe}}])}(),Gt=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"computeEnvelopeInternal",value:function(){for(var a=new De,c=0;c<this._geometries.length;c++)a.expandToInclude(this._geometries[c].getEnvelopeInternal());return a}},{key:"getGeometryN",value:function(a){return this._geometries[a]}},{key:"getCoordinates",value:function(){for(var a=new Array(this.getNumPoints()).fill(null),c=-1,g=0;g<this._geometries.length;g++)for(var m=this._geometries[g].getCoordinates(),v=0;v<m.length;v++)a[++c]=m[v];return a}},{key:"getArea",value:function(){for(var a=0,c=0;c<this._geometries.length;c++)a+=this._geometries[c].getArea();return a}},{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),c=0;c<a.length;c++)a[c]=this._geometries[c].copy();return new o(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var a=arguments[0],c=arguments[1];if(!this.isEquivalentClass(a))return!1;var g=a;if(this._geometries.length!==g._geometries.length)return!1;for(var m=0;m<this._geometries.length;m++)if(!this._geometries[m].equalsExact(g._geometries[m],c))return!1;return!0}return T(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var a=0;a<this._geometries.length;a++)this._geometries[a].normalize();gr.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var a=le.FALSE,c=0;c<this._geometries.length;c++)a=Math.max(a,this._geometries[c].getBoundaryDimension());return a}},{key:"reverseInternal",value:function(){for(var a=this._geometries.length,c=new _e(a),g=0;g<a;g++)c.add(this._geometries[g].reverse());return this.getFactory().buildGeometry(c)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var a=le.FALSE,c=0;c<this._geometries.length;c++)a=Math.max(a,this._geometries[c].getDimension());return a}},{key:"getLength",value:function(){for(var a=0,c=0;c<this._geometries.length;c++)a+=this._geometries[c].getLength();return a}},{key:"getNumPoints",value:function(){for(var a=0,c=0;c<this._geometries.length;c++)a+=this._geometries[c].getNumPoints();return a}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0],c=new rm(gr.asList(this._geometries)),g=new rm(gr.asList(a._geometries));return this.compare(c,g)}if(arguments.length===2){for(var m=arguments[1],v=arguments[0],S=this.getNumGeometries(),I=v.getNumGeometries(),L=0;L<S&&L<I;){var q=this.getGeometryN(L),ee=v.getGeometryN(L),ne=q.compareToSameClass(ee,m);if(ne!==0)return ne;L++}return L<S?1:L<I?-1:0}}},{key:"apply",value:function(){if(Se(arguments[0],fl))for(var a=arguments[0],c=0;c<this._geometries.length;c++)this._geometries[c].apply(a);else if(Se(arguments[0],gl)){var g=arguments[0];if(this._geometries.length===0)return null;for(var m=0;m<this._geometries.length&&(this._geometries[m].apply(g),!g.isDone());m++);g.isGeometryChanged()&&this.geometryChanged()}else if(Se(arguments[0],dl)){var v=arguments[0];v.filter(this);for(var S=0;S<this._geometries.length;S++)this._geometries[S].apply(v)}else if(Se(arguments[0],W)){var I=arguments[0];I.filter(this);for(var L=0;L<this._geometries.length;L++)this._geometries[L].apply(I)}}},{key:"getBoundary",value:function(){return fe.checkNotGeometryCollection(this),he.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return fe.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var a=0;a<this._geometries.length;a++)if(!this._geometries[a].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var a=arguments[0],c=arguments[1];if(fe.constructor_.call(this,c),a===null&&(a=[]),fe.hasNullElements(a))throw new D("geometries must not contain null elements");this._geometries=a}}}}])}(fe),zh=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),c=0;c<a.length;c++)a[c]=this._geometries[c].copy();return new o(a,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var a=arguments[0],c=arguments[1];return!!this.isEquivalentClass(a)&&T(o,"equalsExact",this,1).call(this,a,c)}return T(o,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var a=arguments[0];return this._geometries[a].getCoordinate()}return T(o,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"getTypeCode",value:function(){return fe.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return fe.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[tm]}}],[{key:"constructor_",value:function(){var a=arguments[0],c=arguments[1];Gt.constructor_.call(this,a,c)}}])}(Gt),xo=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"copyInternal",value:function(){return new o(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||T(o,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var a=this._points.copy();return dr.reverse(a),this.getFactory().createLinearRing(a)}},{key:"getTypeCode",value:function(){return fe.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!T(o,"isClosed",this,1).call(this))throw new D("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<o.MINIMUM_VALID_SIZE)throw new D("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return fe.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var a=arguments[0],c=arguments[1];So.constructor_.call(this,a,c),this.validateConstruction()}}])}(So);xo.MINIMUM_VALID_SIZE=4;var pr=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"setOrdinate",value:function(a,c){switch(a){case o.X:this.x=c;break;case o.Y:this.y=c;break;default:throw new D("Invalid ordinate index: "+a)}}},{key:"getZ",value:function(){return J.NULL_ORDINATE}},{key:"getOrdinate",value:function(a){switch(a){case o.X:return this.x;case o.Y:return this.y}throw new D("Invalid ordinate index: "+a)}},{key:"setZ",value:function(a){throw new D("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)J.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof o){var a=arguments[0];J.constructor_.call(this,a.x,a.y)}else if(arguments[0]instanceof J){var c=arguments[0];J.constructor_.call(this,c.x,c.y)}}else if(arguments.length===2){var g=arguments[0],m=arguments[1];J.constructor_.call(this,g,m,J.NULL_ORDINATE)}}}])}(J);pr.X=0,pr.Y=1,pr.Z=-1,pr.M=-1;var _r=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(a,c){switch(a){case o.X:this.x=c;break;case o.Y:this.y=c;break;case o.M:this._m=c;break;default:throw new D("Invalid ordinate index: "+a)}}},{key:"setM",value:function(a){this._m=a}},{key:"getZ",value:function(){return J.NULL_ORDINATE}},{key:"getOrdinate",value:function(a){switch(a){case o.X:return this.x;case o.Y:return this.y;case o.M:return this._m}throw new D("Invalid ordinate index: "+a)}},{key:"setZ",value:function(a){throw new D("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ(),this._m=a.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)J.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof o){var a=arguments[0];J.constructor_.call(this,a.x,a.y),this._m=a._m}else if(arguments[0]instanceof J){var c=arguments[0];J.constructor_.call(this,c.x,c.y),this._m=this.getM()}}else if(arguments.length===3){var g=arguments[0],m=arguments[1],v=arguments[2];J.constructor_.call(this,g,m,J.NULL_ORDINATE),this._m=v}}}])}(J);_r.X=0,_r.Y=1,_r.Z=-1,_r.M=2;var Vh=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(a,c){switch(a){case J.X:this.x=c;break;case J.Y:this.y=c;break;case J.Z:this.z=c;break;case J.M:this._m=c;break;default:throw new D("Invalid ordinate index: "+a)}}},{key:"setM",value:function(a){this._m=a}},{key:"getOrdinate",value:function(a){switch(a){case J.X:return this.x;case J.Y:return this.y;case J.Z:return this.getZ();case J.M:return this.getM()}throw new D("Invalid ordinate index: "+a)}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ(),this._m=a.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)J.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof o){var a=arguments[0];J.constructor_.call(this,a),this._m=a._m}else if(arguments[0]instanceof J){var c=arguments[0];J.constructor_.call(this,c),this._m=this.getM()}}else if(arguments.length===4){var g=arguments[0],m=arguments[1],v=arguments[2],S=arguments[3];J.constructor_.call(this,g,m,v),this._m=S}}}])}(J),_l=function(){function h(){r(this,h)}return u(h,null,[{key:"measures",value:function(o){return o instanceof pr?0:o instanceof _r||o instanceof Vh?1:0}},{key:"dimension",value:function(o){return o instanceof pr?2:o instanceof _r?3:o instanceof Vh?4:3}},{key:"create",value:function(){if(arguments.length===1){var o=arguments[0];return h.create(o,0)}if(arguments.length===2){var a=arguments[0],c=arguments[1];return a===2?new pr:a===3&&c===0?new J:a===3&&c===1?new _r:a===4&&c===1?new Vh:new J}}}])}(),Ao=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"getCoordinate",value:function(a){return this.get(a)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&Se(arguments[0],Ze)){for(var a=arguments[1],c=!1,g=arguments[0].iterator();g.hasNext();)this.add(g.next(),a),c=!0;return c}return T(o,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var a=T(o,"clone",this,1).call(this),c=0;c<this.size();c++)a.add(c,this.get(c).clone());return a}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(o.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(o.coordArrayType);for(var a=this.size(),c=new Array(a).fill(null),g=0;g<a;g++)c[g]=this.get(a-g-1);return c}}},{key:"add",value:function(){if(arguments.length===1){var a=arguments[0];return T(o,"add",this,1).call(this,a)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var c=arguments[0],g=arguments[1];return this.add(c,g,!0),!0}if(arguments[0]instanceof J&&typeof arguments[1]=="boolean"){var m=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(m))return null;T(o,"add",this,1).call(this,m)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var v=arguments[0],S=arguments[1];return this.add(v,S),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var I=arguments[0],L=arguments[1];if(arguments[2])for(var q=0;q<I.length;q++)this.add(I[q],L);else for(var ee=I.length-1;ee>=0;ee--)this.add(I[ee],L);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof J){var ne=arguments[0],ue=arguments[1];if(!arguments[2]){var ge=this.size();if(ge>0&&(ne>0&&this.get(ne-1).equals2D(ue)||ne<ge&&this.get(ne).equals2D(ue)))return null}T(o,"add",this,1).call(this,ne,ue)}}else if(arguments.length===4){var pe=arguments[0],Ie=arguments[1],Re=arguments[2],ze=arguments[3],Tt=1;Re>ze&&(Tt=-1);for(var kt=Re;kt!==ze;kt+=Tt)this.add(pe[kt],Ie);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var a=this.get(0).copy();this.add(a,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var a=arguments[0];this.ensureCapacity(a.length),this.add(a,!0)}else if(arguments.length===2){var c=arguments[0],g=arguments[1];this.ensureCapacity(c.length),this.add(c,g)}}}}])}(_e);Ao.coordArrayType=new Array(0).fill(null);var dt=function(){function h(){r(this,h)}return u(h,null,[{key:"isRing",value:function(o){return!(o.length<4)&&!!o[0].equals2D(o[o.length-1])}},{key:"ptNotInList",value:function(o,a){for(var c=0;c<o.length;c++){var g=o[c];if(h.indexOf(g,a)<0)return g}return null}},{key:"scroll",value:function(o,a){var c=h.indexOf(a,o);if(c<0)return null;var g=new Array(o.length).fill(null);un.arraycopy(o,c,g,0,o.length-c),un.arraycopy(o,0,g,o.length-c,c),un.arraycopy(g,0,o,0,o.length)}},{key:"equals",value:function(){if(arguments.length===2){var o=arguments[0],a=arguments[1];if(o===a)return!0;if(o===null||a===null||o.length!==a.length)return!1;for(var c=0;c<o.length;c++)if(!o[c].equals(a[c]))return!1;return!0}if(arguments.length===3){var g=arguments[0],m=arguments[1],v=arguments[2];if(g===m)return!0;if(g===null||m===null||g.length!==m.length)return!1;for(var S=0;S<g.length;S++)if(v.compare(g[S],m[S])!==0)return!1;return!0}}},{key:"intersection",value:function(o,a){for(var c=new Ao,g=0;g<o.length;g++)a.intersects(o[g])&&c.add(o[g],!0);return c.toCoordinateArray()}},{key:"measures",value:function(o){if(o===null||o.length===0)return 0;var a,c=0,g=f(o);try{for(g.s();!(a=g.n()).done;){var m=a.value;c=Math.max(c,_l.measures(m))}}catch(v){g.e(v)}finally{g.f()}return c}},{key:"hasRepeatedPoints",value:function(o){for(var a=1;a<o.length;a++)if(o[a-1].equals(o[a]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(o){return h.hasRepeatedPoints(o)?new Ao(o,!1).toCoordinateArray():o}},{key:"reverse",value:function(o){for(var a=o.length-1,c=Math.trunc(a/2),g=0;g<=c;g++){var m=o[g];o[g]=o[a-g],o[a-g]=m}}},{key:"removeNull",value:function(o){for(var a=0,c=0;c<o.length;c++)o[c]!==null&&a++;var g=new Array(a).fill(null);if(a===0)return g;for(var m=0,v=0;v<o.length;v++)o[v]!==null&&(g[m++]=o[v]);return g}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var o=arguments[0],a=new Array(o.length).fill(null),c=0;c<o.length;c++)a[c]=o[c].copy();return a}if(arguments.length===5)for(var g=arguments[0],m=arguments[1],v=arguments[2],S=arguments[3],I=arguments[4],L=0;L<I;L++)v[S+L]=g[m+L].copy()}},{key:"isEqualReversed",value:function(o,a){for(var c=0;c<o.length;c++){var g=o[c],m=a[o.length-c-1];if(g.compareTo(m)!==0)return!1}return!0}},{key:"envelope",value:function(o){for(var a=new De,c=0;c<o.length;c++)a.expandToInclude(o[c]);return a}},{key:"toCoordinateArray",value:function(o){return o.toArray(h.coordArrayType)}},{key:"dimension",value:function(o){if(o===null||o.length===0)return 3;var a,c=0,g=f(o);try{for(g.s();!(a=g.n()).done;){var m=a.value;c=Math.max(c,_l.dimension(m))}}catch(v){g.e(v)}finally{g.f()}return c}},{key:"atLeastNCoordinatesOrNothing",value:function(o,a){return a.length>=o?a:[]}},{key:"indexOf",value:function(o,a){for(var c=0;c<a.length;c++)if(o.equals(a[c]))return c;return-1}},{key:"increasingDirection",value:function(o){for(var a=0;a<Math.trunc(o.length/2);a++){var c=o.length-1-a,g=o[a].compareTo(o[c]);if(g!==0)return g}return 1}},{key:"compare",value:function(o,a){for(var c=0;c<o.length&&c<a.length;){var g=o[c].compareTo(a[c]);if(g!==0)return g;c++}return c<a.length?-1:c<o.length?1:0}},{key:"minCoordinate",value:function(o){for(var a=null,c=0;c<o.length;c++)(a===null||a.compareTo(o[c])>0)&&(a=o[c]);return a}},{key:"extract",value:function(o,a,c){a=To.clamp(a,0,o.length);var g=(c=To.clamp(c,-1,o.length))-a+1;c<0&&(g=0),a>=o.length&&(g=0),c<a&&(g=0);var m=new Array(g).fill(null);if(g===0)return m;for(var v=0,S=a;S<=c;S++)m[v++]=o[S];return m}}])}(),FA=function(){return u(function h(){r(this,h)},[{key:"compare",value:function(h,o){var a=h,c=o;return dt.compare(a,c)}},{key:"interfaces_",get:function(){return[ie]}}])}(),BA=function(){return u(function h(){r(this,h)},[{key:"compare",value:function(h,o){var a=h,c=o;if(a.length<c.length)return-1;if(a.length>c.length)return 1;if(a.length===0)return 0;var g=dt.compare(a,c);return dt.isEqualReversed(a,c)?0:g}},{key:"OLDcompare",value:function(h,o){var a=h,c=o;if(a.length<c.length)return-1;if(a.length>c.length)return 1;if(a.length===0)return 0;for(var g=dt.increasingDirection(a),m=dt.increasingDirection(c),v=g>0?0:a.length-1,S=m>0?0:a.length-1,I=0;I<a.length;I++){var L=a[v].compareTo(c[S]);if(L!==0)return L;v+=g,S+=m}return 0}},{key:"interfaces_",get:function(){return[ie]}}])}();dt.ForwardComparator=FA,dt.BidirectionalComparator=BA,dt.coordArrayType=new Array(0).fill(null);var ml=function(){return u(function h(o){r(this,h),this.str=o},[{key:"append",value:function(h){this.str+=h}},{key:"setCharAt",value:function(h,o){this.str=this.str.substr(0,h)+o+this.str.substr(h+1)}},{key:"toString",value:function(){return this.str}}])}(),bo=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"getM",value:function(o){return this.hasM()?this._coordinates[o].getM():te.NaN}},{key:"setOrdinate",value:function(o,a,c){switch(a){case ke.X:this._coordinates[o].x=c;break;case ke.Y:this._coordinates[o].y=c;break;default:this._coordinates[o].setOrdinate(a,c)}}},{key:"getZ",value:function(o){return this.hasZ()?this._coordinates[o].getZ():te.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(o,a){switch(a){case ke.X:return this._coordinates[o].x;case ke.Y:return this._coordinates[o].y;default:return this._coordinates[o].getOrdinate(a)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var o=arguments[0];return this._coordinates[o]}if(arguments.length===2){var a=arguments[0];arguments[1].setCoordinate(this._coordinates[a])}}},{key:"getCoordinateCopy",value:function(o){var a=this.createCoordinate();return a.setCoordinate(this._coordinates[o]),a}},{key:"createCoordinate",value:function(){return _l.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(o){return this._coordinates[o].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(o){for(var a=0;a<this._coordinates.length;a++)o.expandToInclude(this._coordinates[a]);return o}},{key:"copy",value:function(){for(var o=new Array(this.size()).fill(null),a=0;a<this._coordinates.length;a++){var c=this.createCoordinate();c.setCoordinate(this._coordinates[a]),o[a]=c}return new h(o,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var o=new ml(17*this._coordinates.length);o.append("("),o.append(this._coordinates[0]);for(var a=1;a<this._coordinates.length;a++)o.append(", "),o.append(this._coordinates[a]);return o.append(")"),o.toString()}return"()"}},{key:"getY",value:function(o){return this._coordinates[o].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[ke,R]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];h.constructor_.call(this,o,dt.dimension(o),dt.measures(o))}else if(Number.isInteger(arguments[0])){var a=arguments[0];this._coordinates=new Array(a).fill(null);for(var c=0;c<a;c++)this._coordinates[c]=new J}else if(Se(arguments[0],ke)){var g=arguments[0];if(g===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=g.getDimension(),this._measures=g.getMeasures(),this._coordinates=new Array(g.size()).fill(null);for(var m=0;m<this._coordinates.length;m++)this._coordinates[m]=g.getCoordinateCopy(m)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var v=arguments[0],S=arguments[1];h.constructor_.call(this,v,S,dt.measures(v))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var I=arguments[0],L=arguments[1];this._coordinates=new Array(I).fill(null),this._dimension=L;for(var q=0;q<I;q++)this._coordinates[q]=_l.create(L)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var ee=arguments[0],ne=arguments[1],ue=arguments[2];this._dimension=ne,this._measures=ue,this._coordinates=ee===null?new Array(0).fill(null):ee}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var ge=arguments[0],pe=arguments[1],Ie=arguments[2];this._coordinates=new Array(ge).fill(null),this._dimension=pe,this._measures=Ie;for(var Re=0;Re<ge;Re++)this._coordinates[Re]=this.createCoordinate()}}}}])}(),Wh=function(){function h(){r(this,h)}return u(h,[{key:"readResolve",value:function(){return h.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new bo(arguments[0]);if(Se(arguments[0],ke))return new bo(arguments[0])}else{if(arguments.length===2){var o=arguments[1];return o>3&&(o=3),o<2&&(o=2),new bo(arguments[0],o)}if(arguments.length===3){var a=arguments[2],c=arguments[1]-a;return a>1&&(a=1),c>3&&(c=3),c<2&&(c=2),new bo(arguments[0],c+a,a)}}}},{key:"interfaces_",get:function(){return[J_,R]}}],[{key:"instance",value:function(){return h.instanceObject}}])}();Wh.instanceObject=new Wh;var Hh=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),c=0;c<a.length;c++)a[c]=this._geometries[c].copy();return new o(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var a=arguments[0],c=arguments[1];return!!this.isEquivalentClass(a)&&T(o,"equalsExact",this,1).call(this,a,c)}return T(o,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return fe.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var a=new _e,c=0;c<this._geometries.length;c++)for(var g=this._geometries[c].getBoundary(),m=0;m<g.getNumGeometries();m++)a.add(g.getGeometryN(m));var v=new Array(a.size()).fill(null);return this.getFactory().createMultiLineString(a.toArray(v))}},{key:"getGeometryType",value:function(){return fe.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[im]}}],[{key:"constructor_",value:function(){var a=arguments[0],c=arguments[1];Gt.constructor_.call(this,a,c)}}])}(Gt),sm=function(){return u(function h(){r(this,h)},[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])}(),UA=function(h){function o(){var a;return r(this,o),(a=i(this,o)).map=new Map,a}return _(o,h),u(o,[{key:"get",value:function(a){return this.map.get(a)||null}},{key:"put",value:function(a,c){return this.map.set(a,c),c}},{key:"values",value:function(){for(var a=new _e,c=this.map.values(),g=c.next();!g.done;)a.add(g.value),g=c.next();return a}},{key:"entrySet",value:function(){var a=new Lh;return this.map.entries().forEach(function(c){return a.add(c)}),a}},{key:"size",value:function(){return this.map.size()}}])}(sm),An=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"equals",value:function(o){if(!(o instanceof h))return!1;var a=o;return this._modelType===a._modelType&&this._scale===a._scale}},{key:"compareTo",value:function(o){var a=o,c=this.getMaximumSignificantDigits(),g=a.getMaximumSignificantDigits();return hl.compare(c,g)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===h.FLOATING||this._modelType===h.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var o="UNKNOWN";return this._modelType===h.FLOATING?o="Floating":this._modelType===h.FLOATING_SINGLE?o="Floating-Single":this._modelType===h.FIXED&&(o="Fixed (Scale="+this.getScale()+")"),o}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var o=arguments[0];return te.isNaN(o)||this._modelType===h.FLOATING_SINGLE?o:this._modelType===h.FIXED?Math.round(o*this._scale)/this._scale:o}if(arguments[0]instanceof J){var a=arguments[0];if(this._modelType===h.FLOATING)return null;a.x=this.makePrecise(a.x),a.y=this.makePrecise(a.y)}}},{key:"getMaximumSignificantDigits",value:function(){var o=16;return this._modelType===h.FLOATING?o=16:this._modelType===h.FLOATING_SINGLE?o=6:this._modelType===h.FIXED&&(o=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),o}},{key:"setScale",value:function(o){this._scale=Math.abs(o)}},{key:"interfaces_",get:function(){return[R,K]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=h.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof is){var o=arguments[0];this._modelType=o,o===h.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var a=arguments[0];this._modelType=h.FIXED,this.setScale(a)}else if(arguments[0]instanceof h){var c=arguments[0];this._modelType=c._modelType,this._scale=c._scale}}}},{key:"mostPrecise",value:function(o,a){return o.compareTo(a)>=0?o:a}}])}(),is=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"readResolve",value:function(){return h.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[R]}}],[{key:"constructor_",value:function(){this._name=null;var o=arguments[0];this._name=o,h.nameToTypeMap.put(o,this)}}])}();is.nameToTypeMap=new UA,An.Type=is,An.FIXED=new is("FIXED"),An.FLOATING=new is("FLOATING"),An.FLOATING_SINGLE=new is("FLOATING SINGLE"),An.maximumPreciseValue=9007199254740992;var jh=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),c=0;c<a.length;c++)a[c]=this._geometries[c].copy();return new o(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof fe){var a=arguments[0],c=arguments[1];return!!this.isEquivalentClass(a)&&T(o,"equalsExact",this,1).call(this,a,c)}return T(o,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?le.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var a=0;a<this._geometries.length;a++)if(!this._geometries[a].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return fe.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Oe}},{key:"getGeometryType",value:function(){return fe.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[em]}}],[{key:"constructor_",value:function(){var a=arguments[0],c=arguments[1];Gt.constructor_.call(this,a,c)}}])}(Gt),rs=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"createEmpty",value:function(o){switch(o){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new D("Invalid dimension: "+o)}}},{key:"toGeometry",value:function(o){return o.isNull()?this.createPoint():o.getMinX()===o.getMaxX()&&o.getMinY()===o.getMaxY()?this.createPoint(new J(o.getMinX(),o.getMinY())):o.getMinX()===o.getMaxX()||o.getMinY()===o.getMaxY()?this.createLineString([new J(o.getMinX(),o.getMinY()),new J(o.getMaxX(),o.getMaxY())]):this.createPolygon(this.createLinearRing([new J(o.getMinX(),o.getMinY()),new J(o.getMinX(),o.getMaxY()),new J(o.getMaxX(),o.getMaxY()),new J(o.getMaxX(),o.getMinY()),new J(o.getMinX(),o.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];return this.createLineString(o!==null?this.getCoordinateSequenceFactory().create(o):null)}if(Se(arguments[0],ke))return new So(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new jh(null,this):arguments.length===1?new jh(arguments[0],this):void 0}},{key:"buildGeometry",value:function(o){for(var a=null,c=!1,g=!1,m=o.iterator();m.hasNext();){var v=m.next(),S=v.getTypeCode();a===null&&(a=S),S!==a&&(c=!0),v instanceof Gt&&(g=!0)}if(a===null)return this.createGeometryCollection();if(c||g)return this.createGeometryCollection(h.toGeometryArray(o));var I=o.iterator().next();if(o.size()>1){if(I instanceof pl)return this.createMultiPolygon(h.toPolygonArray(o));if(I instanceof So)return this.createMultiLineString(h.toLineStringArray(o));if(I instanceof Uh)return this.createMultiPoint(h.toPointArray(o));he.shouldNeverReachHere("Unhandled geometry type: "+I.getGeometryType())}return I}},{key:"createMultiPointFromCoords",value:function(o){return this.createMultiPoint(o!==null?this.getCoordinateSequenceFactory().create(o):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof J){var o=arguments[0];return this.createPoint(o!==null?this.getCoordinateSequenceFactory().create([o]):null)}if(Se(arguments[0],ke))return new Uh(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(Se(arguments[0],ke)){var o=arguments[0];return this.createPolygon(this.createLinearRing(o))}if(arguments[0]instanceof Array){var a=arguments[0];return this.createPolygon(this.createLinearRing(a))}if(arguments[0]instanceof xo){var c=arguments[0];return this.createPolygon(c,null)}}else if(arguments.length===2)return new pl(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new Gt(null,this):arguments.length===1?new Gt(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];return this.createLinearRing(o!==null?this.getCoordinateSequenceFactory().create(o):null)}if(Se(arguments[0],ke))return new xo(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new Hh(null,this):arguments.length===1?new Hh(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new zh(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new zh(arguments[0],this);if(Se(arguments[0],ke)){var o=arguments[0];if(o===null)return this.createMultiPoint(new Array(0).fill(null));for(var a=new Array(o.size()).fill(null),c=0;c<o.size();c++){var g=this.getCoordinateSequenceFactory().create(1,o.getDimension(),o.getMeasures());dr.copy(o,c,g,0,1),a[c]=this.createPoint(g)}return this.createMultiPoint(a)}}}},{key:"interfaces_",get:function(){return[R]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)h.constructor_.call(this,new An,0);else if(arguments.length===1){if(Se(arguments[0],J_)){var o=arguments[0];h.constructor_.call(this,new An,0,o)}else if(arguments[0]instanceof An){var a=arguments[0];h.constructor_.call(this,a,0,h.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];h.constructor_.call(this,c,g,h.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var m=arguments[0],v=arguments[1],S=arguments[2];this._precisionModel=m,this._coordinateSequenceFactory=S,this._SRID=v}}},{key:"toMultiPolygonArray",value:function(o){var a=new Array(o.size()).fill(null);return o.toArray(a)}},{key:"toGeometryArray",value:function(o){if(o===null)return null;var a=new Array(o.size()).fill(null);return o.toArray(a)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return Wh.instance()}},{key:"toMultiLineStringArray",value:function(o){var a=new Array(o.size()).fill(null);return o.toArray(a)}},{key:"toLineStringArray",value:function(o){var a=new Array(o.size()).fill(null);return o.toArray(a)}},{key:"toMultiPointArray",value:function(o){var a=new Array(o.size()).fill(null);return o.toArray(a)}},{key:"toLinearRingArray",value:function(o){var a=new Array(o.size()).fill(null);return o.toArray(a)}},{key:"toPointArray",value:function(o){var a=new Array(o.size()).fill(null);return o.toArray(a)}},{key:"toPolygonArray",value:function(o){var a=new Array(o.size()).fill(null);return o.toArray(a)}},{key:"createPointFromInternalCoord",value:function(o,a){return a.getPrecisionModel().makePrecise(o),a.getFactory().createPoint(o)}}])}(),$h="XY",zA="XYZ",VA="XYM",WA="XYZM",om={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},am="EMPTY",yl=1,ui=2,Ci=3,lm=4,ss=5,HA=6;for(var jA in om)om[jA].toUpperCase();var $A=function(){return u(function h(o){r(this,h),this.wkt=o,this.index_=-1},[{key:"isAlpha_",value:function(h){return h>="a"&&h<="z"||h>="A"&&h<="Z"}},{key:"isNumeric_",value:function(h,o){return h>="0"&&h<="9"||h=="."&&!(o!==void 0&&o)}},{key:"isWhiteSpace_",value:function(h){return h==" "||h=="	"||h=="\r"||h==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var h,o=this.nextChar_(),a=this.index_,c=o;if(o=="(")h=ui;else if(o==",")h=ss;else if(o==")")h=Ci;else if(this.isNumeric_(o)||o=="-")h=lm,c=this.readNumber_();else if(this.isAlpha_(o))h=yl,c=this.readText_();else{if(this.isWhiteSpace_(o))return this.nextToken();if(o!=="")throw new Error("Unexpected character: "+o);h=HA}return{position:a,value:c,type:h}}},{key:"readNumber_",value:function(){var h,o=this.index_,a=!1,c=!1;do h=="."?a=!0:h!="e"&&h!="E"||(c=!0),h=this.nextChar_();while(this.isNumeric_(h,a)||!c&&(h=="e"||h=="E")||c&&(h=="-"||h=="+"));return parseFloat(this.wkt.substring(o,this.index_--))}},{key:"readText_",value:function(){var h,o=this.index_;do h=this.nextChar_();while(this.isAlpha_(h));return this.wkt.substring(o,this.index_--).toUpperCase()}}])}(),XA=function(){return u(function h(o,a){r(this,h),this.lexer_=o,this.token_,this.layout_=$h,this.factory=a},[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(h){return this.token_.type==h}},{key:"match",value:function(h){var o=this.isTokenType(h);return o&&this.consume_(),o}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var h=$h,o=this.token_;if(this.isTokenType(yl)){var a=o.value;a==="Z"?h=zA:a==="M"?h=VA:a==="ZM"&&(h=WA),h!==$h&&this.consume_()}return h}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(ui)){var h=[];do h.push(this.parseGeometry_());while(this.match(ss));if(this.match(Ci))return h}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(ui)){var h=this.parsePoint_();if(this.match(Ci))return h}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(ui)){var h=this.parsePointList_();if(this.match(Ci))return h}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(ui)){var h=this.parseLineStringTextList_();if(this.match(Ci))return h}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var h;if(this.match(ui)){if(h=this.token_.type==ui?this.parsePointTextList_():this.parsePointList_(),this.match(Ci))return h}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(ui)){var h=this.parseLineStringTextList_();if(this.match(Ci))return h}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(ui)){var h=this.parsePolygonTextList_();if(this.match(Ci))return h}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var h=[],o=this.layout_.length,a=0;a<o;++a){var c=this.token_;if(!this.match(lm))break;h.push(c.value)}if(h.length==o)return h;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var h=[this.parsePoint_()];this.match(ss);)h.push(this.parsePoint_());return h}},{key:"parsePointTextList_",value:function(){for(var h=[this.parsePointText_()];this.match(ss);)h.push(this.parsePointText_());return h}},{key:"parseLineStringTextList_",value:function(){for(var h=[this.parseLineStringText_()];this.match(ss);)h.push(this.parseLineStringText_());return h}},{key:"parsePolygonTextList_",value:function(){for(var h=[this.parsePolygonText_()];this.match(ss);)h.push(this.parsePolygonText_());return h}},{key:"isEmptyGeometry_",value:function(){var h=this.isTokenType(yl)&&this.token_.value==am;return h&&this.consume_(),h}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var h=this.factory,o=function(pe){return s(J,k(pe))},a=function(pe){var Ie=pe.map(function(Re){return h.createLinearRing(Re.map(o))});return Ie.length>1?h.createPolygon(Ie[0],Ie.slice(1)):h.createPolygon(Ie[0])},c=this.token_;if(this.match(yl)){var g=c.value;if(this.layout_=this.parseGeometryLayout_(),g=="GEOMETRYCOLLECTION"){var m=this.parseGeometryCollectionText_();return h.createGeometryCollection(m)}switch(g){case"POINT":var v=this.parsePointText_();return v?h.createPoint(s(J,k(v))):h.createPoint();case"LINESTRING":var S=this.parseLineStringText_().map(o);return h.createLineString(S);case"LINEARRING":var I=this.parseLineStringText_().map(o);return h.createLinearRing(I);case"POLYGON":var L=this.parsePolygonText_();return L&&L.length!==0?a(L):h.createPolygon();case"MULTIPOINT":var q=this.parseMultiPointText_();if(!q||q.length===0)return h.createMultiPoint();var ee=q.map(o).map(function(pe){return h.createPoint(pe)});return h.createMultiPoint(ee);case"MULTILINESTRING":var ne=this.parseMultiLineStringText_().map(function(pe){return h.createLineString(pe.map(o))});return h.createMultiLineString(ne);case"MULTIPOLYGON":var ue=this.parseMultiPolygonText_();if(!ue||ue.length===0)return h.createMultiPolygon();var ge=ue.map(a);return h.createMultiPolygon(ge);default:throw new Error("Invalid geometry type: "+g)}}throw new Error(this.formatErrorMessage_())}}])}();function um(h){if(h.isEmpty())return"";var o=h.getCoordinate(),a=[o.x,o.y];return o.z===void 0||Number.isNaN(o.z)||a.push(o.z),o.m===void 0||Number.isNaN(o.m)||a.push(o.m),a.join(" ")}function Ro(h){for(var o=h.getCoordinates().map(function(m){var v=[m.x,m.y];return m.z===void 0||Number.isNaN(m.z)||v.push(m.z),m.m===void 0||Number.isNaN(m.m)||v.push(m.m),v}),a=[],c=0,g=o.length;c<g;++c)a.push(o[c].join(" "));return a.join(", ")}function cm(h){var o=[];o.push("("+Ro(h.getExteriorRing())+")");for(var a=0,c=h.getNumInteriorRing();a<c;++a)o.push("("+Ro(h.getInteriorRingN(a))+")");return o.join(", ")}var YA={Point:um,LineString:Ro,LinearRing:Ro,Polygon:cm,MultiPoint:function(h){for(var o=[],a=0,c=h.getNumGeometries();a<c;++a)o.push("("+um(h.getGeometryN(a))+")");return o.join(", ")},MultiLineString:function(h){for(var o=[],a=0,c=h.getNumGeometries();a<c;++a)o.push("("+Ro(h.getGeometryN(a))+")");return o.join(", ")},MultiPolygon:function(h){for(var o=[],a=0,c=h.getNumGeometries();a<c;++a)o.push("("+cm(h.getGeometryN(a))+")");return o.join(", ")},GeometryCollection:function(h){for(var o=[],a=0,c=h.getNumGeometries();a<c;++a)o.push(hm(h.getGeometryN(a)));return o.join(", ")}};function hm(h){var o=h.getGeometryType(),a=YA[o];o=o.toUpperCase();var c=function(g){var m="";if(g.isEmpty())return m;var v=g.getCoordinate();return v.z===void 0||Number.isNaN(v.z)||(m+="Z"),v.m===void 0||Number.isNaN(v.m)||(m+="M"),m}(h);return c.length>0&&(o+=" "+c),h.isEmpty()?o+" "+am:o+" ("+a(h)+")"}var qA=function(){return u(function h(o){r(this,h),this.geometryFactory=o||new rs,this.precisionModel=this.geometryFactory.getPrecisionModel()},[{key:"read",value:function(h){var o=new $A(h);return new XA(o,this.geometryFactory).parse()}},{key:"write",value:function(h){return hm(h)}}])}(),Xh=function(){return u(function h(o){r(this,h),this.parser=new qA(o)},[{key:"write",value:function(h){return this.parser.write(h)}}],[{key:"toLineString",value:function(h,o){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+h.x+" "+h.y+", "+o.x+" "+o.y+" )"}}])}(),Ye=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"getIndexAlongSegment",value:function(o,a){return this.computeIntLineIndex(),this._intLineIndex[o][a]}},{key:"getTopologySummary",value:function(){var o=new ml;return this.isEndPoint()&&o.append(" endpoint"),this._isProper&&o.append(" proper"),this.isCollinear()&&o.append(" collinear"),o.toString()}},{key:"computeIntersection",value:function(o,a,c,g){this._inputLines[0][0]=o,this._inputLines[0][1]=a,this._inputLines[1][0]=c,this._inputLines[1][1]=g,this._result=this.computeIntersect(o,a,c,g)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var o=arguments[0];this.getEdgeDistance(o,0)>this.getEdgeDistance(o,1)?(this._intLineIndex[o][0]=0,this._intLineIndex[o][1]=1):(this._intLineIndex[o][0]=1,this._intLineIndex[o][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(o){this._precisionModel=o}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var o=arguments[0],a=0;a<this._result;a++)if(!this._intPt[a].equals2D(this._inputLines[o][0])&&!this._intPt[a].equals2D(this._inputLines[o][1]))return!0;return!1}}},{key:"getIntersection",value:function(o){return this._intPt[o]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==h.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(o,a){return h.computeEdgeDistance(this._intPt[a],this._inputLines[o][0],this._inputLines[o][1])}},{key:"isCollinear",value:function(){return this._result===h.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Xh.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Xh.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(o,a){return this._inputLines[o][a]}},{key:"isIntersection",value:function(o){for(var a=0;a<this._result;a++)if(this._intPt[a].equals2D(o))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(o,a){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[o][a]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new J,this._intPt[1]=new J,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(o,a,c){var g=Math.abs(c.x-a.x),m=Math.abs(c.y-a.y),v=-1;if(o.equals(a))v=0;else if(o.equals(c))v=g>m?g:m;else{var S=Math.abs(o.x-a.x),I=Math.abs(o.y-a.y);(v=g>m?S:I)!==0||o.equals(a)||(v=Math.max(S,I))}return he.isTrue(!(v===0&&!o.equals(a)),"Bad distance calculation"),v}},{key:"nonRobustComputeEdgeDistance",value:function(o,a,c){var g=o.x-a.x,m=o.y-a.y,v=Math.sqrt(g*g+m*m);return he.isTrue(!(v===0&&!o.equals(a)),"Invalid distance calculation"),v}}])}();Ye.DONT_INTERSECT=0,Ye.DO_INTERSECT=1,Ye.COLLINEAR=2,Ye.NO_INTERSECTION=0,Ye.POINT_INTERSECTION=1,Ye.COLLINEAR_INTERSECTION=2;var mr=function(h){function o(){return r(this,o),i(this,o)}return _(o,h),u(o,[{key:"isInSegmentEnvelopes",value:function(a){var c=new De(this._inputLines[0][0],this._inputLines[0][1]),g=new De(this._inputLines[1][0],this._inputLines[1][1]);return c.contains(a)&&g.contains(a)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return T(o,"computeIntersection",this,1).apply(this,arguments);var a=arguments[0],c=arguments[1],g=arguments[2];if(this._isProper=!1,De.intersects(c,g,a)&&ve.index(c,g,a)===0&&ve.index(g,c,a)===0)return this._isProper=!0,(a.equals(c)||a.equals(g))&&(this._isProper=!1),this._result=Ye.POINT_INTERSECTION,null;this._result=Ye.NO_INTERSECTION}},{key:"intersection",value:function(a,c,g,m){var v=this.intersectionSafe(a,c,g,m);return this.isInSegmentEnvelopes(v)||(v=new J(o.nearestEndpoint(a,c,g,m))),this._precisionModel!==null&&this._precisionModel.makePrecise(v),v}},{key:"checkDD",value:function(a,c,g,m,v){var S=Fh.intersection(a,c,g,m),I=this.isInSegmentEnvelopes(S);un.out.println("DD in env = "+I+"  --------------------- "+S),v.distance(S)>1e-4&&un.out.println("Distance = "+v.distance(S))}},{key:"intersectionSafe",value:function(a,c,g,m){var v=Bh.intersection(a,c,g,m);return v===null&&(v=o.nearestEndpoint(a,c,g,m)),v}},{key:"computeCollinearIntersection",value:function(a,c,g,m){var v=De.intersects(a,c,g),S=De.intersects(a,c,m),I=De.intersects(g,m,a),L=De.intersects(g,m,c);return v&&S?(this._intPt[0]=g,this._intPt[1]=m,Ye.COLLINEAR_INTERSECTION):I&&L?(this._intPt[0]=a,this._intPt[1]=c,Ye.COLLINEAR_INTERSECTION):v&&I?(this._intPt[0]=g,this._intPt[1]=a,!g.equals(a)||S||L?Ye.COLLINEAR_INTERSECTION:Ye.POINT_INTERSECTION):v&&L?(this._intPt[0]=g,this._intPt[1]=c,!g.equals(c)||S||I?Ye.COLLINEAR_INTERSECTION:Ye.POINT_INTERSECTION):S&&I?(this._intPt[0]=m,this._intPt[1]=a,!m.equals(a)||v||L?Ye.COLLINEAR_INTERSECTION:Ye.POINT_INTERSECTION):S&&L?(this._intPt[0]=m,this._intPt[1]=c,!m.equals(c)||v||I?Ye.COLLINEAR_INTERSECTION:Ye.POINT_INTERSECTION):Ye.NO_INTERSECTION}},{key:"computeIntersect",value:function(a,c,g,m){if(this._isProper=!1,!De.intersects(a,c,g,m))return Ye.NO_INTERSECTION;var v=ve.index(a,c,g),S=ve.index(a,c,m);if(v>0&&S>0||v<0&&S<0)return Ye.NO_INTERSECTION;var I=ve.index(g,m,a),L=ve.index(g,m,c);return I>0&&L>0||I<0&&L<0?Ye.NO_INTERSECTION:v===0&&S===0&&I===0&&L===0?this.computeCollinearIntersection(a,c,g,m):(v===0||S===0||I===0||L===0?(this._isProper=!1,a.equals2D(g)||a.equals2D(m)?this._intPt[0]=a:c.equals2D(g)||c.equals2D(m)?this._intPt[0]=c:v===0?this._intPt[0]=new J(g):S===0?this._intPt[0]=new J(m):I===0?this._intPt[0]=new J(a):L===0&&(this._intPt[0]=new J(c))):(this._isProper=!0,this._intPt[0]=this.intersection(a,c,g,m)),Ye.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(a,c,g,m){var v=a,S=Vn.pointToSegment(a,g,m),I=Vn.pointToSegment(c,g,m);return I<S&&(S=I,v=c),(I=Vn.pointToSegment(g,a,c))<S&&(S=I,v=g),(I=Vn.pointToSegment(m,a,c))<S&&(S=I,v=m),v}}])}(Ye),KA=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"countSegment",value:function(o,a){if(o.x<this._p.x&&a.x<this._p.x)return null;if(this._p.x===a.x&&this._p.y===a.y)return this._isPointOnSegment=!0,null;if(o.y===this._p.y&&a.y===this._p.y){var c=o.x,g=a.x;return c>g&&(c=a.x,g=o.x),this._p.x>=c&&this._p.x<=g&&(this._isPointOnSegment=!0),null}if(o.y>this._p.y&&a.y<=this._p.y||a.y>this._p.y&&o.y<=this._p.y){var m=ve.index(o,a,this._p);if(m===ve.COLLINEAR)return this._isPointOnSegment=!0,null;a.y<o.y&&(m=-m),m===ve.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==j.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?j.BOUNDARY:this._crossingCount%2==1?j.INTERIOR:j.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var o=arguments[0];this._p=o}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof J&&Se(arguments[1],ke)){for(var o=arguments[1],a=new h(arguments[0]),c=new J,g=new J,m=1;m<o.size();m++)if(o.getCoordinate(m,c),o.getCoordinate(m-1,g),a.countSegment(c,g),a.isOnSegment())return a.getLocation();return a.getLocation()}if(arguments[0]instanceof J&&arguments[1]instanceof Array){for(var v=arguments[1],S=new h(arguments[0]),I=1;I<v.length;I++){var L=v[I],q=v[I-1];if(S.countSegment(L,q),S.isOnSegment())return S.getLocation()}return S.getLocation()}}}])}(),Yh=function(){function h(){r(this,h)}return u(h,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof J&&Se(arguments[1],ke)){for(var o=arguments[0],a=arguments[1],c=new mr,g=new J,m=new J,v=a.size(),S=1;S<v;S++)if(a.getCoordinate(S-1,g),a.getCoordinate(S,m),c.computeIntersection(o,g,m),c.hasIntersection())return!0;return!1}if(arguments[0]instanceof J&&arguments[1]instanceof Array){for(var I=arguments[0],L=arguments[1],q=new mr,ee=1;ee<L.length;ee++){var ne=L[ee-1],ue=L[ee];if(q.computeIntersection(I,ne,ue),q.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(o,a){return KA.locatePointInRing(o,a)}},{key:"isInRing",value:function(o,a){return h.locateInRing(o,a)!==j.EXTERIOR}}])}(),cn=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"setAllLocations",value:function(o){for(var a=0;a<this.location.length;a++)this.location[a]=o}},{key:"isNull",value:function(){for(var o=0;o<this.location.length;o++)if(this.location[o]!==j.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(o){for(var a=0;a<this.location.length;a++)this.location[a]===j.NONE&&(this.location[a]=o)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(o){if(o.location.length>this.location.length){var a=new Array(3).fill(null);a[ae.ON]=this.location[ae.ON],a[ae.LEFT]=j.NONE,a[ae.RIGHT]=j.NONE,this.location=a}for(var c=0;c<this.location.length;c++)this.location[c]===j.NONE&&c<o.location.length&&(this.location[c]=o.location[c])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var o=this.location[ae.LEFT];this.location[ae.LEFT]=this.location[ae.RIGHT],this.location[ae.RIGHT]=o}},{key:"toString",value:function(){var o=new wo;return this.location.length>1&&o.append(j.toLocationSymbol(this.location[ae.LEFT])),o.append(j.toLocationSymbol(this.location[ae.ON])),this.location.length>1&&o.append(j.toLocationSymbol(this.location[ae.RIGHT])),o.toString()}},{key:"setLocations",value:function(o,a,c){this.location[ae.ON]=o,this.location[ae.LEFT]=a,this.location[ae.RIGHT]=c}},{key:"get",value:function(o){return o<this.location.length?this.location[o]:j.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var o=0;o<this.location.length;o++)if(this.location[o]===j.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var o=arguments[0];this.setLocation(ae.ON,o)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.location[a]=c}}},{key:"init",value:function(o){this.location=new Array(o).fill(null),this.setAllLocations(j.NONE)}},{key:"isEqualOnSide",value:function(o,a){return this.location[a]===o.location[a]}},{key:"allPositionsEqual",value:function(o){for(var a=0;a<this.location.length;a++)if(this.location[a]!==o)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];this.init(o.length)}else if(Number.isInteger(arguments[0])){var a=arguments[0];this.init(1),this.location[ae.ON]=a}else if(arguments[0]instanceof h){var c=arguments[0];if(this.init(c.location.length),c!==null)for(var g=0;g<this.location.length;g++)this.location[g]=c.location[g]}}else if(arguments.length===3){var m=arguments[0],v=arguments[1],S=arguments[2];this.init(3),this.location[ae.ON]=m,this.location[ae.LEFT]=v,this.location[ae.RIGHT]=S}}}])}(),hn=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"getGeometryCount",value:function(){var o=0;return this.elt[0].isNull()||o++,this.elt[1].isNull()||o++,o}},{key:"setAllLocations",value:function(o,a){this.elt[o].setAllLocations(a)}},{key:"isNull",value:function(o){return this.elt[o].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var o=arguments[0];this.setAllLocationsIfNull(0,o),this.setAllLocationsIfNull(1,o)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.elt[a].setAllLocationsIfNull(c)}}},{key:"isLine",value:function(o){return this.elt[o].isLine()}},{key:"merge",value:function(o){for(var a=0;a<2;a++)this.elt[a]===null&&o.elt[a]!==null?this.elt[a]=new cn(o.elt[a]):this.elt[a].merge(o.elt[a])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var o=arguments[0];return this.elt[o].get(ae.ON)}if(arguments.length===2){var a=arguments[0],c=arguments[1];return this.elt[a].get(c)}}},{key:"toString",value:function(){var o=new wo;return this.elt[0]!==null&&(o.append("A:"),o.append(this.elt[0].toString())),this.elt[1]!==null&&(o.append(" B:"),o.append(this.elt[1].toString())),o.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var o=arguments[0];return this.elt[o].isArea()}}},{key:"isAnyNull",value:function(o){return this.elt[o].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var o=arguments[0],a=arguments[1];this.elt[o].setLocation(ae.ON,a)}else if(arguments.length===3){var c=arguments[0],g=arguments[1],m=arguments[2];this.elt[c].setLocation(g,m)}}},{key:"isEqualOnSide",value:function(o,a){return this.elt[0].isEqualOnSide(o.elt[0],a)&&this.elt[1].isEqualOnSide(o.elt[1],a)}},{key:"allPositionsEqual",value:function(o,a){return this.elt[o].allPositionsEqual(a)}},{key:"toLine",value:function(o){this.elt[o].isArea()&&(this.elt[o]=new cn(this.elt[o].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var o=arguments[0];this.elt[0]=new cn(o),this.elt[1]=new cn(o)}else if(arguments[0]instanceof h){var a=arguments[0];this.elt[0]=new cn(a.elt[0]),this.elt[1]=new cn(a.elt[1])}}else if(arguments.length===2){var c=arguments[0],g=arguments[1];this.elt[0]=new cn(j.NONE),this.elt[1]=new cn(j.NONE),this.elt[c].setLocation(g)}else if(arguments.length===3){var m=arguments[0],v=arguments[1],S=arguments[2];this.elt[0]=new cn(m,v,S),this.elt[1]=new cn(m,v,S)}else if(arguments.length===4){var I=arguments[0],L=arguments[1],q=arguments[2],ee=arguments[3];this.elt[0]=new cn(j.NONE,j.NONE,j.NONE),this.elt[1]=new cn(j.NONE,j.NONE,j.NONE),this.elt[I].setLocations(L,q,ee)}}},{key:"toLineLabel",value:function(o){for(var a=new h(j.NONE),c=0;c<2;c++)a.setLocation(c,o.getLocation(c));return a}}])}(),vl=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var h=new Array(this._pts.size()).fill(null),o=0;o<this._pts.size();o++)h[o]=this._pts.get(o);this._ring=this._geometryFactory.createLinearRing(h),this._isHole=ve.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(h){this._startDe=h;var o=h,a=!0;do{if(o===null)throw new li("Found null DirectedEdge");if(o.getEdgeRing()===this)throw new li("Directed Edge visited twice during ring-building at "+o.getCoordinate());this._edges.add(o);var c=o.getLabel();he.isTrue(c.isArea()),this.mergeLabel(c),this.addPoints(o.getEdge(),o.isForward(),a),a=!1,this.setEdgeRing(o,this),o=this.getNext(o)}while(o!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(h){return this._pts.get(h)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var h=this._startDe;do{var o=h.getNode().getEdges().getOutgoingDegree(this);o>this._maxNodeDegree&&(this._maxNodeDegree=o),h=this.getNext(h)}while(h!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(h,o,a){var c=h.getCoordinates();if(o){var g=1;a&&(g=0);for(var m=g;m<c.length;m++)this._pts.add(c[m])}else{var v=c.length-2;a&&(v=c.length-1);for(var S=v;S>=0;S--)this._pts.add(c[S])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var h=this._startDe;do h.getEdge().setInResult(!0),h=h.getNext();while(h!==this._startDe)}},{key:"containsPoint",value:function(h){var o=this.getLinearRing();if(!o.getEnvelopeInternal().contains(h)||!Yh.isInRing(h,o.getCoordinates()))return!1;for(var a=this._holes.iterator();a.hasNext();)if(a.next().containsPoint(h))return!1;return!0}},{key:"addHole",value:function(h){this._holes.add(h)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var h=arguments[0];this.mergeLabel(h,0),this.mergeLabel(h,1)}else if(arguments.length===2){var o=arguments[1],a=arguments[0].getLocation(o,ae.RIGHT);if(a===j.NONE)return null;if(this._label.getLocation(o)===j.NONE)return this._label.setLocation(o,a),null}}},{key:"setShell",value:function(h){this._shell=h,h!==null&&h.addHole(this)}},{key:"toPolygon",value:function(h){for(var o=new Array(this._holes.size()).fill(null),a=0;a<this._holes.size();a++)o[a]=this._holes.get(a).getLinearRing();return h.createPolygon(this.getLinearRing(),o)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new _e,this._pts=new _e,this._label=new hn(j.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new _e,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var h=arguments[0],o=arguments[1];this._geometryFactory=o,this.computePoints(h),this.computeRing()}}}}])}(),GA=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"setEdgeRing",value:function(a,c){a.setMinEdgeRing(c)}},{key:"getNext",value:function(a){return a.getNextMin()}}],[{key:"constructor_",value:function(){var a=arguments[0],c=arguments[1];vl.constructor_.call(this,a,c)}}])}(vl),ZA=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"buildMinimalRings",value:function(){var a=new _e,c=this._startDe;do{if(c.getMinEdgeRing()===null){var g=new GA(c,this._geometryFactory);a.add(g)}c=c.getNext()}while(c!==this._startDe);return a}},{key:"setEdgeRing",value:function(a,c){a.setEdgeRing(c)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var a=this._startDe;do a.getNode().getEdges().linkMinimalDirectedEdges(this),a=a.getNext();while(a!==this._startDe)}},{key:"getNext",value:function(a){return a.getNext()}}],[{key:"constructor_",value:function(){var a=arguments[0],c=arguments[1];vl.constructor_.call(this,a,c)}}])}(vl),fm=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"setVisited",value:function(h){this._isVisited=h}},{key:"setInResult",value:function(h){this._isInResult=h}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(h){this._label=h}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(h){this._isCovered=h,this._isCoveredSet=!0}},{key:"updateIM",value:function(h){he.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(h)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var h=arguments[0];this._label=h}}}}])}(),El=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"isIncidentEdgeInResult",value:function(){for(var a=this.getEdges().getEdges().iterator();a.hasNext();)if(a.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(a){a.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(a){}},{key:"computeMergedLocation",value:function(a,c){var g=j.NONE;if(g=this._label.getLocation(c),!a.isNull(c)){var m=a.getLocation(c);g!==j.BOUNDARY&&(g=m)}return g}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return T(o,"setLabel",this,1).apply(this,arguments);var a=arguments[0],c=arguments[1];this._label===null?this._label=new hn(a,c):this._label.setLocation(a,c)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof o){var a=arguments[0];this.mergeLabel(a._label)}else if(arguments[0]instanceof hn)for(var c=arguments[0],g=0;g<2;g++){var m=this.computeMergedLocation(c,g);this._label.getLocation(g)===j.NONE&&this._label.setLocation(g,m)}}},{key:"add",value:function(a){this._edges.insert(a),a.setNode(this)}},{key:"setLabelBoundary",value:function(a){if(this._label===null)return null;var c=j.NONE;this._label!==null&&(c=this._label.getLocation(a));var g=null;switch(c){case j.BOUNDARY:g=j.INTERIOR;break;case j.INTERIOR:default:g=j.BOUNDARY}this._label.setLocation(a,g)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var a=arguments[0],c=arguments[1];this._coord=a,this._edges=c,this._label=new hn(0,j.NONE)}}])}(fm),QA=function(h){function o(){return r(this,o),i(this,o,arguments)}return _(o,h),u(o)}(sm);function dm(h){return h==null?0:h.color}function Le(h){return h==null?null:h.parent}function Wn(h,o){h!==null&&(h.color=o)}function qh(h){return h==null?null:h.left}function gm(h){return h==null?null:h.right}var Co=function(h){function o(){var a;return r(this,o),(a=i(this,o)).root_=null,a.size_=0,a}return _(o,h),u(o,[{key:"get",value:function(a){for(var c=this.root_;c!==null;){var g=a.compareTo(c.key);if(g<0)c=c.left;else{if(!(g>0))return c.value;c=c.right}}return null}},{key:"put",value:function(a,c){if(this.root_===null)return this.root_={key:a,value:c,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var g,m,v=this.root_;do if(g=v,(m=a.compareTo(v.key))<0)v=v.left;else{if(!(m>0)){var S=v.value;return v.value=c,S}v=v.right}while(v!==null);var I={key:a,left:null,right:null,value:c,parent:g,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return m<0?g.left=I:g.right=I,this.fixAfterInsertion(I),this.size_++,null}},{key:"fixAfterInsertion",value:function(a){var c;for(a.color=1;a!=null&&a!==this.root_&&a.parent.color===1;)Le(a)===qh(Le(Le(a)))?dm(c=gm(Le(Le(a))))===1?(Wn(Le(a),0),Wn(c,0),Wn(Le(Le(a)),1),a=Le(Le(a))):(a===gm(Le(a))&&(a=Le(a),this.rotateLeft(a)),Wn(Le(a),0),Wn(Le(Le(a)),1),this.rotateRight(Le(Le(a)))):dm(c=qh(Le(Le(a))))===1?(Wn(Le(a),0),Wn(c,0),Wn(Le(Le(a)),1),a=Le(Le(a))):(a===qh(Le(a))&&(a=Le(a),this.rotateRight(a)),Wn(Le(a),0),Wn(Le(Le(a)),1),this.rotateLeft(Le(Le(a))));this.root_.color=0}},{key:"values",value:function(){var a=new _e,c=this.getFirstEntry();if(c!==null)for(a.add(c.value);(c=o.successor(c))!==null;)a.add(c.value);return a}},{key:"entrySet",value:function(){var a=new Lh,c=this.getFirstEntry();if(c!==null)for(a.add(c);(c=o.successor(c))!==null;)a.add(c);return a}},{key:"rotateLeft",value:function(a){if(a!=null){var c=a.right;a.right=c.left,c.left!=null&&(c.left.parent=a),c.parent=a.parent,a.parent==null?this.root_=c:a.parent.left===a?a.parent.left=c:a.parent.right=c,c.left=a,a.parent=c}}},{key:"rotateRight",value:function(a){if(a!=null){var c=a.left;a.left=c.right,c.right!=null&&(c.right.parent=a),c.parent=a.parent,a.parent==null?this.root_=c:a.parent.right===a?a.parent.right=c:a.parent.left=c,c.right=a,a.parent=c}}},{key:"getFirstEntry",value:function(){var a=this.root_;if(a!=null)for(;a.left!=null;)a=a.left;return a}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(a){for(var c=this.root_;c!==null;){var g=a.compareTo(c.key);if(g<0)c=c.left;else{if(!(g>0))return!0;c=c.right}}return!1}}],[{key:"successor",value:function(a){var c;if(a===null)return null;if(a.right!==null){for(c=a.right;c.left!==null;)c=c.left;return c}c=a.parent;for(var g=a;c!==null&&g===c.right;)g=c,c=c.parent;return c}}])}(QA),pm=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"find",value:function(h){return this.nodeMap.get(h)}},{key:"addNode",value:function(){if(arguments[0]instanceof J){var h=arguments[0],o=this.nodeMap.get(h);return o===null&&(o=this.nodeFact.createNode(h),this.nodeMap.put(h,o)),o}if(arguments[0]instanceof El){var a=arguments[0],c=this.nodeMap.get(a.getCoordinate());return c===null?(this.nodeMap.put(a.getCoordinate(),a),a):(c.mergeLabel(a),c)}}},{key:"print",value:function(h){for(var o=this.iterator();o.hasNext();)o.next().print(h)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(h){for(var o=new _e,a=this.iterator();a.hasNext();){var c=a.next();c.getLabel().getLocation(h)===j.BOUNDARY&&o.add(c)}return o}},{key:"add",value:function(h){var o=h.getCoordinate();this.addNode(o).add(h)}}],[{key:"constructor_",value:function(){this.nodeMap=new Co,this.nodeFact=null;var h=arguments[0];this.nodeFact=h}}])}(),Ft=function(){function h(){r(this,h)}return u(h,null,[{key:"isNorthern",value:function(o){return o===h.NE||o===h.NW}},{key:"isOpposite",value:function(o,a){return o!==a&&(o-a+4)%4===2}},{key:"commonHalfPlane",value:function(o,a){if(o===a)return o;if((o-a+4)%4===2)return-1;var c=o<a?o:a;return c===0&&(o>a?o:a)===3?3:c}},{key:"isInHalfPlane",value:function(o,a){return a===h.SE?o===h.SE||o===h.SW:o===a||o===a+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],a=arguments[1];if(o===0&&a===0)throw new D("Cannot compute the quadrant for point ( "+o+", "+a+" )");return o>=0?a>=0?h.NE:h.SE:a>=0?h.NW:h.SW}if(arguments[0]instanceof J&&arguments[1]instanceof J){var c=arguments[0],g=arguments[1];if(g.x===c.x&&g.y===c.y)throw new D("Cannot compute the quadrant for two identical points "+c);return g.x>=c.x?g.y>=c.y?h.NE:h.SE:g.y>=c.y?h.NW:h.SW}}}])}();Ft.NE=0,Ft.NW=1,Ft.SW=2,Ft.SE=3;var _m=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"compareDirection",value:function(o){return this._dx===o._dx&&this._dy===o._dy?0:this._quadrant>o._quadrant?1:this._quadrant<o._quadrant?-1:ve.index(o._p0,o._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(o){this._node=o}},{key:"print",value:function(o){var a=Math.atan2(this._dy,this._dx),c=this.getClass().getName(),g=c.lastIndexOf("."),m=c.substring(g+1);o.print("  "+m+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+a+"   "+this._label)}},{key:"compareTo",value:function(o){var a=o;return this.compareDirection(a)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var o=Math.atan2(this._dy,this._dx),a=this.getClass().getName(),c=a.lastIndexOf(".");return"  "+a.substring(c+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+o+"   "+this._label}},{key:"computeLabel",value:function(o){}},{key:"init",value:function(o,a){this._p0=o,this._p1=a,this._dx=a.x-o.x,this._dy=a.y-o.y,this._quadrant=Ft.quadrant(this._dx,this._dy),he.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[K]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var o=arguments[0];this._edge=o}else if(arguments.length===3){var a=arguments[0],c=arguments[1],g=arguments[2];h.constructor_.call(this,a,c,g,null)}else if(arguments.length===4){var m=arguments[0],v=arguments[1],S=arguments[2],I=arguments[3];h.constructor_.call(this,m),this.init(v,S),this._label=I}}}])}(),Kh=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(a){return this._depth[a]}},{key:"setVisited",value:function(a){this._isVisited=a}},{key:"computeDirectedLabel",value:function(){this._label=new hn(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(a,c){if(this._depth[a]!==-999&&this._depth[a]!==c)throw new li("assigned depths do not match",this.getCoordinate());this._depth[a]=c}},{key:"isInteriorAreaEdge",value:function(){for(var a=!0,c=0;c<2;c++)this._label.isArea(c)&&this._label.getLocation(c,ae.LEFT)===j.INTERIOR&&this._label.getLocation(c,ae.RIGHT)===j.INTERIOR||(a=!1);return a}},{key:"setNextMin",value:function(a){this._nextMin=a}},{key:"print",value:function(a){T(o,"print",this,1).call(this,a),a.print(" "+this._depth[ae.LEFT]+"/"+this._depth[ae.RIGHT]),a.print(" ("+this.getDepthDelta()+")"),this._isInResult&&a.print(" inResult")}},{key:"setMinEdgeRing",value:function(a){this._minEdgeRing=a}},{key:"isLineEdge",value:function(){var a=this._label.isLine(0)||this._label.isLine(1),c=!this._label.isArea(0)||this._label.allPositionsEqual(0,j.EXTERIOR),g=!this._label.isArea(1)||this._label.allPositionsEqual(1,j.EXTERIOR);return a&&c&&g}},{key:"setEdgeRing",value:function(a){this._edgeRing=a}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var a=this._edge.getDepthDelta();return this._isForward||(a=-a),a}},{key:"setInResult",value:function(a){this._isInResult=a}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(a){this.print(a),a.print(" "),this._isForward?this._edge.print(a):this._edge.printReverse(a)}},{key:"setSym",value:function(a){this._sym=a}},{key:"setVisitedEdge",value:function(a){this.setVisited(a),this._sym.setVisited(a)}},{key:"setEdgeDepths",value:function(a,c){var g=this.getEdge().getDepthDelta();this._isForward||(g=-g);var m=1;a===ae.LEFT&&(m=-1);var v=ae.opposite(a),S=c+g*m;this.setDepth(a,c),this.setDepth(v,S)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(a){this._next=a}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var a=arguments[0],c=arguments[1];if(_m.constructor_.call(this,a),this._isForward=c,c)this.init(a.getCoordinate(0),a.getCoordinate(1));else{var g=a.getNumPoints()-1;this.init(a.getCoordinate(g),a.getCoordinate(g-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(a,c){return a===j.EXTERIOR&&c===j.INTERIOR?1:a===j.INTERIOR&&c===j.EXTERIOR?-1:0}}])}(_m),mm=function(){return u(function h(){r(this,h)},[{key:"createNode",value:function(h){return new El(h,null)}}])}(),ym=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"printEdges",value:function(h){h.println("Edges:");for(var o=0;o<this._edges.size();o++){h.println("edge "+o+":");var a=this._edges.get(o);a.print(h),a.eiList.print(h)}}},{key:"find",value:function(h){return this._nodes.find(h)}},{key:"addNode",value:function(){if(arguments[0]instanceof El){var h=arguments[0];return this._nodes.addNode(h)}if(arguments[0]instanceof J){var o=arguments[0];return this._nodes.addNode(o)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var h=this._nodes.iterator();h.hasNext();)h.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(h){un.out.println(h)}},{key:"isBoundaryNode",value:function(h,o){var a=this._nodes.find(o);if(a===null)return!1;var c=a.getLabel();return c!==null&&c.getLocation(h)===j.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var h=this._nodes.iterator();h.hasNext();)h.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(h,o,a,c){return!!h.equals(a)&&ve.index(h,o,c)===ve.COLLINEAR&&Ft.quadrant(h,o)===Ft.quadrant(a,c)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(h){un.out.print(h)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(h,o){for(var a=0;a<this._edges.size();a++){var c=this._edges.get(a),g=c.getCoordinates();if(this.matchInSameDirection(h,o,g[0],g[1])||this.matchInSameDirection(h,o,g[g.length-1],g[g.length-2]))return c}return null}},{key:"insertEdge",value:function(h){this._edges.add(h)}},{key:"findEdgeEnd",value:function(h){for(var o=this.getEdgeEnds().iterator();o.hasNext();){var a=o.next();if(a.getEdge()===h)return a}return null}},{key:"addEdges",value:function(h){for(var o=h.iterator();o.hasNext();){var a=o.next();this._edges.add(a);var c=new Kh(a,!0),g=new Kh(a,!1);c.setSym(g),g.setSym(c),this.add(c),this.add(g)}}},{key:"add",value:function(h){this._nodes.add(h),this._edgeEndList.add(h)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(h,o){for(var a=0;a<this._edges.size();a++){var c=this._edges.get(a),g=c.getCoordinates();if(h.equals(g[0])&&o.equals(g[1]))return c}return null}}],[{key:"constructor_",value:function(){if(this._edges=new _e,this._nodes=null,this._edgeEndList=new _e,arguments.length===0)this._nodes=new pm(new mm);else if(arguments.length===1){var h=arguments[0];this._nodes=new pm(h)}}},{key:"linkResultDirectedEdges",value:function(h){for(var o=h.iterator();o.hasNext();)o.next().getEdges().linkResultDirectedEdges()}}])}(),JA=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"sortShellsAndHoles",value:function(o,a,c){for(var g=o.iterator();g.hasNext();){var m=g.next();m.isHole()?c.add(m):a.add(m)}}},{key:"computePolygons",value:function(o){for(var a=new _e,c=o.iterator();c.hasNext();){var g=c.next().toPolygon(this._geometryFactory);a.add(g)}return a}},{key:"placeFreeHoles",value:function(o,a){for(var c=a.iterator();c.hasNext();){var g=c.next();if(g.getShell()===null){var m=h.findEdgeRingContaining(g,o);if(m===null)throw new li("unable to assign hole to a shell",g.getCoordinate(0));g.setShell(m)}}}},{key:"buildMinimalEdgeRings",value:function(o,a,c){for(var g=new _e,m=o.iterator();m.hasNext();){var v=m.next();if(v.getMaxNodeDegree()>2){v.linkDirectedEdgesForMinimalEdgeRings();var S=v.buildMinimalRings(),I=this.findShell(S);I!==null?(this.placePolygonHoles(I,S),a.add(I)):c.addAll(S)}else g.add(v)}return g}},{key:"buildMaximalEdgeRings",value:function(o){for(var a=new _e,c=o.iterator();c.hasNext();){var g=c.next();if(g.isInResult()&&g.getLabel().isArea()&&g.getEdgeRing()===null){var m=new ZA(g,this._geometryFactory);a.add(m),m.setInResult()}}return a}},{key:"placePolygonHoles",value:function(o,a){for(var c=a.iterator();c.hasNext();){var g=c.next();g.isHole()&&g.setShell(o)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(o){for(var a=0,c=null,g=o.iterator();g.hasNext();){var m=g.next();m.isHole()||(c=m,a++)}return he.isTrue(a<=1,"found two shells in MinimalEdgeRing list"),c}},{key:"add",value:function(){if(arguments.length===1){var o=arguments[0];this.add(o.getEdgeEnds(),o.getNodes())}else if(arguments.length===2){var a=arguments[0],c=arguments[1];ym.linkResultDirectedEdges(c);var g=this.buildMaximalEdgeRings(a),m=new _e,v=this.buildMinimalEdgeRings(g,this._shellList,m);this.sortShellsAndHoles(v,this._shellList,m),this.placeFreeHoles(this._shellList,m)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new _e;var o=arguments[0];this._geometryFactory=o}},{key:"findEdgeRingContaining",value:function(o,a){for(var c=o.getLinearRing(),g=c.getEnvelopeInternal(),m=c.getCoordinateN(0),v=null,S=null,I=a.iterator();I.hasNext();){var L=I.next(),q=L.getLinearRing(),ee=q.getEnvelopeInternal();if(!ee.equals(g)&&ee.contains(g)){m=dt.ptNotInList(c.getCoordinates(),q.getCoordinates());var ne=!1;Yh.isInRing(m,q.getCoordinates())&&(ne=!0),ne&&(v===null||S.contains(ee))&&(S=(v=L).getLinearRing().getEnvelopeInternal())}}return v}}])}(),vm=function(){return u(function h(){r(this,h)},[{key:"getBounds",value:function(){}}])}(),ci=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[vm,R]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var h=arguments[0],o=arguments[1];this._bounds=h,this._item=o}}])}(),wl=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"poll",value:function(){if(this.isEmpty())return null;var h=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),h}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(h){for(var o=null,a=this._items.get(h);2*h<=this._size&&((o=2*h)!==this._size&&this._items.get(o+1).compareTo(this._items.get(o))<0&&o++,this._items.get(o).compareTo(a)<0);h=o)this._items.set(h,this._items.get(o));this._items.set(h,a)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(h){this._items.add(null),this._size+=1;var o=this._size;for(this._items.set(0,h);h.compareTo(this._items.get(Math.trunc(o/2)))<0;o/=2)this._items.set(o,this._items.get(Math.trunc(o/2)));this._items.set(o,h)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new _e,this._items.add(null)}}])}(),eb=function(){return u(function h(){r(this,h)},[{key:"insert",value:function(h,o){}},{key:"remove",value:function(h,o){}},{key:"query",value:function(){}}])}(),fn=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(h){he.isTrue(this._bounds===null),this._childBoundables.add(h)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[vm,R]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new _e,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var h=arguments[0];this._level=h}}}}])}(),os={reverseOrder:function(){return{compare:function(h,o){return o.compareTo(h)}}},min:function(h){return os.sort(h),h.get(0)},sort:function(h,o){var a=h.toArray();o?gr.sort(a,o):gr.sort(a);for(var c=h.iterator(),g=0,m=a.length;g<m;g++)c.next(),c.set(a[g])},singletonList:function(h){var o=new _e;return o.add(h),o}},tb=function(){function h(){r(this,h)}return u(h,null,[{key:"maxDistance",value:function(o,a,c,g,m,v,S,I){var L=h.distance(o,a,m,v);return L=Math.max(L,h.distance(o,a,S,I)),L=Math.max(L,h.distance(c,g,m,v)),L=Math.max(L,h.distance(c,g,S,I))}},{key:"distance",value:function(o,a,c,g){var m=c-o,v=g-a;return Math.sqrt(m*m+v*v)}},{key:"maximumDistance",value:function(o,a){var c=Math.min(o.getMinX(),a.getMinX()),g=Math.min(o.getMinY(),a.getMinY()),m=Math.max(o.getMaxX(),a.getMaxX()),v=Math.max(o.getMaxY(),a.getMaxY());return h.distance(c,g,m,v)}},{key:"minMaxDistance",value:function(o,a){var c=o.getMinX(),g=o.getMinY(),m=o.getMaxX(),v=o.getMaxY(),S=a.getMinX(),I=a.getMinY(),L=a.getMaxX(),q=a.getMaxY(),ee=h.maxDistance(c,g,c,v,S,I,S,q);return ee=Math.min(ee,h.maxDistance(c,g,c,v,S,I,L,I)),ee=Math.min(ee,h.maxDistance(c,g,c,v,L,q,S,q)),ee=Math.min(ee,h.maxDistance(c,g,c,v,L,q,L,I)),ee=Math.min(ee,h.maxDistance(c,g,m,g,S,I,S,q)),ee=Math.min(ee,h.maxDistance(c,g,m,g,S,I,L,I)),ee=Math.min(ee,h.maxDistance(c,g,m,g,L,q,S,q)),ee=Math.min(ee,h.maxDistance(c,g,m,g,L,q,L,I)),ee=Math.min(ee,h.maxDistance(m,v,c,v,S,I,S,q)),ee=Math.min(ee,h.maxDistance(m,v,c,v,S,I,L,I)),ee=Math.min(ee,h.maxDistance(m,v,c,v,L,q,S,q)),ee=Math.min(ee,h.maxDistance(m,v,c,v,L,q,L,I)),ee=Math.min(ee,h.maxDistance(m,v,m,g,S,I,S,q)),ee=Math.min(ee,h.maxDistance(m,v,m,g,S,I,L,I)),ee=Math.min(ee,h.maxDistance(m,v,m,g,L,q,S,q)),ee=Math.min(ee,h.maxDistance(m,v,m,g,L,q,L,I))}}])}(),as=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"maximumDistance",value:function(){return tb.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(o,a){var c=h.isComposite(this._boundable1),g=h.isComposite(this._boundable2);if(c&&g)return h.area(this._boundable1)>h.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,o,a),null):(this.expand(this._boundable2,this._boundable1,!0,o,a),null);if(c)return this.expand(this._boundable1,this._boundable2,!1,o,a),null;if(g)return this.expand(this._boundable2,this._boundable1,!0,o,a),null;throw new D("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(h.isComposite(this._boundable1)||h.isComposite(this._boundable2))}},{key:"compareTo",value:function(o){var a=o;return this._distance<a._distance?-1:this._distance>a._distance?1:0}},{key:"expand",value:function(o,a,c,g,m){for(var v=o.getChildBoundables().iterator();v.hasNext();){var S=v.next(),I=null;(I=c?new h(a,S,this._itemDistance):new h(S,a,this._itemDistance)).getDistance()<m&&g.add(I)}}},{key:"getBoundable",value:function(o){return o===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[K]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var o=arguments[0],a=arguments[1],c=arguments[2];this._boundable1=o,this._boundable2=a,this._itemDistance=c,this._distance=this.distance()}},{key:"area",value:function(o){return o.getBounds().getArea()}},{key:"isComposite",value:function(o){return o instanceof fn}}])}(),Em=function(){return u(function h(){r(this,h)},[{key:"visitItem",value:function(h){}}])}(),ls=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"queryInternal",value:function(){if(Se(arguments[2],Em)&&arguments[0]instanceof Object&&arguments[1]instanceof fn)for(var o=arguments[0],a=arguments[2],c=arguments[1].getChildBoundables(),g=0;g<c.size();g++){var m=c.get(g);this.getIntersectsOp().intersects(m.getBounds(),o)&&(m instanceof fn?this.queryInternal(o,m,a):m instanceof ci?a.visitItem(m.getItem()):he.shouldNeverReachHere())}else if(Se(arguments[2],fr)&&arguments[0]instanceof Object&&arguments[1]instanceof fn)for(var v=arguments[0],S=arguments[2],I=arguments[1].getChildBoundables(),L=0;L<I.size();L++){var q=I.get(L);this.getIntersectsOp().intersects(q.getBounds(),v)&&(q instanceof fn?this.queryInternal(v,q,S):q instanceof ci?S.add(q.getItem()):he.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(o){return o.get(o.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var o=0,a=arguments[0].getChildBoundables().iterator();a.hasNext();){var c=a.next();c instanceof fn?o+=this.size(c):c instanceof ci&&(o+=1)}return o}}},{key:"removeItem",value:function(o,a){for(var c=null,g=o.getChildBoundables().iterator();g.hasNext();){var m=g.next();m instanceof ci&&m.getItem()===a&&(c=m)}return c!==null&&(o.getChildBoundables().remove(c),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var o=this.itemsTree(this._root);return o===null?new _e:o}if(arguments.length===1){for(var a=arguments[0],c=new _e,g=a.getChildBoundables().iterator();g.hasNext();){var m=g.next();if(m instanceof fn){var v=this.itemsTree(m);v!==null&&c.add(v)}else m instanceof ci?c.add(m.getItem()):he.shouldNeverReachHere()}return c.size()<=0?null:c}}},{key:"insert",value:function(o,a){he.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new ci(o,a))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var o=arguments[0],a=new _e;return this.boundablesAtLevel(o,this._root,a),a}if(arguments.length===3){var c=arguments[0],g=arguments[1],m=arguments[2];if(he.isTrue(c>-2),g.getLevel()===c)return m.add(g),null;for(var v=g.getChildBoundables().iterator();v.hasNext();){var S=v.next();S instanceof fn?this.boundablesAtLevel(c,S,m):(he.isTrue(S instanceof ci),c===-1&&m.add(S))}return null}}},{key:"query",value:function(){if(arguments.length===1){var o=arguments[0];this.build();var a=new _e;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),o)&&this.queryInternal(o,this._root,a),a}if(arguments.length===2){var c=arguments[0],g=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.queryInternal(c,this._root,g)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var o=arguments[0],a=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),o)&&this.remove(o,this._root,a)}if(arguments.length===3){var c=arguments[0],g=arguments[1],m=arguments[2],v=this.removeItem(g,m);if(v)return!0;for(var S=null,I=g.getChildBoundables().iterator();I.hasNext();){var L=I.next();if(this.getIntersectsOp().intersects(L.getBounds(),c)&&L instanceof fn&&(v=this.remove(c,L,m))){S=L;break}}return S!==null&&S.getChildBoundables().isEmpty()&&g.getChildBoundables().remove(S),v}}},{key:"createHigherLevels",value:function(o,a){he.isTrue(!o.isEmpty());var c=this.createParentBoundables(o,a+1);return c.size()===1?c.get(0):this.createHigherLevels(c,a+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var o=0,a=arguments[0].getChildBoundables().iterator();a.hasNext();){var c=a.next();if(c instanceof fn){var g=this.depth(c);g>o&&(o=g)}}return o+1}}},{key:"createParentBoundables",value:function(o,a){he.isTrue(!o.isEmpty());var c=new _e;c.add(this.createNode(a));var g=new _e(o);os.sort(g,this.getComparator());for(var m=g.iterator();m.hasNext();){var v=m.next();this.lastNode(c).getChildBoundables().size()===this.getNodeCapacity()&&c.add(this.createNode(a)),this.lastNode(c).addChildBoundable(v)}return c}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[R]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new _e,this._nodeCapacity=null,arguments.length===0)h.constructor_.call(this,h.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var o=arguments[0];he.isTrue(o>1,"Node capacity must be greater than 1"),this._nodeCapacity=o}}},{key:"compareDoubles",value:function(o,a){return o>a?1:o<a?-1:0}}])}();ls.IntersectsOp=function(){},ls.DEFAULT_NODE_CAPACITY=10;var nb=function(){return u(function h(){r(this,h)},[{key:"distance",value:function(h,o){}}])}(),Hn=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"createParentBoundablesFromVerticalSlices",value:function(a,c){he.isTrue(a.length>0);for(var g=new _e,m=0;m<a.length;m++)g.addAll(this.createParentBoundablesFromVerticalSlice(a[m],c));return g}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var a=arguments[0],c=arguments[1];return this.nearestNeighbourK(a,te.POSITIVE_INFINITY,c)}if(arguments.length===3){var g=arguments[0],m=arguments[2],v=arguments[1],S=new wl;S.add(g);for(var I=new wl;!S.isEmpty()&&v>=0;){var L=S.poll(),q=L.getDistance();if(q>=v)break;L.isLeaves()?I.size()<m?I.add(L):(I.peek().getDistance()>q&&(I.poll(),I.add(L)),v=I.peek().getDistance()):L.expandToQueue(S,v)}return o.getItems(I)}}},{key:"createNode",value:function(a){return new wm(a)}},{key:"size",value:function(){return arguments.length===0?T(o,"size",this,1).call(this):T(o,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof De))return T(o,"insert",this,1).apply(this,arguments);var a=arguments[0],c=arguments[1];if(a.isNull())return null;T(o,"insert",this,1).call(this,a,c)}},{key:"getIntersectsOp",value:function(){return o.intersectsOp}},{key:"verticalSlices",value:function(a,c){for(var g=Math.trunc(Math.ceil(a.size()/c)),m=new Array(c).fill(null),v=a.iterator(),S=0;S<c;S++){m[S]=new _e;for(var I=0;v.hasNext()&&I<g;){var L=v.next();m[S].add(L),I++}}return m}},{key:"query",value:function(){if(arguments.length===1){var a=arguments[0];return T(o,"query",this,1).call(this,a)}if(arguments.length===2){var c=arguments[0],g=arguments[1];T(o,"query",this,1).call(this,c,g)}}},{key:"getComparator",value:function(){return o.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(a,c){return T(o,"createParentBoundables",this,1).call(this,a,c)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof De){var a=arguments[0],c=arguments[1];return T(o,"remove",this,1).call(this,a,c)}return T(o,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?T(o,"depth",this,1).call(this):T(o,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(a,c){he.isTrue(!a.isEmpty());var g=Math.trunc(Math.ceil(a.size()/this.getNodeCapacity())),m=new _e(a);os.sort(m,o.xComparator);var v=this.verticalSlices(m,Math.trunc(Math.ceil(Math.sqrt(g))));return this.createParentBoundablesFromVerticalSlices(v,c)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(Se(arguments[0],nb)){var a=arguments[0];if(this.isEmpty())return null;var c=new as(this.getRoot(),this.getRoot(),a);return this.nearestNeighbour(c)}if(arguments[0]instanceof as){var g=arguments[0],m=te.POSITIVE_INFINITY,v=null,S=new wl;for(S.add(g);!S.isEmpty()&&m>0;){var I=S.poll(),L=I.getDistance();if(L>=m)break;I.isLeaves()?(m=L,v=I):I.expandToQueue(S,m)}return v===null?null:[v.getBoundable(0).getItem(),v.getBoundable(1).getItem()]}}else{if(arguments.length===2){var q=arguments[0],ee=arguments[1];if(this.isEmpty()||q.isEmpty())return null;var ne=new as(this.getRoot(),q.getRoot(),ee);return this.nearestNeighbour(ne)}if(arguments.length===3){var ue=arguments[2],ge=new ci(arguments[0],arguments[1]),pe=new as(this.getRoot(),ge,ue);return this.nearestNeighbour(pe)[0]}if(arguments.length===4){var Ie=arguments[2],Re=arguments[3],ze=new ci(arguments[0],arguments[1]),Tt=new as(this.getRoot(),ze,Ie);return this.nearestNeighbourK(Tt,Re)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var a=arguments[0],c=arguments[1],g=te.POSITIVE_INFINITY,m=new wl;for(m.add(a);!m.isEmpty();){var v=m.poll(),S=v.getDistance();if(S>c)return!1;if(v.maximumDistance()<=c)return!0;if(v.isLeaves()){if((g=S)<=c)return!0}else v.expandToQueue(m,g)}return!1}if(arguments.length===3){var I=arguments[0],L=arguments[1],q=arguments[2],ee=new as(this.getRoot(),I.getRoot(),L);return this.isWithinDistance(ee,q)}}},{key:"interfaces_",get:function(){return[eb,R]}}],[{key:"constructor_",value:function(){if(arguments.length===0)o.constructor_.call(this,o.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var a=arguments[0];ls.constructor_.call(this,a)}}},{key:"centreX",value:function(a){return o.avg(a.getMinX(),a.getMaxX())}},{key:"avg",value:function(a,c){return(a+c)/2}},{key:"getItems",value:function(a){for(var c=new Array(a.size()).fill(null),g=0;!a.isEmpty();){var m=a.poll();c[g]=m.getBoundable(0).getItem(),g++}return c}},{key:"centreY",value:function(a){return o.avg(a.getMinY(),a.getMaxY())}}])}(ls),wm=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"computeBounds",value:function(){for(var a=null,c=this.getChildBoundables().iterator();c.hasNext();){var g=c.next();a===null?a=new De(g.getBounds()):a.expandToInclude(g.getBounds())}return a}}],[{key:"constructor_",value:function(){var a=arguments[0];fn.constructor_.call(this,a)}}])}(fn);Hn.STRtreeNode=wm,Hn.xComparator=new(function(){return u(function h(){r(this,h)},[{key:"interfaces_",get:function(){return[ie]}},{key:"compare",value:function(h,o){return ls.compareDoubles(Hn.centreX(h.getBounds()),Hn.centreX(o.getBounds()))}}])}()),Hn.yComparator=new(function(){return u(function h(){r(this,h)},[{key:"interfaces_",get:function(){return[ie]}},{key:"compare",value:function(h,o){return ls.compareDoubles(Hn.centreY(h.getBounds()),Hn.centreY(o.getBounds()))}}])}()),Hn.intersectsOp=new(function(){return u(function h(){r(this,h)},[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(h,o){return h.intersects(o)}}])}()),Hn.DEFAULT_NODE_CAPACITY=10;var ib=function(){function h(){r(this,h)}return u(h,null,[{key:"relativeSign",value:function(o,a){return o<a?-1:o>a?1:0}},{key:"compare",value:function(o,a,c){if(a.equals2D(c))return 0;var g=h.relativeSign(a.x,c.x),m=h.relativeSign(a.y,c.y);switch(o){case 0:return h.compareValue(g,m);case 1:return h.compareValue(m,g);case 2:return h.compareValue(m,-g);case 3:return h.compareValue(-g,m);case 4:return h.compareValue(-g,-m);case 5:return h.compareValue(-m,-g);case 6:return h.compareValue(-m,g);case 7:return h.compareValue(g,-m)}return he.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(o,a){return o<0?-1:o>0?1:a<0?-1:a>0?1:0}}])}(),rb=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(h){h.print(this.coord),h.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(h){var o=h;return this.segmentIndex<o.segmentIndex?-1:this.segmentIndex>o.segmentIndex?1:this.coord.equals2D(o.coord)?0:this._isInterior?o._isInterior?ib.compare(this._segmentOctant,this.coord,o.coord):1:-1}},{key:"isEndPoint",value:function(h){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===h}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[K]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var h=arguments[0],o=arguments[1],a=arguments[2],c=arguments[3];this._segString=h,this.coord=new J(o),this.segmentIndex=a,this._segmentOctant=c,this._isInterior=!o.equals2D(h.getCoordinate(a))}}])}(),sb=function(){return u(function h(){r(this,h)},[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])}(),ob=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"getSplitCoordinates",value:function(){var h=new Ao;this.addEndpoints();for(var o=this.iterator(),a=o.next();o.hasNext();){var c=o.next();this.addEdgeCoordinates(a,c,h),a=c}return h.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var h=new _e;this.findCollapsesFromInsertedNodes(h),this.findCollapsesFromExistingVertices(h);for(var o=h.iterator();o.hasNext();){var a=o.next().intValue();this.add(this._edge.getCoordinate(a),a)}}},{key:"createSplitEdgePts",value:function(h,o){var a=o.segmentIndex-h.segmentIndex+2;if(a===2)return[new J(h.coord),new J(o.coord)];var c=this._edge.getCoordinate(o.segmentIndex),g=o.isInterior()||!o.coord.equals2D(c);g||a--;var m=new Array(a).fill(null),v=0;m[v++]=new J(h.coord);for(var S=h.segmentIndex+1;S<=o.segmentIndex;S++)m[v++]=this._edge.getCoordinate(S);return g&&(m[v]=new J(o.coord)),m}},{key:"print",value:function(h){h.println("Intersections:");for(var o=this.iterator();o.hasNext();)o.next().print(h)}},{key:"findCollapsesFromExistingVertices",value:function(h){for(var o=0;o<this._edge.size()-2;o++){var a=this._edge.getCoordinate(o);this._edge.getCoordinate(o+1);var c=this._edge.getCoordinate(o+2);a.equals2D(c)&&h.add(hl.valueOf(o+1))}}},{key:"addEdgeCoordinates",value:function(h,o,a){var c=this.createSplitEdgePts(h,o);a.add(c,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(h){this.addEndpoints(),this.addCollapsedNodes();for(var o=this.iterator(),a=o.next();o.hasNext();){var c=o.next(),g=this.createSplitEdge(a,c);h.add(g),a=c}}},{key:"findCollapseIndex",value:function(h,o,a){if(!h.coord.equals2D(o.coord))return!1;var c=o.segmentIndex-h.segmentIndex;return o.isInterior()||c--,c===1&&(a[0]=h.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(h){for(var o=new Array(1).fill(null),a=this.iterator(),c=a.next();a.hasNext();){var g=a.next();this.findCollapseIndex(c,g,o)&&h.add(hl.valueOf(o[0])),c=g}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var h=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(h),h)}},{key:"createSplitEdge",value:function(h,o){var a=this.createSplitEdgePts(h,o);return new yr(a,this._edge.getData())}},{key:"add",value:function(h,o){var a=new rb(this._edge,h,o,this._edge.getSegmentOctant(o)),c=this._nodeMap.get(a);return c!==null?(he.isTrue(c.coord.equals2D(h),"Found equal nodes with different coordinates"),c):(this._nodeMap.put(a,a),a)}},{key:"checkSplitEdgesCorrectness",value:function(h){var o=this._edge.getCoordinates(),a=h.get(0).getCoordinate(0);if(!a.equals2D(o[0]))throw new ce("bad split edge start point at "+a);var c=h.get(h.size()-1).getCoordinates(),g=c[c.length-1];if(!g.equals2D(o[o.length-1]))throw new ce("bad split edge end point at "+g)}}],[{key:"constructor_",value:function(){this._nodeMap=new Co,this._edge=null;var h=arguments[0];this._edge=h}}])}(),ab=function(){function h(){r(this,h)}return u(h,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],a=arguments[1];if(o===0&&a===0)throw new D("Cannot compute the octant for point ( "+o+", "+a+" )");var c=Math.abs(o),g=Math.abs(a);return o>=0?a>=0?c>=g?0:1:c>=g?7:6:a>=0?c>=g?3:2:c>=g?4:5}if(arguments[0]instanceof J&&arguments[1]instanceof J){var m=arguments[0],v=arguments[1],S=v.x-m.x,I=v.y-m.y;if(S===0&&I===0)throw new D("Cannot compute the octant for two identical points "+m);return h.octant(S,I)}}}])}(),lb=function(){return u(function h(){r(this,h)},[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(h){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(h){}},{key:"getData",value:function(){}}])}(),ub=function(){return u(function h(){r(this,h)},[{key:"addIntersection",value:function(h,o){}},{key:"interfaces_",get:function(){return[lb]}}])}(),yr=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(o){return this._pts[o]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(o){return o===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(o),this.getCoordinate(o+1))}},{key:"setData",value:function(o){this._data=o}},{key:"safeOctant",value:function(o,a){return o.equals2D(a)?0:ab.octant(o,a)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var o=arguments[0],a=arguments[1];this.addIntersectionNode(o,a)}else if(arguments.length===4){var c=arguments[1],g=arguments[3],m=new J(arguments[0].getIntersection(g));this.addIntersection(m,c)}}},{key:"toString",value:function(){return Xh.toLineString(new bo(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(o,a){var c=a,g=c+1;if(g<this._pts.length){var m=this._pts[g];o.equals2D(m)&&(c=g)}return this._nodeList.add(o,c)}},{key:"addIntersections",value:function(o,a,c){for(var g=0;g<o.getIntersectionNum();g++)this.addIntersection(o,a,c,g)}},{key:"interfaces_",get:function(){return[ub]}}],[{key:"constructor_",value:function(){this._nodeList=new ob(this),this._pts=null,this._data=null;var o=arguments[0],a=arguments[1];this._pts=o,this._data=a}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var o=arguments[0],a=new _e;return h.getNodedSubstrings(o,a),a}if(arguments.length===2)for(var c=arguments[1],g=arguments[0].iterator();g.hasNext();)g.next().getNodeList().addSplitEdges(c)}}])}(),Zt=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof h){var o=arguments[0],a=ve.index(this.p0,this.p1,o.p0),c=ve.index(this.p0,this.p1,o.p1);return a>=0&&c>=0||a<=0&&c<=0?Math.max(a,c):0}if(arguments[0]instanceof J){var g=arguments[0];return ve.index(this.p0,this.p1,g)}}},{key:"toGeometry",value:function(o){return o.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(o){if(!(o instanceof h))return!1;var a=o;return this.p0.equals(a.p0)&&this.p1.equals(a.p1)}},{key:"intersection",value:function(o){var a=new mr;return a.computeIntersection(this.p0,this.p1,o.p0,o.p1),a.hasIntersection()?a.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof J){var o=arguments[0];if(o.equals(this.p0)||o.equals(this.p1))return new J(o);var a=this.projectionFactor(o),c=new J;return c.x=this.p0.x+a*(this.p1.x-this.p0.x),c.y=this.p0.y+a*(this.p1.y-this.p0.y),c}if(arguments[0]instanceof h){var g=arguments[0],m=this.projectionFactor(g.p0),v=this.projectionFactor(g.p1);if(m>=1&&v>=1||m<=0&&v<=0)return null;var S=this.project(g.p0);m<0&&(S=this.p0),m>1&&(S=this.p1);var I=this.project(g.p1);return v<0&&(I=this.p0),v>1&&(I=this.p1),new h(S,I)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(o){return o===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(o){return Vn.pointToLinePerpendicular(o,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return h.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(o){if(o.equals(this.p0))return 0;if(o.equals(this.p1))return 1;var a=this.p1.x-this.p0.x,c=this.p1.y-this.p0.y,g=a*a+c*c;return g<=0?te.NaN:((o.x-this.p0.x)*a+(o.y-this.p0.y)*c)/g}},{key:"closestPoints",value:function(o){var a=this.intersection(o);if(a!==null)return[a,a];var c=new Array(2).fill(null),g=te.MAX_VALUE,m=null,v=this.closestPoint(o.p0);g=v.distance(o.p0),c[0]=v,c[1]=o.p0;var S=this.closestPoint(o.p1);(m=S.distance(o.p1))<g&&(g=m,c[0]=S,c[1]=o.p1);var I=o.closestPoint(this.p0);(m=I.distance(this.p0))<g&&(g=m,c[0]=this.p0,c[1]=I);var L=o.closestPoint(this.p1);return(m=L.distance(this.p1))<g&&(g=m,c[0]=this.p1,c[1]=L),c}},{key:"closestPoint",value:function(o){var a=this.projectionFactor(o);return a>0&&a<1?this.project(o):this.p0.distance(o)<this.p1.distance(o)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(o){var a=o,c=this.p0.compareTo(a.p0);return c!==0?c:this.p1.compareTo(a.p1)}},{key:"reverse",value:function(){var o=this.p0;this.p0=this.p1,this.p1=o}},{key:"equalsTopo",value:function(o){return this.p0.equals(o.p0)&&this.p1.equals(o.p1)||this.p0.equals(o.p1)&&this.p1.equals(o.p0)}},{key:"lineIntersection",value:function(o){return Bh.intersection(this.p0,this.p1,o.p0,o.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(o,a){var c=this.p0.x+o*(this.p1.x-this.p0.x),g=this.p0.y+o*(this.p1.y-this.p0.y),m=this.p1.x-this.p0.x,v=this.p1.y-this.p0.y,S=Math.sqrt(m*m+v*v),I=0,L=0;if(a!==0){if(S<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");I=a*m/S,L=a*v/S}return new J(c-L,g+I)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var o=arguments[0];this.setCoordinates(o.p0,o.p1)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.p0.x=a.x,this.p0.y=a.y,this.p1.x=c.x,this.p1.y=c.y}}},{key:"segmentFraction",value:function(o){var a=this.projectionFactor(o);return a<0?a=0:(a>1||te.isNaN(a))&&(a=1),a}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(o){var a=this.p1.getY()-this.p0.getY(),c=this.p0.getX()-this.p1.getX(),g=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),m=a*a+c*c,v=a*a-c*c,S=o.getX(),I=o.getY();return new J((-v*S-2*a*c*I-2*a*g)/m,(v*I-2*a*c*S-2*c*g)/m)}},{key:"distance",value:function(){if(arguments[0]instanceof h){var o=arguments[0];return Vn.segmentToSegment(this.p0,this.p1,o.p0,o.p1)}if(arguments[0]instanceof J){var a=arguments[0];return Vn.pointToSegment(a,this.p0,this.p1)}}},{key:"pointAlong",value:function(o){var a=new J;return a.x=this.p0.x+o*(this.p1.x-this.p0.x),a.y=this.p0.y+o*(this.p1.y-this.p0.y),a}},{key:"hashCode",value:function(){var o=te.doubleToLongBits(this.p0.x);o^=31*te.doubleToLongBits(this.p0.y);var a=Math.trunc(o)^Math.trunc(o>>32),c=te.doubleToLongBits(this.p1.x);return c^=31*te.doubleToLongBits(this.p1.y),a^(Math.trunc(c)^Math.trunc(c>>32))}},{key:"interfaces_",get:function(){return[K,R]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)h.constructor_.call(this,new J,new J);else if(arguments.length===1){var o=arguments[0];h.constructor_.call(this,o.p0,o.p1)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.p0=a,this.p1=c}else if(arguments.length===4){var g=arguments[0],m=arguments[1],v=arguments[2],S=arguments[3];h.constructor_.call(this,new J(g,m),new J(v,S))}}},{key:"midPoint",value:function(o,a){return new J((o.x+a.x)/2,(o.y+a.y)/2)}}])}(),cb=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var h=arguments[1],o=arguments[2],a=arguments[3];arguments[0].getLineSegment(h,this._overlapSeg1),o.getLineSegment(a,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Zt,this._overlapSeg2=new Zt}}])}(),Tm=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"getLineSegment",value:function(h,o){o.p0=this._pts[h],o.p1=this._pts[h+1]}},{key:"computeSelect",value:function(h,o,a,c){var g=this._pts[o],m=this._pts[a];if(a-o==1)return c.select(this,o),null;if(!h.intersects(g,m))return null;var v=Math.trunc((o+a)/2);o<v&&this.computeSelect(h,o,v,c),v<a&&this.computeSelect(h,v,a,c)}},{key:"getCoordinates",value:function(){for(var h=new Array(this._end-this._start+1).fill(null),o=0,a=this._start;a<=this._end;a++)h[o++]=this._pts[a];return h}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var h=arguments[0],o=arguments[1];this.computeOverlaps(this._start,this._end,h,h._start,h._end,o)}else if(arguments.length===6){var a=arguments[0],c=arguments[1],g=arguments[2],m=arguments[3],v=arguments[4],S=arguments[5];if(c-a==1&&v-m==1)return S.overlap(this,a,g,m),null;if(!this.overlaps(a,c,g,m,v))return null;var I=Math.trunc((a+c)/2),L=Math.trunc((m+v)/2);a<I&&(m<L&&this.computeOverlaps(a,I,g,m,L,S),L<v&&this.computeOverlaps(a,I,g,L,v,S)),I<c&&(m<L&&this.computeOverlaps(I,c,g,m,L,S),L<v&&this.computeOverlaps(I,c,g,L,v,S))}}},{key:"setId",value:function(h){this._id=h}},{key:"select",value:function(h,o){this.computeSelect(h,this._start,this._end,o)}},{key:"getEnvelope",value:function(){if(this._env===null){var h=this._pts[this._start],o=this._pts[this._end];this._env=new De(h,o)}return this._env}},{key:"overlaps",value:function(h,o,a,c,g){return De.intersects(this._pts[h],this._pts[o],a._pts[c],a._pts[g])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var h=arguments[0],o=arguments[1],a=arguments[2],c=arguments[3];this._pts=h,this._start=o,this._end=a,this._context=c}}])}(),hb=function(){function h(){r(this,h)}return u(h,null,[{key:"findChainEnd",value:function(o,a){for(var c=a;c<o.length-1&&o[c].equals2D(o[c+1]);)c++;if(c>=o.length-1)return o.length-1;for(var g=Ft.quadrant(o[c],o[c+1]),m=a+1;m<o.length&&!(!o[m-1].equals2D(o[m])&&Ft.quadrant(o[m-1],o[m])!==g);)m++;return m-1}},{key:"getChains",value:function(){if(arguments.length===1){var o=arguments[0];return h.getChains(o,null)}if(arguments.length===2){var a=arguments[0],c=arguments[1],g=new _e,m=0;do{var v=h.findChainEnd(a,m),S=new Tm(a,m,v,c);g.add(S),m=v}while(m<a.length-1);return g}}}])}(),Gh=function(){return u(function h(){r(this,h)},[{key:"computeNodes",value:function(h){}},{key:"getNodedSubstrings",value:function(){}}])}(),Sm=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"setSegmentIntersector",value:function(h){this._segInt=h}},{key:"interfaces_",get:function(){return[Gh]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var h=arguments[0];this.setSegmentIntersector(h)}}}}])}(),Zh=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return yr.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(a){for(var c=hb.getChains(a.getCoordinates(),a).iterator();c.hasNext();){var g=c.next();g.setId(this._idCounter++),this._index.insert(g.getEnvelope(),g),this._monoChains.add(g)}}},{key:"computeNodes",value:function(a){this._nodedSegStrings=a;for(var c=a.iterator();c.hasNext();)this.add(c.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var a=new xm(this._segInt),c=this._monoChains.iterator();c.hasNext();)for(var g=c.next(),m=this._index.query(g.getEnvelope()).iterator();m.hasNext();){var v=m.next();if(v.getId()>g.getId()&&(g.computeOverlaps(v,a),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new _e,this._index=new Hn,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var a=arguments[0];Sm.constructor_.call(this,a)}}}}])}(Sm),xm=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"overlap",value:function(){if(arguments.length!==4)return T(o,"overlap",this,1).apply(this,arguments);var a=arguments[1],c=arguments[2],g=arguments[3],m=arguments[0].getContext(),v=c.getContext();this._si.processIntersections(m,a,v,g)}}],[{key:"constructor_",value:function(){this._si=null;var a=arguments[0];this._si=a}}])}(cb);Zh.SegmentOverlapAction=xm;var bn=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"isDeletable",value:function(o,a,c,g){var m=this._inputLine[o],v=this._inputLine[a],S=this._inputLine[c];return!!this.isConcave(m,v,S)&&!!this.isShallow(m,v,S,g)&&this.isShallowSampled(m,v,o,c,g)}},{key:"deleteShallowConcavities",value:function(){for(var o=1,a=this.findNextNonDeletedIndex(o),c=this.findNextNonDeletedIndex(a),g=!1;c<this._inputLine.length;){var m=!1;this.isDeletable(o,a,c,this._distanceTol)&&(this._isDeleted[a]=h.DELETE,m=!0,g=!0),o=m?c:a,a=this.findNextNonDeletedIndex(o),c=this.findNextNonDeletedIndex(a)}return g}},{key:"isShallowConcavity",value:function(o,a,c,g){return ve.index(o,a,c)===this._angleOrientation&&Vn.pointToSegment(a,o,c)<g}},{key:"isShallowSampled",value:function(o,a,c,g,m){var v=Math.trunc((g-c)/h.NUM_PTS_TO_CHECK);v<=0&&(v=1);for(var S=c;S<g;S+=v)if(!this.isShallow(o,a,this._inputLine[S],m))return!1;return!0}},{key:"isConcave",value:function(o,a,c){var g=ve.index(o,a,c)===this._angleOrientation;return g}},{key:"simplify",value:function(o){this._distanceTol=Math.abs(o),o<0&&(this._angleOrientation=ve.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var a=!1;do a=this.deleteShallowConcavities();while(a);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(o){for(var a=o+1;a<this._inputLine.length&&this._isDeleted[a]===h.DELETE;)a++;return a}},{key:"isShallow",value:function(o,a,c,g){return Vn.pointToSegment(a,o,c)<g}},{key:"collapseLine",value:function(){for(var o=new Ao,a=0;a<this._inputLine.length;a++)this._isDeleted[a]!==h.DELETE&&o.add(this._inputLine[a]);return o.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=ve.COUNTERCLOCKWISE;var o=arguments[0];this._inputLine=o}},{key:"simplify",value:function(o,a){return new h(o).simplify(a)}}])}();bn.INIT=0,bn.DELETE=1,bn.KEEP=1,bn.NUM_PTS_TO_CHECK=10;var Am=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"getCoordinates",value:function(){return this._ptList.toArray(h.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(o){this._precisionModel=o}},{key:"addPt",value:function(o){var a=new J(o);if(this._precisionModel.makePrecise(a),this.isRedundant(a))return null;this._ptList.add(a)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(o,a){if(a)for(var c=0;c<o.length;c++)this.addPt(o[c]);else for(var g=o.length-1;g>=0;g--)this.addPt(o[g])}},{key:"isRedundant",value:function(o){if(this._ptList.size()<1)return!1;var a=this._ptList.get(this._ptList.size()-1);return o.distance(a)<this._minimimVertexDistance}},{key:"toString",value:function(){return new rs().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var o=new J(this._ptList.get(0)),a=this._ptList.get(this._ptList.size()-1);if(o.equals(a))return null;this._ptList.add(o)}},{key:"setMinimumVertexDistance",value:function(o){this._minimimVertexDistance=o}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new _e}}])}();Am.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Qt=function(){function h(){r(this,h)}return u(h,null,[{key:"toDegrees",value:function(o){return 180*o/Math.PI}},{key:"normalize",value:function(o){for(;o>Math.PI;)o-=h.PI_TIMES_2;for(;o<=-Math.PI;)o+=h.PI_TIMES_2;return o}},{key:"angle",value:function(){if(arguments.length===1){var o=arguments[0];return Math.atan2(o.y,o.x)}if(arguments.length===2){var a=arguments[0],c=arguments[1],g=c.x-a.x,m=c.y-a.y;return Math.atan2(m,g)}}},{key:"isAcute",value:function(o,a,c){var g=o.x-a.x,m=o.y-a.y;return g*(c.x-a.x)+m*(c.y-a.y)>0}},{key:"isObtuse",value:function(o,a,c){var g=o.x-a.x,m=o.y-a.y;return g*(c.x-a.x)+m*(c.y-a.y)<0}},{key:"interiorAngle",value:function(o,a,c){var g=h.angle(a,o),m=h.angle(a,c);return Math.abs(m-g)}},{key:"normalizePositive",value:function(o){if(o<0){for(;o<0;)o+=h.PI_TIMES_2;o>=h.PI_TIMES_2&&(o=0)}else{for(;o>=h.PI_TIMES_2;)o-=h.PI_TIMES_2;o<0&&(o=0)}return o}},{key:"angleBetween",value:function(o,a,c){var g=h.angle(a,o),m=h.angle(a,c);return h.diff(g,m)}},{key:"diff",value:function(o,a){var c=null;return(c=o<a?a-o:o-a)>Math.PI&&(c=2*Math.PI-c),c}},{key:"toRadians",value:function(o){return o*Math.PI/180}},{key:"getTurn",value:function(o,a){var c=Math.sin(a-o);return c>0?h.COUNTERCLOCKWISE:c<0?h.CLOCKWISE:h.NONE}},{key:"angleBetweenOriented",value:function(o,a,c){var g=h.angle(a,o),m=h.angle(a,c)-g;return m<=-Math.PI?m+h.PI_TIMES_2:m>Math.PI?m-h.PI_TIMES_2:m}}])}();Qt.PI_TIMES_2=2*Math.PI,Qt.PI_OVER_2=Math.PI/2,Qt.PI_OVER_4=Math.PI/4,Qt.COUNTERCLOCKWISE=ve.COUNTERCLOCKWISE,Qt.CLOCKWISE=ve.CLOCKWISE,Qt.NONE=ve.COLLINEAR;var ko=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"addNextSegment",value:function(o,a){if(this._s0=this._s1,this._s1=this._s2,this._s2=o,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var c=ve.index(this._s0,this._s1,this._s2),g=c===ve.CLOCKWISE&&this._side===ae.LEFT||c===ve.COUNTERCLOCKWISE&&this._side===ae.RIGHT;c===0?this.addCollinear(a):g?this.addOutsideTurn(c,a):this.addInsideTurn(c,a)}},{key:"addLineEndCap",value:function(o,a){var c=new Zt(o,a),g=new Zt;this.computeOffsetSegment(c,ae.LEFT,this._distance,g);var m=new Zt;this.computeOffsetSegment(c,ae.RIGHT,this._distance,m);var v=a.x-o.x,S=a.y-o.y,I=Math.atan2(S,v);switch(this._bufParams.getEndCapStyle()){case A.CAP_ROUND:this._segList.addPt(g.p1),this.addDirectedFillet(a,I+Math.PI/2,I-Math.PI/2,ve.CLOCKWISE,this._distance),this._segList.addPt(m.p1);break;case A.CAP_FLAT:this._segList.addPt(g.p1),this._segList.addPt(m.p1);break;case A.CAP_SQUARE:var L=new J;L.x=Math.abs(this._distance)*Math.cos(I),L.y=Math.abs(this._distance)*Math.sin(I);var q=new J(g.p1.x+L.x,g.p1.y+L.y),ee=new J(m.p1.x+L.x,m.p1.y+L.y);this._segList.addPt(q),this._segList.addPt(ee)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(o,a,c,g){var m=Bh.intersection(a.p0,a.p1,c.p0,c.p1);if(m!==null&&(g<=0?1:m.distance(o)/Math.abs(g))<=this._bufParams.getMitreLimit())return this._segList.addPt(m),null;this.addLimitedMitreJoin(a,c,g,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(o,a){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*h.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===A.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===A.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(a&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,o,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(o){this._segList.addPt(new J(o.x+this._distance,o.y+this._distance)),this._segList.addPt(new J(o.x+this._distance,o.y-this._distance)),this._segList.addPt(new J(o.x-this._distance,o.y-this._distance)),this._segList.addPt(new J(o.x-this._distance,o.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(o,a){this._segList.addPts(o,a)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(o,a,c,g,m){var v=a.x-o.x,S=a.y-o.y,I=Math.atan2(S,v),L=c.x-o.x,q=c.y-o.y,ee=Math.atan2(q,L);g===ve.CLOCKWISE?I<=ee&&(I+=2*Math.PI):I>=ee&&(I-=2*Math.PI),this._segList.addPt(a),this.addDirectedFillet(o,I,ee,g,m),this._segList.addPt(c)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(o,a,c){this._s1=o,this._s2=a,this._side=c,this._seg1.setCoordinates(o,a),this.computeOffsetSegment(this._seg1,c,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(o,a,c,g){var m=this._seg0.p1,v=Qt.angle(m,this._seg0.p0),S=Qt.angleBetweenOriented(this._seg0.p0,m,this._seg1.p1)/2,I=Qt.normalize(v+S),L=Qt.normalize(I+Math.PI),q=g*c,ee=c-q*Math.abs(Math.sin(S)),ne=m.x+q*Math.cos(L),ue=m.y+q*Math.sin(L),ge=new J(ne,ue),pe=new Zt(m,ge),Ie=pe.pointAlongOffset(1,ee),Re=pe.pointAlongOffset(1,-ee);this._side===ae.LEFT?(this._segList.addPt(Ie),this._segList.addPt(Re)):(this._segList.addPt(Re),this._segList.addPt(Ie))}},{key:"addDirectedFillet",value:function(o,a,c,g,m){var v=g===ve.CLOCKWISE?-1:1,S=Math.abs(a-c),I=Math.trunc(S/this._filletAngleQuantum+.5);if(I<1)return null;for(var L=S/I,q=new J,ee=0;ee<I;ee++){var ne=a+v*ee*L;q.x=o.x+m*Math.cos(ne),q.y=o.y+m*Math.sin(ne),this._segList.addPt(q)}}},{key:"computeOffsetSegment",value:function(o,a,c,g){var m=a===ae.LEFT?1:-1,v=o.p1.x-o.p0.x,S=o.p1.y-o.p0.y,I=Math.sqrt(v*v+S*S),L=m*c*v/I,q=m*c*S/I;g.p0.x=o.p0.x-q,g.p0.y=o.p0.y+L,g.p1.x=o.p1.x-q,g.p1.y=o.p1.y+L}},{key:"addInsideTurn",value:function(o,a){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*h.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var c=new J((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(c);var g=new J((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(g)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(o){var a=new J(o.x+this._distance,o.y);this._segList.addPt(a),this.addDirectedFillet(o,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(o,a){this._segList.addPt(o.p1),this._segList.addPt(a.p0)}},{key:"init",value:function(o){this._distance=o,this._maxCurveSegmentError=o*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Am,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(o*h.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(o){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===A.JOIN_BEVEL||this._bufParams.getJoinStyle()===A.JOIN_MITRE?(o&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,ve.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Zt,this._seg1=new Zt,this._offset0=new Zt,this._offset1=new Zt,this._side=0,this._hasNarrowConcaveAngle=!1;var o=arguments[0],a=arguments[1],c=arguments[2];this._precisionModel=o,this._bufParams=a,this._li=new mr,this._filletAngleQuantum=Math.PI/2/a.getQuadrantSegments(),a.getQuadrantSegments()>=8&&a.getJoinStyle()===A.JOIN_ROUND&&(this._closingSegLengthFactor=h.MAX_CLOSING_SEG_LEN_FACTOR),this.init(c)}}])}();ko.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,ko.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,ko.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,ko.MAX_CLOSING_SEG_LEN_FACTOR=80;var fb=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"getOffsetCurve",value:function(o,a){if(this._distance=a,a===0)return null;var c=a<0,g=Math.abs(a),m=this.getSegGen(g);o.length<=1?this.computePointCurve(o[0],m):this.computeOffsetCurve(o,c,m);var v=m.getCoordinates();return c&&dt.reverse(v),v}},{key:"computeSingleSidedBufferCurve",value:function(o,a,c){var g=this.simplifyTolerance(this._distance);if(a){c.addSegments(o,!0);var m=bn.simplify(o,-g),v=m.length-1;c.initSideSegments(m[v],m[v-1],ae.LEFT),c.addFirstSegment();for(var S=v-2;S>=0;S--)c.addNextSegment(m[S],!0)}else{c.addSegments(o,!1);var I=bn.simplify(o,g),L=I.length-1;c.initSideSegments(I[0],I[1],ae.LEFT),c.addFirstSegment();for(var q=2;q<=L;q++)c.addNextSegment(I[q],!0)}c.addLastSegment(),c.closeRing()}},{key:"computeRingBufferCurve",value:function(o,a,c){var g=this.simplifyTolerance(this._distance);a===ae.RIGHT&&(g=-g);var m=bn.simplify(o,g),v=m.length-1;c.initSideSegments(m[v-1],m[0],a);for(var S=1;S<=v;S++){var I=S!==1;c.addNextSegment(m[S],I)}c.closeRing()}},{key:"computeLineBufferCurve",value:function(o,a){var c=this.simplifyTolerance(this._distance),g=bn.simplify(o,c),m=g.length-1;a.initSideSegments(g[0],g[1],ae.LEFT);for(var v=2;v<=m;v++)a.addNextSegment(g[v],!0);a.addLastSegment(),a.addLineEndCap(g[m-1],g[m]);var S=bn.simplify(o,-c),I=S.length-1;a.initSideSegments(S[I],S[I-1],ae.LEFT);for(var L=I-2;L>=0;L--)a.addNextSegment(S[L],!0);a.addLastSegment(),a.addLineEndCap(S[1],S[0]),a.closeRing()}},{key:"computePointCurve",value:function(o,a){switch(this._bufParams.getEndCapStyle()){case A.CAP_ROUND:a.createCircle(o);break;case A.CAP_SQUARE:a.createSquare(o)}}},{key:"getLineCurve",value:function(o,a){if(this._distance=a,this.isLineOffsetEmpty(a))return null;var c=Math.abs(a),g=this.getSegGen(c);if(o.length<=1)this.computePointCurve(o[0],g);else if(this._bufParams.isSingleSided()){var m=a<0;this.computeSingleSidedBufferCurve(o,m,g)}else this.computeLineBufferCurve(o,g);return g.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(o){return o*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(o,a,c){if(this._distance=c,o.length<=2)return this.getLineCurve(o,c);if(c===0)return h.copyCoordinates(o);var g=this.getSegGen(c);return this.computeRingBufferCurve(o,a,g),g.getCoordinates()}},{key:"computeOffsetCurve",value:function(o,a,c){var g=this.simplifyTolerance(this._distance);if(a){var m=bn.simplify(o,-g),v=m.length-1;c.initSideSegments(m[v],m[v-1],ae.LEFT),c.addFirstSegment();for(var S=v-2;S>=0;S--)c.addNextSegment(m[S],!0)}else{var I=bn.simplify(o,g),L=I.length-1;c.initSideSegments(I[0],I[1],ae.LEFT),c.addFirstSegment();for(var q=2;q<=L;q++)c.addNextSegment(I[q],!0)}c.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(o){return o===0||o<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(o){return new ko(this._precisionModel,this._bufParams,o)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var o=arguments[0],a=arguments[1];this._precisionModel=o,this._bufParams=a}},{key:"copyCoordinates",value:function(o){for(var a=new Array(o.length).fill(null),c=0;c<a.length;c++)a[c]=new J(o[c]);return a}}])}(),bm=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var h=arguments[0],o=new _e,a=this._subgraphs.iterator();a.hasNext();){var c=a.next(),g=c.getEnvelope();h.y<g.getMinY()||h.y>g.getMaxY()||this.findStabbedSegments(h,c.getDirectedEdges(),o)}return o}if(arguments.length===3){if(Se(arguments[2],fr)&&arguments[0]instanceof J&&arguments[1]instanceof Kh){for(var m=arguments[0],v=arguments[1],S=arguments[2],I=v.getEdge().getCoordinates(),L=0;L<I.length-1;L++)if(this._seg.p0=I[L],this._seg.p1=I[L+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<m.x||this._seg.isHorizontal()||m.y<this._seg.p0.y||m.y>this._seg.p1.y||ve.index(this._seg.p0,this._seg.p1,m)===ve.RIGHT)){var q=v.getDepth(ae.LEFT);this._seg.p0.equals(I[L])||(q=v.getDepth(ae.RIGHT));var ee=new Rm(this._seg,q);S.add(ee)}}else if(Se(arguments[2],fr)&&arguments[0]instanceof J&&Se(arguments[1],fr))for(var ne=arguments[0],ue=arguments[2],ge=arguments[1].iterator();ge.hasNext();){var pe=ge.next();pe.isForward()&&this.findStabbedSegments(ne,pe,ue)}}}},{key:"getDepth",value:function(h){var o=this.findStabbedSegments(h);return o.size()===0?0:os.min(o)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Zt;var h=arguments[0];this._subgraphs=h}}])}(),Rm=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"compareTo",value:function(h){var o=h;if(this._upwardSeg.minX()>=o._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=o._upwardSeg.minX())return-1;var a=this._upwardSeg.orientationIndex(o._upwardSeg);return a!==0||(a=-1*o._upwardSeg.orientationIndex(this._upwardSeg))!==0?a:this._upwardSeg.compareTo(o._upwardSeg)}},{key:"compareX",value:function(h,o){var a=h.p0.compareTo(o.p0);return a!==0?a:h.p1.compareTo(o.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[K]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var h=arguments[0],o=arguments[1];this._upwardSeg=new Zt(h),this._leftDepth=o}}])}();bm.DepthSegment=Rm;var Cm=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,null,[{key:"constructor_",value:function(){N.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])}(N),Qh=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"getY",value:function(){var o=this.y/this.w;if(te.isNaN(o)||te.isInfinite(o))throw new Cm;return o}},{key:"getX",value:function(){var o=this.x/this.w;if(te.isNaN(o)||te.isInfinite(o))throw new Cm;return o}},{key:"getCoordinate",value:function(){var o=new J;return o.x=this.getX(),o.y=this.getY(),o}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var o=arguments[0];this.x=o.x,this.y=o.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var a=arguments[0],c=arguments[1];this.x=a,this.y=c,this.w=1}else if(arguments[0]instanceof h&&arguments[1]instanceof h){var g=arguments[0],m=arguments[1];this.x=g.y*m.w-m.y*g.w,this.y=m.x*g.w-g.x*m.w,this.w=g.x*m.y-m.x*g.y}else if(arguments[0]instanceof J&&arguments[1]instanceof J){var v=arguments[0],S=arguments[1];this.x=v.y-S.y,this.y=S.x-v.x,this.w=v.x*S.y-S.x*v.y}}else if(arguments.length===3){var I=arguments[0],L=arguments[1],q=arguments[2];this.x=I,this.y=L,this.w=q}else if(arguments.length===4){var ee=arguments[0],ne=arguments[1],ue=arguments[2],ge=arguments[3],pe=ee.y-ne.y,Ie=ne.x-ee.x,Re=ee.x*ne.y-ne.x*ee.y,ze=ue.y-ge.y,Tt=ge.x-ue.x,kt=ue.x*ge.y-ge.x*ue.y;this.x=Ie*kt-Tt*Re,this.y=ze*Re-pe*kt,this.w=pe*Tt-ze*Ie}}}])}(),db=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"area",value:function(){return h.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return h.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(o){if(o===null)throw new D("Supplied point is null.");return h.interpolateZ(o,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return h.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return h.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return h.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return h.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return h.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return h.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var o=arguments[0],a=arguments[1],c=arguments[2];this.p0=o,this.p1=a,this.p2=c}},{key:"area",value:function(o,a,c){return Math.abs(((c.x-o.x)*(a.y-o.y)-(a.x-o.x)*(c.y-o.y))/2)}},{key:"signedArea",value:function(o,a,c){return((c.x-o.x)*(a.y-o.y)-(a.x-o.x)*(c.y-o.y))/2}},{key:"det",value:function(o,a,c,g){return o*g-a*c}},{key:"interpolateZ",value:function(o,a,c,g){var m=a.x,v=a.y,S=c.x-m,I=g.x-m,L=c.y-v,q=g.y-v,ee=S*q-I*L,ne=o.x-m,ue=o.y-v,ge=(q*ne-I*ue)/ee,pe=(-L*ne+S*ue)/ee;return a.getZ()+ge*(c.getZ()-a.getZ())+pe*(g.getZ()-a.getZ())}},{key:"longestSideLength",value:function(o,a,c){var g=o.distance(a),m=a.distance(c),v=c.distance(o),S=g;return m>S&&(S=m),v>S&&(S=v),S}},{key:"circumcentreDD",value:function(o,a,c){var g=me.valueOf(o.x).subtract(c.x),m=me.valueOf(o.y).subtract(c.y),v=me.valueOf(a.x).subtract(c.x),S=me.valueOf(a.y).subtract(c.y),I=me.determinant(g,m,v,S).multiply(2),L=g.sqr().add(m.sqr()),q=v.sqr().add(S.sqr()),ee=me.determinant(m,L,S,q),ne=me.determinant(g,L,v,q),ue=me.valueOf(c.x).subtract(ee.divide(I)).doubleValue(),ge=me.valueOf(c.y).add(ne.divide(I)).doubleValue();return new J(ue,ge)}},{key:"isAcute",value:function(o,a,c){return!!Qt.isAcute(o,a,c)&&!!Qt.isAcute(a,c,o)&&!!Qt.isAcute(c,o,a)}},{key:"circumcentre",value:function(o,a,c){var g=c.x,m=c.y,v=o.x-g,S=o.y-m,I=a.x-g,L=a.y-m,q=2*h.det(v,S,I,L),ee=h.det(S,v*v+S*S,L,I*I+L*L),ne=h.det(v,v*v+S*S,I,I*I+L*L);return new J(g-ee/q,m+ne/q)}},{key:"perpendicularBisector",value:function(o,a){var c=a.x-o.x,g=a.y-o.y,m=new Qh(o.x+c/2,o.y+g/2,1),v=new Qh(o.x-g+c/2,o.y+c+g/2,1);return new Qh(m,v)}},{key:"angleBisector",value:function(o,a,c){var g=a.distance(o),m=g/(g+a.distance(c)),v=c.x-o.x,S=c.y-o.y;return new J(o.x+m*v,o.y+m*S)}},{key:"area3D",value:function(o,a,c){var g=a.x-o.x,m=a.y-o.y,v=a.getZ()-o.getZ(),S=c.x-o.x,I=c.y-o.y,L=c.getZ()-o.getZ(),q=m*L-v*I,ee=v*S-g*L,ne=g*I-m*S,ue=q*q+ee*ee+ne*ne,ge=Math.sqrt(ue)/2;return ge}},{key:"centroid",value:function(o,a,c){var g=(o.x+a.x+c.x)/3,m=(o.y+a.y+c.y)/3;return new J(g,m)}},{key:"inCentre",value:function(o,a,c){var g=a.distance(c),m=o.distance(c),v=o.distance(a),S=g+m+v,I=(g*o.x+m*a.x+v*c.x)/S,L=(g*o.y+m*a.y+v*c.y)/S;return new J(I,L)}}])}(),gb=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"addRingSide",value:function(h,o,a,c,g){if(o===0&&h.length<xo.MINIMUM_VALID_SIZE)return null;var m=c,v=g;h.length>=xo.MINIMUM_VALID_SIZE&&ve.isCCW(h)&&(m=g,v=c,a=ae.opposite(a));var S=this._curveBuilder.getRingCurve(h,a,o);this.addCurve(S,m,v)}},{key:"addRingBothSides",value:function(h,o){this.addRingSide(h,o,ae.LEFT,j.EXTERIOR,j.INTERIOR),this.addRingSide(h,o,ae.RIGHT,j.INTERIOR,j.EXTERIOR)}},{key:"addPoint",value:function(h){if(this._distance<=0)return null;var o=h.getCoordinates(),a=this._curveBuilder.getLineCurve(o,this._distance);this.addCurve(a,j.EXTERIOR,j.INTERIOR)}},{key:"addPolygon",value:function(h){var o=this._distance,a=ae.LEFT;this._distance<0&&(o=-this._distance,a=ae.RIGHT);var c=h.getExteriorRing(),g=dt.removeRepeatedPoints(c.getCoordinates());if(this._distance<0&&this.isErodedCompletely(c,this._distance)||this._distance<=0&&g.length<3)return null;this.addRingSide(g,o,a,j.EXTERIOR,j.INTERIOR);for(var m=0;m<h.getNumInteriorRing();m++){var v=h.getInteriorRingN(m),S=dt.removeRepeatedPoints(v.getCoordinates());this._distance>0&&this.isErodedCompletely(v,-this._distance)||this.addRingSide(S,o,ae.opposite(a),j.INTERIOR,j.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(h,o){var a=new db(h[0],h[1],h[2]),c=a.inCentre();return Vn.pointToSegment(c,a.p0,a.p1)<Math.abs(o)}},{key:"addLineString",value:function(h){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var o=dt.removeRepeatedPoints(h.getCoordinates());if(dt.isRing(o)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(o,this._distance);else{var a=this._curveBuilder.getLineCurve(o,this._distance);this.addCurve(a,j.EXTERIOR,j.INTERIOR)}}},{key:"addCurve",value:function(h,o,a){if(h===null||h.length<2)return null;var c=new yr(h,new hn(0,j.BOUNDARY,o,a));this._curveList.add(c)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(h){if(h.isEmpty())return null;if(h instanceof pl)this.addPolygon(h);else if(h instanceof So)this.addLineString(h);else if(h instanceof Uh)this.addPoint(h);else if(h instanceof zh)this.addCollection(h);else if(h instanceof jh)this.addCollection(h);else if(h instanceof Hh)this.addCollection(h);else{if(!(h instanceof Gt))throw new Oe(h.getGeometryType());this.addCollection(h)}}},{key:"isErodedCompletely",value:function(h,o){var a=h.getCoordinates();if(a.length<4)return o<0;if(a.length===4)return this.isTriangleErodedCompletely(a,o);var c=h.getEnvelopeInternal(),g=Math.min(c.getHeight(),c.getWidth());return o<0&&2*Math.abs(o)>g}},{key:"addCollection",value:function(h){for(var o=0;o<h.getNumGeometries();o++){var a=h.getGeometryN(o);this.add(a)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new _e;var h=arguments[0],o=arguments[1],a=arguments[2];this._inputGeom=h,this._distance=o,this._curveBuilder=a}}])}(),pb=function(){return u(function h(){r(this,h)},[{key:"locate",value:function(h){}}])}(),_b=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,h.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new ut;var o=this._parent.getGeometryN(this._index++);return o instanceof Gt?(this._subcollectionIterator=new h(o),this._subcollectionIterator.next()):o}},{key:"remove",value:function(){throw new Oe(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[sb]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var o=arguments[0];this._parent=o,this._atStart=!0,this._index=0,this._max=o.getNumGeometries()}},{key:"isAtomic",value:function(o){return!(o instanceof Gt)}}])}(),mb=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"locate",value:function(o){return h.locate(o,this._geom)}},{key:"interfaces_",get:function(){return[pb]}}],[{key:"constructor_",value:function(){this._geom=null;var o=arguments[0];this._geom=o}},{key:"locatePointInPolygon",value:function(o,a){if(a.isEmpty())return j.EXTERIOR;var c=a.getExteriorRing(),g=h.locatePointInRing(o,c);if(g!==j.INTERIOR)return g;for(var m=0;m<a.getNumInteriorRing();m++){var v=a.getInteriorRingN(m),S=h.locatePointInRing(o,v);if(S===j.BOUNDARY)return j.BOUNDARY;if(S===j.INTERIOR)return j.EXTERIOR}return j.INTERIOR}},{key:"locatePointInRing",value:function(o,a){return a.getEnvelopeInternal().intersects(o)?Yh.locateInRing(o,a.getCoordinates()):j.EXTERIOR}},{key:"containsPointInPolygon",value:function(o,a){return j.EXTERIOR!==h.locatePointInPolygon(o,a)}},{key:"locateInGeometry",value:function(o,a){if(a instanceof pl)return h.locatePointInPolygon(o,a);if(a instanceof Gt)for(var c=new _b(a);c.hasNext();){var g=c.next();if(g!==a){var m=h.locateInGeometry(o,g);if(m!==j.EXTERIOR)return m}}return j.EXTERIOR}},{key:"isContained",value:function(o,a){return j.EXTERIOR!==h.locate(o,a)}},{key:"locate",value:function(o,a){return a.isEmpty()?j.EXTERIOR:a.getEnvelopeInternal().intersects(o)?h.locateInGeometry(o,a):j.EXTERIOR}}])}(),yb=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"getNextCW",value:function(h){this.getEdges();var o=this._edgeList.indexOf(h),a=o-1;return o===0&&(a=this._edgeList.size()-1),this._edgeList.get(a)}},{key:"propagateSideLabels",value:function(h){for(var o=j.NONE,a=this.iterator();a.hasNext();){var c=a.next().getLabel();c.isArea(h)&&c.getLocation(h,ae.LEFT)!==j.NONE&&(o=c.getLocation(h,ae.LEFT))}if(o===j.NONE)return null;for(var g=o,m=this.iterator();m.hasNext();){var v=m.next(),S=v.getLabel();if(S.getLocation(h,ae.ON)===j.NONE&&S.setLocation(h,ae.ON,g),S.isArea(h)){var I=S.getLocation(h,ae.LEFT),L=S.getLocation(h,ae.RIGHT);if(L!==j.NONE){if(L!==g)throw new li("side location conflict",v.getCoordinate());I===j.NONE&&he.shouldNeverReachHere("found single null side (at "+v.getCoordinate()+")"),g=I}else he.isTrue(S.getLocation(h,ae.LEFT)===j.NONE,"found single null side"),S.setLocation(h,ae.RIGHT,g),S.setLocation(h,ae.LEFT,g)}}}},{key:"getCoordinate",value:function(){var h=this.iterator();return h.hasNext()?h.next().getCoordinate():null}},{key:"print",value:function(h){un.out.println("EdgeEndStar:   "+this.getCoordinate());for(var o=this.iterator();o.hasNext();)o.next().print(h)}},{key:"isAreaLabelsConsistent",value:function(h){return this.computeEdgeEndLabels(h.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(h){var o=this.getEdges();if(o.size()<=0)return!0;var a=o.size()-1,c=o.get(a).getLabel().getLocation(h,ae.LEFT);he.isTrue(c!==j.NONE,"Found unlabelled area edge");for(var g=c,m=this.iterator();m.hasNext();){var v=m.next().getLabel();he.isTrue(v.isArea(h),"Found non-area edge");var S=v.getLocation(h,ae.LEFT),I=v.getLocation(h,ae.RIGHT);if(S===I||I!==g)return!1;g=S}return!0}},{key:"findIndex",value:function(h){this.iterator();for(var o=0;o<this._edgeList.size();o++)if(this._edgeList.get(o)===h)return o;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new _e(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(h,o,a){return this._ptInAreaLocation[h]===j.NONE&&(this._ptInAreaLocation[h]=mb.locate(o,a[h].getGeometry())),this._ptInAreaLocation[h]}},{key:"toString",value:function(){var h=new wo;h.append("EdgeEndStar:   "+this.getCoordinate()),h.append(`
`);for(var o=this.iterator();o.hasNext();){var a=o.next();h.append(a),h.append(`
`)}return h.toString()}},{key:"computeEdgeEndLabels",value:function(h){for(var o=this.iterator();o.hasNext();)o.next().computeLabel(h)}},{key:"computeLabelling",value:function(h){this.computeEdgeEndLabels(h[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var o=[!1,!1],a=this.iterator();a.hasNext();)for(var c=a.next().getLabel(),g=0;g<2;g++)c.isLine(g)&&c.getLocation(g)===j.BOUNDARY&&(o[g]=!0);for(var m=this.iterator();m.hasNext();)for(var v=m.next(),S=v.getLabel(),I=0;I<2;I++)if(S.isAnyNull(I)){var L=j.NONE;if(o[I])L=j.EXTERIOR;else{var q=v.getCoordinate();L=this.getLocation(I,q,h)}S.setAllLocationsIfNull(I,L)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(h,o){this._edgeMap.put(h,o),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Co,this._edgeList=null,this._ptInAreaLocation=[j.NONE,j.NONE]}}])}(),vb=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var a=null,c=null,g=this._SCANNING_FOR_INCOMING,m=0;m<this._resultAreaEdgeList.size();m++){var v=this._resultAreaEdgeList.get(m),S=v.getSym();if(v.getLabel().isArea())switch(a===null&&v.isInResult()&&(a=v),g){case this._SCANNING_FOR_INCOMING:if(!S.isInResult())continue;c=S,g=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!v.isInResult())continue;c.setNext(v),g=this._SCANNING_FOR_INCOMING}}if(g===this._LINKING_TO_OUTGOING){if(a===null)throw new li("no outgoing dirEdge found",this.getCoordinate());he.isTrue(a.isInResult(),"unable to link last incoming dirEdge"),c.setNext(a)}}},{key:"insert",value:function(a){var c=a;this.insertEdgeEnd(c,c)}},{key:"getRightmostEdge",value:function(){var a=this.getEdges(),c=a.size();if(c<1)return null;var g=a.get(0);if(c===1)return g;var m=a.get(c-1),v=g.getQuadrant(),S=m.getQuadrant();return Ft.isNorthern(v)&&Ft.isNorthern(S)?g:Ft.isNorthern(v)||Ft.isNorthern(S)?g.getDy()!==0?g:m.getDy()!==0?m:(he.shouldNeverReachHere("found two horizontal edges incident on node"),null):m}},{key:"print",value:function(a){un.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var c=this.iterator();c.hasNext();){var g=c.next();a.print("out "),g.print(a),a.println(),a.print("in "),g.getSym().print(a),a.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new _e;for(var a=this.iterator();a.hasNext();){var c=a.next();(c.isInResult()||c.getSym().isInResult())&&this._resultAreaEdgeList.add(c)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(a){for(var c=this.iterator();c.hasNext();){var g=c.next().getLabel();g.setAllLocationsIfNull(0,a.getLocation(0)),g.setAllLocationsIfNull(1,a.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var a=null,c=null,g=this._edgeList.size()-1;g>=0;g--){var m=this._edgeList.get(g),v=m.getSym();c===null&&(c=v),a!==null&&v.setNext(a),a=m}c.setNext(a)}},{key:"computeDepths",value:function(){if(arguments.length===1){var a=arguments[0],c=this.findIndex(a),g=a.getDepth(ae.LEFT),m=a.getDepth(ae.RIGHT),v=this.computeDepths(c+1,this._edgeList.size(),g);if(this.computeDepths(0,c,v)!==m)throw new li("depth mismatch at "+a.getCoordinate())}else if(arguments.length===3){for(var S=arguments[1],I=arguments[2],L=arguments[0];L<S;L++){var q=this._edgeList.get(L);q.setEdgeDepths(ae.RIGHT,I),I=q.getDepth(ae.LEFT)}return I}}},{key:"mergeSymLabels",value:function(){for(var a=this.iterator();a.hasNext();){var c=a.next();c.getLabel().merge(c.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(a){for(var c=null,g=null,m=this._SCANNING_FOR_INCOMING,v=this._resultAreaEdgeList.size()-1;v>=0;v--){var S=this._resultAreaEdgeList.get(v),I=S.getSym();switch(c===null&&S.getEdgeRing()===a&&(c=S),m){case this._SCANNING_FOR_INCOMING:if(I.getEdgeRing()!==a)continue;g=I,m=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(S.getEdgeRing()!==a)continue;g.setNextMin(S),m=this._SCANNING_FOR_INCOMING}}m===this._LINKING_TO_OUTGOING&&(he.isTrue(c!==null,"found null for first outgoing dirEdge"),he.isTrue(c.getEdgeRing()===a,"unable to link last incoming dirEdge"),g.setNextMin(c))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var a=0,c=this.iterator();c.hasNext();)c.next().isInResult()&&a++;return a}if(arguments.length===1){for(var g=arguments[0],m=0,v=this.iterator();v.hasNext();)v.next().getEdgeRing()===g&&m++;return m}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var a=j.NONE,c=this.iterator();c.hasNext();){var g=c.next(),m=g.getSym();if(!g.isLineEdge()){if(g.isInResult()){a=j.INTERIOR;break}if(m.isInResult()){a=j.EXTERIOR;break}}}if(a===j.NONE)return null;for(var v=a,S=this.iterator();S.hasNext();){var I=S.next(),L=I.getSym();I.isLineEdge()?I.getEdge().setCovered(v===j.INTERIOR):(I.isInResult()&&(v=j.EXTERIOR),L.isInResult()&&(v=j.INTERIOR))}}},{key:"computeLabelling",value:function(a){T(o,"computeLabelling",this,1).call(this,a),this._label=new hn(j.NONE);for(var c=this.iterator();c.hasNext();)for(var g=c.next().getEdge().getLabel(),m=0;m<2;m++){var v=g.getLocation(m);v!==j.INTERIOR&&v!==j.BOUNDARY||this._label.setLocation(m,j.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])}(yb),Eb=function(h){function o(){return r(this,o),i(this,o)}return _(o,h),u(o,[{key:"createNode",value:function(a){return new El(a,new vb)}}])}(mm),km=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"compareTo",value:function(o){var a=o;return h.compareOriented(this._pts,this._orientation,a._pts,a._orientation)}},{key:"interfaces_",get:function(){return[K]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var o=arguments[0];this._pts=o,this._orientation=h.orientation(o)}},{key:"orientation",value:function(o){return dt.increasingDirection(o)===1}},{key:"compareOriented",value:function(o,a,c,g){for(var m=a?1:-1,v=g?1:-1,S=a?o.length:-1,I=g?c.length:-1,L=a?0:o.length-1,q=g?0:c.length-1;;){var ee=o[L].compareTo(c[q]);if(ee!==0)return ee;var ne=(L+=m)===S,ue=(q+=v)===I;if(ne&&!ue)return-1;if(!ne&&ue)return 1;if(ne&&ue)return 0}}}])}(),wb=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"print",value:function(h){h.print("MULTILINESTRING ( ");for(var o=0;o<this._edges.size();o++){var a=this._edges.get(o);o>0&&h.print(","),h.print("(");for(var c=a.getCoordinates(),g=0;g<c.length;g++)g>0&&h.print(","),h.print(c[g].x+" "+c[g].y);h.println(")")}h.print(")  ")}},{key:"addAll",value:function(h){for(var o=h.iterator();o.hasNext();)this.add(o.next())}},{key:"findEdgeIndex",value:function(h){for(var o=0;o<this._edges.size();o++)if(this._edges.get(o).equals(h))return o;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(h){return this._edges.get(h)}},{key:"findEqualEdge",value:function(h){var o=new km(h.getCoordinates());return this._ocaMap.get(o)}},{key:"add",value:function(h){this._edges.add(h);var o=new km(h.getCoordinates());this._ocaMap.put(o,h)}}],[{key:"constructor_",value:function(){this._edges=new _e,this._ocaMap=new Co}}])}(),Im=function(){return u(function h(){r(this,h)},[{key:"processIntersections",value:function(h,o,a,c){}},{key:"isDone",value:function(){}}])}(),Tb=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"isTrivialIntersection",value:function(o,a,c,g){if(o===c&&this._li.getIntersectionNum()===1){if(h.isAdjacentSegments(a,g))return!0;if(o.isClosed()){var m=o.size()-1;if(a===0&&g===m||g===0&&a===m)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(o,a,c,g){if(o===c&&a===g)return null;this.numTests++;var m=o.getCoordinates()[a],v=o.getCoordinates()[a+1],S=c.getCoordinates()[g],I=c.getCoordinates()[g+1];this._li.computeIntersection(m,v,S,I),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(o,a,c,g)||(this._hasIntersection=!0,o.addIntersections(this._li,a,0),c.addIntersections(this._li,g,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Im]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var o=arguments[0];this._li=o}},{key:"isAdjacentSegments",value:function(o,a){return Math.abs(o-a)===1}}])}(),Sb=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(h){h.print(this.coord),h.print(" seg # = "+this.segmentIndex),h.println(" dist = "+this.dist)}},{key:"compareTo",value:function(h){var o=h;return this.compare(o.segmentIndex,o.dist)}},{key:"isEndPoint",value:function(h){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===h}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(h,o){return this.segmentIndex<h?-1:this.segmentIndex>h?1:this.dist<o?-1:this.dist>o?1:0}},{key:"interfaces_",get:function(){return[K]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var h=arguments[0],o=arguments[1],a=arguments[2];this.coord=new J(h),this.segmentIndex=o,this.dist=a}}])}(),xb=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"print",value:function(h){h.println("Intersections:");for(var o=this.iterator();o.hasNext();)o.next().print(h)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(h){this.addEndpoints();for(var o=this.iterator(),a=o.next();o.hasNext();){var c=o.next(),g=this.createSplitEdge(a,c);h.add(g),a=c}}},{key:"addEndpoints",value:function(){var h=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[h],h,0)}},{key:"createSplitEdge",value:function(h,o){var a=o.segmentIndex-h.segmentIndex+2,c=this.edge.pts[o.segmentIndex],g=o.dist>0||!o.coord.equals2D(c);g||a--;var m=new Array(a).fill(null),v=0;m[v++]=new J(h.coord);for(var S=h.segmentIndex+1;S<=o.segmentIndex;S++)m[v++]=this.edge.pts[S];return g&&(m[v]=o.coord),new Nm(m,new hn(this.edge._label))}},{key:"add",value:function(h,o,a){var c=new Sb(h,o,a),g=this._nodeMap.get(c);return g!==null?g:(this._nodeMap.put(c,c),c)}},{key:"isIntersection",value:function(h){for(var o=this.iterator();o.hasNext();)if(o.next().coord.equals(h))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Co,this.edge=null;var h=arguments[0];this.edge=h}}])}(),Ab=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(h.isTrue(this._matrix[j.INTERIOR][j.INTERIOR])||h.isTrue(this._matrix[j.INTERIOR][j.BOUNDARY])||h.isTrue(this._matrix[j.BOUNDARY][j.INTERIOR])||h.isTrue(this._matrix[j.BOUNDARY][j.BOUNDARY]))&&this._matrix[j.EXTERIOR][j.INTERIOR]===le.FALSE&&this._matrix[j.EXTERIOR][j.BOUNDARY]===le.FALSE}},{key:"isCoveredBy",value:function(){return(h.isTrue(this._matrix[j.INTERIOR][j.INTERIOR])||h.isTrue(this._matrix[j.INTERIOR][j.BOUNDARY])||h.isTrue(this._matrix[j.BOUNDARY][j.INTERIOR])||h.isTrue(this._matrix[j.BOUNDARY][j.BOUNDARY]))&&this._matrix[j.INTERIOR][j.EXTERIOR]===le.FALSE&&this._matrix[j.BOUNDARY][j.EXTERIOR]===le.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var o=arguments[0],a=0;a<o.length;a++){var c=Math.trunc(a/3),g=a%3;this._matrix[c][g]=le.toDimensionValue(o.charAt(a))}else if(arguments.length===3){var m=arguments[0],v=arguments[1],S=arguments[2];this._matrix[m][v]=S}}},{key:"isContains",value:function(){return h.isTrue(this._matrix[j.INTERIOR][j.INTERIOR])&&this._matrix[j.EXTERIOR][j.INTERIOR]===le.FALSE&&this._matrix[j.EXTERIOR][j.BOUNDARY]===le.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var o=arguments[0],a=0;a<o.length;a++){var c=Math.trunc(a/3),g=a%3;this.setAtLeast(c,g,le.toDimensionValue(o.charAt(a)))}else if(arguments.length===3){var m=arguments[0],v=arguments[1],S=arguments[2];this._matrix[m][v]<S&&(this._matrix[m][v]=S)}}},{key:"setAtLeastIfValid",value:function(o,a,c){o>=0&&a>=0&&this.setAtLeast(o,a,c)}},{key:"isWithin",value:function(){return h.isTrue(this._matrix[j.INTERIOR][j.INTERIOR])&&this._matrix[j.INTERIOR][j.EXTERIOR]===le.FALSE&&this._matrix[j.BOUNDARY][j.EXTERIOR]===le.FALSE}},{key:"isTouches",value:function(o,a){return o>a?this.isTouches(a,o):(o===le.A&&a===le.A||o===le.L&&a===le.L||o===le.L&&a===le.A||o===le.P&&a===le.A||o===le.P&&a===le.L)&&this._matrix[j.INTERIOR][j.INTERIOR]===le.FALSE&&(h.isTrue(this._matrix[j.INTERIOR][j.BOUNDARY])||h.isTrue(this._matrix[j.BOUNDARY][j.INTERIOR])||h.isTrue(this._matrix[j.BOUNDARY][j.BOUNDARY]))}},{key:"isOverlaps",value:function(o,a){return o===le.P&&a===le.P||o===le.A&&a===le.A?h.isTrue(this._matrix[j.INTERIOR][j.INTERIOR])&&h.isTrue(this._matrix[j.INTERIOR][j.EXTERIOR])&&h.isTrue(this._matrix[j.EXTERIOR][j.INTERIOR]):o===le.L&&a===le.L&&this._matrix[j.INTERIOR][j.INTERIOR]===1&&h.isTrue(this._matrix[j.INTERIOR][j.EXTERIOR])&&h.isTrue(this._matrix[j.EXTERIOR][j.INTERIOR])}},{key:"isEquals",value:function(o,a){return o===a&&h.isTrue(this._matrix[j.INTERIOR][j.INTERIOR])&&this._matrix[j.INTERIOR][j.EXTERIOR]===le.FALSE&&this._matrix[j.BOUNDARY][j.EXTERIOR]===le.FALSE&&this._matrix[j.EXTERIOR][j.INTERIOR]===le.FALSE&&this._matrix[j.EXTERIOR][j.BOUNDARY]===le.FALSE}},{key:"toString",value:function(){for(var o=new ml("123456789"),a=0;a<3;a++)for(var c=0;c<3;c++)o.setCharAt(3*a+c,le.toDimensionSymbol(this._matrix[a][c]));return o.toString()}},{key:"setAll",value:function(o){for(var a=0;a<3;a++)for(var c=0;c<3;c++)this._matrix[a][c]=o}},{key:"get",value:function(o,a){return this._matrix[o][a]}},{key:"transpose",value:function(){var o=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=o,o=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=o,o=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=o,this}},{key:"matches",value:function(o){if(o.length!==9)throw new D("Should be length 9: "+o);for(var a=0;a<3;a++)for(var c=0;c<3;c++)if(!h.matches(this._matrix[a][c],o.charAt(3*a+c)))return!1;return!0}},{key:"add",value:function(o){for(var a=0;a<3;a++)for(var c=0;c<3;c++)this.setAtLeast(a,c,o.get(a,c))}},{key:"isDisjoint",value:function(){return this._matrix[j.INTERIOR][j.INTERIOR]===le.FALSE&&this._matrix[j.INTERIOR][j.BOUNDARY]===le.FALSE&&this._matrix[j.BOUNDARY][j.INTERIOR]===le.FALSE&&this._matrix[j.BOUNDARY][j.BOUNDARY]===le.FALSE}},{key:"isCrosses",value:function(o,a){return o===le.P&&a===le.L||o===le.P&&a===le.A||o===le.L&&a===le.A?h.isTrue(this._matrix[j.INTERIOR][j.INTERIOR])&&h.isTrue(this._matrix[j.INTERIOR][j.EXTERIOR]):o===le.L&&a===le.P||o===le.A&&a===le.P||o===le.A&&a===le.L?h.isTrue(this._matrix[j.INTERIOR][j.INTERIOR])&&h.isTrue(this._matrix[j.EXTERIOR][j.INTERIOR]):o===le.L&&a===le.L&&this._matrix[j.INTERIOR][j.INTERIOR]===0}},{key:"interfaces_",get:function(){return[x]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(le.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var o=arguments[0];h.constructor_.call(this),this.set(o)}else if(arguments[0]instanceof h){var a=arguments[0];h.constructor_.call(this),this._matrix[j.INTERIOR][j.INTERIOR]=a._matrix[j.INTERIOR][j.INTERIOR],this._matrix[j.INTERIOR][j.BOUNDARY]=a._matrix[j.INTERIOR][j.BOUNDARY],this._matrix[j.INTERIOR][j.EXTERIOR]=a._matrix[j.INTERIOR][j.EXTERIOR],this._matrix[j.BOUNDARY][j.INTERIOR]=a._matrix[j.BOUNDARY][j.INTERIOR],this._matrix[j.BOUNDARY][j.BOUNDARY]=a._matrix[j.BOUNDARY][j.BOUNDARY],this._matrix[j.BOUNDARY][j.EXTERIOR]=a._matrix[j.BOUNDARY][j.EXTERIOR],this._matrix[j.EXTERIOR][j.INTERIOR]=a._matrix[j.EXTERIOR][j.INTERIOR],this._matrix[j.EXTERIOR][j.BOUNDARY]=a._matrix[j.EXTERIOR][j.BOUNDARY],this._matrix[j.EXTERIOR][j.EXTERIOR]=a._matrix[j.EXTERIOR][j.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var o=arguments[0],a=arguments[1];return a===le.SYM_DONTCARE||a===le.SYM_TRUE&&(o>=0||o===le.TRUE)||a===le.SYM_FALSE&&o===le.FALSE||a===le.SYM_P&&o===le.P||a===le.SYM_L&&o===le.L||a===le.SYM_A&&o===le.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var c=arguments[1];return new h(arguments[0]).matches(c)}}},{key:"isTrue",value:function(o){return o>=0||o===le.TRUE}}])}(),bb=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(o){return o===null||o.length===0?null:(this.ensureCapacity(this._size+o.length),un.arraycopy(o,0,this._data,this._size,o.length),void(this._size+=o.length))}},{key:"ensureCapacity",value:function(o){if(o<=this._data.length)return null;var a=Math.max(o,2*this._data.length);this._data=gr.copyOf(this._data,a)}},{key:"toArray",value:function(){var o=new Array(this._size).fill(null);return un.arraycopy(this._data,0,o,0,this._size),o}},{key:"add",value:function(o){this.ensureCapacity(this._size+1),this._data[this._size]=o,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)h.constructor_.call(this,10);else if(arguments.length===1){var o=arguments[0];this._data=new Array(o).fill(null)}}}])}(),Rb=function(){function h(){r(this,h)}return u(h,[{key:"getChainStartIndices",value:function(o){var a=0,c=new bb(Math.trunc(o.length/2));c.add(a);do{var g=this.findChainEnd(o,a);c.add(g),a=g}while(a<o.length-1);return c.toArray()}},{key:"findChainEnd",value:function(o,a){for(var c=Ft.quadrant(o[a],o[a+1]),g=a+1;g<o.length&&Ft.quadrant(o[g-1],o[g])===c;)g++;return g-1}},{key:"OLDgetChainStartIndices",value:function(o){var a=0,c=new _e;c.add(a);do{var g=this.findChainEnd(o,a);c.add(g),a=g}while(a<o.length-1);return h.toIntArray(c)}}],[{key:"toIntArray",value:function(o){for(var a=new Array(o.size()).fill(null),c=0;c<a.length;c++)a[c]=o.get(c).intValue();return a}}])}(),Cb=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(h){var o=this.pts[this.startIndex[h]].x,a=this.pts[this.startIndex[h+1]].x;return o>a?o:a}},{key:"getMinX",value:function(h){var o=this.pts[this.startIndex[h]].x,a=this.pts[this.startIndex[h+1]].x;return o<a?o:a}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var h=arguments[0],o=arguments[1],a=arguments[2],c=arguments[3];this.computeIntersectsForChain(this.startIndex[h],this.startIndex[h+1],o,o.startIndex[a],o.startIndex[a+1],c)}else if(arguments.length===6){var g=arguments[0],m=arguments[1],v=arguments[2],S=arguments[3],I=arguments[4],L=arguments[5];if(m-g==1&&I-S==1)return L.addIntersections(this.e,g,v.e,S),null;if(!this.overlaps(g,m,v,S,I))return null;var q=Math.trunc((g+m)/2),ee=Math.trunc((S+I)/2);g<q&&(S<ee&&this.computeIntersectsForChain(g,q,v,S,ee,L),ee<I&&this.computeIntersectsForChain(g,q,v,ee,I,L)),q<m&&(S<ee&&this.computeIntersectsForChain(q,m,v,S,ee,L),ee<I&&this.computeIntersectsForChain(q,m,v,ee,I,L))}}},{key:"overlaps",value:function(h,o,a,c,g){return De.intersects(this.pts[h],this.pts[o],a.pts[c],a.pts[g])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(h,o){for(var a=0;a<this.startIndex.length-1;a++)for(var c=0;c<h.startIndex.length-1;c++)this.computeIntersectsForChain(a,h,c,o)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var h=arguments[0];this.e=h,this.pts=h.getCoordinates();var o=new Rb;this.startIndex=o.getChainStartIndices(this.pts)}}])}(),Pm=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"getDepth",value:function(o,a){return this._depth[o][a]}},{key:"setDepth",value:function(o,a,c){this._depth[o][a]=c}},{key:"isNull",value:function(){if(arguments.length===0){for(var o=0;o<2;o++)for(var a=0;a<3;a++)if(this._depth[o][a]!==h.NULL_VALUE)return!1;return!0}if(arguments.length===1){var c=arguments[0];return this._depth[c][1]===h.NULL_VALUE}if(arguments.length===2){var g=arguments[0],m=arguments[1];return this._depth[g][m]===h.NULL_VALUE}}},{key:"normalize",value:function(){for(var o=0;o<2;o++)if(!this.isNull(o)){var a=this._depth[o][1];this._depth[o][2]<a&&(a=this._depth[o][2]),a<0&&(a=0);for(var c=1;c<3;c++){var g=0;this._depth[o][c]>a&&(g=1),this._depth[o][c]=g}}}},{key:"getDelta",value:function(o){return this._depth[o][ae.RIGHT]-this._depth[o][ae.LEFT]}},{key:"getLocation",value:function(o,a){return this._depth[o][a]<=0?j.EXTERIOR:j.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var o=arguments[0],a=0;a<2;a++)for(var c=1;c<3;c++){var g=o.getLocation(a,c);g!==j.EXTERIOR&&g!==j.INTERIOR||(this.isNull(a,c)?this._depth[a][c]=h.depthAtLocation(g):this._depth[a][c]+=h.depthAtLocation(g))}else if(arguments.length===3){var m=arguments[0],v=arguments[1];arguments[2]===j.INTERIOR&&this._depth[m][v]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var o=0;o<2;o++)for(var a=0;a<3;a++)this._depth[o][a]=h.NULL_VALUE}},{key:"depthAtLocation",value:function(o){return o===j.EXTERIOR?0:o===j.INTERIOR?1:h.NULL_VALUE}}])}();Pm.NULL_VALUE=-1;var Nm=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var a=new Array(2).fill(null);return a[0]=this.pts[0],a[1]=this.pts[1],new o(a,hn.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(a){this._isIsolated=a}},{key:"setName",value:function(a){this._name=a}},{key:"equals",value:function(a){if(!(a instanceof o))return!1;var c=a;if(this.pts.length!==c.pts.length)return!1;for(var g=!0,m=!0,v=this.pts.length,S=0;S<this.pts.length;S++)if(this.pts[S].equals2D(c.pts[S])||(g=!1),this.pts[S].equals2D(c.pts[--v])||(m=!1),!g&&!m)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var a=arguments[0];return this.pts[a]}}},{key:"print",value:function(a){a.print("edge "+this._name+": "),a.print("LINESTRING (");for(var c=0;c<this.pts.length;c++)c>0&&a.print(","),a.print(this.pts[c].x+" "+this.pts[c].y);a.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(a){o.updateIM(this._label,a)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(a){a.print("edge "+this._name+": ");for(var c=this.pts.length-1;c>=0;c--)a.print(this.pts[c]+" ");a.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new Cb(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new De;for(var a=0;a<this.pts.length;a++)this._env.expandToInclude(this.pts[a])}return this._env}},{key:"addIntersection",value:function(a,c,g,m){var v=new J(a.getIntersection(m)),S=c,I=a.getEdgeDistance(g,m),L=S+1;if(L<this.pts.length){var q=this.pts[L];v.equals2D(q)&&(S=L,I=0)}this.eiList.add(v,S,I)}},{key:"toString",value:function(){var a=new ml;a.append("edge "+this._name+": "),a.append("LINESTRING (");for(var c=0;c<this.pts.length;c++)c>0&&a.append(","),a.append(this.pts[c].x+" "+this.pts[c].y);return a.append(")  "+this._label+" "+this._depthDelta),a.toString()}},{key:"isPointwiseEqual",value:function(a){if(this.pts.length!==a.pts.length)return!1;for(var c=0;c<this.pts.length;c++)if(!this.pts[c].equals2D(a.pts[c]))return!1;return!0}},{key:"setDepthDelta",value:function(a){this._depthDelta=a}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(a,c,g){for(var m=0;m<a.getIntersectionNum();m++)this.addIntersection(a,c,g,m)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new xb(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Pm,this._depthDelta=0,arguments.length===1){var a=arguments[0];o.constructor_.call(this,a,null)}else if(arguments.length===2){var c=arguments[0],g=arguments[1];this.pts=c,this._label=g}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Ab&&arguments[0]instanceof hn))return T(o,"updateIM",this).apply(this,arguments);var a=arguments[0],c=arguments[1];c.setAtLeastIfValid(a.getLocation(0,ae.ON),a.getLocation(1,ae.ON),1),a.isArea()&&(c.setAtLeastIfValid(a.getLocation(0,ae.LEFT),a.getLocation(1,ae.LEFT),2),c.setAtLeastIfValid(a.getLocation(0,ae.RIGHT),a.getLocation(1,ae.RIGHT),2))}}])}(fm),Mm=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"setWorkingPrecisionModel",value:function(o){this._workingPrecisionModel=o}},{key:"insertUniqueEdge",value:function(o){var a=this._edgeList.findEqualEdge(o);if(a!==null){var c=a.getLabel(),g=o.getLabel();a.isPointwiseEqual(o)||(g=new hn(o.getLabel())).flip(),c.merge(g);var m=h.depthDelta(g),v=a.getDepthDelta()+m;a.setDepthDelta(v)}else this._edgeList.add(o),o.setDepthDelta(h.depthDelta(o.getLabel()))}},{key:"buildSubgraphs",value:function(o,a){for(var c=new _e,g=o.iterator();g.hasNext();){var m=g.next(),v=m.getRightmostCoordinate(),S=new bm(c).getDepth(v);m.computeDepth(S),m.findResultEdges(),c.add(m),a.add(m.getDirectedEdges(),m.getNodes())}}},{key:"createSubgraphs",value:function(o){for(var a=new _e,c=o.getNodes().iterator();c.hasNext();){var g=c.next();if(!g.isVisited()){var m=new MA;m.create(g),a.add(m)}}return os.sort(a,os.reverseOrder()),a}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(o){if(this._workingNoder!==null)return this._workingNoder;var a=new Zh,c=new mr;return c.setPrecisionModel(o),a.setSegmentIntersector(new Tb(c)),a}},{key:"buffer",value:function(o,a){var c=this._workingPrecisionModel;c===null&&(c=o.getPrecisionModel()),this._geomFact=o.getFactory();var g=new fb(c,this._bufParams),m=new gb(o,a,g).getCurves();if(m.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(m,c),this._graph=new ym(new Eb),this._graph.addEdges(this._edgeList.getEdges());var v=this.createSubgraphs(this._graph),S=new JA(this._geomFact);this.buildSubgraphs(v,S);var I=S.getPolygons();return I.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(I)}},{key:"computeNodedEdges",value:function(o,a){var c=this.getNoder(a);c.computeNodes(o);for(var g=c.getNodedSubstrings().iterator();g.hasNext();){var m=g.next(),v=m.getCoordinates();if(v.length!==2||!v[0].equals2D(v[1])){var S=m.getData(),I=new Nm(m.getCoordinates(),new hn(S));this.insertUniqueEdge(I)}}}},{key:"setNoder",value:function(o){this._workingNoder=o}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new wb;var o=arguments[0];this._bufParams=o}},{key:"depthDelta",value:function(o){var a=o.getLocation(0,ae.LEFT),c=o.getLocation(0,ae.RIGHT);return a===j.INTERIOR&&c===j.EXTERIOR?1:a===j.EXTERIOR&&c===j.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(o){for(var a=new rs,c=new _e;o.hasNext();){var g=o.next(),m=a.createLineString(g.getCoordinates());c.add(m)}return a.buildGeometry(c)}}])}(),kb=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"rescale",value:function(){if(Se(arguments[0],Ze))for(var o=arguments[0].iterator();o.hasNext();){var a=o.next();this.rescale(a.getCoordinates())}else if(arguments[0]instanceof Array){for(var c=arguments[0],g=0;g<c.length;g++)c[g].x=c[g].x/this._scaleFactor+this._offsetX,c[g].y=c[g].y/this._scaleFactor+this._offsetY;c.length===2&&c[0].equals2D(c[1])&&un.out.println(c)}}},{key:"scale",value:function(){if(Se(arguments[0],Ze)){for(var o=arguments[0],a=new _e(o.size()),c=o.iterator();c.hasNext();){var g=c.next();a.add(new yr(this.scale(g.getCoordinates()),g.getData()))}return a}if(arguments[0]instanceof Array){for(var m=arguments[0],v=new Array(m.length).fill(null),S=0;S<m.length;S++)v[S]=new J(Math.round((m[S].x-this._offsetX)*this._scaleFactor),Math.round((m[S].y-this._offsetY)*this._scaleFactor),m[S].getZ());return dt.removeRepeatedPoints(v)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var o=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(o),o}},{key:"computeNodes",value:function(o){var a=o;this._isScaled&&(a=this.scale(o)),this._noder.computeNodes(a)}},{key:"interfaces_",get:function(){return[Gh]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var o=arguments[0],a=arguments[1];h.constructor_.call(this,o,a,0,0)}else if(arguments.length===4){var c=arguments[0],g=arguments[1];this._noder=c,this._scaleFactor=g,this._isScaled=!this.isIntegerPrecision()}}}])}(),Om=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var o=this._segStrings.iterator();o.hasNext();){var a=o.next().getCoordinates();this.checkEndPtVertexIntersections(a[0],this._segStrings),this.checkEndPtVertexIntersections(a[a.length-1],this._segStrings)}else if(arguments.length===2){for(var c=arguments[0],g=arguments[1].iterator();g.hasNext();)for(var m=g.next().getCoordinates(),v=1;v<m.length-1;v++)if(m[v].equals(c))throw new ce("found endpt/interior pt intersection at index "+v+" :pt "+c)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var o=this._segStrings.iterator();o.hasNext();)for(var a=o.next(),c=this._segStrings.iterator();c.hasNext();){var g=c.next();this.checkInteriorIntersections(a,g)}else if(arguments.length===2)for(var m=arguments[0],v=arguments[1],S=m.getCoordinates(),I=v.getCoordinates(),L=0;L<S.length-1;L++)for(var q=0;q<I.length-1;q++)this.checkInteriorIntersections(m,L,v,q);else if(arguments.length===4){var ee=arguments[0],ne=arguments[1],ue=arguments[2],ge=arguments[3];if(ee===ue&&ne===ge)return null;var pe=ee.getCoordinates()[ne],Ie=ee.getCoordinates()[ne+1],Re=ue.getCoordinates()[ge],ze=ue.getCoordinates()[ge+1];if(this._li.computeIntersection(pe,Ie,Re,ze),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,pe,Ie)||this.hasInteriorIntersection(this._li,Re,ze)))throw new ce("found non-noded intersection at "+pe+"-"+Ie+" and "+Re+"-"+ze)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var o=this._segStrings.iterator();o.hasNext();){var a=o.next();this.checkCollapses(a)}else if(arguments.length===1)for(var c=arguments[0].getCoordinates(),g=0;g<c.length-2;g++)this.checkCollapse(c[g],c[g+1],c[g+2])}},{key:"hasInteriorIntersection",value:function(o,a,c){for(var g=0;g<o.getIntersectionNum();g++){var m=o.getIntersection(g);if(!m.equals(a)&&!m.equals(c))return!0}return!1}},{key:"checkCollapse",value:function(o,a,c){if(o.equals(c))throw new ce("found non-noded collapse at "+h.fact.createLineString([o,a,c]))}}],[{key:"constructor_",value:function(){this._li=new mr,this._segStrings=null;var o=arguments[0];this._segStrings=o}}])}();Om.fact=new rs;var Jh=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"intersectsScaled",value:function(o,a){var c=Math.min(o.x,a.x),g=Math.max(o.x,a.x),m=Math.min(o.y,a.y),v=Math.max(o.y,a.y),S=this._maxx<c||this._minx>g||this._maxy<m||this._miny>v;if(S)return!1;var I=this.intersectsToleranceSquare(o,a);return he.isTrue(!(S&&I),"Found bad envelope test"),I}},{key:"initCorners",value:function(o){var a=.5;this._minx=o.x-a,this._maxx=o.x+a,this._miny=o.y-a,this._maxy=o.y+a,this._corner[0]=new J(this._maxx,this._maxy),this._corner[1]=new J(this._minx,this._maxy),this._corner[2]=new J(this._minx,this._miny),this._corner[3]=new J(this._maxx,this._miny)}},{key:"intersects",value:function(o,a){return this._scaleFactor===1?this.intersectsScaled(o,a):(this.copyScaled(o,this._p0Scaled),this.copyScaled(a,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(o){return Math.round(o*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(o,a){a.x=this.scale(o.x),a.y=this.scale(o.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var o=h.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new De(this._originalPt.x-o,this._originalPt.x+o,this._originalPt.y-o,this._originalPt.y+o)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(o,a){return this._li.computeIntersection(o,a,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(o,a,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(o,a,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(o,a,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(o,a){var c=!1,g=!1;return this._li.computeIntersection(o,a,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(o,a,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(c=!0),this._li.computeIntersection(o,a,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(g=!0),this._li.computeIntersection(o,a,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!c||!g)||!!o.equals(this._pt)||!!a.equals(this._pt))))}},{key:"addSnappedNode",value:function(o,a){var c=o.getCoordinate(a),g=o.getCoordinate(a+1);return!!this.intersects(c,g)&&(o.addIntersection(this.getCoordinate(),a),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var o=arguments[0],a=arguments[1],c=arguments[2];if(this._originalPt=o,this._pt=o,this._scaleFactor=a,this._li=c,a<=0)throw new D("Scale factor must be non-zero");a!==1&&(this._pt=new J(this.scale(o.x),this.scale(o.y)),this._p0Scaled=new J,this._p1Scaled=new J),this.initCorners(this._pt)}}])}();Jh.SAFE_ENV_EXPANSION_FACTOR=.75;var Ib=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var h=arguments[1];arguments[0].getLineSegment(h,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Zt}}])}(),Lm=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"snap",value:function(){if(arguments.length===1){var h=arguments[0];return this.snap(h,null,-1)}if(arguments.length===3){var o=arguments[0],a=arguments[1],c=arguments[2],g=o.getSafeEnvelope(),m=new Dm(o,a,c);return this._index.query(g,new(function(){return u(function v(){r(this,v)},[{key:"interfaces_",get:function(){return[Em]}},{key:"visitItem",value:function(v){v.select(g,m)}}])}())),m.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var h=arguments[0];this._index=h}}])}(),Dm=function(h){function o(){var a;return r(this,o),a=i(this,o),o.constructor_.apply(a,arguments),a}return _(o,h),u(o,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Tm))return T(o,"select",this,1).apply(this,arguments);var a=arguments[1],c=arguments[0].getContext();if(this._parentEdge===c&&(a===this._hotPixelVertexIndex||a+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(c,a)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var a=arguments[0],c=arguments[1],g=arguments[2];this._hotPixel=a,this._parentEdge=c,this._hotPixelVertexIndex=g}}])}(Ib);Lm.HotPixelSnapAction=Dm;var Pb=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"processIntersections",value:function(h,o,a,c){if(h===a&&o===c)return null;var g=h.getCoordinates()[o],m=h.getCoordinates()[o+1],v=a.getCoordinates()[c],S=a.getCoordinates()[c+1];if(this._li.computeIntersection(g,m,v,S),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var I=0;I<this._li.getIntersectionNum();I++)this._interiorIntersections.add(this._li.getIntersection(I));h.addIntersections(this._li,o,0),a.addIntersections(this._li,c,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Im]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var h=arguments[0];this._li=h,this._interiorIntersections=new _e}}])}(),Nb=function(){return u(function h(){r(this,h),h.constructor_.apply(this,arguments)},[{key:"checkCorrectness",value:function(h){var o=yr.getNodedSubstrings(h),a=new Om(o);try{a.checkValid()}catch(c){if(!(c instanceof N))throw c;c.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return yr.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(h,o){var a=this.findInteriorIntersections(h,o);this.computeIntersectionSnaps(a),this.computeVertexSnaps(h)}},{key:"findInteriorIntersections",value:function(h,o){var a=new Pb(o);return this._noder.setSegmentIntersector(a),this._noder.computeNodes(h),a.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(Se(arguments[0],Ze))for(var h=arguments[0].iterator();h.hasNext();){var o=h.next();this.computeVertexSnaps(o)}else if(arguments[0]instanceof yr)for(var a=arguments[0],c=a.getCoordinates(),g=0;g<c.length;g++){var m=new Jh(c[g],this._scaleFactor,this._li);this._pointSnapper.snap(m,a,g)&&a.addIntersection(c[g],g)}}},{key:"computeNodes",value:function(h){this._nodedSegStrings=h,this._noder=new Zh,this._pointSnapper=new Lm(this._noder.getIndex()),this.snapRound(h,this._li)}},{key:"computeIntersectionSnaps",value:function(h){for(var o=h.iterator();o.hasNext();){var a=o.next(),c=new Jh(a,this._scaleFactor,this._li);this._pointSnapper.snap(c)}}},{key:"interfaces_",get:function(){return[Gh]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var h=arguments[0];this._pm=h,this._li=new mr,this._li.setPrecisionModel(h),this._scaleFactor=h.getScale()}}])}(),us=function(){function h(){r(this,h),h.constructor_.apply(this,arguments)}return u(h,[{key:"bufferFixedPrecision",value:function(o){var a=new kb(new Nb(new An(1)),o.getScale()),c=new Mm(this._bufParams);c.setWorkingPrecisionModel(o),c.setNoder(a),this._resultGeometry=c.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var o=h.MAX_PRECISION_DIGITS;o>=0;o--){try{this.bufferReducedPrecision(o)}catch(m){if(!(m instanceof li))throw m;this._saveException=m}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var a=arguments[0],c=h.precisionScaleFactor(this._argGeom,this._distance,a),g=new An(c);this.bufferFixedPrecision(g)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var o=this._argGeom.getFactory().getPrecisionModel();o.getType()===An.FIXED?this.bufferFixedPrecision(o):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(o){this._bufParams.setQuadrantSegments(o)}},{key:"bufferOriginalPrecision",value:function(){try{var o=new Mm(this._bufParams);this._resultGeometry=o.buffer(this._argGeom,this._distance)}catch(a){if(!(a instanceof ce))throw a;this._saveException=a}}},{key:"getResultGeometry",value:function(o){return this._distance=o,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(o){this._bufParams.setEndCapStyle(o)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new A,this._resultGeometry=null,this._saveException=null,arguments.length===1){var o=arguments[0];this._argGeom=o}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this._argGeom=a,this._bufParams=c}}},{key:"bufferOp",value:function(){if(arguments.length===2){var o=arguments[1];return new h(arguments[0]).getResultGeometry(o)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof fe&&typeof arguments[1]=="number"){var a=arguments[1],c=arguments[2],g=new h(arguments[0]);return g.setQuadrantSegments(c),g.getResultGeometry(a)}if(arguments[2]instanceof A&&arguments[0]instanceof fe&&typeof arguments[1]=="number"){var m=arguments[1];return new h(arguments[0],arguments[2]).getResultGeometry(m)}}else if(arguments.length===4){var v=arguments[1],S=arguments[2],I=arguments[3],L=new h(arguments[0]);return L.setQuadrantSegments(S),L.setEndCapStyle(I),L.getResultGeometry(v)}}},{key:"precisionScaleFactor",value:function(o,a,c){var g=o.getEnvelopeInternal(),m=To.max(Math.abs(g.getMaxX()),Math.abs(g.getMaxY()),Math.abs(g.getMinX()),Math.abs(g.getMinY()))+2*(a>0?a:0),v=c-Math.trunc(Math.log(m)/Math.log(10)+1);return Math.pow(10,v)}}])}();us.CAP_ROUND=A.CAP_ROUND,us.CAP_BUTT=A.CAP_FLAT,us.CAP_FLAT=A.CAP_FLAT,us.CAP_SQUARE=A.CAP_SQUARE,us.MAX_PRECISION_DIGITS=12;var Mb=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Fm=function(){return u(function h(o){r(this,h),this.geometryFactory=o||new rs},[{key:"read",value:function(h){var o,a=(o=typeof h=="string"?JSON.parse(h):h).type;if(!dn[a])throw new Error("Unknown GeoJSON type: "+o.type);return Mb.indexOf(a)!==-1?dn[a].call(this,o.coordinates):a==="GeometryCollection"?dn[a].call(this,o.geometries):dn[a].call(this,o)}},{key:"write",value:function(h){var o=h.getGeometryType();if(!jn[o])throw new Error("Geometry is not supported");return jn[o].call(this,h)}}])}(),dn={Feature:function(h){var o={};for(var a in h)o[a]=h[a];if(h.geometry){var c=h.geometry.type;if(!dn[c])throw new Error("Unknown GeoJSON type: "+h.type);o.geometry=this.read(h.geometry)}return h.bbox&&(o.bbox=dn.bbox.call(this,h.bbox)),o},FeatureCollection:function(h){var o={};if(h.features){o.features=[];for(var a=0;a<h.features.length;++a)o.features.push(this.read(h.features[a]))}return h.bbox&&(o.bbox=this.parse.bbox.call(this,h.bbox)),o},coordinates:function(h){for(var o=[],a=0;a<h.length;++a){var c=h[a];o.push(s(J,k(c)))}return o},bbox:function(h){return this.geometryFactory.createLinearRing([new J(h[0],h[1]),new J(h[2],h[1]),new J(h[2],h[3]),new J(h[0],h[3]),new J(h[0],h[1])])},Point:function(h){var o=s(J,k(h));return this.geometryFactory.createPoint(o)},MultiPoint:function(h){for(var o=[],a=0;a<h.length;++a)o.push(dn.Point.call(this,h[a]));return this.geometryFactory.createMultiPoint(o)},LineString:function(h){var o=dn.coordinates.call(this,h);return this.geometryFactory.createLineString(o)},MultiLineString:function(h){for(var o=[],a=0;a<h.length;++a)o.push(dn.LineString.call(this,h[a]));return this.geometryFactory.createMultiLineString(o)},Polygon:function(h){for(var o=dn.coordinates.call(this,h[0]),a=this.geometryFactory.createLinearRing(o),c=[],g=1;g<h.length;++g){var m=h[g],v=dn.coordinates.call(this,m),S=this.geometryFactory.createLinearRing(v);c.push(S)}return this.geometryFactory.createPolygon(a,c)},MultiPolygon:function(h){for(var o=[],a=0;a<h.length;++a){var c=h[a];o.push(dn.Polygon.call(this,c))}return this.geometryFactory.createMultiPolygon(o)},GeometryCollection:function(h){for(var o=[],a=0;a<h.length;++a){var c=h[a];o.push(this.read(c))}return this.geometryFactory.createGeometryCollection(o)}},jn={coordinate:function(h){var o=[h.x,h.y];return h.z&&o.push(h.z),h.m&&o.push(h.m),o},Point:function(h){return{type:"Point",coordinates:jn.coordinate.call(this,h.getCoordinate())}},MultiPoint:function(h){for(var o=[],a=0;a<h._geometries.length;++a){var c=h._geometries[a],g=jn.Point.call(this,c);o.push(g.coordinates)}return{type:"MultiPoint",coordinates:o}},LineString:function(h){for(var o=[],a=h.getCoordinates(),c=0;c<a.length;++c){var g=a[c];o.push(jn.coordinate.call(this,g))}return{type:"LineString",coordinates:o}},MultiLineString:function(h){for(var o=[],a=0;a<h._geometries.length;++a){var c=h._geometries[a],g=jn.LineString.call(this,c);o.push(g.coordinates)}return{type:"MultiLineString",coordinates:o}},Polygon:function(h){var o=[],a=jn.LineString.call(this,h._shell);o.push(a.coordinates);for(var c=0;c<h._holes.length;++c){var g=h._holes[c],m=jn.LineString.call(this,g);o.push(m.coordinates)}return{type:"Polygon",coordinates:o}},MultiPolygon:function(h){for(var o=[],a=0;a<h._geometries.length;++a){var c=h._geometries[a],g=jn.Polygon.call(this,c);o.push(g.coordinates)}return{type:"MultiPolygon",coordinates:o}},GeometryCollection:function(h){for(var o=[],a=0;a<h._geometries.length;++a){var c=h._geometries[a],g=c.getGeometryType();o.push(jn[g].call(this,c))}return{type:"GeometryCollection",geometries:o}}};return{BufferOp:us,GeoJSONReader:function(){return u(function h(o){r(this,h),this.parser=new Fm(o||new rs)},[{key:"read",value:function(h){return this.parser.read(h)}}])}(),GeoJSONWriter:function(){return u(function h(){r(this,h),this.parser=new Fm(this.geometryFactory)},[{key:"write",value:function(h){return this.parser.write(h)}}])}()}})})(sA);var Iz=sA.exports;const Pz=vp(Iz);function W1(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function oA(t,e){var n,i,r,s,l,u,f,d,p,_,y=0,E=t.type==="FeatureCollection",T=t.type==="Feature",k=E?t.features.length:1;for(n=0;n<k;n++){for(u=E?t.features[n].geometry:T?t.geometry:t,d=E?t.features[n].properties:T?t.properties:{},p=E?t.features[n].bbox:T?t.bbox:void 0,_=E?t.features[n].id:T?t.id:void 0,f=u?u.type==="GeometryCollection":!1,l=f?u.geometries.length:1,r=0;r<l;r++){if(s=f?u.geometries[r]:u,s===null){if(e(null,y,d,p,_)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(s,y,d,p,_)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<s.geometries.length;i++)if(e(s.geometries[i],y,d,p,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}y++}}function hr(){return new Bc}function Bc(){this.reset()}Bc.prototype={constructor:Bc,reset:function(){this.s=this.t=0},add:function(t){H1(lu,t,this.t),H1(this,lu.s,this.s),this.s?this.t+=lu.t:this.s=lu.t},valueOf:function(){return this.s}};var lu=new Bc;function H1(t,e,n){var i=t.s=e+n,r=i-e,s=i-r;t.t=e-s+(n-r)}var We=1e-6,Ne=Math.PI,ei=Ne/2,j1=Ne/4,oi=Ne*2,Oi=180/Ne,mn=Ne/180,Et=Math.abs,Nz=Math.atan,ho=Math.atan2,et=Math.cos,tt=Math.sin,vo=Math.sqrt;function aA(t){return t>1?0:t<-1?Ne:Math.acos(t)}function qr(t){return t>1?ei:t<-1?-ei:Math.asin(t)}function na(){}function Uc(t,e){t&&X1.hasOwnProperty(t.type)&&X1[t.type](t,e)}var $1={Feature:function(t,e){Uc(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)Uc(n[i].geometry,e)}},X1={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){up(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)up(n[i],e,0)},Polygon:function(t,e){Y1(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)Y1(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)Uc(n[i],e)}};function up(t,e,n){var i=-1,r=t.length-n,s;for(e.lineStart();++i<r;)s=t[i],e.point(s[0],s[1],s[2]);e.lineEnd()}function Y1(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)up(t[n],e,1);e.polygonEnd()}function Mz(t,e){t&&$1.hasOwnProperty(t.type)?$1[t.type](t,e):Uc(t,e)}hr();hr();function cp(t){return[ho(t[1],t[0]),qr(t[2])]}function fo(t){var e=t[0],n=t[1],i=et(n);return[i*et(e),i*tt(e),tt(n)]}function uu(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function zc(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function pd(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function cu(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function hp(t){var e=vo(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}hr();function lA(t,e){function n(i,r){return i=t(i,r),e(i[0],i[1])}return t.invert&&e.invert&&(n.invert=function(i,r){return i=e.invert(i,r),i&&t.invert(i[0],i[1])}),n}function fp(t,e){return[t>Ne?t-oi:t<-Ne?t+oi:t,e]}fp.invert=fp;function Oz(t,e,n){return(t%=oi)?e||n?lA(K1(t),G1(e,n)):K1(t):e||n?G1(e,n):fp}function q1(t){return function(e,n){return e+=t,[e>Ne?e-oi:e<-Ne?e+oi:e,n]}}function K1(t){var e=q1(t);return e.invert=q1(-t),e}function G1(t,e){var n=et(t),i=tt(t),r=et(e),s=tt(e);function l(u,f){var d=et(f),p=et(u)*d,_=tt(u)*d,y=tt(f),E=y*n+p*i;return[ho(_*r-E*s,p*n-y*i),qr(E*r+_*s)]}return l.invert=function(u,f){var d=et(f),p=et(u)*d,_=tt(u)*d,y=tt(f),E=y*r-_*s;return[ho(_*r+y*s,p*n+E*i),qr(E*n-p*i)]},l}function Lz(t,e,n,i,r,s){if(n){var l=et(e),u=tt(e),f=i*n;r==null?(r=e+i*oi,s=e-f/2):(r=Z1(l,r),s=Z1(l,s),(i>0?r<s:r>s)&&(r+=i*oi));for(var d,p=r;i>0?p>s:p<s;p-=f)d=cp([l,-u*et(p),-u*tt(p)]),t.point(d[0],d[1])}}function Z1(t,e){e=fo(e),e[0]-=t,hp(e);var n=aA(-e[1]);return((-e[2]<0?-n:n)+oi-We)%oi}function uA(){var t=[],e;return{point:function(n,i){e.push([n,i])},lineStart:function(){t.push(e=[])},lineEnd:na,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Dz(t,e,n,i,r,s){var l=t[0],u=t[1],f=e[0],d=e[1],p=0,_=1,y=f-l,E=d-u,T;if(T=n-l,!(!y&&T>0)){if(T/=y,y<0){if(T<p)return;T<_&&(_=T)}else if(y>0){if(T>_)return;T>p&&(p=T)}if(T=r-l,!(!y&&T<0)){if(T/=y,y<0){if(T>_)return;T>p&&(p=T)}else if(y>0){if(T<p)return;T<_&&(_=T)}if(T=i-u,!(!E&&T>0)){if(T/=E,E<0){if(T<p)return;T<_&&(_=T)}else if(E>0){if(T>_)return;T>p&&(p=T)}if(T=s-u,!(!E&&T<0)){if(T/=E,E<0){if(T>_)return;T>p&&(p=T)}else if(E>0){if(T<p)return;T<_&&(_=T)}return p>0&&(t[0]=l+p*y,t[1]=u+p*E),_<1&&(e[0]=l+_*y,e[1]=u+_*E),!0}}}}}function Du(t,e){return Et(t[0]-e[0])<We&&Et(t[1]-e[1])<We}function hu(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function cA(t,e,n,i,r){var s=[],l=[],u,f;if(t.forEach(function(T){if(!((k=T.length-1)<=0)){var k,M=T[0],b=T[k],w;if(Du(M,b)){for(r.lineStart(),u=0;u<k;++u)r.point((M=T[u])[0],M[1]);r.lineEnd();return}s.push(w=new hu(M,T,null,!0)),l.push(w.o=new hu(M,null,w,!1)),s.push(w=new hu(b,T,null,!1)),l.push(w.o=new hu(b,null,w,!0))}}),!!s.length){for(l.sort(e),Q1(s),Q1(l),u=0,f=l.length;u<f;++u)l[u].e=n=!n;for(var d=s[0],p,_;;){for(var y=d,E=!0;y.v;)if((y=y.n)===d)return;p=y.z,r.lineStart();do{if(y.v=y.o.v=!0,y.e){if(E)for(u=0,f=p.length;u<f;++u)r.point((_=p[u])[0],_[1]);else i(y.x,y.n.x,1,r);y=y.n}else{if(E)for(p=y.p.z,u=p.length-1;u>=0;--u)r.point((_=p[u])[0],_[1]);else i(y.x,y.p.x,-1,r);y=y.p}y=y.o,p=y.z,E=!E}while(!y.v);r.lineEnd()}}}function Q1(t){if(e=t.length){for(var e,n=0,i=t[0],r;++n<e;)i.n=r=t[n],r.p=i,i=r;i.n=r=t[0],r.p=i}}function hA(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Fz(t){return t.length===1&&(t=Bz(t)),{left:function(e,n,i,r){for(i==null&&(i=0),r==null&&(r=e.length);i<r;){var s=i+r>>>1;t(e[s],n)<0?i=s+1:r=s}return i},right:function(e,n,i,r){for(i==null&&(i=0),r==null&&(r=e.length);i<r;){var s=i+r>>>1;t(e[s],n)>0?r=s:i=s+1}return i}}}function Bz(t){return function(e,n){return hA(t(e),n)}}Fz(hA);function fA(t){for(var e=t.length,n,i=-1,r=0,s,l;++i<e;)r+=t[i].length;for(s=new Array(r);--e>=0;)for(l=t[e],n=l.length;--n>=0;)s[--r]=l[n];return s}var ia=1e9,fu=-ia;function Uz(t,e,n,i){function r(d,p){return t<=d&&d<=n&&e<=p&&p<=i}function s(d,p,_,y){var E=0,T=0;if(d==null||(E=l(d,_))!==(T=l(p,_))||f(d,p)<0^_>0)do y.point(E===0||E===3?t:n,E>1?i:e);while((E=(E+_+4)%4)!==T);else y.point(p[0],p[1])}function l(d,p){return Et(d[0]-t)<We?p>0?0:3:Et(d[0]-n)<We?p>0?2:1:Et(d[1]-e)<We?p>0?1:0:p>0?3:2}function u(d,p){return f(d.x,p.x)}function f(d,p){var _=l(d,1),y=l(p,1);return _!==y?_-y:_===0?p[1]-d[1]:_===1?d[0]-p[0]:_===2?d[1]-p[1]:p[0]-d[0]}return function(d){var p=d,_=uA(),y,E,T,k,M,b,w,A,N,D,W,K={point:x,lineStart:F,lineEnd:z,polygonStart:P,polygonEnd:U};function x(V,$){r(V,$)&&p.point(V,$)}function R(){for(var V=0,$=0,G=E.length;$<G;++$)for(var H=E[$],Z=1,te=H.length,ie=H[0],ce,Ee,he=ie[0],ye=ie[1];Z<te;++Z)ce=he,Ee=ye,ie=H[Z],he=ie[0],ye=ie[1],Ee<=i?ye>i&&(he-ce)*(i-Ee)>(ye-Ee)*(t-ce)&&++V:ye<=i&&(he-ce)*(i-Ee)<(ye-Ee)*(t-ce)&&--V;return V}function P(){p=_,y=[],E=[],W=!0}function U(){var V=R(),$=W&&V,G=(y=fA(y)).length;($||G)&&(d.polygonStart(),$&&(d.lineStart(),s(null,null,1,d),d.lineEnd()),G&&cA(y,u,V,s,d),d.polygonEnd()),p=d,y=E=T=null}function F(){K.point=B,E&&E.push(T=[]),D=!0,N=!1,w=A=NaN}function z(){y&&(B(k,M),b&&N&&_.rejoin(),y.push(_.result())),K.point=x,N&&p.lineEnd()}function B(V,$){var G=r(V,$);if(E&&T.push([V,$]),D)k=V,M=$,b=G,D=!1,G&&(p.lineStart(),p.point(V,$));else if(G&&N)p.point(V,$);else{var H=[w=Math.max(fu,Math.min(ia,w)),A=Math.max(fu,Math.min(ia,A))],Z=[V=Math.max(fu,Math.min(ia,V)),$=Math.max(fu,Math.min(ia,$))];Dz(H,Z,t,e,n,i)?(N||(p.lineStart(),p.point(H[0],H[1])),p.point(Z[0],Z[1]),G||p.lineEnd(),W=!1):G&&(p.lineStart(),p.point(V,$),W=!1)}w=V,A=$,N=G}return K}}var _d=hr();function zz(t,e){var n=e[0],i=e[1],r=[tt(n),-et(n),0],s=0,l=0;_d.reset();for(var u=0,f=t.length;u<f;++u)if(p=(d=t[u]).length)for(var d,p,_=d[p-1],y=_[0],E=_[1]/2+j1,T=tt(E),k=et(E),M=0;M<p;++M,y=w,T=N,k=D,_=b){var b=d[M],w=b[0],A=b[1]/2+j1,N=tt(A),D=et(A),W=w-y,K=W>=0?1:-1,x=K*W,R=x>Ne,P=T*N;if(_d.add(ho(P*K*tt(x),k*D+P*et(x))),s+=R?W+K*oi:W,R^y>=n^w>=n){var U=zc(fo(_),fo(b));hp(U);var F=zc(r,U);hp(F);var z=(R^W>=0?-1:1)*qr(F[2]);(i>z||i===z&&(U[0]||U[1]))&&(l+=R^W>=0?1:-1)}}return(s<-We||s<We&&_d<-We)^l&1}hr();function J1(t){return t}hr();hr();var go=1/0,Vc=go,Ga=-go,Wc=Ga,eE={point:Vz,lineStart:na,lineEnd:na,polygonStart:na,polygonEnd:na,result:function(){var t=[[go,Vc],[Ga,Wc]];return Ga=Wc=-(Vc=go=1/0),t}};function Vz(t,e){t<go&&(go=t),t>Ga&&(Ga=t),e<Vc&&(Vc=e),e>Wc&&(Wc=e)}hr();function dA(t,e,n,i){return function(r,s){var l=e(s),u=r.invert(i[0],i[1]),f=uA(),d=e(f),p=!1,_,y,E,T={point:k,lineStart:b,lineEnd:w,polygonStart:function(){T.point=A,T.lineStart=N,T.lineEnd=D,y=[],_=[]},polygonEnd:function(){T.point=k,T.lineStart=b,T.lineEnd=w,y=fA(y);var W=zz(_,u);y.length?(p||(s.polygonStart(),p=!0),cA(y,Hz,W,n,s)):W&&(p||(s.polygonStart(),p=!0),s.lineStart(),n(null,null,1,s),s.lineEnd()),p&&(s.polygonEnd(),p=!1),y=_=null},sphere:function(){s.polygonStart(),s.lineStart(),n(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function k(W,K){var x=r(W,K);t(W=x[0],K=x[1])&&s.point(W,K)}function M(W,K){var x=r(W,K);l.point(x[0],x[1])}function b(){T.point=M,l.lineStart()}function w(){T.point=k,l.lineEnd()}function A(W,K){E.push([W,K]);var x=r(W,K);d.point(x[0],x[1])}function N(){d.lineStart(),E=[]}function D(){A(E[0][0],E[0][1]),d.lineEnd();var W=d.clean(),K=f.result(),x,R=K.length,P,U,F;if(E.pop(),_.push(E),E=null,!!R){if(W&1){if(U=K[0],(P=U.length-1)>0){for(p||(s.polygonStart(),p=!0),s.lineStart(),x=0;x<P;++x)s.point((F=U[x])[0],F[1]);s.lineEnd()}return}R>1&&W&2&&K.push(K.pop().concat(K.shift())),y.push(K.filter(Wz))}}return T}}function Wz(t){return t.length>1}function Hz(t,e){return((t=t.x)[0]<0?t[1]-ei-We:ei-t[1])-((e=e.x)[0]<0?e[1]-ei-We:ei-e[1])}const tE=dA(function(){return!0},jz,Xz,[-Ne,-ei]);function jz(t){var e=NaN,n=NaN,i=NaN,r;return{lineStart:function(){t.lineStart(),r=1},point:function(s,l){var u=s>0?Ne:-Ne,f=Et(s-e);Et(f-Ne)<We?(t.point(e,n=(n+l)/2>0?ei:-ei),t.point(i,n),t.lineEnd(),t.lineStart(),t.point(u,n),t.point(s,n),r=0):i!==u&&f>=Ne&&(Et(e-i)<We&&(e-=i*We),Et(s-u)<We&&(s-=u*We),n=$z(e,n,s,l),t.point(i,n),t.lineEnd(),t.lineStart(),t.point(u,n),r=0),t.point(e=s,n=l),i=u},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-r}}}function $z(t,e,n,i){var r,s,l=tt(t-n);return Et(l)>We?Nz((tt(e)*(s=et(i))*tt(n)-tt(i)*(r=et(e))*tt(t))/(r*s*l)):(e+i)/2}function Xz(t,e,n,i){var r;if(t==null)r=n*ei,i.point(-Ne,r),i.point(0,r),i.point(Ne,r),i.point(Ne,0),i.point(Ne,-r),i.point(0,-r),i.point(-Ne,-r),i.point(-Ne,0),i.point(-Ne,r);else if(Et(t[0]-e[0])>We){var s=t[0]<e[0]?Ne:-Ne;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(e[0],e[1])}function Yz(t,e){var n=et(t),i=n>0,r=Et(n)>We;function s(p,_,y,E){Lz(E,t,e,y,p,_)}function l(p,_){return et(p)*et(_)>n}function u(p){var _,y,E,T,k;return{lineStart:function(){T=E=!1,k=1},point:function(M,b){var w=[M,b],A,N=l(M,b),D=i?N?0:d(M,b):N?d(M+(M<0?Ne:-Ne),b):0;if(!_&&(T=E=N)&&p.lineStart(),N!==E&&(A=f(_,w),(!A||Du(_,A)||Du(w,A))&&(w[0]+=We,w[1]+=We,N=l(w[0],w[1]))),N!==E)k=0,N?(p.lineStart(),A=f(w,_),p.point(A[0],A[1])):(A=f(_,w),p.point(A[0],A[1]),p.lineEnd()),_=A;else if(r&&_&&i^N){var W;!(D&y)&&(W=f(w,_,!0))&&(k=0,i?(p.lineStart(),p.point(W[0][0],W[0][1]),p.point(W[1][0],W[1][1]),p.lineEnd()):(p.point(W[1][0],W[1][1]),p.lineEnd(),p.lineStart(),p.point(W[0][0],W[0][1])))}N&&(!_||!Du(_,w))&&p.point(w[0],w[1]),_=w,E=N,y=D},lineEnd:function(){E&&p.lineEnd(),_=null},clean:function(){return k|(T&&E)<<1}}}function f(p,_,y){var E=fo(p),T=fo(_),k=[1,0,0],M=zc(E,T),b=uu(M,M),w=M[0],A=b-w*w;if(!A)return!y&&p;var N=n*b/A,D=-n*w/A,W=zc(k,M),K=cu(k,N),x=cu(M,D);pd(K,x);var R=W,P=uu(K,R),U=uu(R,R),F=P*P-U*(uu(K,K)-1);if(!(F<0)){var z=vo(F),B=cu(R,(-P-z)/U);if(pd(B,K),B=cp(B),!y)return B;var V=p[0],$=_[0],G=p[1],H=_[1],Z;$<V&&(Z=V,V=$,$=Z);var te=$-V,ie=Et(te-Ne)<We,ce=ie||te<We;if(!ie&&H<G&&(Z=G,G=H,H=Z),ce?ie?G+H>0^B[1]<(Et(B[0]-V)<We?G:H):G<=B[1]&&B[1]<=H:te>Ne^(V<=B[0]&&B[0]<=$)){var Ee=cu(R,(-P+z)/U);return pd(Ee,K),[B,cp(Ee)]}}}function d(p,_){var y=i?t:Ne-t,E=0;return p<-y?E|=1:p>y&&(E|=2),_<-y?E|=4:_>y&&(E|=8),E}return dA(l,u,s,i?[0,-t]:[-Ne,t-Ne])}function gA(t){return function(e){var n=new dp;for(var i in t)n[i]=t[i];return n.stream=e,n}}function dp(){}dp.prototype={constructor:dp,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function pA(t,e,n){var i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],s=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),s!=null&&t.clipExtent(null),Mz(n,t.stream(eE));var l=eE.result(),u=Math.min(i/(l[1][0]-l[0][0]),r/(l[1][1]-l[0][1])),f=+e[0][0]+(i-u*(l[1][0]+l[0][0]))/2,d=+e[0][1]+(r-u*(l[1][1]+l[0][1]))/2;return s!=null&&t.clipExtent(s),t.scale(u*150).translate([f,d])}function qz(t,e,n){return pA(t,[[0,0],e],n)}var nE=16,Kz=et(30*mn);function iE(t,e){return+e?Zz(t,e):Gz(t)}function Gz(t){return gA({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function Zz(t,e){function n(i,r,s,l,u,f,d,p,_,y,E,T,k,M){var b=d-i,w=p-r,A=b*b+w*w;if(A>4*e&&k--){var N=l+y,D=u+E,W=f+T,K=vo(N*N+D*D+W*W),x=qr(W/=K),R=Et(Et(W)-1)<We||Et(s-_)<We?(s+_)/2:ho(D,N),P=t(R,x),U=P[0],F=P[1],z=U-i,B=F-r,V=w*z-b*B;(V*V/A>e||Et((b*z+w*B)/A-.5)>.3||l*y+u*E+f*T<Kz)&&(n(i,r,s,l,u,f,U,F,R,N/=K,D/=K,W,k,M),M.point(U,F),n(U,F,R,N,D,W,d,p,_,y,E,T,k,M))}}return function(i){var r,s,l,u,f,d,p,_,y,E,T,k,M={point:b,lineStart:w,lineEnd:N,polygonStart:function(){i.polygonStart(),M.lineStart=D},polygonEnd:function(){i.polygonEnd(),M.lineStart=w}};function b(x,R){x=t(x,R),i.point(x[0],x[1])}function w(){_=NaN,M.point=A,i.lineStart()}function A(x,R){var P=fo([x,R]),U=t(x,R);n(_,y,p,E,T,k,_=U[0],y=U[1],p=x,E=P[0],T=P[1],k=P[2],nE,i),i.point(_,y)}function N(){M.point=b,i.lineEnd()}function D(){w(),M.point=W,M.lineEnd=K}function W(x,R){A(r=x,R),s=_,l=y,u=E,f=T,d=k,M.point=A}function K(){n(_,y,p,E,T,k,s,l,r,u,f,d,nE,i),M.lineEnd=N,N()}return M}}var Qz=gA({point:function(t,e){this.stream.point(t*mn,e*mn)}});function Jz(t){return e8(function(){return t})()}function e8(t){var e,n=150,i=480,r=250,s,l,u=0,f=0,d=0,p=0,_=0,y,E,T=null,k=tE,M=null,b,w,A,N=J1,D=.5,W=iE(U,D),K,x;function R(B){return B=E(B[0]*mn,B[1]*mn),[B[0]*n+s,l-B[1]*n]}function P(B){return B=E.invert((B[0]-s)/n,(l-B[1])/n),B&&[B[0]*Oi,B[1]*Oi]}function U(B,V){return B=e(B,V),[B[0]*n+s,l-B[1]*n]}R.stream=function(B){return K&&x===B?K:K=Qz(k(y,W(N(x=B))))},R.clipAngle=function(B){return arguments.length?(k=+B?Yz(T=B*mn,6*mn):(T=null,tE),z()):T*Oi},R.clipExtent=function(B){return arguments.length?(N=B==null?(M=b=w=A=null,J1):Uz(M=+B[0][0],b=+B[0][1],w=+B[1][0],A=+B[1][1]),z()):M==null?null:[[M,b],[w,A]]},R.scale=function(B){return arguments.length?(n=+B,F()):n},R.translate=function(B){return arguments.length?(i=+B[0],r=+B[1],F()):[i,r]},R.center=function(B){return arguments.length?(u=B[0]%360*mn,f=B[1]%360*mn,F()):[u*Oi,f*Oi]},R.rotate=function(B){return arguments.length?(d=B[0]%360*mn,p=B[1]%360*mn,_=B.length>2?B[2]%360*mn:0,F()):[d*Oi,p*Oi,_*Oi]},R.precision=function(B){return arguments.length?(W=iE(U,D=B*B),z()):vo(D)},R.fitExtent=function(B,V){return pA(R,B,V)},R.fitSize=function(B,V){return qz(R,B,V)};function F(){E=lA(y=Oz(d,p,_),e);var B=e(u,f);return s=i-B[0]*n,l=r+B[1]*n,z()}function z(){return K=x=null,R}return function(){return e=t.apply(this,arguments),R.invert=e.invert&&P,F()}}function _A(t){return function(e,n){var i=et(e),r=et(n),s=t(i*r);return[s*r*tt(e),s*tt(n)]}}function mA(t){return function(e,n){var i=vo(e*e+n*n),r=t(i),s=tt(r),l=et(r);return[ho(e*s,i*l),qr(i&&n*s/i)]}}var t8=_A(function(t){return vo(2/(1+t))});t8.invert=mA(function(t){return 2*qr(t/2)});var yA=_A(function(t){return(t=aA(t))&&t/tt(t)});yA.invert=mA(function(t){return t});function n8(){return Jz(yA).scale(79.4188).clipAngle(180-.001)}function rE(t,e){return[t,e]}rE.invert=rE;var{BufferOp:i8,GeoJSONReader:r8,GeoJSONWriter:s8}=Pz;function o8(t,e,n){n=n||{};var i=n.units||"kilometers",r=n.steps||8;if(!t)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof r!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(r<=0)throw new Error("steps must be greater than 0");var s=[];switch(t.type){case"GeometryCollection":return oA(t,function(l){var u=Fu(l,e,i,r);u&&s.push(u)}),Ka(s);case"FeatureCollection":return W1(t,function(l){var u=Fu(l,e,i,r);u&&W1(u,function(f){f&&s.push(f)})}),Ka(s)}return Fu(t,e,i,r)}function Fu(t,e,n,i){var r=t.properties||{},s=t.type==="Feature"?t.geometry:t;if(s.type==="GeometryCollection"){var l=[];return oA(t,function(k){var M=Fu(k,e,n,i);M&&l.push(M)}),Ka(l)}var u=a8(s),f={type:s.type,coordinates:EA(s.coordinates,u)},d=new r8,p=d.read(f),_=pz(_z(e,n),"meters"),y=i8.bufferOp(p,_,i),E=new s8;if(y=E.write(y),!vA(y.coordinates)){var T={type:y.type,coordinates:wA(y.coordinates,u)};return Oh(T,r)}}function vA(t){return Array.isArray(t[0])?vA(t[0]):isNaN(t[0])}function EA(t,e){return typeof t[0]!="object"?e(t):t.map(function(n){return EA(n,e)})}function wA(t,e){return typeof t[0]!="object"?e.invert(t):t.map(function(n){return wA(n,e)})}function a8(t){var e=kz(t).geometry.coordinates,n=[-e[0],-e[1]];return n8().rotate(n).scale(Ht)}var l8=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,md=Math.ceil,pn=Math.floor,jt="[BigNumber Error] ",sE=jt+"Number primitive has more than 15 significant digits: ",kn=1e14,we=14,yd=9007199254740991,vd=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Li=1e7,yt=1e9;function TA(t){var e,n,i,r=w.prototype={constructor:w,toString:null,valueOf:null},s=new w(1),l=20,u=4,f=-7,d=21,p=-1e7,_=1e7,y=!1,E=1,T=0,k={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},M="0123456789abcdefghijklmnopqrstuvwxyz",b=!0;function w(x,R){var P,U,F,z,B,V,$,G,H=this;if(!(H instanceof w))return new w(x,R);if(R==null){if(x&&x._isBigNumber===!0){H.s=x.s,!x.c||x.e>_?H.c=H.e=null:x.e<p?H.c=[H.e=0]:(H.e=x.e,H.c=x.c.slice());return}if((V=typeof x=="number")&&x*0==0){if(H.s=1/x<0?(x=-x,-1):1,x===~~x){for(z=0,B=x;B>=10;B/=10,z++);z>_?H.c=H.e=null:(H.e=z,H.c=[x]);return}G=String(x)}else{if(!l8.test(G=String(x)))return i(H,G,V);H.s=G.charCodeAt(0)==45?(G=G.slice(1),-1):1}(z=G.indexOf("."))>-1&&(G=G.replace(".","")),(B=G.search(/e/i))>0?(z<0&&(z=B),z+=+G.slice(B+1),G=G.substring(0,B)):z<0&&(z=G.length)}else{if(Qe(R,2,M.length,"Base"),R==10&&b)return H=new w(x),W(H,l+H.e+1,u);if(G=String(x),V=typeof x=="number"){if(x*0!=0)return i(H,G,V,R);if(H.s=1/x<0?(G=G.slice(1),-1):1,w.DEBUG&&G.replace(/^0\.0*|\./,"").length>15)throw Error(sE+x)}else H.s=G.charCodeAt(0)===45?(G=G.slice(1),-1):1;for(P=M.slice(0,R),z=B=0,$=G.length;B<$;B++)if(P.indexOf(U=G.charAt(B))<0){if(U=="."){if(B>z){z=$;continue}}else if(!F&&(G==G.toUpperCase()&&(G=G.toLowerCase())||G==G.toLowerCase()&&(G=G.toUpperCase()))){F=!0,B=-1,z=0;continue}return i(H,String(x),V,R)}V=!1,G=n(G,R,10,H.s),(z=G.indexOf("."))>-1?G=G.replace(".",""):z=G.length}for(B=0;G.charCodeAt(B)===48;B++);for($=G.length;G.charCodeAt(--$)===48;);if(G=G.slice(B,++$)){if($-=B,V&&w.DEBUG&&$>15&&(x>yd||x!==pn(x)))throw Error(sE+H.s*x);if((z=z-B-1)>_)H.c=H.e=null;else if(z<p)H.c=[H.e=0];else{if(H.e=z,H.c=[],B=(z+1)%we,z<0&&(B+=we),B<$){for(B&&H.c.push(+G.slice(0,B)),$-=we;B<$;)H.c.push(+G.slice(B,B+=we));B=we-(G=G.slice(B)).length}else B-=$;for(;B--;G+="0");H.c.push(+G)}}else H.c=[H.e=0]}w.clone=TA,w.ROUND_UP=0,w.ROUND_DOWN=1,w.ROUND_CEIL=2,w.ROUND_FLOOR=3,w.ROUND_HALF_UP=4,w.ROUND_HALF_DOWN=5,w.ROUND_HALF_EVEN=6,w.ROUND_HALF_CEIL=7,w.ROUND_HALF_FLOOR=8,w.EUCLID=9,w.config=w.set=function(x){var R,P;if(x!=null)if(typeof x=="object"){if(x.hasOwnProperty(R="DECIMAL_PLACES")&&(P=x[R],Qe(P,0,yt,R),l=P),x.hasOwnProperty(R="ROUNDING_MODE")&&(P=x[R],Qe(P,0,8,R),u=P),x.hasOwnProperty(R="EXPONENTIAL_AT")&&(P=x[R],P&&P.pop?(Qe(P[0],-yt,0,R),Qe(P[1],0,yt,R),f=P[0],d=P[1]):(Qe(P,-yt,yt,R),f=-(d=P<0?-P:P))),x.hasOwnProperty(R="RANGE"))if(P=x[R],P&&P.pop)Qe(P[0],-yt,-1,R),Qe(P[1],1,yt,R),p=P[0],_=P[1];else if(Qe(P,-yt,yt,R),P)p=-(_=P<0?-P:P);else throw Error(jt+R+" cannot be zero: "+P);if(x.hasOwnProperty(R="CRYPTO"))if(P=x[R],P===!!P)if(P)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))y=P;else throw y=!P,Error(jt+"crypto unavailable");else y=P;else throw Error(jt+R+" not true or false: "+P);if(x.hasOwnProperty(R="MODULO_MODE")&&(P=x[R],Qe(P,0,9,R),E=P),x.hasOwnProperty(R="POW_PRECISION")&&(P=x[R],Qe(P,0,yt,R),T=P),x.hasOwnProperty(R="FORMAT"))if(P=x[R],typeof P=="object")k=P;else throw Error(jt+R+" not an object: "+P);if(x.hasOwnProperty(R="ALPHABET"))if(P=x[R],typeof P=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(P))b=P.slice(0,10)=="0123456789",M=P;else throw Error(jt+R+" invalid: "+P)}else throw Error(jt+"Object expected: "+x);return{DECIMAL_PLACES:l,ROUNDING_MODE:u,EXPONENTIAL_AT:[f,d],RANGE:[p,_],CRYPTO:y,MODULO_MODE:E,POW_PRECISION:T,FORMAT:k,ALPHABET:M}},w.isBigNumber=function(x){if(!x||x._isBigNumber!==!0)return!1;if(!w.DEBUG)return!0;var R,P,U=x.c,F=x.e,z=x.s;e:if({}.toString.call(U)=="[object Array]"){if((z===1||z===-1)&&F>=-yt&&F<=yt&&F===pn(F)){if(U[0]===0){if(F===0&&U.length===1)return!0;break e}if(R=(F+1)%we,R<1&&(R+=we),String(U[0]).length==R){for(R=0;R<U.length;R++)if(P=U[R],P<0||P>=kn||P!==pn(P))break e;if(P!==0)return!0}}}else if(U===null&&F===null&&(z===null||z===1||z===-1))return!0;throw Error(jt+"Invalid BigNumber: "+x)},w.maximum=w.max=function(){return N(arguments,-1)},w.minimum=w.min=function(){return N(arguments,1)},w.random=function(){var x=9007199254740992,R=Math.random()*x&2097151?function(){return pn(Math.random()*x)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(P){var U,F,z,B,V,$=0,G=[],H=new w(s);if(P==null?P=l:Qe(P,0,yt),B=md(P/we),y)if(crypto.getRandomValues){for(U=crypto.getRandomValues(new Uint32Array(B*=2));$<B;)V=U[$]*131072+(U[$+1]>>>11),V>=9e15?(F=crypto.getRandomValues(new Uint32Array(2)),U[$]=F[0],U[$+1]=F[1]):(G.push(V%1e14),$+=2);$=B/2}else if(crypto.randomBytes){for(U=crypto.randomBytes(B*=7);$<B;)V=(U[$]&31)*281474976710656+U[$+1]*1099511627776+U[$+2]*4294967296+U[$+3]*16777216+(U[$+4]<<16)+(U[$+5]<<8)+U[$+6],V>=9e15?crypto.randomBytes(7).copy(U,$):(G.push(V%1e14),$+=7);$=B/7}else throw y=!1,Error(jt+"crypto unavailable");if(!y)for(;$<B;)V=R(),V<9e15&&(G[$++]=V%1e14);for(B=G[--$],P%=we,B&&P&&(V=vd[we-P],G[$]=pn(B/V)*V);G[$]===0;G.pop(),$--);if($<0)G=[z=0];else{for(z=-1;G[0]===0;G.splice(0,1),z-=we);for($=1,V=G[0];V>=10;V/=10,$++);$<we&&(z-=we-$)}return H.e=z,H.c=G,H}}(),w.sum=function(){for(var x=1,R=arguments,P=new w(R[0]);x<R.length;)P=P.plus(R[x++]);return P},n=function(){var x="0123456789";function R(P,U,F,z){for(var B,V=[0],$,G=0,H=P.length;G<H;){for($=V.length;$--;V[$]*=U);for(V[0]+=z.indexOf(P.charAt(G++)),B=0;B<V.length;B++)V[B]>F-1&&(V[B+1]==null&&(V[B+1]=0),V[B+1]+=V[B]/F|0,V[B]%=F)}return V.reverse()}return function(P,U,F,z,B){var V,$,G,H,Z,te,ie,ce,Ee=P.indexOf("."),he=l,ye=u;for(Ee>=0&&(H=T,T=0,P=P.replace(".",""),ce=new w(U),te=ce.pow(P.length-Ee),T=H,ce.c=R(hi(gn(te.c),te.e,"0"),10,F,x),ce.e=ce.c.length),ie=R(P,U,F,B?(V=M,x):(V=x,M)),G=H=ie.length;ie[--H]==0;ie.pop());if(!ie[0])return V.charAt(0);if(Ee<0?--G:(te.c=ie,te.e=G,te.s=z,te=e(te,ce,he,ye,F),ie=te.c,Z=te.r,G=te.e),$=G+he+1,Ee=ie[$],H=F/2,Z=Z||$<0||ie[$+1]!=null,Z=ye<4?(Ee!=null||Z)&&(ye==0||ye==(te.s<0?3:2)):Ee>H||Ee==H&&(ye==4||Z||ye==6&&ie[$-1]&1||ye==(te.s<0?8:7)),$<1||!ie[0])P=Z?hi(V.charAt(1),-he,V.charAt(0)):V.charAt(0);else{if(ie.length=$,Z)for(--F;++ie[--$]>F;)ie[$]=0,$||(++G,ie=[1].concat(ie));for(H=ie.length;!ie[--H];);for(Ee=0,P="";Ee<=H;P+=V.charAt(ie[Ee++]));P=hi(P,G,V.charAt(0))}return P}}(),e=function(){function x(U,F,z){var B,V,$,G,H=0,Z=U.length,te=F%Li,ie=F/Li|0;for(U=U.slice();Z--;)$=U[Z]%Li,G=U[Z]/Li|0,B=ie*$+G*te,V=te*$+B%Li*Li+H,H=(V/z|0)+(B/Li|0)+ie*G,U[Z]=V%z;return H&&(U=[H].concat(U)),U}function R(U,F,z,B){var V,$;if(z!=B)$=z>B?1:-1;else for(V=$=0;V<z;V++)if(U[V]!=F[V]){$=U[V]>F[V]?1:-1;break}return $}function P(U,F,z,B){for(var V=0;z--;)U[z]-=V,V=U[z]<F[z]?1:0,U[z]=V*B+U[z]-F[z];for(;!U[0]&&U.length>1;U.splice(0,1));}return function(U,F,z,B,V){var $,G,H,Z,te,ie,ce,Ee,he,ye,xe,Xe,J,Eo,De,fe,j,Ze=U.s==F.s?1:-1,ut=U.c,Oe=F.c;if(!ut||!ut[0]||!Oe||!Oe[0])return new w(!U.s||!F.s||(ut?Oe&&ut[0]==Oe[0]:!Oe)?NaN:ut&&ut[0]==0||!Oe?Ze*0:Ze/0);for(Ee=new w(Ze),he=Ee.c=[],G=U.e-F.e,Ze=z+G+1,V||(V=kn,G=_n(U.e/we)-_n(F.e/we),Ze=Ze/we|0),H=0;Oe[H]==(ut[H]||0);H++);if(Oe[H]>(ut[H]||0)&&G--,Ze<0)he.push(1),Z=!0;else{for(Eo=ut.length,fe=Oe.length,H=0,Ze+=2,te=pn(V/(Oe[0]+1)),te>1&&(Oe=x(Oe,te,V),ut=x(ut,te,V),fe=Oe.length,Eo=ut.length),J=fe,ye=ut.slice(0,fe),xe=ye.length;xe<fe;ye[xe++]=0);j=Oe.slice(),j=[0].concat(j),De=Oe[0],Oe[1]>=V/2&&De++;do{if(te=0,$=R(Oe,ye,fe,xe),$<0){if(Xe=ye[0],fe!=xe&&(Xe=Xe*V+(ye[1]||0)),te=pn(Xe/De),te>1)for(te>=V&&(te=V-1),ie=x(Oe,te,V),ce=ie.length,xe=ye.length;R(ie,ye,ce,xe)==1;)te--,P(ie,fe<ce?j:Oe,ce,V),ce=ie.length,$=1;else te==0&&($=te=1),ie=Oe.slice(),ce=ie.length;if(ce<xe&&(ie=[0].concat(ie)),P(ye,ie,xe,V),xe=ye.length,$==-1)for(;R(Oe,ye,fe,xe)<1;)te++,P(ye,fe<xe?j:Oe,xe,V),xe=ye.length}else $===0&&(te++,ye=[0]);he[H++]=te,ye[0]?ye[xe++]=ut[J]||0:(ye=[ut[J]],xe=1)}while((J++<Eo||ye[0]!=null)&&Ze--);Z=ye[0]!=null,he[0]||he.splice(0,1)}if(V==kn){for(H=1,Ze=he[0];Ze>=10;Ze/=10,H++);W(Ee,z+(Ee.e=H+G*we-1)+1,B,Z)}else Ee.e=G,Ee.r=+Z;return Ee}}();function A(x,R,P,U){var F,z,B,V,$;if(P==null?P=u:Qe(P,0,8),!x.c)return x.toString();if(F=x.c[0],B=x.e,R==null)$=gn(x.c),$=U==1||U==2&&(B<=f||B>=d)?gu($,B):hi($,B,"0");else if(x=W(new w(x),R,P),z=x.e,$=gn(x.c),V=$.length,U==1||U==2&&(R<=z||z<=f)){for(;V<R;$+="0",V++);$=gu($,z)}else if(R-=B,$=hi($,z,"0"),z+1>V){if(--R>0)for($+=".";R--;$+="0");}else if(R+=z-V,R>0)for(z+1==V&&($+=".");R--;$+="0");return x.s<0&&F?"-"+$:$}function N(x,R){for(var P,U,F=1,z=new w(x[0]);F<x.length;F++)U=new w(x[F]),(!U.s||(P=Sr(z,U))===R||P===0&&z.s===R)&&(z=U);return z}function D(x,R,P){for(var U=1,F=R.length;!R[--F];R.pop());for(F=R[0];F>=10;F/=10,U++);return(P=U+P*we-1)>_?x.c=x.e=null:P<p?x.c=[x.e=0]:(x.e=P,x.c=R),x}i=function(){var x=/^(-?)0([xbo])(?=\w[\w.]*$)/i,R=/^([^.]+)\.$/,P=/^\.([^.]+)$/,U=/^-?(Infinity|NaN)$/,F=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(z,B,V,$){var G,H=V?B:B.replace(F,"");if(U.test(H))z.s=isNaN(H)?null:H<0?-1:1;else{if(!V&&(H=H.replace(x,function(Z,te,ie){return G=(ie=ie.toLowerCase())=="x"?16:ie=="b"?2:8,!$||$==G?te:Z}),$&&(G=$,H=H.replace(R,"$1").replace(P,"0.$1")),B!=H))return new w(H,G);if(w.DEBUG)throw Error(jt+"Not a"+($?" base "+$:"")+" number: "+B);z.s=null}z.c=z.e=null}}();function W(x,R,P,U){var F,z,B,V,$,G,H,Z=x.c,te=vd;if(Z){e:{for(F=1,V=Z[0];V>=10;V/=10,F++);if(z=R-F,z<0)z+=we,B=R,$=Z[G=0],H=pn($/te[F-B-1]%10);else if(G=md((z+1)/we),G>=Z.length)if(U){for(;Z.length<=G;Z.push(0));$=H=0,F=1,z%=we,B=z-we+1}else break e;else{for($=V=Z[G],F=1;V>=10;V/=10,F++);z%=we,B=z-we+F,H=B<0?0:pn($/te[F-B-1]%10)}if(U=U||R<0||Z[G+1]!=null||(B<0?$:$%te[F-B-1]),U=P<4?(H||U)&&(P==0||P==(x.s<0?3:2)):H>5||H==5&&(P==4||U||P==6&&(z>0?B>0?$/te[F-B]:0:Z[G-1])%10&1||P==(x.s<0?8:7)),R<1||!Z[0])return Z.length=0,U?(R-=x.e+1,Z[0]=te[(we-R%we)%we],x.e=-R||0):Z[0]=x.e=0,x;if(z==0?(Z.length=G,V=1,G--):(Z.length=G+1,V=te[we-z],Z[G]=B>0?pn($/te[F-B]%te[B])*V:0),U)for(;;)if(G==0){for(z=1,B=Z[0];B>=10;B/=10,z++);for(B=Z[0]+=V,V=1;B>=10;B/=10,V++);z!=V&&(x.e++,Z[0]==kn&&(Z[0]=1));break}else{if(Z[G]+=V,Z[G]!=kn)break;Z[G--]=0,V=1}for(z=Z.length;Z[--z]===0;Z.pop());}x.e>_?x.c=x.e=null:x.e<p&&(x.c=[x.e=0])}return x}function K(x){var R,P=x.e;return P===null?x.toString():(R=gn(x.c),R=P<=f||P>=d?gu(R,P):hi(R,P,"0"),x.s<0?"-"+R:R)}return r.absoluteValue=r.abs=function(){var x=new w(this);return x.s<0&&(x.s=1),x},r.comparedTo=function(x,R){return Sr(this,new w(x,R))},r.decimalPlaces=r.dp=function(x,R){var P,U,F,z=this;if(x!=null)return Qe(x,0,yt),R==null?R=u:Qe(R,0,8),W(new w(z),x+z.e+1,R);if(!(P=z.c))return null;if(U=((F=P.length-1)-_n(this.e/we))*we,F=P[F])for(;F%10==0;F/=10,U--);return U<0&&(U=0),U},r.dividedBy=r.div=function(x,R){return e(this,new w(x,R),l,u)},r.dividedToIntegerBy=r.idiv=function(x,R){return e(this,new w(x,R),0,1)},r.exponentiatedBy=r.pow=function(x,R){var P,U,F,z,B,V,$,G,H,Z=this;if(x=new w(x),x.c&&!x.isInteger())throw Error(jt+"Exponent not an integer: "+K(x));if(R!=null&&(R=new w(R)),V=x.e>14,!Z.c||!Z.c[0]||Z.c[0]==1&&!Z.e&&Z.c.length==1||!x.c||!x.c[0])return H=new w(Math.pow(+K(Z),V?x.s*(2-du(x)):+K(x))),R?H.mod(R):H;if($=x.s<0,R){if(R.c?!R.c[0]:!R.s)return new w(NaN);U=!$&&Z.isInteger()&&R.isInteger(),U&&(Z=Z.mod(R))}else{if(x.e>9&&(Z.e>0||Z.e<-1||(Z.e==0?Z.c[0]>1||V&&Z.c[1]>=24e7:Z.c[0]<8e13||V&&Z.c[0]<=9999975e7)))return z=Z.s<0&&du(x)?-0:0,Z.e>-1&&(z=1/z),new w($?1/z:z);T&&(z=md(T/we+2))}for(V?(P=new w(.5),$&&(x.s=1),G=du(x)):(F=Math.abs(+K(x)),G=F%2),H=new w(s);;){if(G){if(H=H.times(Z),!H.c)break;z?H.c.length>z&&(H.c.length=z):U&&(H=H.mod(R))}if(F){if(F=pn(F/2),F===0)break;G=F%2}else if(x=x.times(P),W(x,x.e+1,1),x.e>14)G=du(x);else{if(F=+K(x),F===0)break;G=F%2}Z=Z.times(Z),z?Z.c&&Z.c.length>z&&(Z.c.length=z):U&&(Z=Z.mod(R))}return U?H:($&&(H=s.div(H)),R?H.mod(R):z?W(H,T,u,B):H)},r.integerValue=function(x){var R=new w(this);return x==null?x=u:Qe(x,0,8),W(R,R.e+1,x)},r.isEqualTo=r.eq=function(x,R){return Sr(this,new w(x,R))===0},r.isFinite=function(){return!!this.c},r.isGreaterThan=r.gt=function(x,R){return Sr(this,new w(x,R))>0},r.isGreaterThanOrEqualTo=r.gte=function(x,R){return(R=Sr(this,new w(x,R)))===1||R===0},r.isInteger=function(){return!!this.c&&_n(this.e/we)>this.c.length-2},r.isLessThan=r.lt=function(x,R){return Sr(this,new w(x,R))<0},r.isLessThanOrEqualTo=r.lte=function(x,R){return(R=Sr(this,new w(x,R)))===-1||R===0},r.isNaN=function(){return!this.s},r.isNegative=function(){return this.s<0},r.isPositive=function(){return this.s>0},r.isZero=function(){return!!this.c&&this.c[0]==0},r.minus=function(x,R){var P,U,F,z,B=this,V=B.s;if(x=new w(x,R),R=x.s,!V||!R)return new w(NaN);if(V!=R)return x.s=-R,B.plus(x);var $=B.e/we,G=x.e/we,H=B.c,Z=x.c;if(!$||!G){if(!H||!Z)return H?(x.s=-R,x):new w(Z?B:NaN);if(!H[0]||!Z[0])return Z[0]?(x.s=-R,x):new w(H[0]?B:u==3?-0:0)}if($=_n($),G=_n(G),H=H.slice(),V=$-G){for((z=V<0)?(V=-V,F=H):(G=$,F=Z),F.reverse(),R=V;R--;F.push(0));F.reverse()}else for(U=(z=(V=H.length)<(R=Z.length))?V:R,V=R=0;R<U;R++)if(H[R]!=Z[R]){z=H[R]<Z[R];break}if(z&&(F=H,H=Z,Z=F,x.s=-x.s),R=(U=Z.length)-(P=H.length),R>0)for(;R--;H[P++]=0);for(R=kn-1;U>V;){if(H[--U]<Z[U]){for(P=U;P&&!H[--P];H[P]=R);--H[P],H[U]+=kn}H[U]-=Z[U]}for(;H[0]==0;H.splice(0,1),--G);return H[0]?D(x,H,G):(x.s=u==3?-1:1,x.c=[x.e=0],x)},r.modulo=r.mod=function(x,R){var P,U,F=this;return x=new w(x,R),!F.c||!x.s||x.c&&!x.c[0]?new w(NaN):!x.c||F.c&&!F.c[0]?new w(F):(E==9?(U=x.s,x.s=1,P=e(F,x,0,3),x.s=U,P.s*=U):P=e(F,x,0,E),x=F.minus(P.times(x)),!x.c[0]&&E==1&&(x.s=F.s),x)},r.multipliedBy=r.times=function(x,R){var P,U,F,z,B,V,$,G,H,Z,te,ie,ce,Ee,he,ye=this,xe=ye.c,Xe=(x=new w(x,R)).c;if(!xe||!Xe||!xe[0]||!Xe[0])return!ye.s||!x.s||xe&&!xe[0]&&!Xe||Xe&&!Xe[0]&&!xe?x.c=x.e=x.s=null:(x.s*=ye.s,!xe||!Xe?x.c=x.e=null:(x.c=[0],x.e=0)),x;for(U=_n(ye.e/we)+_n(x.e/we),x.s*=ye.s,$=xe.length,Z=Xe.length,$<Z&&(ce=xe,xe=Xe,Xe=ce,F=$,$=Z,Z=F),F=$+Z,ce=[];F--;ce.push(0));for(Ee=kn,he=Li,F=Z;--F>=0;){for(P=0,te=Xe[F]%he,ie=Xe[F]/he|0,B=$,z=F+B;z>F;)G=xe[--B]%he,H=xe[B]/he|0,V=ie*G+H*te,G=te*G+V%he*he+ce[z]+P,P=(G/Ee|0)+(V/he|0)+ie*H,ce[z--]=G%Ee;ce[z]=P}return P?++U:ce.splice(0,1),D(x,ce,U)},r.negated=function(){var x=new w(this);return x.s=-x.s||null,x},r.plus=function(x,R){var P,U=this,F=U.s;if(x=new w(x,R),R=x.s,!F||!R)return new w(NaN);if(F!=R)return x.s=-R,U.minus(x);var z=U.e/we,B=x.e/we,V=U.c,$=x.c;if(!z||!B){if(!V||!$)return new w(F/0);if(!V[0]||!$[0])return $[0]?x:new w(V[0]?U:F*0)}if(z=_n(z),B=_n(B),V=V.slice(),F=z-B){for(F>0?(B=z,P=$):(F=-F,P=V),P.reverse();F--;P.push(0));P.reverse()}for(F=V.length,R=$.length,F-R<0&&(P=$,$=V,V=P,R=F),F=0;R;)F=(V[--R]=V[R]+$[R]+F)/kn|0,V[R]=kn===V[R]?0:V[R]%kn;return F&&(V=[F].concat(V),++B),D(x,V,B)},r.precision=r.sd=function(x,R){var P,U,F,z=this;if(x!=null&&x!==!!x)return Qe(x,1,yt),R==null?R=u:Qe(R,0,8),W(new w(z),x,R);if(!(P=z.c))return null;if(F=P.length-1,U=F*we+1,F=P[F]){for(;F%10==0;F/=10,U--);for(F=P[0];F>=10;F/=10,U++);}return x&&z.e+1>U&&(U=z.e+1),U},r.shiftedBy=function(x){return Qe(x,-yd,yd),this.times("1e"+x)},r.squareRoot=r.sqrt=function(){var x,R,P,U,F,z=this,B=z.c,V=z.s,$=z.e,G=l+4,H=new w("0.5");if(V!==1||!B||!B[0])return new w(!V||V<0&&(!B||B[0])?NaN:B?z:1/0);if(V=Math.sqrt(+K(z)),V==0||V==1/0?(R=gn(B),(R.length+$)%2==0&&(R+="0"),V=Math.sqrt(+R),$=_n(($+1)/2)-($<0||$%2),V==1/0?R="5e"+$:(R=V.toExponential(),R=R.slice(0,R.indexOf("e")+1)+$),P=new w(R)):P=new w(V+""),P.c[0]){for($=P.e,V=$+G,V<3&&(V=0);;)if(F=P,P=H.times(F.plus(e(z,F,G,1))),gn(F.c).slice(0,V)===(R=gn(P.c)).slice(0,V))if(P.e<$&&--V,R=R.slice(V-3,V+1),R=="9999"||!U&&R=="4999"){if(!U&&(W(F,F.e+l+2,0),F.times(F).eq(z))){P=F;break}G+=4,V+=4,U=1}else{(!+R||!+R.slice(1)&&R.charAt(0)=="5")&&(W(P,P.e+l+2,1),x=!P.times(P).eq(z));break}}return W(P,P.e+l+1,u,x)},r.toExponential=function(x,R){return x!=null&&(Qe(x,0,yt),x++),A(this,x,R,1)},r.toFixed=function(x,R){return x!=null&&(Qe(x,0,yt),x=x+this.e+1),A(this,x,R)},r.toFormat=function(x,R,P){var U,F=this;if(P==null)x!=null&&R&&typeof R=="object"?(P=R,R=null):x&&typeof x=="object"?(P=x,x=R=null):P=k;else if(typeof P!="object")throw Error(jt+"Argument not an object: "+P);if(U=F.toFixed(x,R),F.c){var z,B=U.split("."),V=+P.groupSize,$=+P.secondaryGroupSize,G=P.groupSeparator||"",H=B[0],Z=B[1],te=F.s<0,ie=te?H.slice(1):H,ce=ie.length;if($&&(z=V,V=$,$=z,ce-=z),V>0&&ce>0){for(z=ce%V||V,H=ie.substr(0,z);z<ce;z+=V)H+=G+ie.substr(z,V);$>0&&(H+=G+ie.slice(z)),te&&(H="-"+H)}U=Z?H+(P.decimalSeparator||"")+(($=+P.fractionGroupSize)?Z.replace(new RegExp("\\d{"+$+"}\\B","g"),"$&"+(P.fractionGroupSeparator||"")):Z):H}return(P.prefix||"")+U+(P.suffix||"")},r.toFraction=function(x){var R,P,U,F,z,B,V,$,G,H,Z,te,ie=this,ce=ie.c;if(x!=null&&(V=new w(x),!V.isInteger()&&(V.c||V.s!==1)||V.lt(s)))throw Error(jt+"Argument "+(V.isInteger()?"out of range: ":"not an integer: ")+K(V));if(!ce)return new w(ie);for(R=new w(s),G=P=new w(s),U=$=new w(s),te=gn(ce),z=R.e=te.length-ie.e-1,R.c[0]=vd[(B=z%we)<0?we+B:B],x=!x||V.comparedTo(R)>0?z>0?R:G:V,B=_,_=1/0,V=new w(te),$.c[0]=0;H=e(V,R,0,1),F=P.plus(H.times(U)),F.comparedTo(x)!=1;)P=U,U=F,G=$.plus(H.times(F=G)),$=F,R=V.minus(H.times(F=R)),V=F;return F=e(x.minus(P),U,0,1),$=$.plus(F.times(G)),P=P.plus(F.times(U)),$.s=G.s=ie.s,z=z*2,Z=e(G,U,z,u).minus(ie).abs().comparedTo(e($,P,z,u).minus(ie).abs())<1?[G,U]:[$,P],_=B,Z},r.toNumber=function(){return+K(this)},r.toPrecision=function(x,R){return x!=null&&Qe(x,1,yt),A(this,x,R,2)},r.toString=function(x){var R,P=this,U=P.s,F=P.e;return F===null?U?(R="Infinity",U<0&&(R="-"+R)):R="NaN":(x==null?R=F<=f||F>=d?gu(gn(P.c),F):hi(gn(P.c),F,"0"):x===10&&b?(P=W(new w(P),l+F+1,u),R=hi(gn(P.c),P.e,"0")):(Qe(x,2,M.length,"Base"),R=n(hi(gn(P.c),F,"0"),10,x,U,!0)),U<0&&P.c[0]&&(R="-"+R)),R},r.valueOf=r.toJSON=function(){return K(this)},r._isBigNumber=!0,r[Symbol.toStringTag]="BigNumber",r[Symbol.for("nodejs.util.inspect.custom")]=r.valueOf,t!=null&&w.set(t),w}function _n(t){var e=t|0;return t>0||t===e?e:e-1}function gn(t){for(var e,n,i=1,r=t.length,s=t[0]+"";i<r;){for(e=t[i++]+"",n=we-e.length;n--;e="0"+e);s+=e}for(r=s.length;s.charCodeAt(--r)===48;);return s.slice(0,r+1||1)}function Sr(t,e){var n,i,r=t.c,s=e.c,l=t.s,u=e.s,f=t.e,d=e.e;if(!l||!u)return null;if(n=r&&!r[0],i=s&&!s[0],n||i)return n?i?0:-u:l;if(l!=u)return l;if(n=l<0,i=f==d,!r||!s)return i?0:!r^n?1:-1;if(!i)return f>d^n?1:-1;for(u=(f=r.length)<(d=s.length)?f:d,l=0;l<u;l++)if(r[l]!=s[l])return r[l]>s[l]^n?1:-1;return f==d?0:f>d^n?1:-1}function Qe(t,e,n,i){if(t<e||t>n||t!==pn(t))throw Error(jt+(i||"Argument")+(typeof t=="number"?t<e||t>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function du(t){var e=t.c.length-1;return _n(t.e/we)==e&&t.c[e]%2!=0}function gu(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function hi(t,e,n){var i,r;if(e<0){for(r=n+".";++e;r+=n);t=r+t}else if(i=t.length,++e>i){for(r=n,e-=i;--e;r+=n);t+=r}else e<i&&(t=t.slice(0,e)+"."+t.slice(e));return t}var ti=TA(),u8=class{constructor(t){C(this,"key");C(this,"left",null);C(this,"right",null);this.key=t}},jo=class extends u8{constructor(t){super(t)}},c8=class{constructor(){C(this,"size",0);C(this,"modificationCount",0);C(this,"splayCount",0)}splay(t){const e=this.root;if(e==null)return this.compare(t,t),-1;let n=null,i=null,r=null,s=null,l=e;const u=this.compare;let f;for(;;)if(f=u(l.key,t),f>0){let d=l.left;if(d==null||(f=u(d.key,t),f>0&&(l.left=d.right,d.right=l,l=d,d=l.left,d==null)))break;n==null?i=l:n.left=l,n=l,l=d}else if(f<0){let d=l.right;if(d==null||(f=u(d.key,t),f<0&&(l.right=d.left,d.left=l,l=d,d=l.right,d==null)))break;r==null?s=l:r.right=l,r=l,l=d}else break;return r!=null&&(r.right=l.left,l.left=s),n!=null&&(n.left=l.right,l.right=i),this.root!==l&&(this.root=l,this.splayCount++),f}splayMin(t){let e=t,n=e.left;for(;n!=null;){const i=n;e.left=i.right,i.right=e,e=i,n=e.left}return e}splayMax(t){let e=t,n=e.right;for(;n!=null;){const i=n;e.right=i.left,i.left=e,e=i,n=e.right}return e}_delete(t){if(this.root==null||this.splay(t)!=0)return null;let n=this.root;const i=n,r=n.left;if(this.size--,r==null)this.root=n.right;else{const s=n.right;n=this.splayMax(r),n.right=s,this.root=n}return this.modificationCount++,i}addNewRoot(t,e){this.size++,this.modificationCount++;const n=this.root;if(n==null){this.root=t;return}e<0?(t.left=n,t.right=n.right,n.right=null):(t.right=n,t.left=n.left,n.left=null),this.root=t}_first(){const t=this.root;return t==null?null:(this.root=this.splayMin(t),this.root)}_last(){const t=this.root;return t==null?null:(this.root=this.splayMax(t),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(t){return this.validKey(t)&&this.splay(t)==0}defaultCompare(){return(t,e)=>t<e?-1:t>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:t=>{this.root=t},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:t=>{this.splayCount=t},splay:t=>this.splay(t),has:t=>this.has(t)}}},H8,Ki,Hc=(Ki=class extends c8{constructor(n,i){super();C(this,"root",null);C(this,"compare");C(this,"validKey");C(this,H8,"[object Set]");this.compare=n??this.defaultCompare(),this.validKey=i??(r=>r!=null&&r!=null)}delete(n){return this.validKey(n)?this._delete(n)!=null:!1}deleteAll(n){for(const i of n)this.delete(i)}forEach(n){const i=this[Symbol.iterator]();let r;for(;r=i.next(),!r.done;)n(r.value,r.value,this)}add(n){const i=this.splay(n);return i!=0&&this.addNewRoot(new jo(n),i),this}addAndReturn(n){const i=this.splay(n);return i!=0&&this.addNewRoot(new jo(n),i),this.root.key}addAll(n){for(const i of n)this.add(i)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(n){if(n==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(n)<0)return this.root.key;let r=this.root.left;if(r==null)return null;let s=r.right;for(;s!=null;)r=s,s=r.right;return r.key}firstAfter(n){if(n==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(n)>0)return this.root.key;let r=this.root.right;if(r==null)return null;let s=r.left;for(;s!=null;)r=s,s=r.left;return r.key}retainAll(n){const i=new Ki(this.compare,this.validKey),r=this.modificationCount;for(const s of n){if(r!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(s)&&this.splay(s)==0&&i.add(this.root.key)}i.size!=this.size&&(this.root=i.root,this.size=i.size,this.modificationCount++)}lookup(n){return!this.validKey(n)||this.splay(n)!=0?null:this.root.key}intersection(n){const i=new Ki(this.compare,this.validKey);for(const r of this)n.has(r)&&i.add(r);return i}difference(n){const i=new Ki(this.compare,this.validKey);for(const r of this)n.has(r)||i.add(r);return i}union(n){const i=this.clone();return i.addAll(n),i}clone(){const n=new Ki(this.compare,this.validKey);return n.size=this.size,n.root=this.copyNode(this.root),n}copyNode(n){if(n==null)return null;function i(s,l){let u,f;do{if(u=s.left,f=s.right,u!=null){const d=new jo(u.key);l.left=d,i(u,d)}if(f!=null){const d=new jo(f.key);l.right=d,s=f,l=d}}while(f!=null)}const r=new jo(n.key);return i(n,r),r}toSet(){return this.clone()}entries(){return new f8(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new h8(this.wrap())}},H8=Symbol.toStringTag,Ki),SA=class{constructor(t){C(this,"tree");C(this,"path",new Array);C(this,"modificationCount",null);C(this,"splayCount");this.tree=t,this.splayCount=t.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const t=this.path[this.path.length-1];return this.getValue(t)}rebuildPath(t){this.path.splice(0,this.path.length),this.tree.splay(t),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(t){for(;t!=null;)this.path.push(t),t=t.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let n=this.tree.getRoot();for(;n!=null;)this.path.push(n),n=n.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let t=this.path[this.path.length-1],e=t.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===t;)t=this.path.pop();return this.path.length>0}},h8=class extends SA{getValue(t){return t.key}},f8=class extends SA{getValue(t){return[t.key,t.key]}},xA=t=>()=>t,gp=t=>{const e=t?(n,i)=>i.minus(n).abs().isLessThanOrEqualTo(t):xA(!1);return(n,i)=>e(n,i)?0:n.comparedTo(i)};function d8(t){const e=t?(n,i,r,s,l)=>n.exponentiatedBy(2).isLessThanOrEqualTo(s.minus(i).exponentiatedBy(2).plus(l.minus(r).exponentiatedBy(2)).times(t)):xA(!1);return(n,i,r)=>{const s=n.x,l=n.y,u=r.x,f=r.y,d=l.minus(f).times(i.x.minus(u)).minus(s.minus(u).times(i.y.minus(f)));return e(d,s,l,u,f)?0:d.comparedTo(0)}}var g8=t=>t,p8=t=>{if(t){const e=new Hc(gp(t)),n=new Hc(gp(t)),i=(s,l)=>l.addAndReturn(s),r=s=>({x:i(s.x,e),y:i(s.y,n)});return r({x:new ti(0),y:new ti(0)}),r}return g8},pp=t=>({set:e=>{Ai=pp(e)},reset:()=>pp(t),compare:gp(t),snap:p8(t),orient:d8(t)}),Ai=pp(),$o=(t,e)=>t.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(t.ur.x)&&t.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(t.ur.y),_p=(t,e)=>{if(e.ur.x.isLessThan(t.ll.x)||t.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(t.ll.y)||t.ur.y.isLessThan(e.ll.y))return null;const n=t.ll.x.isLessThan(e.ll.x)?e.ll.x:t.ll.x,i=t.ur.x.isLessThan(e.ur.x)?t.ur.x:e.ur.x,r=t.ll.y.isLessThan(e.ll.y)?e.ll.y:t.ll.y,s=t.ur.y.isLessThan(e.ur.y)?t.ur.y:e.ur.y;return{ll:{x:n,y:r},ur:{x:i,y:s}}},Bu=(t,e)=>t.x.times(e.y).minus(t.y.times(e.x)),AA=(t,e)=>t.x.times(e.x).plus(t.y.times(e.y)),jc=t=>AA(t,t).sqrt(),_8=(t,e,n)=>{const i={x:e.x.minus(t.x),y:e.y.minus(t.y)},r={x:n.x.minus(t.x),y:n.y.minus(t.y)};return Bu(r,i).div(jc(r)).div(jc(i))},m8=(t,e,n)=>{const i={x:e.x.minus(t.x),y:e.y.minus(t.y)},r={x:n.x.minus(t.x),y:n.y.minus(t.y)};return AA(r,i).div(jc(r)).div(jc(i))},oE=(t,e,n)=>e.y.isZero()?null:{x:t.x.plus(e.x.div(e.y).times(n.minus(t.y))),y:n},aE=(t,e,n)=>e.x.isZero()?null:{x:n,y:t.y.plus(e.y.div(e.x).times(n.minus(t.x)))},y8=(t,e,n,i)=>{if(e.x.isZero())return aE(n,i,t.x);if(i.x.isZero())return aE(t,e,n.x);if(e.y.isZero())return oE(n,i,t.y);if(i.y.isZero())return oE(t,e,n.y);const r=Bu(e,i);if(r.isZero())return null;const s={x:n.x.minus(t.x),y:n.y.minus(t.y)},l=Bu(s,e).div(r),u=Bu(s,i).div(r),f=t.x.plus(u.times(e.x)),d=n.x.plus(l.times(i.x)),p=t.y.plus(u.times(e.y)),_=n.y.plus(l.times(i.y)),y=f.plus(d).div(2),E=p.plus(_).div(2);return{x:y,y:E}},Gn=class bA{constructor(e,n){C(this,"point");C(this,"isLeft");C(this,"segment");C(this,"otherSE");C(this,"consumedBy");e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}static compare(e,n){const i=bA.comparePoints(e.point,n.point);return i!==0?i:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:$c.compare(e.segment,n.segment))}static comparePoints(e,n){return e.x.isLessThan(n.x)?-1:e.x.isGreaterThan(n.x)?1:e.y.isLessThan(n.y)?-1:e.y.isGreaterThan(n.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const n=e.point.events;for(let i=0,r=n.length;i<r;i++){const s=n[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let n=0;n<e;n++){const i=this.point.events[n];if(i.segment.consumedBy===void 0)for(let r=n+1;r<e;r++){const s=this.point.events[r];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}getAvailableLinkedEvents(){const e=[];for(let n=0,i=this.point.events.length;n<i;n++){const r=this.point.events[n];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}getLeftmostComparator(e){const n=new Map,i=r=>{const s=r.otherSE;n.set(r,{sine:_8(this.point,e.point,s.point),cosine:m8(this.point,e.point,s.point)})};return(r,s)=>{n.has(r)||i(r),n.has(s)||i(s);const{sine:l,cosine:u}=n.get(r),{sine:f,cosine:d}=n.get(s);return l.isGreaterThanOrEqualTo(0)&&f.isGreaterThanOrEqualTo(0)?u.isLessThan(d)?1:u.isGreaterThan(d)?-1:0:l.isLessThan(0)&&f.isLessThan(0)?u.isLessThan(d)?-1:u.isGreaterThan(d)?1:0:f.isLessThan(l)?-1:f.isGreaterThan(l)?1:0}}},v8=class mp{constructor(e){C(this,"events");C(this,"poly");C(this,"_isExteriorRing");C(this,"_enclosingRing");this.events=e;for(let n=0,i=e.length;n<i;n++)e[n].segment.ringOut=this;this.poly=null}static factory(e){const n=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];if(!s.isInResult()||s.ringOut)continue;let l=null,u=s.leftSE,f=s.rightSE;const d=[u],p=u.point,_=[];for(;l=u,u=f,d.push(u),u.point!==p;)for(;;){const y=u.getAvailableLinkedEvents();if(y.length===0){const k=d[0].point,M=d[d.length-1].point;throw new Error(`Unable to complete output ring starting at [${k.x}, ${k.y}]. Last matching segment found ends at [${M.x}, ${M.y}].`)}if(y.length===1){f=y[0].otherSE;break}let E=null;for(let k=0,M=_.length;k<M;k++)if(_[k].point===u.point){E=k;break}if(E!==null){const k=_.splice(E)[0],M=d.splice(k.index);M.unshift(M[0].otherSE),n.push(new mp(M.reverse()));continue}_.push({index:d.length,point:u.point});const T=u.getLeftmostComparator(l);f=y.sort(T)[0].otherSE;break}n.push(new mp(d))}return n}getGeom(){let e=this.events[0].point;const n=[e];for(let d=1,p=this.events.length-1;d<p;d++){const _=this.events[d].point,y=this.events[d+1].point;Ai.orient(_,e,y)!==0&&(n.push(_),e=_)}if(n.length===1)return null;const i=n[0],r=n[1];Ai.orient(i,e,r)===0&&n.shift(),n.push(n[0]);const s=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:n.length-1,u=this.isExteriorRing()?n.length:-1,f=[];for(let d=l;d!=u;d+=s)f.push([n[d].x.toNumber(),n[d].y.toNumber()]);return f}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var r,s;let e=this.events[0];for(let l=1,u=this.events.length;l<u;l++){const f=this.events[l];Gn.compare(e,f)>0&&(e=f)}let n=e.segment.prevInResult(),i=n?n.prevInResult():null;for(;;){if(!n)return null;if(!i)return n.ringOut;if(i.ringOut!==n.ringOut)return((r=i.ringOut)==null?void 0:r.enclosingRing())!==n.ringOut?n.ringOut:(s=n.ringOut)==null?void 0:s.enclosingRing();n=i.prevInResult(),i=n?n.prevInResult():null}}},lE=class{constructor(t){C(this,"exteriorRing");C(this,"interiorRings");this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=this.exteriorRing.getGeom();if(t===null)return null;const e=[t];for(let n=0,i=this.interiorRings.length;n<i;n++){const r=this.interiorRings[n].getGeom();r!==null&&e.push(r)}return e}},E8=class{constructor(t){C(this,"rings");C(this,"polys");this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,n=this.polys.length;e<n;e++){const i=this.polys[e].getGeom();i!==null&&t.push(i)}return t}_composePolys(t){var n;const e=[];for(let i=0,r=t.length;i<r;i++){const s=t[i];if(!s.poly)if(s.isExteriorRing())e.push(new lE(s));else{const l=s.enclosingRing();l!=null&&l.poly||e.push(new lE(l)),(n=l==null?void 0:l.poly)==null||n.addInterior(s)}}return e}},w8=class{constructor(t,e=$c.compare){C(this,"queue");C(this,"tree");C(this,"segments");this.queue=t,this.tree=new Hc(e),this.segments=[]}process(t){const e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.delete(t.otherSE):this.tree.delete(e),n;t.isLeft&&this.tree.add(e);let i=e,r=e;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do r=this.tree.firstAfter(r);while(r!=null&&r.consumedBy!=null);if(t.isLeft){let s=null;if(i){const u=i.getIntersection(e);if(u!==null&&(e.isAnEndpoint(u)||(s=u),!i.isAnEndpoint(u))){const f=this._splitSafely(i,u);for(let d=0,p=f.length;d<p;d++)n.push(f[d])}}let l=null;if(r){const u=r.getIntersection(e);if(u!==null&&(e.isAnEndpoint(u)||(l=u),!r.isAnEndpoint(u))){const f=this._splitSafely(r,u);for(let d=0,p=f.length;d<p;d++)n.push(f[d])}}if(s!==null||l!==null){let u=null;s===null?u=l:l===null?u=s:u=Gn.comparePoints(s,l)<=0?s:l,this.queue.delete(e.rightSE),n.push(e.rightSE);const f=e.split(u);for(let d=0,p=f.length;d<p;d++)n.push(f[d])}n.length>0?(this.tree.delete(e),n.push(t)):(this.segments.push(e),e.prev=i)}else{if(i&&r){const s=i.getIntersection(r);if(s!==null){if(!i.isAnEndpoint(s)){const l=this._splitSafely(i,s);for(let u=0,f=l.length;u<f;u++)n.push(l[u])}if(!r.isAnEndpoint(s)){const l=this._splitSafely(r,s);for(let u=0,f=l.length;u<f;u++)n.push(l[u])}}}this.tree.delete(e)}return n}_splitSafely(t,e){this.tree.delete(t);const n=t.rightSE;this.queue.delete(n);const i=t.split(e);return i.push(n),t.consumedBy===void 0&&this.tree.add(t),i}},T8=class{constructor(){C(this,"type");C(this,"numMultiPolys")}run(t,e,n){ra.type=t;const i=[new cE(e,!0)];for(let d=0,p=n.length;d<p;d++)i.push(new cE(n[d],!1));if(ra.numMultiPolys=i.length,ra.type==="difference"){const d=i[0];let p=1;for(;p<i.length;)_p(i[p].bbox,d.bbox)!==null?p++:i.splice(p,1)}if(ra.type==="intersection")for(let d=0,p=i.length;d<p;d++){const _=i[d];for(let y=d+1,E=i.length;y<E;y++)if(_p(_.bbox,i[y].bbox)===null)return[]}const r=new Hc(Gn.compare);for(let d=0,p=i.length;d<p;d++){const _=i[d].getSweepEvents();for(let y=0,E=_.length;y<E;y++)r.add(_[y])}const s=new w8(r);let l=null;for(r.size!=0&&(l=r.first(),r.delete(l));l;){const d=s.process(l);for(let p=0,_=d.length;p<_;p++){const y=d[p];y.consumedBy===void 0&&r.add(y)}r.size!=0?(l=r.first(),r.delete(l)):l=null}Ai.reset();const u=v8.factory(s.segments);return new E8(u).getGeom()}},ra=new T8,yp=ra,S8=0,$c=class Uu{constructor(e,n,i,r){C(this,"id");C(this,"leftSE");C(this,"rightSE");C(this,"rings");C(this,"windings");C(this,"ringOut");C(this,"consumedBy");C(this,"prev");C(this,"_prevInResult");C(this,"_beforeState");C(this,"_afterState");C(this,"_isInResult");this.id=++S8,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=i,this.windings=r}static compare(e,n){const i=e.leftSE.point.x,r=n.leftSE.point.x,s=e.rightSE.point.x,l=n.rightSE.point.x;if(l.isLessThan(i))return 1;if(s.isLessThan(r))return-1;const u=e.leftSE.point.y,f=n.leftSE.point.y,d=e.rightSE.point.y,p=n.rightSE.point.y;if(i.isLessThan(r)){if(f.isLessThan(u)&&f.isLessThan(d))return 1;if(f.isGreaterThan(u)&&f.isGreaterThan(d))return-1;const _=e.comparePoint(n.leftSE.point);if(_<0)return 1;if(_>0)return-1;const y=n.comparePoint(e.rightSE.point);return y!==0?y:-1}if(i.isGreaterThan(r)){if(u.isLessThan(f)&&u.isLessThan(p))return-1;if(u.isGreaterThan(f)&&u.isGreaterThan(p))return 1;const _=n.comparePoint(e.leftSE.point);if(_!==0)return _;const y=e.comparePoint(n.rightSE.point);return y<0?1:y>0?-1:1}if(u.isLessThan(f))return-1;if(u.isGreaterThan(f))return 1;if(s.isLessThan(l)){const _=n.comparePoint(e.rightSE.point);if(_!==0)return _}if(s.isGreaterThan(l)){const _=e.comparePoint(n.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(!s.eq(l)){const _=d.minus(u),y=s.minus(i),E=p.minus(f),T=l.minus(r);if(_.isGreaterThan(y)&&E.isLessThan(T))return 1;if(_.isLessThan(y)&&E.isGreaterThan(T))return-1}return s.isGreaterThan(l)?1:s.isLessThan(l)||d.isLessThan(p)?-1:d.isGreaterThan(p)?1:e.id<n.id?-1:e.id>n.id?1:0}static fromRing(e,n,i){let r,s,l;const u=Gn.comparePoints(e,n);if(u<0)r=e,s=n,l=1;else if(u>0)r=n,s=e,l=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const f=new Gn(r,!0),d=new Gn(s,!1);return new Uu(f,d,[i],[l])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(n)?e:n},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(n)?e:n}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Ai.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const n=this.bbox(),i=e.bbox(),r=_p(n,i);if(r===null)return null;const s=this.leftSE.point,l=this.rightSE.point,u=e.leftSE.point,f=e.rightSE.point,d=$o(n,u)&&this.comparePoint(u)===0,p=$o(i,s)&&e.comparePoint(s)===0,_=$o(n,f)&&this.comparePoint(f)===0,y=$o(i,l)&&e.comparePoint(l)===0;if(p&&d)return y&&!_?l:!y&&_?f:null;if(p)return _&&s.x.eq(f.x)&&s.y.eq(f.y)?null:s;if(d)return y&&l.x.eq(u.x)&&l.y.eq(u.y)?null:u;if(y&&_)return null;if(y)return l;if(_)return f;const E=y8(s,this.vector(),u,e.vector());return E===null||!$o(r,E)?null:Ai.snap(E)}split(e){const n=[],i=e.events!==void 0,r=new Gn(e,!0),s=new Gn(e,!1),l=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(r);const u=new Uu(r,l,this.rings.slice(),this.windings.slice());return Gn.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),Gn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(r.checkForConsuming(),s.checkForConsuming()),n}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}consume(e){let n=this,i=e;for(;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const r=Uu.compare(n,i);if(r!==0){if(r>0){const s=n;n=i,i=s}if(n.prev===i){const s=n;n=i,i=s}for(let s=0,l=i.rings.length;s<l;s++){const u=i.rings[s],f=i.windings[s],d=n.rings.indexOf(u);d===-1?(n.rings.push(u),n.windings.push(f)):n.windings[d]+=f}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const n=this._afterState.rings,i=this._afterState.windings,r=this._afterState.multiPolys;for(let u=0,f=this.rings.length;u<f;u++){const d=this.rings[u],p=this.windings[u],_=n.indexOf(d);_===-1?(n.push(d),i.push(p)):i[_]+=p}const s=[],l=[];for(let u=0,f=n.length;u<f;u++){if(i[u]===0)continue;const d=n[u],p=d.poly;if(l.indexOf(p)===-1)if(d.isExterior)s.push(p);else{l.indexOf(p)===-1&&l.push(p);const _=s.indexOf(d.poly);_!==-1&&s.splice(_,1)}}for(let u=0,f=s.length;u<f;u++){const d=s[u].multiPoly;r.indexOf(d)===-1&&r.push(d)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(yp.type){case"union":{const i=e.length===0,r=n.length===0;this._isInResult=i!==r;break}case"intersection":{let i,r;e.length<n.length?(i=e.length,r=n.length):(i=n.length,r=e.length),this._isInResult=r===yp.numMultiPolys&&i<r;break}case"xor":{const i=Math.abs(e.length-n.length);this._isInResult=i%2===1;break}case"difference":{const i=r=>r.length===1&&r[0].isSubject;this._isInResult=i(e)!==i(n);break}}return this._isInResult}},uE=class{constructor(t,e,n){C(this,"poly");C(this,"isExterior");C(this,"segments");C(this,"bbox");if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=n,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Ai.snap({x:new ti(t[0][0]),y:new ti(t[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let r=i;for(let s=1,l=t.length;s<l;s++){if(typeof t[s][0]!="number"||typeof t[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const u=Ai.snap({x:new ti(t[s][0]),y:new ti(t[s][1])});u.x.eq(r.x)&&u.y.eq(r.y)||(this.segments.push($c.fromRing(r,u,this)),u.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=u.x),u.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=u.y),u.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=u.x),u.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=u.y),r=u)}(!i.x.eq(r.x)||!i.y.eq(r.y))&&this.segments.push($c.fromRing(r,i,this))}getSweepEvents(){const t=[];for(let e=0,n=this.segments.length;e<n;e++){const i=this.segments[e];t.push(i.leftSE),t.push(i.rightSE)}return t}},x8=class{constructor(t,e){C(this,"multiPoly");C(this,"exteriorRing");C(this,"interiorRings");C(this,"bbox");if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new uE(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=t.length;n<i;n++){const r=new uE(t[n],this,!1);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.interiorRings.push(r)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,n=this.interiorRings.length;e<n;e++){const i=this.interiorRings[e].getSweepEvents();for(let r=0,s=i.length;r<s;r++)t.push(i[r])}return t}},cE=class{constructor(t,e){C(this,"isSubject");C(this,"polys");C(this,"bbox");if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:new ti(Number.POSITIVE_INFINITY),y:new ti(Number.POSITIVE_INFINITY)},ur:{x:new ti(Number.NEGATIVE_INFINITY),y:new ti(Number.NEGATIVE_INFINITY)}};for(let n=0,i=t.length;n<i;n++){const r=new x8(t[n],this);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.polys.push(r)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,n=this.polys.length;e<n;e++){const i=this.polys[e].getSweepEvents();for(let r=0,s=i.length;r<s;r++)t.push(i[r])}return t}},A8=(t,...e)=>yp.run("difference",t,e);Ai.set;function b8(t,e){var n,i,r,s,l,u,f,d,p,_,y=0,E=t.type==="FeatureCollection",T=t.type==="Feature",k=E?t.features.length:1;for(n=0;n<k;n++){for(u=E?t.features[n].geometry:T?t.geometry:t,d=E?t.features[n].properties:T?t.properties:{},p=E?t.features[n].bbox:T?t.bbox:void 0,_=E?t.features[n].id:T?t.id:void 0,f=u?u.type==="GeometryCollection":!1,l=f?u.geometries.length:1,r=0;r<l;r++){if(s=f?u.geometries[r]:u,s===null){if(e(null,y,d,p,_)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(s,y,d,p,_)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<s.geometries.length;i++)if(e(s.geometries[i],y,d,p,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}y++}}function R8(t){const e=[];if(b8(t,r=>{e.push(r.coordinates)}),e.length<2)throw new Error("Must have at least two features");const n=t.features[0].properties||{},i=A8(e[0],...e.slice(1));return i.length===0?null:i.length===1?dz(i[0],n):gz(i,n)}/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C8=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),RA=(...t)=>t.filter((e,n,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===n).join(" ").trim();/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var k8={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I8=re.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:r="",children:s,iconNode:l,...u},f)=>re.createElement("svg",{ref:f,...k8,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:RA("lucide",r),...u},[...l.map(([d,p])=>re.createElement(d,p)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K_=(t,e)=>{const n=re.forwardRef(({className:i,...r},s)=>re.createElement(I8,{ref:s,iconNode:e,className:RA(`lucide-${C8(t)}`,i),...r}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P8=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],N8=K_("Check",P8);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M8=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],O8=K_("LoaderCircle",M8);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L8=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],D8=K_("X",L8),F8="https://raw.githubusercontent.com/keplergl/kepler.gl-data/master/nyctrips/data.csv",B8="https://data.cityofnewyork.us/resource/7jdm-inj8.geojson",U8="https://raw.githubusercontent.com/nycehs/NYC_geography/refs/heads/master/NTA.geo.json",z8={longitude:-73.99,latitude:40.75,zoom:11,pitch:0,bearing:0};function V8(){const[t,e]=re.useState([]),[n,i]=re.useState([]),[r,s]=re.useState(null),[l,u]=re.useState([]),[f,d]=re.useState(null),[p,_]=re.useState(0),[y,E]=re.useState(!0),[T,k]=re.useState(!1),[M,b]=re.useState(null);re.useEffect(()=>{async function x(){try{const U=(await(await fetch(F8)).text()).trim().split(`
`),F=U[0].split(","),z=F.indexOf("pickup_longitude"),B=F.indexOf("pickup_latitude"),V=F.indexOf("dropoff_longitude"),$=F.indexOf("dropoff_latitude"),G=[];for(let H=1;H<U.length;H++){const Z=U[H].split(",");if(Z.length<F.length)continue;const te=parseFloat(Z[z]),ie=parseFloat(Z[B]),ce=parseFloat(Z[V]),Ee=parseFloat(Z[$]);Math.abs(te)<1||Math.abs(ie)<1||Math.abs(ce)<1||Math.abs(Ee)<1||G.push({pickup:[te,ie],dropoff:[ce,Ee]})}e(G)}catch(R){console.error("Error loading taxi data:",R)}}x()},[]),re.useEffect(()=>{async function x(){try{const P=await(await fetch(B8)).json();s(P)}catch(R){console.error("Error loading BIDs:",R)}}x()},[]),re.useEffect(()=>{async function x(){try{const U=(await(await fetch(U8)).json()).features.filter(F=>{var B,V;if(((B=F.properties)==null?void 0:B.BoroName)!=="Manhattan")return!1;const z=(V=F.geometry)==null?void 0:V.type;return z==="Polygon"||z==="MultiPolygon"});u(U)}catch(R){console.error("Error loading Manhattan boundary:",R)}}x()},[]),re.useEffect(()=>{if(y||l.length===0){i(t);return}const x=t.filter(R=>{const P=ta(R.pickup),U=ta(R.dropoff),F=l.some(B=>au(P,B)),z=l.some(B=>au(U,B));return!(F||z)});i(x)},[t,l,y]),re.useEffect(()=>{if(!r){d(null);return}let x=r.features.map(R=>{var P,U;if(((P=R.geometry)==null?void 0:P.type)!=="Polygon"&&((U=R.geometry)==null?void 0:U.type)!=="MultiPolygon")return null;if(p>0)try{return o8(R,p,{units:"meters"})}catch{return null}return R});if(x=x.filter(Boolean),!y&&l.length>0)for(const R of l){const P=[];for(const U of x)try{const F=R8(U,R);F&&P.push(F)}catch(F){console.warn("Difference error, skipping feature:",F),P.push(U)}x=P}d(Ka(x))},[r,l,y,p]);async function w(){if(!f||n.length===0)return;k(!0),await new Promise(z=>setTimeout(z,0));const x=performance.now();let R=0,P=0;const U=f.features;for(const z of n){const B=ta(z.pickup),V=ta(z.dropoff);U.some(H=>au(B,H))&&R++,U.some(H=>au(V,H))&&P++}const F=performance.now();b({totalTrips:n.length,pickupInBID:R,dropoffInBID:P,elapsedMs:F-x}),k(!1)}const A=new C1({id:"bids-layer",data:f||void 0,filled:!0,stroked:!0,getLineColor:[255,0,255],getFillColor:[255,0,255,60],lineWidthMinPixels:1}),N=!y&&l.length?new C1({id:"manhattan-layer",data:Ka(l),filled:!0,stroked:!0,getLineColor:[150,0,0],getFillColor:[150,0,0,70],lineWidthMinPixels:2}):null,D=new np({id:"pickup-layer",data:n,getPosition:x=>x.pickup,getFillColor:[255,0,0],radiusScale:30,radiusMinPixels:1}),W=new np({id:"dropoff-layer",data:n,getPosition:x=>x.dropoff,getFillColor:[0,255,0],radiusScale:30,radiusMinPixels:1}),K=[A,N,D,W].filter(Boolean);return Ce.createElement("div",{className:"relative w-full h-full"},Ce.createElement("div",{className:"absolute top-4 left-4 z-50 bg-white shadow-lg rounded-lg p-4 w-80 space-y-4"},Ce.createElement("h1",{className:"text-lg font-bold text-gray-700 flex items-center gap-2"},"Taxi Rides vs BIDs"),Ce.createElement("div",{className:"flex flex-col space-y-1"},Ce.createElement("label",{className:"text-sm text-gray-600 font-medium"},"Buffer distance (meters)"),Ce.createElement("input",{type:"range",min:0,max:300,step:10,value:p,onChange:x=>_(Number(x.target.value)),className:"accent-pink-500"}),Ce.createElement("span",{className:"text-sm text-gray-800"},p," m")),Ce.createElement("div",{className:"flex items-center space-x-4"},Ce.createElement("button",{onClick:()=>E(!y),className:"flex items-center gap-2 px-3 py-2 rounded-md border border-pink-400 text-pink-500 hover:bg-pink-50 transition-colors"},y?Ce.createElement(Ce.Fragment,null,Ce.createElement(N8,{className:"w-4 h-4"}),Ce.createElement("span",null,"Manhattan")):Ce.createElement(Ce.Fragment,null,Ce.createElement(D8,{className:"w-4 h-4"}),Ce.createElement("span",null,"Manhattan"))),Ce.createElement("button",{onClick:w,disabled:!f||!n.length,className:"flex items-center justify-center gap-2 px-3 py-2 bg-pink-500 text-white rounded-md disabled:bg-gray-300"},T?Ce.createElement(Ce.Fragment,null,Ce.createElement(O8,{className:"animate-spin w-5 h-5"}),Ce.createElement("span",null,"Computing...")):Ce.createElement("span",null,"Intersect"))),M&&!T&&Ce.createElement("div",{className:"border-t border-gray-200 pt-2 mt-2 text-sm text-gray-800 space-y-1"},Ce.createElement("div",null,Ce.createElement("b",null,"Total Trips:")," ",M.totalTrips),Ce.createElement("div",null,Ce.createElement("b",null,"Pickup in BIDs:")," ",(M.pickupInBID/M.totalTrips*100).toFixed(1),"%"),Ce.createElement("div",null,Ce.createElement("b",null,"Dropoff in BIDs:")," ",(M.dropoffInBID/M.totalTrips*100).toFixed(1),"%"),Ce.createElement("div",null,Ce.createElement("b",null,"Time:")," ",M.elapsedMs.toFixed(0)," ms"))),Ce.createElement(VU,{initialViewState:z8,controller:!0,layers:K,style:{width:"100%",height:"100%"}},Ce.createElement(fz,{reuseMaps:!0,mapStyle:"https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json"})))}function W8(t){t&&TT(t).render(Ce.createElement(V8,null))}W8(document.getElementById("app"));export{Db as c,vp as g};
